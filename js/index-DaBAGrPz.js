var VW=Object.defineProperty;var YW=(n,e,t)=>e in n?VW(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var G=(n,e,t)=>YW(n,typeof e!="symbol"?e+"":e,t);function XW(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();var cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function lC(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var $S={exports:{}},wf={},HS={exports:{}},jt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sk;function ZW(){if(Sk)return jt;Sk=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),o=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function g($){return $===null||typeof $!="object"?null:($=f&&$[f]||$["@@iterator"],typeof $=="function"?$:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,w={};function S($,C,R){this.props=$,this.context=C,this.refs=w,this.updater=R||m}S.prototype.isReactComponent={},S.prototype.setState=function($,C){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,C,"setState")},S.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function b(){}b.prototype=S.prototype;function x($,C,R){this.props=$,this.context=C,this.refs=w,this.updater=R||m}var E=x.prototype=new b;E.constructor=x,v(E,S.prototype),E.isPureReactComponent=!0;var M=Array.isArray,j=Object.prototype.hasOwnProperty,D={current:null},H={key:!0,ref:!0,__self:!0,__source:!0};function L($,C,R){var Z,J={},oe=null,ue=null;if(C!=null)for(Z in C.ref!==void 0&&(ue=C.ref),C.key!==void 0&&(oe=""+C.key),C)j.call(C,Z)&&!H.hasOwnProperty(Z)&&(J[Z]=C[Z]);var fe=arguments.length-2;if(fe===1)J.children=R;else if(1<fe){for(var _e=Array(fe),Le=0;Le<fe;Le++)_e[Le]=arguments[Le+2];J.children=_e}if($&&$.defaultProps)for(Z in fe=$.defaultProps,fe)J[Z]===void 0&&(J[Z]=fe[Z]);return{$$typeof:n,type:$,key:oe,ref:ue,props:J,_owner:D.current}}function U($,C){return{$$typeof:n,type:$.type,key:C,ref:$.ref,props:$.props,_owner:$._owner}}function z($){return typeof $=="object"&&$!==null&&$.$$typeof===n}function Y($){var C={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(R){return C[R]})}var V=/\/+/g;function N($,C){return typeof $=="object"&&$!==null&&$.key!=null?Y(""+$.key):C.toString(36)}function _($,C,R,Z,J){var oe=typeof $;(oe==="undefined"||oe==="boolean")&&($=null);var ue=!1;if($===null)ue=!0;else switch(oe){case"string":case"number":ue=!0;break;case"object":switch($.$$typeof){case n:case e:ue=!0}}if(ue)return ue=$,J=J(ue),$=Z===""?"."+N(ue,0):Z,M(J)?(R="",$!=null&&(R=$.replace(V,"$&/")+"/"),_(J,C,R,"",function(Le){return Le})):J!=null&&(z(J)&&(J=U(J,R+(!J.key||ue&&ue.key===J.key?"":(""+J.key).replace(V,"$&/")+"/")+$)),C.push(J)),1;if(ue=0,Z=Z===""?".":Z+":",M($))for(var fe=0;fe<$.length;fe++){oe=$[fe];var _e=Z+N(oe,fe);ue+=_(oe,C,R,_e,J)}else if(_e=g($),typeof _e=="function")for($=_e.call($),fe=0;!(oe=$.next()).done;)oe=oe.value,_e=Z+N(oe,fe++),ue+=_(oe,C,R,_e,J);else if(oe==="object")throw C=String($),Error("Objects are not valid as a React child (found: "+(C==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":C)+"). If you meant to render a collection of children, use an array instead.");return ue}function k($,C,R){if($==null)return $;var Z=[],J=0;return _($,Z,"","",function(oe){return C.call(R,oe,J++)}),Z}function O($){if($._status===-1){var C=$._result;C=C(),C.then(function(R){($._status===0||$._status===-1)&&($._status=1,$._result=R)},function(R){($._status===0||$._status===-1)&&($._status=2,$._result=R)}),$._status===-1&&($._status=0,$._result=C)}if($._status===1)return $._result.default;throw $._result}var W={current:null},q={transition:null},X={ReactCurrentDispatcher:W,ReactCurrentBatchConfig:q,ReactCurrentOwner:D};function ne(){throw Error("act(...) is not supported in production builds of React.")}return jt.Children={map:k,forEach:function($,C,R){k($,function(){C.apply(this,arguments)},R)},count:function($){var C=0;return k($,function(){C++}),C},toArray:function($){return k($,function(C){return C})||[]},only:function($){if(!z($))throw Error("React.Children.only expected to receive a single React element child.");return $}},jt.Component=S,jt.Fragment=t,jt.Profiler=i,jt.PureComponent=x,jt.StrictMode=r,jt.Suspense=c,jt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,jt.act=ne,jt.cloneElement=function($,C,R){if($==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+$+".");var Z=v({},$.props),J=$.key,oe=$.ref,ue=$._owner;if(C!=null){if(C.ref!==void 0&&(oe=C.ref,ue=D.current),C.key!==void 0&&(J=""+C.key),$.type&&$.type.defaultProps)var fe=$.type.defaultProps;for(_e in C)j.call(C,_e)&&!H.hasOwnProperty(_e)&&(Z[_e]=C[_e]===void 0&&fe!==void 0?fe[_e]:C[_e])}var _e=arguments.length-2;if(_e===1)Z.children=R;else if(1<_e){fe=Array(_e);for(var Le=0;Le<_e;Le++)fe[Le]=arguments[Le+2];Z.children=fe}return{$$typeof:n,type:$.type,key:J,ref:oe,props:Z,_owner:ue}},jt.createContext=function($){return $={$$typeof:o,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},$.Provider={$$typeof:s,_context:$},$.Consumer=$},jt.createElement=L,jt.createFactory=function($){var C=L.bind(null,$);return C.type=$,C},jt.createRef=function(){return{current:null}},jt.forwardRef=function($){return{$$typeof:a,render:$}},jt.isValidElement=z,jt.lazy=function($){return{$$typeof:d,_payload:{_status:-1,_result:$},_init:O}},jt.memo=function($,C){return{$$typeof:u,type:$,compare:C===void 0?null:C}},jt.startTransition=function($){var C=q.transition;q.transition={};try{$()}finally{q.transition=C}},jt.unstable_act=ne,jt.useCallback=function($,C){return W.current.useCallback($,C)},jt.useContext=function($){return W.current.useContext($)},jt.useDebugValue=function(){},jt.useDeferredValue=function($){return W.current.useDeferredValue($)},jt.useEffect=function($,C){return W.current.useEffect($,C)},jt.useId=function(){return W.current.useId()},jt.useImperativeHandle=function($,C,R){return W.current.useImperativeHandle($,C,R)},jt.useInsertionEffect=function($,C){return W.current.useInsertionEffect($,C)},jt.useLayoutEffect=function($,C){return W.current.useLayoutEffect($,C)},jt.useMemo=function($,C){return W.current.useMemo($,C)},jt.useReducer=function($,C,R){return W.current.useReducer($,C,R)},jt.useRef=function($){return W.current.useRef($)},jt.useState=function($){return W.current.useState($)},jt.useSyncExternalStore=function($,C,R){return W.current.useSyncExternalStore($,C,R)},jt.useTransition=function(){return W.current.useTransition()},jt.version="18.3.1",jt}var xk;function uC(){return xk||(xk=1,HS.exports=ZW()),HS.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bk;function QW(){if(bk)return wf;bk=1;var n=uC(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function o(a,c,u){var d,f={},g=null,m=null;u!==void 0&&(g=""+u),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(m=c.ref);for(d in c)r.call(c,d)&&!s.hasOwnProperty(d)&&(f[d]=c[d]);if(a&&a.defaultProps)for(d in c=a.defaultProps,c)f[d]===void 0&&(f[d]=c[d]);return{$$typeof:e,type:a,key:g,ref:m,props:f,_owner:i.current}}return wf.Fragment=t,wf.jsx=o,wf.jsxs=o,wf}var _k;function JW(){return _k||(_k=1,$S.exports=QW()),$S.exports}var p=JW(),fm={},WS={exports:{}},Zi={},KS={exports:{}},qS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ik;function eK(){return Ik||(Ik=1,function(n){function e(q,X){var ne=q.length;q.push(X);e:for(;0<ne;){var $=ne-1>>>1,C=q[$];if(0<i(C,X))q[$]=X,q[ne]=C,ne=$;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var X=q[0],ne=q.pop();if(ne!==X){q[0]=ne;e:for(var $=0,C=q.length,R=C>>>1;$<R;){var Z=2*($+1)-1,J=q[Z],oe=Z+1,ue=q[oe];if(0>i(J,ne))oe<C&&0>i(ue,J)?(q[$]=ue,q[oe]=ne,$=oe):(q[$]=J,q[Z]=ne,$=Z);else if(oe<C&&0>i(ue,ne))q[$]=ue,q[oe]=ne,$=oe;else break e}}return X}function i(q,X){var ne=q.sortIndex-X.sortIndex;return ne!==0?ne:q.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();n.unstable_now=function(){return o.now()-a}}var c=[],u=[],d=1,f=null,g=3,m=!1,v=!1,w=!1,S=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(q){for(var X=t(u);X!==null;){if(X.callback===null)r(u);else if(X.startTime<=q)r(u),X.sortIndex=X.expirationTime,e(c,X);else break;X=t(u)}}function M(q){if(w=!1,E(q),!v)if(t(c)!==null)v=!0,O(j);else{var X=t(u);X!==null&&W(M,X.startTime-q)}}function j(q,X){v=!1,w&&(w=!1,b(L),L=-1),m=!0;var ne=g;try{for(E(X),f=t(c);f!==null&&(!(f.expirationTime>X)||q&&!Y());){var $=f.callback;if(typeof $=="function"){f.callback=null,g=f.priorityLevel;var C=$(f.expirationTime<=X);X=n.unstable_now(),typeof C=="function"?f.callback=C:f===t(c)&&r(c),E(X)}else r(c);f=t(c)}if(f!==null)var R=!0;else{var Z=t(u);Z!==null&&W(M,Z.startTime-X),R=!1}return R}finally{f=null,g=ne,m=!1}}var D=!1,H=null,L=-1,U=5,z=-1;function Y(){return!(n.unstable_now()-z<U)}function V(){if(H!==null){var q=n.unstable_now();z=q;var X=!0;try{X=H(!0,q)}finally{X?N():(D=!1,H=null)}}else D=!1}var N;if(typeof x=="function")N=function(){x(V)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,k=_.port2;_.port1.onmessage=V,N=function(){k.postMessage(null)}}else N=function(){S(V,0)};function O(q){H=q,D||(D=!0,N())}function W(q,X){L=S(function(){q(n.unstable_now())},X)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(q){q.callback=null},n.unstable_continueExecution=function(){v||m||(v=!0,O(j))},n.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<q?Math.floor(1e3/q):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(q){switch(g){case 1:case 2:case 3:var X=3;break;default:X=g}var ne=g;g=X;try{return q()}finally{g=ne}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(q,X){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ne=g;g=q;try{return X()}finally{g=ne}},n.unstable_scheduleCallback=function(q,X,ne){var $=n.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?$+ne:$):ne=$,q){case 1:var C=-1;break;case 2:C=250;break;case 5:C=1073741823;break;case 4:C=1e4;break;default:C=5e3}return C=ne+C,q={id:d++,callback:X,priorityLevel:q,startTime:ne,expirationTime:C,sortIndex:-1},ne>$?(q.sortIndex=ne,e(u,q),t(c)===null&&q===t(u)&&(w?(b(L),L=-1):w=!0,W(M,ne-$))):(q.sortIndex=C,e(c,q),v||m||(v=!0,O(j))),q},n.unstable_shouldYield=Y,n.unstable_wrapCallback=function(q){var X=g;return function(){var ne=g;g=X;try{return q.apply(this,arguments)}finally{g=ne}}}}(qS)),qS}var Ek;function tK(){return Ek||(Ek=1,KS.exports=eK()),KS.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ck;function nK(){if(Ck)return Zi;Ck=1;var n=uC(),e=tK();function t(l){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+l,y=1;y<arguments.length;y++)h+="&args[]="+encodeURIComponent(arguments[y]);return"Minified React error #"+l+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(l,h){o(l,h),o(l+"Capture",h)}function o(l,h){for(i[l]=h,l=0;l<h.length;l++)r.add(h[l])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function g(l){return c.call(f,l)?!0:c.call(d,l)?!1:u.test(l)?f[l]=!0:(d[l]=!0,!1)}function m(l,h,y,I){if(y!==null&&y.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return I?!1:y!==null?!y.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function v(l,h,y,I){if(h===null||typeof h>"u"||m(l,h,y,I))return!0;if(I)return!1;if(y!==null)switch(y.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function w(l,h,y,I,A,B,ee){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=I,this.attributeNamespace=A,this.mustUseProperty=y,this.propertyName=l,this.type=h,this.sanitizeURL=B,this.removeEmptyString=ee}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){S[l]=new w(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var h=l[0];S[h]=new w(h,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){S[l]=new w(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){S[l]=new w(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){S[l]=new w(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){S[l]=new w(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){S[l]=new w(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){S[l]=new w(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){S[l]=new w(l,5,!1,l.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function x(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var h=l.replace(b,x);S[h]=new w(h,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var h=l.replace(b,x);S[h]=new w(h,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var h=l.replace(b,x);S[h]=new w(h,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){S[l]=new w(l,1,!1,l.toLowerCase(),null,!1,!1)}),S.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){S[l]=new w(l,1,!1,l.toLowerCase(),null,!0,!0)});function E(l,h,y,I){var A=S.hasOwnProperty(h)?S[h]:null;(A!==null?A.type!==0:I||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(v(h,y,A,I)&&(y=null),I||A===null?g(h)&&(y===null?l.removeAttribute(h):l.setAttribute(h,""+y)):A.mustUseProperty?l[A.propertyName]=y===null?A.type===3?!1:"":y:(h=A.attributeName,I=A.attributeNamespace,y===null?l.removeAttribute(h):(A=A.type,y=A===3||A===4&&y===!0?"":""+y,I?l.setAttributeNS(I,h,y):l.setAttribute(h,y))))}var M=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j=Symbol.for("react.element"),D=Symbol.for("react.portal"),H=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),Y=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),_=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),O=Symbol.for("react.lazy"),W=Symbol.for("react.offscreen"),q=Symbol.iterator;function X(l){return l===null||typeof l!="object"?null:(l=q&&l[q]||l["@@iterator"],typeof l=="function"?l:null)}var ne=Object.assign,$;function C(l){if($===void 0)try{throw Error()}catch(y){var h=y.stack.trim().match(/\n( *(at )?)/);$=h&&h[1]||""}return`
`+$+l}var R=!1;function Z(l,h){if(!l||R)return"";R=!0;var y=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(be){var I=be}Reflect.construct(l,[],h)}else{try{h.call()}catch(be){I=be}l.call(h.prototype)}else{try{throw Error()}catch(be){I=be}l()}}catch(be){if(be&&I&&typeof be.stack=="string"){for(var A=be.stack.split(`
`),B=I.stack.split(`
`),ee=A.length-1,se=B.length-1;1<=ee&&0<=se&&A[ee]!==B[se];)se--;for(;1<=ee&&0<=se;ee--,se--)if(A[ee]!==B[se]){if(ee!==1||se!==1)do if(ee--,se--,0>se||A[ee]!==B[se]){var le=`
`+A[ee].replace(" at new "," at ");return l.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",l.displayName)),le}while(1<=ee&&0<=se);break}}}finally{R=!1,Error.prepareStackTrace=y}return(l=l?l.displayName||l.name:"")?C(l):""}function J(l){switch(l.tag){case 5:return C(l.type);case 16:return C("Lazy");case 13:return C("Suspense");case 19:return C("SuspenseList");case 0:case 2:case 15:return l=Z(l.type,!1),l;case 11:return l=Z(l.type.render,!1),l;case 1:return l=Z(l.type,!0),l;default:return""}}function oe(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case H:return"Fragment";case D:return"Portal";case U:return"Profiler";case L:return"StrictMode";case N:return"Suspense";case _:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case Y:return(l.displayName||"Context")+".Consumer";case z:return(l._context.displayName||"Context")+".Provider";case V:var h=l.render;return l=l.displayName,l||(l=h.displayName||h.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case k:return h=l.displayName||null,h!==null?h:oe(l.type)||"Memo";case O:h=l._payload,l=l._init;try{return oe(l(h))}catch{}}return null}function ue(l){var h=l.type;switch(l.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=h.render,l=l.displayName||l.name||"",h.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oe(h);case 8:return h===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function fe(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function _e(l){var h=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Le(l){var h=_e(l)?"checked":"value",y=Object.getOwnPropertyDescriptor(l.constructor.prototype,h),I=""+l[h];if(!l.hasOwnProperty(h)&&typeof y<"u"&&typeof y.get=="function"&&typeof y.set=="function"){var A=y.get,B=y.set;return Object.defineProperty(l,h,{configurable:!0,get:function(){return A.call(this)},set:function(ee){I=""+ee,B.call(this,ee)}}),Object.defineProperty(l,h,{enumerable:y.enumerable}),{getValue:function(){return I},setValue:function(ee){I=""+ee},stopTracking:function(){l._valueTracker=null,delete l[h]}}}}function Ne(l){l._valueTracker||(l._valueTracker=Le(l))}function Ze(l){if(!l)return!1;var h=l._valueTracker;if(!h)return!0;var y=h.getValue(),I="";return l&&(I=_e(l)?l.checked?"true":"false":l.value),l=I,l!==y?(h.setValue(l),!0):!1}function dt(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function et(l,h){var y=h.checked;return ne({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:y??l._wrapperState.initialChecked})}function Xe(l,h){var y=h.defaultValue==null?"":h.defaultValue,I=h.checked!=null?h.checked:h.defaultChecked;y=fe(h.value!=null?h.value:y),l._wrapperState={initialChecked:I,initialValue:y,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function Kt(l,h){h=h.checked,h!=null&&E(l,"checked",h,!1)}function _t(l,h){Kt(l,h);var y=fe(h.value),I=h.type;if(y!=null)I==="number"?(y===0&&l.value===""||l.value!=y)&&(l.value=""+y):l.value!==""+y&&(l.value=""+y);else if(I==="submit"||I==="reset"){l.removeAttribute("value");return}h.hasOwnProperty("value")?ur(l,h.type,y):h.hasOwnProperty("defaultValue")&&ur(l,h.type,fe(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(l.defaultChecked=!!h.defaultChecked)}function Ut(l,h,y){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var I=h.type;if(!(I!=="submit"&&I!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+l._wrapperState.initialValue,y||h===l.value||(l.value=h),l.defaultValue=h}y=l.name,y!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,y!==""&&(l.name=y)}function ur(l,h,y){(h!=="number"||dt(l.ownerDocument)!==l)&&(y==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+y&&(l.defaultValue=""+y))}var At=Array.isArray;function Et(l,h,y,I){if(l=l.options,h){h={};for(var A=0;A<y.length;A++)h["$"+y[A]]=!0;for(y=0;y<l.length;y++)A=h.hasOwnProperty("$"+l[y].value),l[y].selected!==A&&(l[y].selected=A),A&&I&&(l[y].defaultSelected=!0)}else{for(y=""+fe(y),h=null,A=0;A<l.length;A++){if(l[A].value===y){l[A].selected=!0,I&&(l[A].defaultSelected=!0);return}h!==null||l[A].disabled||(h=l[A])}h!==null&&(h.selected=!0)}}function On(l,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return ne({},h,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function qt(l,h){var y=h.value;if(y==null){if(y=h.children,h=h.defaultValue,y!=null){if(h!=null)throw Error(t(92));if(At(y)){if(1<y.length)throw Error(t(93));y=y[0]}h=y}h==null&&(h=""),y=h}l._wrapperState={initialValue:fe(y)}}function tn(l,h){var y=fe(h.value),I=fe(h.defaultValue);y!=null&&(y=""+y,y!==l.value&&(l.value=y),h.defaultValue==null&&l.defaultValue!==y&&(l.defaultValue=y)),I!=null&&(l.defaultValue=""+I)}function dr(l){var h=l.textContent;h===l._wrapperState.initialValue&&h!==""&&h!==null&&(l.value=h)}function nn(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function te(l,h){return l==null||l==="http://www.w3.org/1999/xhtml"?nn(h):l==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var F,K=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,y,I,A){MSApp.execUnsafeLocalFunction(function(){return l(h,y,I,A)})}:l}(function(l,h){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=h;else{for(F=F||document.createElement("div"),F.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=F.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;h.firstChild;)l.appendChild(h.firstChild)}});function Q(l,h){if(h){var y=l.firstChild;if(y&&y===l.lastChild&&y.nodeType===3){y.nodeValue=h;return}}l.textContent=h}var re={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ce=["Webkit","ms","Moz","O"];Object.keys(re).forEach(function(l){ce.forEach(function(h){h=h+l.charAt(0).toUpperCase()+l.substring(1),re[h]=re[l]})});function ye(l,h,y){return h==null||typeof h=="boolean"||h===""?"":y||typeof h!="number"||h===0||re.hasOwnProperty(l)&&re[l]?(""+h).trim():h+"px"}function ut(l,h){l=l.style;for(var y in h)if(h.hasOwnProperty(y)){var I=y.indexOf("--")===0,A=ye(y,h[y],I);y==="float"&&(y="cssFloat"),I?l.setProperty(y,A):l[y]=A}}var st=ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function at(l,h){if(h){if(st[l]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,l));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function Rt(l,h){if(l.indexOf("-")===-1)return typeof h.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qe=null;function $t(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var ii=null,Ht=null,rn=null;function Ma(l){if(l=nf(l)){if(typeof ii!="function")throw Error(t(280));var h=l.stateNode;h&&(h=Mg(h),ii(l.stateNode,l.type,h))}}function dn(l){Ht?rn?rn.push(l):rn=[l]:Ht=l}function vn(){if(Ht){var l=Ht,h=rn;if(rn=Ht=null,Ma(l),h)for(l=0;l<h.length;l++)Ma(h[l])}}function Ta(l,h){return l(h)}function Sn(){}var ln=!1;function jl(l,h,y){if(ln)return l(h,y);ln=!0;try{return Ta(l,h,y)}finally{ln=!1,(Ht!==null||rn!==null)&&(Sn(),vn())}}function mn(l,h){var y=l.stateNode;if(y===null)return null;var I=Mg(y);if(I===null)return null;y=I[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(I=!I.disabled)||(l=l.type,I=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!I;break e;default:l=!1}if(l)return null;if(y&&typeof y!="function")throw Error(t(231,h,typeof y));return y}var En=!1;if(a)try{var $o={};Object.defineProperty($o,"passive",{get:function(){En=!0}}),window.addEventListener("test",$o,$o),window.removeEventListener("test",$o,$o)}catch{En=!1}function Hn(l,h,y,I,A,B,ee,se,le){var be=Array.prototype.slice.call(arguments,3);try{h.apply(y,be)}catch(ke){this.onError(ke)}}var hn=!1,oo=null,Yt=!1,Cn=null,Zu={onError:function(l){hn=!0,oo=l}};function Wn(l,h,y,I,A,B,ee,se,le){hn=!1,oo=null,Hn.apply(Zu,arguments)}function Kn(l,h,y,I,A,B,ee,se,le){if(Wn.apply(this,arguments),hn){if(hn){var be=oo;hn=!1,oo=null}else throw Error(t(198));Yt||(Yt=!0,Cn=be)}}function Bs(l){var h=l,y=l;if(l.alternate)for(;h.return;)h=h.return;else{l=h;do h=l,h.flags&4098&&(y=h.return),l=h.return;while(l)}return h.tag===3?y:null}function Xt(l){if(l.tag===13){var h=l.memoizedState;if(h===null&&(l=l.alternate,l!==null&&(h=l.memoizedState)),h!==null)return h.dehydrated}return null}function Ln(l){if(Bs(l)!==l)throw Error(t(188))}function Dl(l){var h=l.alternate;if(!h){if(h=Bs(l),h===null)throw Error(t(188));return h!==l?null:l}for(var y=l,I=h;;){var A=y.return;if(A===null)break;var B=A.alternate;if(B===null){if(I=A.return,I!==null){y=I;continue}break}if(A.child===B.child){for(B=A.child;B;){if(B===y)return Ln(A),l;if(B===I)return Ln(A),h;B=B.sibling}throw Error(t(188))}if(y.return!==I.return)y=A,I=B;else{for(var ee=!1,se=A.child;se;){if(se===y){ee=!0,y=A,I=B;break}if(se===I){ee=!0,I=A,y=B;break}se=se.sibling}if(!ee){for(se=B.child;se;){if(se===y){ee=!0,y=B,I=A;break}if(se===I){ee=!0,I=B,y=A;break}se=se.sibling}if(!ee)throw Error(t(189))}}if(y.alternate!==I)throw Error(t(190))}if(y.tag!==3)throw Error(t(188));return y.stateNode.current===y?l:h}function xc(l){return l=Dl(l),l!==null?bc(l):null}function bc(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var h=bc(l);if(h!==null)return h;l=l.sibling}return null}var _c=e.unstable_scheduleCallback,Wi=e.unstable_cancelCallback,Ol=e.unstable_shouldYield,Ll=e.unstable_requestPaint,xn=e.unstable_now,Nl=e.unstable_getCurrentPriorityLevel,ka=e.unstable_ImmediatePriority,ao=e.unstable_UserBlockingPriority,Ho=e.unstable_NormalPriority,Bl=e.unstable_LowPriority,Ai=e.unstable_IdlePriority,Wo=null,si=null;function Fl(l){if(si&&typeof si.onCommitFiberRoot=="function")try{si.onCommitFiberRoot(Wo,l,void 0,(l.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:Qu,zl=Math.log,pv=Math.LN2;function Qu(l){return l>>>=0,l===0?32:31-(zl(l)/pv|0)|0}var Ju=64,Ko=4194304;function Ic(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function Ul(l,h){var y=l.pendingLanes;if(y===0)return 0;var I=0,A=l.suspendedLanes,B=l.pingedLanes,ee=y&268435455;if(ee!==0){var se=ee&~A;se!==0?I=Ic(se):(B&=ee,B!==0&&(I=Ic(B)))}else ee=y&~A,ee!==0?I=Ic(ee):B!==0&&(I=Ic(B));if(I===0)return 0;if(h!==0&&h!==I&&!(h&A)&&(A=I&-I,B=h&-h,A>=B||A===16&&(B&4194240)!==0))return h;if(I&4&&(I|=y&16),h=l.entangledLanes,h!==0)for(l=l.entanglements,h&=I;0<h;)y=31-Fr(h),A=1<<y,I|=l[y],h&=~A;return I}function gv(l,h){switch(l){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mv(l,h){for(var y=l.suspendedLanes,I=l.pingedLanes,A=l.expirationTimes,B=l.pendingLanes;0<B;){var ee=31-Fr(B),se=1<<ee,le=A[ee];le===-1?(!(se&y)||se&I)&&(A[ee]=gv(se,h)):le<=h&&(l.expiredLanes|=se),B&=~se}}function zh(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function pg(){var l=Ju;return Ju<<=1,!(Ju&4194240)&&(Ju=64),l}function ed(l){for(var h=[],y=0;31>y;y++)h.push(l);return h}function $l(l,h,y){l.pendingLanes|=h,h!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,h=31-Fr(h),l[h]=y}function yv(l,h){var y=l.pendingLanes&~h;l.pendingLanes=h,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=h,l.mutableReadLanes&=h,l.entangledLanes&=h,h=l.entanglements;var I=l.eventTimes;for(l=l.expirationTimes;0<y;){var A=31-Fr(y),B=1<<A;h[A]=0,I[A]=-1,l[A]=-1,y&=~B}}function td(l,h){var y=l.entangledLanes|=h;for(l=l.entanglements;y;){var I=31-Fr(y),A=1<<I;A&h|l[I]&h&&(l[I]|=h),y&=~A}}var Gt=0;function Aa(l){return l&=-l,1<l?4<l?l&268435455?16:536870912:4:1}var gg,Uh,co,mg,yg,$h=!1,nd=[],qo=null,oi=null,lo=null,Hl=new Map,Go=new Map,Vo=[],Hh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function wg(l,h){switch(l){case"focusin":case"focusout":qo=null;break;case"dragenter":case"dragleave":oi=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":Hl.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":Go.delete(h.pointerId)}}function Ec(l,h,y,I,A,B){return l===null||l.nativeEvent!==B?(l={blockedOn:h,domEventName:y,eventSystemFlags:I,nativeEvent:B,targetContainers:[A]},h!==null&&(h=nf(h),h!==null&&Uh(h)),l):(l.eventSystemFlags|=I,h=l.targetContainers,A!==null&&h.indexOf(A)===-1&&h.push(A),l)}function vg(l,h,y,I,A){switch(h){case"focusin":return qo=Ec(qo,l,h,y,I,A),!0;case"dragenter":return oi=Ec(oi,l,h,y,I,A),!0;case"mouseover":return lo=Ec(lo,l,h,y,I,A),!0;case"pointerover":var B=A.pointerId;return Hl.set(B,Ec(Hl.get(B)||null,l,h,y,I,A)),!0;case"gotpointercapture":return B=A.pointerId,Go.set(B,Ec(Go.get(B)||null,l,h,y,I,A)),!0}return!1}function Wh(l){var h=ql(l.target);if(h!==null){var y=Bs(h);if(y!==null){if(h=y.tag,h===13){if(h=Xt(y),h!==null){l.blockedOn=h,yg(l.priority,function(){co(y)});return}}else if(h===3&&y.stateNode.current.memoizedState.isDehydrated){l.blockedOn=y.tag===3?y.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Yo(l){if(l.blockedOn!==null)return!1;for(var h=l.targetContainers;0<h.length;){var y=Pn(l.domEventName,l.eventSystemFlags,h[0],l.nativeEvent);if(y===null){y=l.nativeEvent;var I=new y.constructor(y.type,y);Qe=I,y.target.dispatchEvent(I),Qe=null}else return h=nf(y),h!==null&&Uh(h),l.blockedOn=y,!1;h.shift()}return!0}function Kh(l,h,y){Yo(l)&&y.delete(h)}function wv(){$h=!1,qo!==null&&Yo(qo)&&(qo=null),oi!==null&&Yo(oi)&&(oi=null),lo!==null&&Yo(lo)&&(lo=null),Hl.forEach(Kh),Go.forEach(Kh)}function Wl(l,h){l.blockedOn===h&&(l.blockedOn=null,$h||($h=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,wv)))}function Kl(l){function h(A){return Wl(A,l)}if(0<nd.length){Wl(nd[0],l);for(var y=1;y<nd.length;y++){var I=nd[y];I.blockedOn===l&&(I.blockedOn=null)}}for(qo!==null&&Wl(qo,l),oi!==null&&Wl(oi,l),lo!==null&&Wl(lo,l),Hl.forEach(h),Go.forEach(h),y=0;y<Vo.length;y++)I=Vo[y],I.blockedOn===l&&(I.blockedOn=null);for(;0<Vo.length&&(y=Vo[0],y.blockedOn===null);)Wh(y),y.blockedOn===null&&Vo.shift()}var ie=M.ReactCurrentBatchConfig,he=!0;function Pe(l,h,y,I){var A=Gt,B=ie.transition;ie.transition=null;try{Gt=1,fn(l,h,y,I)}finally{Gt=A,ie.transition=B}}function Ke(l,h,y,I){var A=Gt,B=ie.transition;ie.transition=null;try{Gt=4,fn(l,h,y,I)}finally{Gt=A,ie.transition=B}}function fn(l,h,y,I){if(he){var A=Pn(l,h,y,I);if(A===null)Rv(l,h,I,vt,y),wg(l,I);else if(vg(A,l,h,y,I))I.stopPropagation();else if(wg(l,I),h&4&&-1<Hh.indexOf(l)){for(;A!==null;){var B=nf(A);if(B!==null&&gg(B),B=Pn(l,h,y,I),B===null&&Rv(l,h,I,vt,y),B===A)break;A=B}A!==null&&I.stopPropagation()}else Rv(l,h,I,null,y)}}var vt=null;function Pn(l,h,y,I){if(vt=null,l=$t(I),l=ql(l),l!==null)if(h=Bs(l),h===null)l=null;else if(y=h.tag,y===13){if(l=Xt(h),l!==null)return l;l=null}else if(y===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;l=null}else h!==l&&(l=null);return vt=l,null}function hr(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Nl()){case ka:return 1;case ao:return 4;case Ho:case Bl:return 16;case Ai:return 536870912;default:return 16}default:return 16}}var Mn=null,bn=null,Tr=null;function Ki(){if(Tr)return Tr;var l,h=bn,y=h.length,I,A="value"in Mn?Mn.value:Mn.textContent,B=A.length;for(l=0;l<y&&h[l]===A[l];l++);var ee=y-l;for(I=1;I<=ee&&h[y-I]===A[B-I];I++);return Tr=A.slice(l,1<I?1-I:void 0)}function fr(l){var h=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&h===13&&(l=13)):l=h,l===10&&(l=13),32<=l||l===13?l:0}function zr(){return!0}function Ri(){return!1}function ir(l){function h(y,I,A,B,ee){this._reactName=y,this._targetInst=A,this.type=I,this.nativeEvent=B,this.target=ee,this.currentTarget=null;for(var se in l)l.hasOwnProperty(se)&&(y=l[se],this[se]=y?y(B):B[se]);return this.isDefaultPrevented=(B.defaultPrevented!=null?B.defaultPrevented:B.returnValue===!1)?zr:Ri,this.isPropagationStopped=Ri,this}return ne(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var y=this.nativeEvent;y&&(y.preventDefault?y.preventDefault():typeof y.returnValue!="unknown"&&(y.returnValue=!1),this.isDefaultPrevented=zr)},stopPropagation:function(){var y=this.nativeEvent;y&&(y.stopPropagation?y.stopPropagation():typeof y.cancelBubble!="unknown"&&(y.cancelBubble=!0),this.isPropagationStopped=zr)},persist:function(){},isPersistent:zr}),h}var ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uo=ir(ai),Cc=ne({},ai,{view:0,detail:0}),rd=ir(Cc),Pc,vv,qh,Sg=ne({},Cc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:xv,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==qh&&(qh&&l.type==="mousemove"?(Pc=l.screenX-qh.screenX,vv=l.screenY-qh.screenY):vv=Pc=0,qh=l),Pc)},movementY:function(l){return"movementY"in l?l.movementY:vv}}),lM=ir(Sg),bH=ne({},Sg,{dataTransfer:0}),_H=ir(bH),IH=ne({},Cc,{relatedTarget:0}),Sv=ir(IH),EH=ne({},ai,{animationName:0,elapsedTime:0,pseudoElement:0}),CH=ir(EH),PH=ne({},ai,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),MH=ir(PH),TH=ne({},ai,{data:0}),uM=ir(TH),kH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jH(l){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(l):(l=RH[l])?!!h[l]:!1}function xv(){return jH}var DH=ne({},Cc,{key:function(l){if(l.key){var h=kH[l.key]||l.key;if(h!=="Unidentified")return h}return l.type==="keypress"?(l=fr(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?AH[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:xv,charCode:function(l){return l.type==="keypress"?fr(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?fr(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),OH=ir(DH),LH=ne({},Sg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),dM=ir(LH),NH=ne({},Cc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:xv}),BH=ir(NH),FH=ne({},ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),zH=ir(FH),UH=ne({},Sg,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),$H=ir(UH),HH=[9,13,27,32],bv=a&&"CompositionEvent"in window,Gh=null;a&&"documentMode"in document&&(Gh=document.documentMode);var WH=a&&"TextEvent"in window&&!Gh,hM=a&&(!bv||Gh&&8<Gh&&11>=Gh),fM=" ",pM=!1;function gM(l,h){switch(l){case"keyup":return HH.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function mM(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var id=!1;function KH(l,h){switch(l){case"compositionend":return mM(h);case"keypress":return h.which!==32?null:(pM=!0,fM);case"textInput":return l=h.data,l===fM&&pM?null:l;default:return null}}function qH(l,h){if(id)return l==="compositionend"||!bv&&gM(l,h)?(l=Ki(),Tr=bn=Mn=null,id=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return hM&&h.locale!=="ko"?null:h.data;default:return null}}var GH={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function yM(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h==="input"?!!GH[l.type]:h==="textarea"}function wM(l,h,y,I){dn(I),h=Eg(h,"onChange"),0<h.length&&(y=new uo("onChange","change",null,y,I),l.push({event:y,listeners:h}))}var Vh=null,Yh=null;function VH(l){LM(l,0)}function xg(l){var h=ld(l);if(Ze(h))return l}function YH(l,h){if(l==="change")return h}var vM=!1;if(a){var _v;if(a){var Iv="oninput"in document;if(!Iv){var SM=document.createElement("div");SM.setAttribute("oninput","return;"),Iv=typeof SM.oninput=="function"}_v=Iv}else _v=!1;vM=_v&&(!document.documentMode||9<document.documentMode)}function xM(){Vh&&(Vh.detachEvent("onpropertychange",bM),Yh=Vh=null)}function bM(l){if(l.propertyName==="value"&&xg(Yh)){var h=[];wM(h,Yh,l,$t(l)),jl(VH,h)}}function XH(l,h,y){l==="focusin"?(xM(),Vh=h,Yh=y,Vh.attachEvent("onpropertychange",bM)):l==="focusout"&&xM()}function ZH(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return xg(Yh)}function QH(l,h){if(l==="click")return xg(h)}function JH(l,h){if(l==="input"||l==="change")return xg(h)}function eW(l,h){return l===h&&(l!==0||1/l===1/h)||l!==l&&h!==h}var ho=typeof Object.is=="function"?Object.is:eW;function Xh(l,h){if(ho(l,h))return!0;if(typeof l!="object"||l===null||typeof h!="object"||h===null)return!1;var y=Object.keys(l),I=Object.keys(h);if(y.length!==I.length)return!1;for(I=0;I<y.length;I++){var A=y[I];if(!c.call(h,A)||!ho(l[A],h[A]))return!1}return!0}function _M(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function IM(l,h){var y=_M(l);l=0;for(var I;y;){if(y.nodeType===3){if(I=l+y.textContent.length,l<=h&&I>=h)return{node:y,offset:h-l};l=I}e:{for(;y;){if(y.nextSibling){y=y.nextSibling;break e}y=y.parentNode}y=void 0}y=_M(y)}}function EM(l,h){return l&&h?l===h?!0:l&&l.nodeType===3?!1:h&&h.nodeType===3?EM(l,h.parentNode):"contains"in l?l.contains(h):l.compareDocumentPosition?!!(l.compareDocumentPosition(h)&16):!1:!1}function CM(){for(var l=window,h=dt();h instanceof l.HTMLIFrameElement;){try{var y=typeof h.contentWindow.location.href=="string"}catch{y=!1}if(y)l=h.contentWindow;else break;h=dt(l.document)}return h}function Ev(l){var h=l&&l.nodeName&&l.nodeName.toLowerCase();return h&&(h==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||h==="textarea"||l.contentEditable==="true")}function tW(l){var h=CM(),y=l.focusedElem,I=l.selectionRange;if(h!==y&&y&&y.ownerDocument&&EM(y.ownerDocument.documentElement,y)){if(I!==null&&Ev(y)){if(h=I.start,l=I.end,l===void 0&&(l=h),"selectionStart"in y)y.selectionStart=h,y.selectionEnd=Math.min(l,y.value.length);else if(l=(h=y.ownerDocument||document)&&h.defaultView||window,l.getSelection){l=l.getSelection();var A=y.textContent.length,B=Math.min(I.start,A);I=I.end===void 0?B:Math.min(I.end,A),!l.extend&&B>I&&(A=I,I=B,B=A),A=IM(y,B);var ee=IM(y,I);A&&ee&&(l.rangeCount!==1||l.anchorNode!==A.node||l.anchorOffset!==A.offset||l.focusNode!==ee.node||l.focusOffset!==ee.offset)&&(h=h.createRange(),h.setStart(A.node,A.offset),l.removeAllRanges(),B>I?(l.addRange(h),l.extend(ee.node,ee.offset)):(h.setEnd(ee.node,ee.offset),l.addRange(h)))}}for(h=[],l=y;l=l.parentNode;)l.nodeType===1&&h.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof y.focus=="function"&&y.focus(),y=0;y<h.length;y++)l=h[y],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var nW=a&&"documentMode"in document&&11>=document.documentMode,sd=null,Cv=null,Zh=null,Pv=!1;function PM(l,h,y){var I=y.window===y?y.document:y.nodeType===9?y:y.ownerDocument;Pv||sd==null||sd!==dt(I)||(I=sd,"selectionStart"in I&&Ev(I)?I={start:I.selectionStart,end:I.selectionEnd}:(I=(I.ownerDocument&&I.ownerDocument.defaultView||window).getSelection(),I={anchorNode:I.anchorNode,anchorOffset:I.anchorOffset,focusNode:I.focusNode,focusOffset:I.focusOffset}),Zh&&Xh(Zh,I)||(Zh=I,I=Eg(Cv,"onSelect"),0<I.length&&(h=new uo("onSelect","select",null,h,y),l.push({event:h,listeners:I}),h.target=sd)))}function bg(l,h){var y={};return y[l.toLowerCase()]=h.toLowerCase(),y["Webkit"+l]="webkit"+h,y["Moz"+l]="moz"+h,y}var od={animationend:bg("Animation","AnimationEnd"),animationiteration:bg("Animation","AnimationIteration"),animationstart:bg("Animation","AnimationStart"),transitionend:bg("Transition","TransitionEnd")},Mv={},MM={};a&&(MM=document.createElement("div").style,"AnimationEvent"in window||(delete od.animationend.animation,delete od.animationiteration.animation,delete od.animationstart.animation),"TransitionEvent"in window||delete od.transitionend.transition);function _g(l){if(Mv[l])return Mv[l];if(!od[l])return l;var h=od[l],y;for(y in h)if(h.hasOwnProperty(y)&&y in MM)return Mv[l]=h[y];return l}var TM=_g("animationend"),kM=_g("animationiteration"),AM=_g("animationstart"),RM=_g("transitionend"),jM=new Map,DM="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Mc(l,h){jM.set(l,h),s(h,[l])}for(var Tv=0;Tv<DM.length;Tv++){var kv=DM[Tv],rW=kv.toLowerCase(),iW=kv[0].toUpperCase()+kv.slice(1);Mc(rW,"on"+iW)}Mc(TM,"onAnimationEnd"),Mc(kM,"onAnimationIteration"),Mc(AM,"onAnimationStart"),Mc("dblclick","onDoubleClick"),Mc("focusin","onFocus"),Mc("focusout","onBlur"),Mc(RM,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sW=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qh));function OM(l,h,y){var I=l.type||"unknown-event";l.currentTarget=y,Kn(I,h,void 0,l),l.currentTarget=null}function LM(l,h){h=(h&4)!==0;for(var y=0;y<l.length;y++){var I=l[y],A=I.event;I=I.listeners;e:{var B=void 0;if(h)for(var ee=I.length-1;0<=ee;ee--){var se=I[ee],le=se.instance,be=se.currentTarget;if(se=se.listener,le!==B&&A.isPropagationStopped())break e;OM(A,se,be),B=le}else for(ee=0;ee<I.length;ee++){if(se=I[ee],le=se.instance,be=se.currentTarget,se=se.listener,le!==B&&A.isPropagationStopped())break e;OM(A,se,be),B=le}}}if(Yt)throw l=Cn,Yt=!1,Cn=null,l}function Nn(l,h){var y=h[Bv];y===void 0&&(y=h[Bv]=new Set);var I=l+"__bubble";y.has(I)||(NM(h,l,2,!1),y.add(I))}function Av(l,h,y){var I=0;h&&(I|=4),NM(y,l,I,h)}var Ig="_reactListening"+Math.random().toString(36).slice(2);function Jh(l){if(!l[Ig]){l[Ig]=!0,r.forEach(function(y){y!=="selectionchange"&&(sW.has(y)||Av(y,!1,l),Av(y,!0,l))});var h=l.nodeType===9?l:l.ownerDocument;h===null||h[Ig]||(h[Ig]=!0,Av("selectionchange",!1,h))}}function NM(l,h,y,I){switch(hr(h)){case 1:var A=Pe;break;case 4:A=Ke;break;default:A=fn}y=A.bind(null,h,y,l),A=void 0,!En||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(A=!0),I?A!==void 0?l.addEventListener(h,y,{capture:!0,passive:A}):l.addEventListener(h,y,!0):A!==void 0?l.addEventListener(h,y,{passive:A}):l.addEventListener(h,y,!1)}function Rv(l,h,y,I,A){var B=I;if(!(h&1)&&!(h&2)&&I!==null)e:for(;;){if(I===null)return;var ee=I.tag;if(ee===3||ee===4){var se=I.stateNode.containerInfo;if(se===A||se.nodeType===8&&se.parentNode===A)break;if(ee===4)for(ee=I.return;ee!==null;){var le=ee.tag;if((le===3||le===4)&&(le=ee.stateNode.containerInfo,le===A||le.nodeType===8&&le.parentNode===A))return;ee=ee.return}for(;se!==null;){if(ee=ql(se),ee===null)return;if(le=ee.tag,le===5||le===6){I=B=ee;continue e}se=se.parentNode}}I=I.return}jl(function(){var be=B,ke=$t(y),Ae=[];e:{var Me=jM.get(l);if(Me!==void 0){var We=uo,Ve=l;switch(l){case"keypress":if(fr(y)===0)break e;case"keydown":case"keyup":We=OH;break;case"focusin":Ve="focus",We=Sv;break;case"focusout":Ve="blur",We=Sv;break;case"beforeblur":case"afterblur":We=Sv;break;case"click":if(y.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":We=lM;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":We=_H;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":We=BH;break;case TM:case kM:case AM:We=CH;break;case RM:We=zH;break;case"scroll":We=rd;break;case"wheel":We=$H;break;case"copy":case"cut":case"paste":We=MH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":We=dM}var Je=(h&4)!==0,pr=!Je&&l==="scroll",pe=Je?Me!==null?Me+"Capture":null:Me;Je=[];for(var de=be,ve;de!==null;){ve=de;var je=ve.stateNode;if(ve.tag===5&&je!==null&&(ve=je,pe!==null&&(je=mn(de,pe),je!=null&&Je.push(ef(de,je,ve)))),pr)break;de=de.return}0<Je.length&&(Me=new We(Me,Ve,null,y,ke),Ae.push({event:Me,listeners:Je}))}}if(!(h&7)){e:{if(Me=l==="mouseover"||l==="pointerover",We=l==="mouseout"||l==="pointerout",Me&&y!==Qe&&(Ve=y.relatedTarget||y.fromElement)&&(ql(Ve)||Ve[Ra]))break e;if((We||Me)&&(Me=ke.window===ke?ke:(Me=ke.ownerDocument)?Me.defaultView||Me.parentWindow:window,We?(Ve=y.relatedTarget||y.toElement,We=be,Ve=Ve?ql(Ve):null,Ve!==null&&(pr=Bs(Ve),Ve!==pr||Ve.tag!==5&&Ve.tag!==6)&&(Ve=null)):(We=null,Ve=be),We!==Ve)){if(Je=lM,je="onMouseLeave",pe="onMouseEnter",de="mouse",(l==="pointerout"||l==="pointerover")&&(Je=dM,je="onPointerLeave",pe="onPointerEnter",de="pointer"),pr=We==null?Me:ld(We),ve=Ve==null?Me:ld(Ve),Me=new Je(je,de+"leave",We,y,ke),Me.target=pr,Me.relatedTarget=ve,je=null,ql(ke)===be&&(Je=new Je(pe,de+"enter",Ve,y,ke),Je.target=ve,Je.relatedTarget=pr,je=Je),pr=je,We&&Ve)t:{for(Je=We,pe=Ve,de=0,ve=Je;ve;ve=ad(ve))de++;for(ve=0,je=pe;je;je=ad(je))ve++;for(;0<de-ve;)Je=ad(Je),de--;for(;0<ve-de;)pe=ad(pe),ve--;for(;de--;){if(Je===pe||pe!==null&&Je===pe.alternate)break t;Je=ad(Je),pe=ad(pe)}Je=null}else Je=null;We!==null&&BM(Ae,Me,We,Je,!1),Ve!==null&&pr!==null&&BM(Ae,pr,Ve,Je,!0)}}e:{if(Me=be?ld(be):window,We=Me.nodeName&&Me.nodeName.toLowerCase(),We==="select"||We==="input"&&Me.type==="file")var tt=YH;else if(yM(Me))if(vM)tt=JH;else{tt=ZH;var ht=XH}else(We=Me.nodeName)&&We.toLowerCase()==="input"&&(Me.type==="checkbox"||Me.type==="radio")&&(tt=QH);if(tt&&(tt=tt(l,be))){wM(Ae,tt,y,ke);break e}ht&&ht(l,Me,be),l==="focusout"&&(ht=Me._wrapperState)&&ht.controlled&&Me.type==="number"&&ur(Me,"number",Me.value)}switch(ht=be?ld(be):window,l){case"focusin":(yM(ht)||ht.contentEditable==="true")&&(sd=ht,Cv=be,Zh=null);break;case"focusout":Zh=Cv=sd=null;break;case"mousedown":Pv=!0;break;case"contextmenu":case"mouseup":case"dragend":Pv=!1,PM(Ae,y,ke);break;case"selectionchange":if(nW)break;case"keydown":case"keyup":PM(Ae,y,ke)}var ft;if(bv)e:{switch(l){case"compositionstart":var wt="onCompositionStart";break e;case"compositionend":wt="onCompositionEnd";break e;case"compositionupdate":wt="onCompositionUpdate";break e}wt=void 0}else id?gM(l,y)&&(wt="onCompositionEnd"):l==="keydown"&&y.keyCode===229&&(wt="onCompositionStart");wt&&(hM&&y.locale!=="ko"&&(id||wt!=="onCompositionStart"?wt==="onCompositionEnd"&&id&&(ft=Ki()):(Mn=ke,bn="value"in Mn?Mn.value:Mn.textContent,id=!0)),ht=Eg(be,wt),0<ht.length&&(wt=new uM(wt,l,null,y,ke),Ae.push({event:wt,listeners:ht}),ft?wt.data=ft:(ft=mM(y),ft!==null&&(wt.data=ft)))),(ft=WH?KH(l,y):qH(l,y))&&(be=Eg(be,"onBeforeInput"),0<be.length&&(ke=new uM("onBeforeInput","beforeinput",null,y,ke),Ae.push({event:ke,listeners:be}),ke.data=ft))}LM(Ae,h)})}function ef(l,h,y){return{instance:l,listener:h,currentTarget:y}}function Eg(l,h){for(var y=h+"Capture",I=[];l!==null;){var A=l,B=A.stateNode;A.tag===5&&B!==null&&(A=B,B=mn(l,y),B!=null&&I.unshift(ef(l,B,A)),B=mn(l,h),B!=null&&I.push(ef(l,B,A))),l=l.return}return I}function ad(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function BM(l,h,y,I,A){for(var B=h._reactName,ee=[];y!==null&&y!==I;){var se=y,le=se.alternate,be=se.stateNode;if(le!==null&&le===I)break;se.tag===5&&be!==null&&(se=be,A?(le=mn(y,B),le!=null&&ee.unshift(ef(y,le,se))):A||(le=mn(y,B),le!=null&&ee.push(ef(y,le,se)))),y=y.return}ee.length!==0&&l.push({event:h,listeners:ee})}var oW=/\r\n?/g,aW=/\u0000|\uFFFD/g;function FM(l){return(typeof l=="string"?l:""+l).replace(oW,`
`).replace(aW,"")}function Cg(l,h,y){if(h=FM(h),FM(l)!==h&&y)throw Error(t(425))}function Pg(){}var jv=null,Dv=null;function Ov(l,h){return l==="textarea"||l==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var Lv=typeof setTimeout=="function"?setTimeout:void 0,cW=typeof clearTimeout=="function"?clearTimeout:void 0,zM=typeof Promise=="function"?Promise:void 0,lW=typeof queueMicrotask=="function"?queueMicrotask:typeof zM<"u"?function(l){return zM.resolve(null).then(l).catch(uW)}:Lv;function uW(l){setTimeout(function(){throw l})}function Nv(l,h){var y=h,I=0;do{var A=y.nextSibling;if(l.removeChild(y),A&&A.nodeType===8)if(y=A.data,y==="/$"){if(I===0){l.removeChild(A),Kl(h);return}I--}else y!=="$"&&y!=="$?"&&y!=="$!"||I++;y=A}while(y);Kl(h)}function Tc(l){for(;l!=null;l=l.nextSibling){var h=l.nodeType;if(h===1||h===3)break;if(h===8){if(h=l.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return l}function UM(l){l=l.previousSibling;for(var h=0;l;){if(l.nodeType===8){var y=l.data;if(y==="$"||y==="$!"||y==="$?"){if(h===0)return l;h--}else y==="/$"&&h++}l=l.previousSibling}return null}var cd=Math.random().toString(36).slice(2),Xo="__reactFiber$"+cd,tf="__reactProps$"+cd,Ra="__reactContainer$"+cd,Bv="__reactEvents$"+cd,dW="__reactListeners$"+cd,hW="__reactHandles$"+cd;function ql(l){var h=l[Xo];if(h)return h;for(var y=l.parentNode;y;){if(h=y[Ra]||y[Xo]){if(y=h.alternate,h.child!==null||y!==null&&y.child!==null)for(l=UM(l);l!==null;){if(y=l[Xo])return y;l=UM(l)}return h}l=y,y=l.parentNode}return null}function nf(l){return l=l[Xo]||l[Ra],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function ld(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(t(33))}function Mg(l){return l[tf]||null}var Fv=[],ud=-1;function kc(l){return{current:l}}function Bn(l){0>ud||(l.current=Fv[ud],Fv[ud]=null,ud--)}function Tn(l,h){ud++,Fv[ud]=l.current,l.current=h}var Ac={},ci=kc(Ac),qi=kc(!1),Gl=Ac;function dd(l,h){var y=l.type.contextTypes;if(!y)return Ac;var I=l.stateNode;if(I&&I.__reactInternalMemoizedUnmaskedChildContext===h)return I.__reactInternalMemoizedMaskedChildContext;var A={},B;for(B in y)A[B]=h[B];return I&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=h,l.__reactInternalMemoizedMaskedChildContext=A),A}function Gi(l){return l=l.childContextTypes,l!=null}function Tg(){Bn(qi),Bn(ci)}function $M(l,h,y){if(ci.current!==Ac)throw Error(t(168));Tn(ci,h),Tn(qi,y)}function HM(l,h,y){var I=l.stateNode;if(h=h.childContextTypes,typeof I.getChildContext!="function")return y;I=I.getChildContext();for(var A in I)if(!(A in h))throw Error(t(108,ue(l)||"Unknown",A));return ne({},y,I)}function kg(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Ac,Gl=ci.current,Tn(ci,l),Tn(qi,qi.current),!0}function WM(l,h,y){var I=l.stateNode;if(!I)throw Error(t(169));y?(l=HM(l,h,Gl),I.__reactInternalMemoizedMergedChildContext=l,Bn(qi),Bn(ci),Tn(ci,l)):Bn(qi),Tn(qi,y)}var ja=null,Ag=!1,zv=!1;function KM(l){ja===null?ja=[l]:ja.push(l)}function fW(l){Ag=!0,KM(l)}function Rc(){if(!zv&&ja!==null){zv=!0;var l=0,h=Gt;try{var y=ja;for(Gt=1;l<y.length;l++){var I=y[l];do I=I(!0);while(I!==null)}ja=null,Ag=!1}catch(A){throw ja!==null&&(ja=ja.slice(l+1)),_c(ka,Rc),A}finally{Gt=h,zv=!1}}return null}var hd=[],fd=0,Rg=null,jg=0,Fs=[],zs=0,Vl=null,Da=1,Oa="";function Yl(l,h){hd[fd++]=jg,hd[fd++]=Rg,Rg=l,jg=h}function qM(l,h,y){Fs[zs++]=Da,Fs[zs++]=Oa,Fs[zs++]=Vl,Vl=l;var I=Da;l=Oa;var A=32-Fr(I)-1;I&=~(1<<A),y+=1;var B=32-Fr(h)+A;if(30<B){var ee=A-A%5;B=(I&(1<<ee)-1).toString(32),I>>=ee,A-=ee,Da=1<<32-Fr(h)+A|y<<A|I,Oa=B+l}else Da=1<<B|y<<A|I,Oa=l}function Uv(l){l.return!==null&&(Yl(l,1),qM(l,1,0))}function $v(l){for(;l===Rg;)Rg=hd[--fd],hd[fd]=null,jg=hd[--fd],hd[fd]=null;for(;l===Vl;)Vl=Fs[--zs],Fs[zs]=null,Oa=Fs[--zs],Fs[zs]=null,Da=Fs[--zs],Fs[zs]=null}var ys=null,ws=null,qn=!1,fo=null;function GM(l,h){var y=Ws(5,null,null,0);y.elementType="DELETED",y.stateNode=h,y.return=l,h=l.deletions,h===null?(l.deletions=[y],l.flags|=16):h.push(y)}function VM(l,h){switch(l.tag){case 5:var y=l.type;return h=h.nodeType!==1||y.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(l.stateNode=h,ys=l,ws=Tc(h.firstChild),!0):!1;case 6:return h=l.pendingProps===""||h.nodeType!==3?null:h,h!==null?(l.stateNode=h,ys=l,ws=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(y=Vl!==null?{id:Da,overflow:Oa}:null,l.memoizedState={dehydrated:h,treeContext:y,retryLane:1073741824},y=Ws(18,null,null,0),y.stateNode=h,y.return=l,l.child=y,ys=l,ws=null,!0):!1;default:return!1}}function Hv(l){return(l.mode&1)!==0&&(l.flags&128)===0}function Wv(l){if(qn){var h=ws;if(h){var y=h;if(!VM(l,h)){if(Hv(l))throw Error(t(418));h=Tc(y.nextSibling);var I=ys;h&&VM(l,h)?GM(I,y):(l.flags=l.flags&-4097|2,qn=!1,ys=l)}}else{if(Hv(l))throw Error(t(418));l.flags=l.flags&-4097|2,qn=!1,ys=l}}}function YM(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;ys=l}function Dg(l){if(l!==ys)return!1;if(!qn)return YM(l),qn=!0,!1;var h;if((h=l.tag!==3)&&!(h=l.tag!==5)&&(h=l.type,h=h!=="head"&&h!=="body"&&!Ov(l.type,l.memoizedProps)),h&&(h=ws)){if(Hv(l))throw XM(),Error(t(418));for(;h;)GM(l,h),h=Tc(h.nextSibling)}if(YM(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(t(317));e:{for(l=l.nextSibling,h=0;l;){if(l.nodeType===8){var y=l.data;if(y==="/$"){if(h===0){ws=Tc(l.nextSibling);break e}h--}else y!=="$"&&y!=="$!"&&y!=="$?"||h++}l=l.nextSibling}ws=null}}else ws=ys?Tc(l.stateNode.nextSibling):null;return!0}function XM(){for(var l=ws;l;)l=Tc(l.nextSibling)}function pd(){ws=ys=null,qn=!1}function Kv(l){fo===null?fo=[l]:fo.push(l)}var pW=M.ReactCurrentBatchConfig;function rf(l,h,y){if(l=y.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(y._owner){if(y=y._owner,y){if(y.tag!==1)throw Error(t(309));var I=y.stateNode}if(!I)throw Error(t(147,l));var A=I,B=""+l;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===B?h.ref:(h=function(ee){var se=A.refs;ee===null?delete se[B]:se[B]=ee},h._stringRef=B,h)}if(typeof l!="string")throw Error(t(284));if(!y._owner)throw Error(t(290,l))}return l}function Og(l,h){throw l=Object.prototype.toString.call(h),Error(t(31,l==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":l))}function ZM(l){var h=l._init;return h(l._payload)}function QM(l){function h(pe,de){if(l){var ve=pe.deletions;ve===null?(pe.deletions=[de],pe.flags|=16):ve.push(de)}}function y(pe,de){if(!l)return null;for(;de!==null;)h(pe,de),de=de.sibling;return null}function I(pe,de){for(pe=new Map;de!==null;)de.key!==null?pe.set(de.key,de):pe.set(de.index,de),de=de.sibling;return pe}function A(pe,de){return pe=zc(pe,de),pe.index=0,pe.sibling=null,pe}function B(pe,de,ve){return pe.index=ve,l?(ve=pe.alternate,ve!==null?(ve=ve.index,ve<de?(pe.flags|=2,de):ve):(pe.flags|=2,de)):(pe.flags|=1048576,de)}function ee(pe){return l&&pe.alternate===null&&(pe.flags|=2),pe}function se(pe,de,ve,je){return de===null||de.tag!==6?(de=LS(ve,pe.mode,je),de.return=pe,de):(de=A(de,ve),de.return=pe,de)}function le(pe,de,ve,je){var tt=ve.type;return tt===H?ke(pe,de,ve.props.children,je,ve.key):de!==null&&(de.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===O&&ZM(tt)===de.type)?(je=A(de,ve.props),je.ref=rf(pe,de,ve),je.return=pe,je):(je=sm(ve.type,ve.key,ve.props,null,pe.mode,je),je.ref=rf(pe,de,ve),je.return=pe,je)}function be(pe,de,ve,je){return de===null||de.tag!==4||de.stateNode.containerInfo!==ve.containerInfo||de.stateNode.implementation!==ve.implementation?(de=NS(ve,pe.mode,je),de.return=pe,de):(de=A(de,ve.children||[]),de.return=pe,de)}function ke(pe,de,ve,je,tt){return de===null||de.tag!==7?(de=ru(ve,pe.mode,je,tt),de.return=pe,de):(de=A(de,ve),de.return=pe,de)}function Ae(pe,de,ve){if(typeof de=="string"&&de!==""||typeof de=="number")return de=LS(""+de,pe.mode,ve),de.return=pe,de;if(typeof de=="object"&&de!==null){switch(de.$$typeof){case j:return ve=sm(de.type,de.key,de.props,null,pe.mode,ve),ve.ref=rf(pe,null,de),ve.return=pe,ve;case D:return de=NS(de,pe.mode,ve),de.return=pe,de;case O:var je=de._init;return Ae(pe,je(de._payload),ve)}if(At(de)||X(de))return de=ru(de,pe.mode,ve,null),de.return=pe,de;Og(pe,de)}return null}function Me(pe,de,ve,je){var tt=de!==null?de.key:null;if(typeof ve=="string"&&ve!==""||typeof ve=="number")return tt!==null?null:se(pe,de,""+ve,je);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case j:return ve.key===tt?le(pe,de,ve,je):null;case D:return ve.key===tt?be(pe,de,ve,je):null;case O:return tt=ve._init,Me(pe,de,tt(ve._payload),je)}if(At(ve)||X(ve))return tt!==null?null:ke(pe,de,ve,je,null);Og(pe,ve)}return null}function We(pe,de,ve,je,tt){if(typeof je=="string"&&je!==""||typeof je=="number")return pe=pe.get(ve)||null,se(de,pe,""+je,tt);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case j:return pe=pe.get(je.key===null?ve:je.key)||null,le(de,pe,je,tt);case D:return pe=pe.get(je.key===null?ve:je.key)||null,be(de,pe,je,tt);case O:var ht=je._init;return We(pe,de,ve,ht(je._payload),tt)}if(At(je)||X(je))return pe=pe.get(ve)||null,ke(de,pe,je,tt,null);Og(de,je)}return null}function Ve(pe,de,ve,je){for(var tt=null,ht=null,ft=de,wt=de=0,Rr=null;ft!==null&&wt<ve.length;wt++){ft.index>wt?(Rr=ft,ft=null):Rr=ft.sibling;var sn=Me(pe,ft,ve[wt],je);if(sn===null){ft===null&&(ft=Rr);break}l&&ft&&sn.alternate===null&&h(pe,ft),de=B(sn,de,wt),ht===null?tt=sn:ht.sibling=sn,ht=sn,ft=Rr}if(wt===ve.length)return y(pe,ft),qn&&Yl(pe,wt),tt;if(ft===null){for(;wt<ve.length;wt++)ft=Ae(pe,ve[wt],je),ft!==null&&(de=B(ft,de,wt),ht===null?tt=ft:ht.sibling=ft,ht=ft);return qn&&Yl(pe,wt),tt}for(ft=I(pe,ft);wt<ve.length;wt++)Rr=We(ft,pe,wt,ve[wt],je),Rr!==null&&(l&&Rr.alternate!==null&&ft.delete(Rr.key===null?wt:Rr.key),de=B(Rr,de,wt),ht===null?tt=Rr:ht.sibling=Rr,ht=Rr);return l&&ft.forEach(function(Uc){return h(pe,Uc)}),qn&&Yl(pe,wt),tt}function Je(pe,de,ve,je){var tt=X(ve);if(typeof tt!="function")throw Error(t(150));if(ve=tt.call(ve),ve==null)throw Error(t(151));for(var ht=tt=null,ft=de,wt=de=0,Rr=null,sn=ve.next();ft!==null&&!sn.done;wt++,sn=ve.next()){ft.index>wt?(Rr=ft,ft=null):Rr=ft.sibling;var Uc=Me(pe,ft,sn.value,je);if(Uc===null){ft===null&&(ft=Rr);break}l&&ft&&Uc.alternate===null&&h(pe,ft),de=B(Uc,de,wt),ht===null?tt=Uc:ht.sibling=Uc,ht=Uc,ft=Rr}if(sn.done)return y(pe,ft),qn&&Yl(pe,wt),tt;if(ft===null){for(;!sn.done;wt++,sn=ve.next())sn=Ae(pe,sn.value,je),sn!==null&&(de=B(sn,de,wt),ht===null?tt=sn:ht.sibling=sn,ht=sn);return qn&&Yl(pe,wt),tt}for(ft=I(pe,ft);!sn.done;wt++,sn=ve.next())sn=We(ft,pe,wt,sn.value,je),sn!==null&&(l&&sn.alternate!==null&&ft.delete(sn.key===null?wt:sn.key),de=B(sn,de,wt),ht===null?tt=sn:ht.sibling=sn,ht=sn);return l&&ft.forEach(function(GW){return h(pe,GW)}),qn&&Yl(pe,wt),tt}function pr(pe,de,ve,je){if(typeof ve=="object"&&ve!==null&&ve.type===H&&ve.key===null&&(ve=ve.props.children),typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case j:e:{for(var tt=ve.key,ht=de;ht!==null;){if(ht.key===tt){if(tt=ve.type,tt===H){if(ht.tag===7){y(pe,ht.sibling),de=A(ht,ve.props.children),de.return=pe,pe=de;break e}}else if(ht.elementType===tt||typeof tt=="object"&&tt!==null&&tt.$$typeof===O&&ZM(tt)===ht.type){y(pe,ht.sibling),de=A(ht,ve.props),de.ref=rf(pe,ht,ve),de.return=pe,pe=de;break e}y(pe,ht);break}else h(pe,ht);ht=ht.sibling}ve.type===H?(de=ru(ve.props.children,pe.mode,je,ve.key),de.return=pe,pe=de):(je=sm(ve.type,ve.key,ve.props,null,pe.mode,je),je.ref=rf(pe,de,ve),je.return=pe,pe=je)}return ee(pe);case D:e:{for(ht=ve.key;de!==null;){if(de.key===ht)if(de.tag===4&&de.stateNode.containerInfo===ve.containerInfo&&de.stateNode.implementation===ve.implementation){y(pe,de.sibling),de=A(de,ve.children||[]),de.return=pe,pe=de;break e}else{y(pe,de);break}else h(pe,de);de=de.sibling}de=NS(ve,pe.mode,je),de.return=pe,pe=de}return ee(pe);case O:return ht=ve._init,pr(pe,de,ht(ve._payload),je)}if(At(ve))return Ve(pe,de,ve,je);if(X(ve))return Je(pe,de,ve,je);Og(pe,ve)}return typeof ve=="string"&&ve!==""||typeof ve=="number"?(ve=""+ve,de!==null&&de.tag===6?(y(pe,de.sibling),de=A(de,ve),de.return=pe,pe=de):(y(pe,de),de=LS(ve,pe.mode,je),de.return=pe,pe=de),ee(pe)):y(pe,de)}return pr}var gd=QM(!0),JM=QM(!1),Lg=kc(null),Ng=null,md=null,qv=null;function Gv(){qv=md=Ng=null}function Vv(l){var h=Lg.current;Bn(Lg),l._currentValue=h}function Yv(l,h,y){for(;l!==null;){var I=l.alternate;if((l.childLanes&h)!==h?(l.childLanes|=h,I!==null&&(I.childLanes|=h)):I!==null&&(I.childLanes&h)!==h&&(I.childLanes|=h),l===y)break;l=l.return}}function yd(l,h){Ng=l,qv=md=null,l=l.dependencies,l!==null&&l.firstContext!==null&&(l.lanes&h&&(Vi=!0),l.firstContext=null)}function Us(l){var h=l._currentValue;if(qv!==l)if(l={context:l,memoizedValue:h,next:null},md===null){if(Ng===null)throw Error(t(308));md=l,Ng.dependencies={lanes:0,firstContext:l}}else md=md.next=l;return h}var Xl=null;function Xv(l){Xl===null?Xl=[l]:Xl.push(l)}function eT(l,h,y,I){var A=h.interleaved;return A===null?(y.next=y,Xv(h)):(y.next=A.next,A.next=y),h.interleaved=y,La(l,I)}function La(l,h){l.lanes|=h;var y=l.alternate;for(y!==null&&(y.lanes|=h),y=l,l=l.return;l!==null;)l.childLanes|=h,y=l.alternate,y!==null&&(y.childLanes|=h),y=l,l=l.return;return y.tag===3?y.stateNode:null}var jc=!1;function Zv(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function tT(l,h){l=l.updateQueue,h.updateQueue===l&&(h.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function Na(l,h){return{eventTime:l,lane:h,tag:0,payload:null,callback:null,next:null}}function Dc(l,h,y){var I=l.updateQueue;if(I===null)return null;if(I=I.shared,Zt&2){var A=I.pending;return A===null?h.next=h:(h.next=A.next,A.next=h),I.pending=h,La(l,y)}return A=I.interleaved,A===null?(h.next=h,Xv(I)):(h.next=A.next,A.next=h),I.interleaved=h,La(l,y)}function Bg(l,h,y){if(h=h.updateQueue,h!==null&&(h=h.shared,(y&4194240)!==0)){var I=h.lanes;I&=l.pendingLanes,y|=I,h.lanes=y,td(l,y)}}function nT(l,h){var y=l.updateQueue,I=l.alternate;if(I!==null&&(I=I.updateQueue,y===I)){var A=null,B=null;if(y=y.firstBaseUpdate,y!==null){do{var ee={eventTime:y.eventTime,lane:y.lane,tag:y.tag,payload:y.payload,callback:y.callback,next:null};B===null?A=B=ee:B=B.next=ee,y=y.next}while(y!==null);B===null?A=B=h:B=B.next=h}else A=B=h;y={baseState:I.baseState,firstBaseUpdate:A,lastBaseUpdate:B,shared:I.shared,effects:I.effects},l.updateQueue=y;return}l=y.lastBaseUpdate,l===null?y.firstBaseUpdate=h:l.next=h,y.lastBaseUpdate=h}function Fg(l,h,y,I){var A=l.updateQueue;jc=!1;var B=A.firstBaseUpdate,ee=A.lastBaseUpdate,se=A.shared.pending;if(se!==null){A.shared.pending=null;var le=se,be=le.next;le.next=null,ee===null?B=be:ee.next=be,ee=le;var ke=l.alternate;ke!==null&&(ke=ke.updateQueue,se=ke.lastBaseUpdate,se!==ee&&(se===null?ke.firstBaseUpdate=be:se.next=be,ke.lastBaseUpdate=le))}if(B!==null){var Ae=A.baseState;ee=0,ke=be=le=null,se=B;do{var Me=se.lane,We=se.eventTime;if((I&Me)===Me){ke!==null&&(ke=ke.next={eventTime:We,lane:0,tag:se.tag,payload:se.payload,callback:se.callback,next:null});e:{var Ve=l,Je=se;switch(Me=h,We=y,Je.tag){case 1:if(Ve=Je.payload,typeof Ve=="function"){Ae=Ve.call(We,Ae,Me);break e}Ae=Ve;break e;case 3:Ve.flags=Ve.flags&-65537|128;case 0:if(Ve=Je.payload,Me=typeof Ve=="function"?Ve.call(We,Ae,Me):Ve,Me==null)break e;Ae=ne({},Ae,Me);break e;case 2:jc=!0}}se.callback!==null&&se.lane!==0&&(l.flags|=64,Me=A.effects,Me===null?A.effects=[se]:Me.push(se))}else We={eventTime:We,lane:Me,tag:se.tag,payload:se.payload,callback:se.callback,next:null},ke===null?(be=ke=We,le=Ae):ke=ke.next=We,ee|=Me;if(se=se.next,se===null){if(se=A.shared.pending,se===null)break;Me=se,se=Me.next,Me.next=null,A.lastBaseUpdate=Me,A.shared.pending=null}}while(!0);if(ke===null&&(le=Ae),A.baseState=le,A.firstBaseUpdate=be,A.lastBaseUpdate=ke,h=A.shared.interleaved,h!==null){A=h;do ee|=A.lane,A=A.next;while(A!==h)}else B===null&&(A.shared.lanes=0);Jl|=ee,l.lanes=ee,l.memoizedState=Ae}}function rT(l,h,y){if(l=h.effects,h.effects=null,l!==null)for(h=0;h<l.length;h++){var I=l[h],A=I.callback;if(A!==null){if(I.callback=null,I=y,typeof A!="function")throw Error(t(191,A));A.call(I)}}}var sf={},Zo=kc(sf),of=kc(sf),af=kc(sf);function Zl(l){if(l===sf)throw Error(t(174));return l}function Qv(l,h){switch(Tn(af,h),Tn(of,l),Tn(Zo,sf),l=h.nodeType,l){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:te(null,"");break;default:l=l===8?h.parentNode:h,h=l.namespaceURI||null,l=l.tagName,h=te(h,l)}Bn(Zo),Tn(Zo,h)}function wd(){Bn(Zo),Bn(of),Bn(af)}function iT(l){Zl(af.current);var h=Zl(Zo.current),y=te(h,l.type);h!==y&&(Tn(of,l),Tn(Zo,y))}function Jv(l){of.current===l&&(Bn(Zo),Bn(of))}var Zn=kc(0);function zg(l){for(var h=l;h!==null;){if(h.tag===13){var y=h.memoizedState;if(y!==null&&(y=y.dehydrated,y===null||y.data==="$?"||y.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if(h.flags&128)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var eS=[];function tS(){for(var l=0;l<eS.length;l++)eS[l]._workInProgressVersionPrimary=null;eS.length=0}var Ug=M.ReactCurrentDispatcher,nS=M.ReactCurrentBatchConfig,Ql=0,Qn=null,Er=null,kr=null,$g=!1,cf=!1,lf=0,gW=0;function li(){throw Error(t(321))}function rS(l,h){if(h===null)return!1;for(var y=0;y<h.length&&y<l.length;y++)if(!ho(l[y],h[y]))return!1;return!0}function iS(l,h,y,I,A,B){if(Ql=B,Qn=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,Ug.current=l===null||l.memoizedState===null?vW:SW,l=y(I,A),cf){B=0;do{if(cf=!1,lf=0,25<=B)throw Error(t(301));B+=1,kr=Er=null,h.updateQueue=null,Ug.current=xW,l=y(I,A)}while(cf)}if(Ug.current=Kg,h=Er!==null&&Er.next!==null,Ql=0,kr=Er=Qn=null,$g=!1,h)throw Error(t(300));return l}function sS(){var l=lf!==0;return lf=0,l}function Qo(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kr===null?Qn.memoizedState=kr=l:kr=kr.next=l,kr}function $s(){if(Er===null){var l=Qn.alternate;l=l!==null?l.memoizedState:null}else l=Er.next;var h=kr===null?Qn.memoizedState:kr.next;if(h!==null)kr=h,Er=l;else{if(l===null)throw Error(t(310));Er=l,l={memoizedState:Er.memoizedState,baseState:Er.baseState,baseQueue:Er.baseQueue,queue:Er.queue,next:null},kr===null?Qn.memoizedState=kr=l:kr=kr.next=l}return kr}function uf(l,h){return typeof h=="function"?h(l):h}function oS(l){var h=$s(),y=h.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=l;var I=Er,A=I.baseQueue,B=y.pending;if(B!==null){if(A!==null){var ee=A.next;A.next=B.next,B.next=ee}I.baseQueue=A=B,y.pending=null}if(A!==null){B=A.next,I=I.baseState;var se=ee=null,le=null,be=B;do{var ke=be.lane;if((Ql&ke)===ke)le!==null&&(le=le.next={lane:0,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null}),I=be.hasEagerState?be.eagerState:l(I,be.action);else{var Ae={lane:ke,action:be.action,hasEagerState:be.hasEagerState,eagerState:be.eagerState,next:null};le===null?(se=le=Ae,ee=I):le=le.next=Ae,Qn.lanes|=ke,Jl|=ke}be=be.next}while(be!==null&&be!==B);le===null?ee=I:le.next=se,ho(I,h.memoizedState)||(Vi=!0),h.memoizedState=I,h.baseState=ee,h.baseQueue=le,y.lastRenderedState=I}if(l=y.interleaved,l!==null){A=l;do B=A.lane,Qn.lanes|=B,Jl|=B,A=A.next;while(A!==l)}else A===null&&(y.lanes=0);return[h.memoizedState,y.dispatch]}function aS(l){var h=$s(),y=h.queue;if(y===null)throw Error(t(311));y.lastRenderedReducer=l;var I=y.dispatch,A=y.pending,B=h.memoizedState;if(A!==null){y.pending=null;var ee=A=A.next;do B=l(B,ee.action),ee=ee.next;while(ee!==A);ho(B,h.memoizedState)||(Vi=!0),h.memoizedState=B,h.baseQueue===null&&(h.baseState=B),y.lastRenderedState=B}return[B,I]}function sT(){}function oT(l,h){var y=Qn,I=$s(),A=h(),B=!ho(I.memoizedState,A);if(B&&(I.memoizedState=A,Vi=!0),I=I.queue,cS(lT.bind(null,y,I,l),[l]),I.getSnapshot!==h||B||kr!==null&&kr.memoizedState.tag&1){if(y.flags|=2048,df(9,cT.bind(null,y,I,A,h),void 0,null),Ar===null)throw Error(t(349));Ql&30||aT(y,h,A)}return A}function aT(l,h,y){l.flags|=16384,l={getSnapshot:h,value:y},h=Qn.updateQueue,h===null?(h={lastEffect:null,stores:null},Qn.updateQueue=h,h.stores=[l]):(y=h.stores,y===null?h.stores=[l]:y.push(l))}function cT(l,h,y,I){h.value=y,h.getSnapshot=I,uT(h)&&dT(l)}function lT(l,h,y){return y(function(){uT(h)&&dT(l)})}function uT(l){var h=l.getSnapshot;l=l.value;try{var y=h();return!ho(l,y)}catch{return!0}}function dT(l){var h=La(l,1);h!==null&&yo(h,l,1,-1)}function hT(l){var h=Qo();return typeof l=="function"&&(l=l()),h.memoizedState=h.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:uf,lastRenderedState:l},h.queue=l,l=l.dispatch=wW.bind(null,Qn,l),[h.memoizedState,l]}function df(l,h,y,I){return l={tag:l,create:h,destroy:y,deps:I,next:null},h=Qn.updateQueue,h===null?(h={lastEffect:null,stores:null},Qn.updateQueue=h,h.lastEffect=l.next=l):(y=h.lastEffect,y===null?h.lastEffect=l.next=l:(I=y.next,y.next=l,l.next=I,h.lastEffect=l)),l}function fT(){return $s().memoizedState}function Hg(l,h,y,I){var A=Qo();Qn.flags|=l,A.memoizedState=df(1|h,y,void 0,I===void 0?null:I)}function Wg(l,h,y,I){var A=$s();I=I===void 0?null:I;var B=void 0;if(Er!==null){var ee=Er.memoizedState;if(B=ee.destroy,I!==null&&rS(I,ee.deps)){A.memoizedState=df(h,y,B,I);return}}Qn.flags|=l,A.memoizedState=df(1|h,y,B,I)}function pT(l,h){return Hg(8390656,8,l,h)}function cS(l,h){return Wg(2048,8,l,h)}function gT(l,h){return Wg(4,2,l,h)}function mT(l,h){return Wg(4,4,l,h)}function yT(l,h){if(typeof h=="function")return l=l(),h(l),function(){h(null)};if(h!=null)return l=l(),h.current=l,function(){h.current=null}}function wT(l,h,y){return y=y!=null?y.concat([l]):null,Wg(4,4,yT.bind(null,h,l),y)}function lS(){}function vT(l,h){var y=$s();h=h===void 0?null:h;var I=y.memoizedState;return I!==null&&h!==null&&rS(h,I[1])?I[0]:(y.memoizedState=[l,h],l)}function ST(l,h){var y=$s();h=h===void 0?null:h;var I=y.memoizedState;return I!==null&&h!==null&&rS(h,I[1])?I[0]:(l=l(),y.memoizedState=[l,h],l)}function xT(l,h,y){return Ql&21?(ho(y,h)||(y=pg(),Qn.lanes|=y,Jl|=y,l.baseState=!0),h):(l.baseState&&(l.baseState=!1,Vi=!0),l.memoizedState=y)}function mW(l,h){var y=Gt;Gt=y!==0&&4>y?y:4,l(!0);var I=nS.transition;nS.transition={};try{l(!1),h()}finally{Gt=y,nS.transition=I}}function bT(){return $s().memoizedState}function yW(l,h,y){var I=Bc(l);if(y={lane:I,action:y,hasEagerState:!1,eagerState:null,next:null},_T(l))IT(h,y);else if(y=eT(l,h,y,I),y!==null){var A=Di();yo(y,l,I,A),ET(y,h,I)}}function wW(l,h,y){var I=Bc(l),A={lane:I,action:y,hasEagerState:!1,eagerState:null,next:null};if(_T(l))IT(h,A);else{var B=l.alternate;if(l.lanes===0&&(B===null||B.lanes===0)&&(B=h.lastRenderedReducer,B!==null))try{var ee=h.lastRenderedState,se=B(ee,y);if(A.hasEagerState=!0,A.eagerState=se,ho(se,ee)){var le=h.interleaved;le===null?(A.next=A,Xv(h)):(A.next=le.next,le.next=A),h.interleaved=A;return}}catch{}finally{}y=eT(l,h,A,I),y!==null&&(A=Di(),yo(y,l,I,A),ET(y,h,I))}}function _T(l){var h=l.alternate;return l===Qn||h!==null&&h===Qn}function IT(l,h){cf=$g=!0;var y=l.pending;y===null?h.next=h:(h.next=y.next,y.next=h),l.pending=h}function ET(l,h,y){if(y&4194240){var I=h.lanes;I&=l.pendingLanes,y|=I,h.lanes=y,td(l,y)}}var Kg={readContext:Us,useCallback:li,useContext:li,useEffect:li,useImperativeHandle:li,useInsertionEffect:li,useLayoutEffect:li,useMemo:li,useReducer:li,useRef:li,useState:li,useDebugValue:li,useDeferredValue:li,useTransition:li,useMutableSource:li,useSyncExternalStore:li,useId:li,unstable_isNewReconciler:!1},vW={readContext:Us,useCallback:function(l,h){return Qo().memoizedState=[l,h===void 0?null:h],l},useContext:Us,useEffect:pT,useImperativeHandle:function(l,h,y){return y=y!=null?y.concat([l]):null,Hg(4194308,4,yT.bind(null,h,l),y)},useLayoutEffect:function(l,h){return Hg(4194308,4,l,h)},useInsertionEffect:function(l,h){return Hg(4,2,l,h)},useMemo:function(l,h){var y=Qo();return h=h===void 0?null:h,l=l(),y.memoizedState=[l,h],l},useReducer:function(l,h,y){var I=Qo();return h=y!==void 0?y(h):h,I.memoizedState=I.baseState=h,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:h},I.queue=l,l=l.dispatch=yW.bind(null,Qn,l),[I.memoizedState,l]},useRef:function(l){var h=Qo();return l={current:l},h.memoizedState=l},useState:hT,useDebugValue:lS,useDeferredValue:function(l){return Qo().memoizedState=l},useTransition:function(){var l=hT(!1),h=l[0];return l=mW.bind(null,l[1]),Qo().memoizedState=l,[h,l]},useMutableSource:function(){},useSyncExternalStore:function(l,h,y){var I=Qn,A=Qo();if(qn){if(y===void 0)throw Error(t(407));y=y()}else{if(y=h(),Ar===null)throw Error(t(349));Ql&30||aT(I,h,y)}A.memoizedState=y;var B={value:y,getSnapshot:h};return A.queue=B,pT(lT.bind(null,I,B,l),[l]),I.flags|=2048,df(9,cT.bind(null,I,B,y,h),void 0,null),y},useId:function(){var l=Qo(),h=Ar.identifierPrefix;if(qn){var y=Oa,I=Da;y=(I&~(1<<32-Fr(I)-1)).toString(32)+y,h=":"+h+"R"+y,y=lf++,0<y&&(h+="H"+y.toString(32)),h+=":"}else y=gW++,h=":"+h+"r"+y.toString(32)+":";return l.memoizedState=h},unstable_isNewReconciler:!1},SW={readContext:Us,useCallback:vT,useContext:Us,useEffect:cS,useImperativeHandle:wT,useInsertionEffect:gT,useLayoutEffect:mT,useMemo:ST,useReducer:oS,useRef:fT,useState:function(){return oS(uf)},useDebugValue:lS,useDeferredValue:function(l){var h=$s();return xT(h,Er.memoizedState,l)},useTransition:function(){var l=oS(uf)[0],h=$s().memoizedState;return[l,h]},useMutableSource:sT,useSyncExternalStore:oT,useId:bT,unstable_isNewReconciler:!1},xW={readContext:Us,useCallback:vT,useContext:Us,useEffect:cS,useImperativeHandle:wT,useInsertionEffect:gT,useLayoutEffect:mT,useMemo:ST,useReducer:aS,useRef:fT,useState:function(){return aS(uf)},useDebugValue:lS,useDeferredValue:function(l){var h=$s();return Er===null?h.memoizedState=l:xT(h,Er.memoizedState,l)},useTransition:function(){var l=aS(uf)[0],h=$s().memoizedState;return[l,h]},useMutableSource:sT,useSyncExternalStore:oT,useId:bT,unstable_isNewReconciler:!1};function po(l,h){if(l&&l.defaultProps){h=ne({},h),l=l.defaultProps;for(var y in l)h[y]===void 0&&(h[y]=l[y]);return h}return h}function uS(l,h,y,I){h=l.memoizedState,y=y(I,h),y=y==null?h:ne({},h,y),l.memoizedState=y,l.lanes===0&&(l.updateQueue.baseState=y)}var qg={isMounted:function(l){return(l=l._reactInternals)?Bs(l)===l:!1},enqueueSetState:function(l,h,y){l=l._reactInternals;var I=Di(),A=Bc(l),B=Na(I,A);B.payload=h,y!=null&&(B.callback=y),h=Dc(l,B,A),h!==null&&(yo(h,l,A,I),Bg(h,l,A))},enqueueReplaceState:function(l,h,y){l=l._reactInternals;var I=Di(),A=Bc(l),B=Na(I,A);B.tag=1,B.payload=h,y!=null&&(B.callback=y),h=Dc(l,B,A),h!==null&&(yo(h,l,A,I),Bg(h,l,A))},enqueueForceUpdate:function(l,h){l=l._reactInternals;var y=Di(),I=Bc(l),A=Na(y,I);A.tag=2,h!=null&&(A.callback=h),h=Dc(l,A,I),h!==null&&(yo(h,l,I,y),Bg(h,l,I))}};function CT(l,h,y,I,A,B,ee){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(I,B,ee):h.prototype&&h.prototype.isPureReactComponent?!Xh(y,I)||!Xh(A,B):!0}function PT(l,h,y){var I=!1,A=Ac,B=h.contextType;return typeof B=="object"&&B!==null?B=Us(B):(A=Gi(h)?Gl:ci.current,I=h.contextTypes,B=(I=I!=null)?dd(l,A):Ac),h=new h(y,B),l.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=qg,l.stateNode=h,h._reactInternals=l,I&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=A,l.__reactInternalMemoizedMaskedChildContext=B),h}function MT(l,h,y,I){l=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(y,I),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(y,I),h.state!==l&&qg.enqueueReplaceState(h,h.state,null)}function dS(l,h,y,I){var A=l.stateNode;A.props=y,A.state=l.memoizedState,A.refs={},Zv(l);var B=h.contextType;typeof B=="object"&&B!==null?A.context=Us(B):(B=Gi(h)?Gl:ci.current,A.context=dd(l,B)),A.state=l.memoizedState,B=h.getDerivedStateFromProps,typeof B=="function"&&(uS(l,h,B,y),A.state=l.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof A.getSnapshotBeforeUpdate=="function"||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(h=A.state,typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount(),h!==A.state&&qg.enqueueReplaceState(A,A.state,null),Fg(l,y,A,I),A.state=l.memoizedState),typeof A.componentDidMount=="function"&&(l.flags|=4194308)}function vd(l,h){try{var y="",I=h;do y+=J(I),I=I.return;while(I);var A=y}catch(B){A=`
Error generating stack: `+B.message+`
`+B.stack}return{value:l,source:h,stack:A,digest:null}}function hS(l,h,y){return{value:l,source:null,stack:y??null,digest:h??null}}function fS(l,h){try{console.error(h.value)}catch(y){setTimeout(function(){throw y})}}var bW=typeof WeakMap=="function"?WeakMap:Map;function TT(l,h,y){y=Na(-1,y),y.tag=3,y.payload={element:null};var I=h.value;return y.callback=function(){Jg||(Jg=!0,MS=I),fS(l,h)},y}function kT(l,h,y){y=Na(-1,y),y.tag=3;var I=l.type.getDerivedStateFromError;if(typeof I=="function"){var A=h.value;y.payload=function(){return I(A)},y.callback=function(){fS(l,h)}}var B=l.stateNode;return B!==null&&typeof B.componentDidCatch=="function"&&(y.callback=function(){fS(l,h),typeof I!="function"&&(Lc===null?Lc=new Set([this]):Lc.add(this));var ee=h.stack;this.componentDidCatch(h.value,{componentStack:ee!==null?ee:""})}),y}function AT(l,h,y){var I=l.pingCache;if(I===null){I=l.pingCache=new bW;var A=new Set;I.set(h,A)}else A=I.get(h),A===void 0&&(A=new Set,I.set(h,A));A.has(y)||(A.add(y),l=LW.bind(null,l,h,y),h.then(l,l))}function RT(l){do{var h;if((h=l.tag===13)&&(h=l.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return l;l=l.return}while(l!==null);return null}function jT(l,h,y,I,A){return l.mode&1?(l.flags|=65536,l.lanes=A,l):(l===h?l.flags|=65536:(l.flags|=128,y.flags|=131072,y.flags&=-52805,y.tag===1&&(y.alternate===null?y.tag=17:(h=Na(-1,1),h.tag=2,Dc(y,h,1))),y.lanes|=1),l)}var _W=M.ReactCurrentOwner,Vi=!1;function ji(l,h,y,I){h.child=l===null?JM(h,null,y,I):gd(h,l.child,y,I)}function DT(l,h,y,I,A){y=y.render;var B=h.ref;return yd(h,A),I=iS(l,h,y,I,B,A),y=sS(),l!==null&&!Vi?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~A,Ba(l,h,A)):(qn&&y&&Uv(h),h.flags|=1,ji(l,h,I,A),h.child)}function OT(l,h,y,I,A){if(l===null){var B=y.type;return typeof B=="function"&&!OS(B)&&B.defaultProps===void 0&&y.compare===null&&y.defaultProps===void 0?(h.tag=15,h.type=B,LT(l,h,B,I,A)):(l=sm(y.type,null,I,h,h.mode,A),l.ref=h.ref,l.return=h,h.child=l)}if(B=l.child,!(l.lanes&A)){var ee=B.memoizedProps;if(y=y.compare,y=y!==null?y:Xh,y(ee,I)&&l.ref===h.ref)return Ba(l,h,A)}return h.flags|=1,l=zc(B,I),l.ref=h.ref,l.return=h,h.child=l}function LT(l,h,y,I,A){if(l!==null){var B=l.memoizedProps;if(Xh(B,I)&&l.ref===h.ref)if(Vi=!1,h.pendingProps=I=B,(l.lanes&A)!==0)l.flags&131072&&(Vi=!0);else return h.lanes=l.lanes,Ba(l,h,A)}return pS(l,h,y,I,A)}function NT(l,h,y){var I=h.pendingProps,A=I.children,B=l!==null?l.memoizedState:null;if(I.mode==="hidden")if(!(h.mode&1))h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Tn(xd,vs),vs|=y;else{if(!(y&1073741824))return l=B!==null?B.baseLanes|y:y,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:l,cachePool:null,transitions:null},h.updateQueue=null,Tn(xd,vs),vs|=l,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},I=B!==null?B.baseLanes:y,Tn(xd,vs),vs|=I}else B!==null?(I=B.baseLanes|y,h.memoizedState=null):I=y,Tn(xd,vs),vs|=I;return ji(l,h,A,y),h.child}function BT(l,h){var y=h.ref;(l===null&&y!==null||l!==null&&l.ref!==y)&&(h.flags|=512,h.flags|=2097152)}function pS(l,h,y,I,A){var B=Gi(y)?Gl:ci.current;return B=dd(h,B),yd(h,A),y=iS(l,h,y,I,B,A),I=sS(),l!==null&&!Vi?(h.updateQueue=l.updateQueue,h.flags&=-2053,l.lanes&=~A,Ba(l,h,A)):(qn&&I&&Uv(h),h.flags|=1,ji(l,h,y,A),h.child)}function FT(l,h,y,I,A){if(Gi(y)){var B=!0;kg(h)}else B=!1;if(yd(h,A),h.stateNode===null)Vg(l,h),PT(h,y,I),dS(h,y,I,A),I=!0;else if(l===null){var ee=h.stateNode,se=h.memoizedProps;ee.props=se;var le=ee.context,be=y.contextType;typeof be=="object"&&be!==null?be=Us(be):(be=Gi(y)?Gl:ci.current,be=dd(h,be));var ke=y.getDerivedStateFromProps,Ae=typeof ke=="function"||typeof ee.getSnapshotBeforeUpdate=="function";Ae||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(se!==I||le!==be)&&MT(h,ee,I,be),jc=!1;var Me=h.memoizedState;ee.state=Me,Fg(h,I,ee,A),le=h.memoizedState,se!==I||Me!==le||qi.current||jc?(typeof ke=="function"&&(uS(h,y,ke,I),le=h.memoizedState),(se=jc||CT(h,y,se,I,Me,le,be))?(Ae||typeof ee.UNSAFE_componentWillMount!="function"&&typeof ee.componentWillMount!="function"||(typeof ee.componentWillMount=="function"&&ee.componentWillMount(),typeof ee.UNSAFE_componentWillMount=="function"&&ee.UNSAFE_componentWillMount()),typeof ee.componentDidMount=="function"&&(h.flags|=4194308)):(typeof ee.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=I,h.memoizedState=le),ee.props=I,ee.state=le,ee.context=be,I=se):(typeof ee.componentDidMount=="function"&&(h.flags|=4194308),I=!1)}else{ee=h.stateNode,tT(l,h),se=h.memoizedProps,be=h.type===h.elementType?se:po(h.type,se),ee.props=be,Ae=h.pendingProps,Me=ee.context,le=y.contextType,typeof le=="object"&&le!==null?le=Us(le):(le=Gi(y)?Gl:ci.current,le=dd(h,le));var We=y.getDerivedStateFromProps;(ke=typeof We=="function"||typeof ee.getSnapshotBeforeUpdate=="function")||typeof ee.UNSAFE_componentWillReceiveProps!="function"&&typeof ee.componentWillReceiveProps!="function"||(se!==Ae||Me!==le)&&MT(h,ee,I,le),jc=!1,Me=h.memoizedState,ee.state=Me,Fg(h,I,ee,A);var Ve=h.memoizedState;se!==Ae||Me!==Ve||qi.current||jc?(typeof We=="function"&&(uS(h,y,We,I),Ve=h.memoizedState),(be=jc||CT(h,y,be,I,Me,Ve,le)||!1)?(ke||typeof ee.UNSAFE_componentWillUpdate!="function"&&typeof ee.componentWillUpdate!="function"||(typeof ee.componentWillUpdate=="function"&&ee.componentWillUpdate(I,Ve,le),typeof ee.UNSAFE_componentWillUpdate=="function"&&ee.UNSAFE_componentWillUpdate(I,Ve,le)),typeof ee.componentDidUpdate=="function"&&(h.flags|=4),typeof ee.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof ee.componentDidUpdate!="function"||se===l.memoizedProps&&Me===l.memoizedState||(h.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||se===l.memoizedProps&&Me===l.memoizedState||(h.flags|=1024),h.memoizedProps=I,h.memoizedState=Ve),ee.props=I,ee.state=Ve,ee.context=le,I=be):(typeof ee.componentDidUpdate!="function"||se===l.memoizedProps&&Me===l.memoizedState||(h.flags|=4),typeof ee.getSnapshotBeforeUpdate!="function"||se===l.memoizedProps&&Me===l.memoizedState||(h.flags|=1024),I=!1)}return gS(l,h,y,I,B,A)}function gS(l,h,y,I,A,B){BT(l,h);var ee=(h.flags&128)!==0;if(!I&&!ee)return A&&WM(h,y,!1),Ba(l,h,B);I=h.stateNode,_W.current=h;var se=ee&&typeof y.getDerivedStateFromError!="function"?null:I.render();return h.flags|=1,l!==null&&ee?(h.child=gd(h,l.child,null,B),h.child=gd(h,null,se,B)):ji(l,h,se,B),h.memoizedState=I.state,A&&WM(h,y,!0),h.child}function zT(l){var h=l.stateNode;h.pendingContext?$M(l,h.pendingContext,h.pendingContext!==h.context):h.context&&$M(l,h.context,!1),Qv(l,h.containerInfo)}function UT(l,h,y,I,A){return pd(),Kv(A),h.flags|=256,ji(l,h,y,I),h.child}var mS={dehydrated:null,treeContext:null,retryLane:0};function yS(l){return{baseLanes:l,cachePool:null,transitions:null}}function $T(l,h,y){var I=h.pendingProps,A=Zn.current,B=!1,ee=(h.flags&128)!==0,se;if((se=ee)||(se=l!==null&&l.memoizedState===null?!1:(A&2)!==0),se?(B=!0,h.flags&=-129):(l===null||l.memoizedState!==null)&&(A|=1),Tn(Zn,A&1),l===null)return Wv(h),l=h.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?(h.mode&1?l.data==="$!"?h.lanes=8:h.lanes=1073741824:h.lanes=1,null):(ee=I.children,l=I.fallback,B?(I=h.mode,B=h.child,ee={mode:"hidden",children:ee},!(I&1)&&B!==null?(B.childLanes=0,B.pendingProps=ee):B=om(ee,I,0,null),l=ru(l,I,y,null),B.return=h,l.return=h,B.sibling=l,h.child=B,h.child.memoizedState=yS(y),h.memoizedState=mS,l):wS(h,ee));if(A=l.memoizedState,A!==null&&(se=A.dehydrated,se!==null))return IW(l,h,ee,I,se,A,y);if(B){B=I.fallback,ee=h.mode,A=l.child,se=A.sibling;var le={mode:"hidden",children:I.children};return!(ee&1)&&h.child!==A?(I=h.child,I.childLanes=0,I.pendingProps=le,h.deletions=null):(I=zc(A,le),I.subtreeFlags=A.subtreeFlags&14680064),se!==null?B=zc(se,B):(B=ru(B,ee,y,null),B.flags|=2),B.return=h,I.return=h,I.sibling=B,h.child=I,I=B,B=h.child,ee=l.child.memoizedState,ee=ee===null?yS(y):{baseLanes:ee.baseLanes|y,cachePool:null,transitions:ee.transitions},B.memoizedState=ee,B.childLanes=l.childLanes&~y,h.memoizedState=mS,I}return B=l.child,l=B.sibling,I=zc(B,{mode:"visible",children:I.children}),!(h.mode&1)&&(I.lanes=y),I.return=h,I.sibling=null,l!==null&&(y=h.deletions,y===null?(h.deletions=[l],h.flags|=16):y.push(l)),h.child=I,h.memoizedState=null,I}function wS(l,h){return h=om({mode:"visible",children:h},l.mode,0,null),h.return=l,l.child=h}function Gg(l,h,y,I){return I!==null&&Kv(I),gd(h,l.child,null,y),l=wS(h,h.pendingProps.children),l.flags|=2,h.memoizedState=null,l}function IW(l,h,y,I,A,B,ee){if(y)return h.flags&256?(h.flags&=-257,I=hS(Error(t(422))),Gg(l,h,ee,I)):h.memoizedState!==null?(h.child=l.child,h.flags|=128,null):(B=I.fallback,A=h.mode,I=om({mode:"visible",children:I.children},A,0,null),B=ru(B,A,ee,null),B.flags|=2,I.return=h,B.return=h,I.sibling=B,h.child=I,h.mode&1&&gd(h,l.child,null,ee),h.child.memoizedState=yS(ee),h.memoizedState=mS,B);if(!(h.mode&1))return Gg(l,h,ee,null);if(A.data==="$!"){if(I=A.nextSibling&&A.nextSibling.dataset,I)var se=I.dgst;return I=se,B=Error(t(419)),I=hS(B,I,void 0),Gg(l,h,ee,I)}if(se=(ee&l.childLanes)!==0,Vi||se){if(I=Ar,I!==null){switch(ee&-ee){case 4:A=2;break;case 16:A=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:A=32;break;case 536870912:A=268435456;break;default:A=0}A=A&(I.suspendedLanes|ee)?0:A,A!==0&&A!==B.retryLane&&(B.retryLane=A,La(l,A),yo(I,l,A,-1))}return DS(),I=hS(Error(t(421))),Gg(l,h,ee,I)}return A.data==="$?"?(h.flags|=128,h.child=l.child,h=NW.bind(null,l),A._reactRetry=h,null):(l=B.treeContext,ws=Tc(A.nextSibling),ys=h,qn=!0,fo=null,l!==null&&(Fs[zs++]=Da,Fs[zs++]=Oa,Fs[zs++]=Vl,Da=l.id,Oa=l.overflow,Vl=h),h=wS(h,I.children),h.flags|=4096,h)}function HT(l,h,y){l.lanes|=h;var I=l.alternate;I!==null&&(I.lanes|=h),Yv(l.return,h,y)}function vS(l,h,y,I,A){var B=l.memoizedState;B===null?l.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:I,tail:y,tailMode:A}:(B.isBackwards=h,B.rendering=null,B.renderingStartTime=0,B.last=I,B.tail=y,B.tailMode=A)}function WT(l,h,y){var I=h.pendingProps,A=I.revealOrder,B=I.tail;if(ji(l,h,I.children,y),I=Zn.current,I&2)I=I&1|2,h.flags|=128;else{if(l!==null&&l.flags&128)e:for(l=h.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&HT(l,y,h);else if(l.tag===19)HT(l,y,h);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===h)break e;for(;l.sibling===null;){if(l.return===null||l.return===h)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}I&=1}if(Tn(Zn,I),!(h.mode&1))h.memoizedState=null;else switch(A){case"forwards":for(y=h.child,A=null;y!==null;)l=y.alternate,l!==null&&zg(l)===null&&(A=y),y=y.sibling;y=A,y===null?(A=h.child,h.child=null):(A=y.sibling,y.sibling=null),vS(h,!1,A,y,B);break;case"backwards":for(y=null,A=h.child,h.child=null;A!==null;){if(l=A.alternate,l!==null&&zg(l)===null){h.child=A;break}l=A.sibling,A.sibling=y,y=A,A=l}vS(h,!0,y,null,B);break;case"together":vS(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function Vg(l,h){!(h.mode&1)&&l!==null&&(l.alternate=null,h.alternate=null,h.flags|=2)}function Ba(l,h,y){if(l!==null&&(h.dependencies=l.dependencies),Jl|=h.lanes,!(y&h.childLanes))return null;if(l!==null&&h.child!==l.child)throw Error(t(153));if(h.child!==null){for(l=h.child,y=zc(l,l.pendingProps),h.child=y,y.return=h;l.sibling!==null;)l=l.sibling,y=y.sibling=zc(l,l.pendingProps),y.return=h;y.sibling=null}return h.child}function EW(l,h,y){switch(h.tag){case 3:zT(h),pd();break;case 5:iT(h);break;case 1:Gi(h.type)&&kg(h);break;case 4:Qv(h,h.stateNode.containerInfo);break;case 10:var I=h.type._context,A=h.memoizedProps.value;Tn(Lg,I._currentValue),I._currentValue=A;break;case 13:if(I=h.memoizedState,I!==null)return I.dehydrated!==null?(Tn(Zn,Zn.current&1),h.flags|=128,null):y&h.child.childLanes?$T(l,h,y):(Tn(Zn,Zn.current&1),l=Ba(l,h,y),l!==null?l.sibling:null);Tn(Zn,Zn.current&1);break;case 19:if(I=(y&h.childLanes)!==0,l.flags&128){if(I)return WT(l,h,y);h.flags|=128}if(A=h.memoizedState,A!==null&&(A.rendering=null,A.tail=null,A.lastEffect=null),Tn(Zn,Zn.current),I)break;return null;case 22:case 23:return h.lanes=0,NT(l,h,y)}return Ba(l,h,y)}var KT,SS,qT,GT;KT=function(l,h){for(var y=h.child;y!==null;){if(y.tag===5||y.tag===6)l.appendChild(y.stateNode);else if(y.tag!==4&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===h)break;for(;y.sibling===null;){if(y.return===null||y.return===h)return;y=y.return}y.sibling.return=y.return,y=y.sibling}},SS=function(){},qT=function(l,h,y,I){var A=l.memoizedProps;if(A!==I){l=h.stateNode,Zl(Zo.current);var B=null;switch(y){case"input":A=et(l,A),I=et(l,I),B=[];break;case"select":A=ne({},A,{value:void 0}),I=ne({},I,{value:void 0}),B=[];break;case"textarea":A=On(l,A),I=On(l,I),B=[];break;default:typeof A.onClick!="function"&&typeof I.onClick=="function"&&(l.onclick=Pg)}at(y,I);var ee;y=null;for(be in A)if(!I.hasOwnProperty(be)&&A.hasOwnProperty(be)&&A[be]!=null)if(be==="style"){var se=A[be];for(ee in se)se.hasOwnProperty(ee)&&(y||(y={}),y[ee]="")}else be!=="dangerouslySetInnerHTML"&&be!=="children"&&be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&be!=="autoFocus"&&(i.hasOwnProperty(be)?B||(B=[]):(B=B||[]).push(be,null));for(be in I){var le=I[be];if(se=A!=null?A[be]:void 0,I.hasOwnProperty(be)&&le!==se&&(le!=null||se!=null))if(be==="style")if(se){for(ee in se)!se.hasOwnProperty(ee)||le&&le.hasOwnProperty(ee)||(y||(y={}),y[ee]="");for(ee in le)le.hasOwnProperty(ee)&&se[ee]!==le[ee]&&(y||(y={}),y[ee]=le[ee])}else y||(B||(B=[]),B.push(be,y)),y=le;else be==="dangerouslySetInnerHTML"?(le=le?le.__html:void 0,se=se?se.__html:void 0,le!=null&&se!==le&&(B=B||[]).push(be,le)):be==="children"?typeof le!="string"&&typeof le!="number"||(B=B||[]).push(be,""+le):be!=="suppressContentEditableWarning"&&be!=="suppressHydrationWarning"&&(i.hasOwnProperty(be)?(le!=null&&be==="onScroll"&&Nn("scroll",l),B||se===le||(B=[])):(B=B||[]).push(be,le))}y&&(B=B||[]).push("style",y);var be=B;(h.updateQueue=be)&&(h.flags|=4)}},GT=function(l,h,y,I){y!==I&&(h.flags|=4)};function hf(l,h){if(!qn)switch(l.tailMode){case"hidden":h=l.tail;for(var y=null;h!==null;)h.alternate!==null&&(y=h),h=h.sibling;y===null?l.tail=null:y.sibling=null;break;case"collapsed":y=l.tail;for(var I=null;y!==null;)y.alternate!==null&&(I=y),y=y.sibling;I===null?h||l.tail===null?l.tail=null:l.tail.sibling=null:I.sibling=null}}function ui(l){var h=l.alternate!==null&&l.alternate.child===l.child,y=0,I=0;if(h)for(var A=l.child;A!==null;)y|=A.lanes|A.childLanes,I|=A.subtreeFlags&14680064,I|=A.flags&14680064,A.return=l,A=A.sibling;else for(A=l.child;A!==null;)y|=A.lanes|A.childLanes,I|=A.subtreeFlags,I|=A.flags,A.return=l,A=A.sibling;return l.subtreeFlags|=I,l.childLanes=y,h}function CW(l,h,y){var I=h.pendingProps;switch($v(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ui(h),null;case 1:return Gi(h.type)&&Tg(),ui(h),null;case 3:return I=h.stateNode,wd(),Bn(qi),Bn(ci),tS(),I.pendingContext&&(I.context=I.pendingContext,I.pendingContext=null),(l===null||l.child===null)&&(Dg(h)?h.flags|=4:l===null||l.memoizedState.isDehydrated&&!(h.flags&256)||(h.flags|=1024,fo!==null&&(AS(fo),fo=null))),SS(l,h),ui(h),null;case 5:Jv(h);var A=Zl(af.current);if(y=h.type,l!==null&&h.stateNode!=null)qT(l,h,y,I,A),l.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!I){if(h.stateNode===null)throw Error(t(166));return ui(h),null}if(l=Zl(Zo.current),Dg(h)){I=h.stateNode,y=h.type;var B=h.memoizedProps;switch(I[Xo]=h,I[tf]=B,l=(h.mode&1)!==0,y){case"dialog":Nn("cancel",I),Nn("close",I);break;case"iframe":case"object":case"embed":Nn("load",I);break;case"video":case"audio":for(A=0;A<Qh.length;A++)Nn(Qh[A],I);break;case"source":Nn("error",I);break;case"img":case"image":case"link":Nn("error",I),Nn("load",I);break;case"details":Nn("toggle",I);break;case"input":Xe(I,B),Nn("invalid",I);break;case"select":I._wrapperState={wasMultiple:!!B.multiple},Nn("invalid",I);break;case"textarea":qt(I,B),Nn("invalid",I)}at(y,B),A=null;for(var ee in B)if(B.hasOwnProperty(ee)){var se=B[ee];ee==="children"?typeof se=="string"?I.textContent!==se&&(B.suppressHydrationWarning!==!0&&Cg(I.textContent,se,l),A=["children",se]):typeof se=="number"&&I.textContent!==""+se&&(B.suppressHydrationWarning!==!0&&Cg(I.textContent,se,l),A=["children",""+se]):i.hasOwnProperty(ee)&&se!=null&&ee==="onScroll"&&Nn("scroll",I)}switch(y){case"input":Ne(I),Ut(I,B,!0);break;case"textarea":Ne(I),dr(I);break;case"select":case"option":break;default:typeof B.onClick=="function"&&(I.onclick=Pg)}I=A,h.updateQueue=I,I!==null&&(h.flags|=4)}else{ee=A.nodeType===9?A:A.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=nn(y)),l==="http://www.w3.org/1999/xhtml"?y==="script"?(l=ee.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof I.is=="string"?l=ee.createElement(y,{is:I.is}):(l=ee.createElement(y),y==="select"&&(ee=l,I.multiple?ee.multiple=!0:I.size&&(ee.size=I.size))):l=ee.createElementNS(l,y),l[Xo]=h,l[tf]=I,KT(l,h,!1,!1),h.stateNode=l;e:{switch(ee=Rt(y,I),y){case"dialog":Nn("cancel",l),Nn("close",l),A=I;break;case"iframe":case"object":case"embed":Nn("load",l),A=I;break;case"video":case"audio":for(A=0;A<Qh.length;A++)Nn(Qh[A],l);A=I;break;case"source":Nn("error",l),A=I;break;case"img":case"image":case"link":Nn("error",l),Nn("load",l),A=I;break;case"details":Nn("toggle",l),A=I;break;case"input":Xe(l,I),A=et(l,I),Nn("invalid",l);break;case"option":A=I;break;case"select":l._wrapperState={wasMultiple:!!I.multiple},A=ne({},I,{value:void 0}),Nn("invalid",l);break;case"textarea":qt(l,I),A=On(l,I),Nn("invalid",l);break;default:A=I}at(y,A),se=A;for(B in se)if(se.hasOwnProperty(B)){var le=se[B];B==="style"?ut(l,le):B==="dangerouslySetInnerHTML"?(le=le?le.__html:void 0,le!=null&&K(l,le)):B==="children"?typeof le=="string"?(y!=="textarea"||le!=="")&&Q(l,le):typeof le=="number"&&Q(l,""+le):B!=="suppressContentEditableWarning"&&B!=="suppressHydrationWarning"&&B!=="autoFocus"&&(i.hasOwnProperty(B)?le!=null&&B==="onScroll"&&Nn("scroll",l):le!=null&&E(l,B,le,ee))}switch(y){case"input":Ne(l),Ut(l,I,!1);break;case"textarea":Ne(l),dr(l);break;case"option":I.value!=null&&l.setAttribute("value",""+fe(I.value));break;case"select":l.multiple=!!I.multiple,B=I.value,B!=null?Et(l,!!I.multiple,B,!1):I.defaultValue!=null&&Et(l,!!I.multiple,I.defaultValue,!0);break;default:typeof A.onClick=="function"&&(l.onclick=Pg)}switch(y){case"button":case"input":case"select":case"textarea":I=!!I.autoFocus;break e;case"img":I=!0;break e;default:I=!1}}I&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return ui(h),null;case 6:if(l&&h.stateNode!=null)GT(l,h,l.memoizedProps,I);else{if(typeof I!="string"&&h.stateNode===null)throw Error(t(166));if(y=Zl(af.current),Zl(Zo.current),Dg(h)){if(I=h.stateNode,y=h.memoizedProps,I[Xo]=h,(B=I.nodeValue!==y)&&(l=ys,l!==null))switch(l.tag){case 3:Cg(I.nodeValue,y,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Cg(I.nodeValue,y,(l.mode&1)!==0)}B&&(h.flags|=4)}else I=(y.nodeType===9?y:y.ownerDocument).createTextNode(I),I[Xo]=h,h.stateNode=I}return ui(h),null;case 13:if(Bn(Zn),I=h.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(qn&&ws!==null&&h.mode&1&&!(h.flags&128))XM(),pd(),h.flags|=98560,B=!1;else if(B=Dg(h),I!==null&&I.dehydrated!==null){if(l===null){if(!B)throw Error(t(318));if(B=h.memoizedState,B=B!==null?B.dehydrated:null,!B)throw Error(t(317));B[Xo]=h}else pd(),!(h.flags&128)&&(h.memoizedState=null),h.flags|=4;ui(h),B=!1}else fo!==null&&(AS(fo),fo=null),B=!0;if(!B)return h.flags&65536?h:null}return h.flags&128?(h.lanes=y,h):(I=I!==null,I!==(l!==null&&l.memoizedState!==null)&&I&&(h.child.flags|=8192,h.mode&1&&(l===null||Zn.current&1?Cr===0&&(Cr=3):DS())),h.updateQueue!==null&&(h.flags|=4),ui(h),null);case 4:return wd(),SS(l,h),l===null&&Jh(h.stateNode.containerInfo),ui(h),null;case 10:return Vv(h.type._context),ui(h),null;case 17:return Gi(h.type)&&Tg(),ui(h),null;case 19:if(Bn(Zn),B=h.memoizedState,B===null)return ui(h),null;if(I=(h.flags&128)!==0,ee=B.rendering,ee===null)if(I)hf(B,!1);else{if(Cr!==0||l!==null&&l.flags&128)for(l=h.child;l!==null;){if(ee=zg(l),ee!==null){for(h.flags|=128,hf(B,!1),I=ee.updateQueue,I!==null&&(h.updateQueue=I,h.flags|=4),h.subtreeFlags=0,I=y,y=h.child;y!==null;)B=y,l=I,B.flags&=14680066,ee=B.alternate,ee===null?(B.childLanes=0,B.lanes=l,B.child=null,B.subtreeFlags=0,B.memoizedProps=null,B.memoizedState=null,B.updateQueue=null,B.dependencies=null,B.stateNode=null):(B.childLanes=ee.childLanes,B.lanes=ee.lanes,B.child=ee.child,B.subtreeFlags=0,B.deletions=null,B.memoizedProps=ee.memoizedProps,B.memoizedState=ee.memoizedState,B.updateQueue=ee.updateQueue,B.type=ee.type,l=ee.dependencies,B.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),y=y.sibling;return Tn(Zn,Zn.current&1|2),h.child}l=l.sibling}B.tail!==null&&xn()>bd&&(h.flags|=128,I=!0,hf(B,!1),h.lanes=4194304)}else{if(!I)if(l=zg(ee),l!==null){if(h.flags|=128,I=!0,y=l.updateQueue,y!==null&&(h.updateQueue=y,h.flags|=4),hf(B,!0),B.tail===null&&B.tailMode==="hidden"&&!ee.alternate&&!qn)return ui(h),null}else 2*xn()-B.renderingStartTime>bd&&y!==1073741824&&(h.flags|=128,I=!0,hf(B,!1),h.lanes=4194304);B.isBackwards?(ee.sibling=h.child,h.child=ee):(y=B.last,y!==null?y.sibling=ee:h.child=ee,B.last=ee)}return B.tail!==null?(h=B.tail,B.rendering=h,B.tail=h.sibling,B.renderingStartTime=xn(),h.sibling=null,y=Zn.current,Tn(Zn,I?y&1|2:y&1),h):(ui(h),null);case 22:case 23:return jS(),I=h.memoizedState!==null,l!==null&&l.memoizedState!==null!==I&&(h.flags|=8192),I&&h.mode&1?vs&1073741824&&(ui(h),h.subtreeFlags&6&&(h.flags|=8192)):ui(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function PW(l,h){switch($v(h),h.tag){case 1:return Gi(h.type)&&Tg(),l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 3:return wd(),Bn(qi),Bn(ci),tS(),l=h.flags,l&65536&&!(l&128)?(h.flags=l&-65537|128,h):null;case 5:return Jv(h),null;case 13:if(Bn(Zn),l=h.memoizedState,l!==null&&l.dehydrated!==null){if(h.alternate===null)throw Error(t(340));pd()}return l=h.flags,l&65536?(h.flags=l&-65537|128,h):null;case 19:return Bn(Zn),null;case 4:return wd(),null;case 10:return Vv(h.type._context),null;case 22:case 23:return jS(),null;case 24:return null;default:return null}}var Yg=!1,di=!1,MW=typeof WeakSet=="function"?WeakSet:Set,qe=null;function Sd(l,h){var y=l.ref;if(y!==null)if(typeof y=="function")try{y(null)}catch(I){sr(l,h,I)}else y.current=null}function xS(l,h,y){try{y()}catch(I){sr(l,h,I)}}var VT=!1;function TW(l,h){if(jv=he,l=CM(),Ev(l)){if("selectionStart"in l)var y={start:l.selectionStart,end:l.selectionEnd};else e:{y=(y=l.ownerDocument)&&y.defaultView||window;var I=y.getSelection&&y.getSelection();if(I&&I.rangeCount!==0){y=I.anchorNode;var A=I.anchorOffset,B=I.focusNode;I=I.focusOffset;try{y.nodeType,B.nodeType}catch{y=null;break e}var ee=0,se=-1,le=-1,be=0,ke=0,Ae=l,Me=null;t:for(;;){for(var We;Ae!==y||A!==0&&Ae.nodeType!==3||(se=ee+A),Ae!==B||I!==0&&Ae.nodeType!==3||(le=ee+I),Ae.nodeType===3&&(ee+=Ae.nodeValue.length),(We=Ae.firstChild)!==null;)Me=Ae,Ae=We;for(;;){if(Ae===l)break t;if(Me===y&&++be===A&&(se=ee),Me===B&&++ke===I&&(le=ee),(We=Ae.nextSibling)!==null)break;Ae=Me,Me=Ae.parentNode}Ae=We}y=se===-1||le===-1?null:{start:se,end:le}}else y=null}y=y||{start:0,end:0}}else y=null;for(Dv={focusedElem:l,selectionRange:y},he=!1,qe=h;qe!==null;)if(h=qe,l=h.child,(h.subtreeFlags&1028)!==0&&l!==null)l.return=h,qe=l;else for(;qe!==null;){h=qe;try{var Ve=h.alternate;if(h.flags&1024)switch(h.tag){case 0:case 11:case 15:break;case 1:if(Ve!==null){var Je=Ve.memoizedProps,pr=Ve.memoizedState,pe=h.stateNode,de=pe.getSnapshotBeforeUpdate(h.elementType===h.type?Je:po(h.type,Je),pr);pe.__reactInternalSnapshotBeforeUpdate=de}break;case 3:var ve=h.stateNode.containerInfo;ve.nodeType===1?ve.textContent="":ve.nodeType===9&&ve.documentElement&&ve.removeChild(ve.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(je){sr(h,h.return,je)}if(l=h.sibling,l!==null){l.return=h.return,qe=l;break}qe=h.return}return Ve=VT,VT=!1,Ve}function ff(l,h,y){var I=h.updateQueue;if(I=I!==null?I.lastEffect:null,I!==null){var A=I=I.next;do{if((A.tag&l)===l){var B=A.destroy;A.destroy=void 0,B!==void 0&&xS(h,y,B)}A=A.next}while(A!==I)}}function Xg(l,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var y=h=h.next;do{if((y.tag&l)===l){var I=y.create;y.destroy=I()}y=y.next}while(y!==h)}}function bS(l){var h=l.ref;if(h!==null){var y=l.stateNode;switch(l.tag){case 5:l=y;break;default:l=y}typeof h=="function"?h(l):h.current=l}}function YT(l){var h=l.alternate;h!==null&&(l.alternate=null,YT(h)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(h=l.stateNode,h!==null&&(delete h[Xo],delete h[tf],delete h[Bv],delete h[dW],delete h[hW])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function XT(l){return l.tag===5||l.tag===3||l.tag===4}function ZT(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||XT(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function _S(l,h,y){var I=l.tag;if(I===5||I===6)l=l.stateNode,h?y.nodeType===8?y.parentNode.insertBefore(l,h):y.insertBefore(l,h):(y.nodeType===8?(h=y.parentNode,h.insertBefore(l,y)):(h=y,h.appendChild(l)),y=y._reactRootContainer,y!=null||h.onclick!==null||(h.onclick=Pg));else if(I!==4&&(l=l.child,l!==null))for(_S(l,h,y),l=l.sibling;l!==null;)_S(l,h,y),l=l.sibling}function IS(l,h,y){var I=l.tag;if(I===5||I===6)l=l.stateNode,h?y.insertBefore(l,h):y.appendChild(l);else if(I!==4&&(l=l.child,l!==null))for(IS(l,h,y),l=l.sibling;l!==null;)IS(l,h,y),l=l.sibling}var Ur=null,go=!1;function Oc(l,h,y){for(y=y.child;y!==null;)QT(l,h,y),y=y.sibling}function QT(l,h,y){if(si&&typeof si.onCommitFiberUnmount=="function")try{si.onCommitFiberUnmount(Wo,y)}catch{}switch(y.tag){case 5:di||Sd(y,h);case 6:var I=Ur,A=go;Ur=null,Oc(l,h,y),Ur=I,go=A,Ur!==null&&(go?(l=Ur,y=y.stateNode,l.nodeType===8?l.parentNode.removeChild(y):l.removeChild(y)):Ur.removeChild(y.stateNode));break;case 18:Ur!==null&&(go?(l=Ur,y=y.stateNode,l.nodeType===8?Nv(l.parentNode,y):l.nodeType===1&&Nv(l,y),Kl(l)):Nv(Ur,y.stateNode));break;case 4:I=Ur,A=go,Ur=y.stateNode.containerInfo,go=!0,Oc(l,h,y),Ur=I,go=A;break;case 0:case 11:case 14:case 15:if(!di&&(I=y.updateQueue,I!==null&&(I=I.lastEffect,I!==null))){A=I=I.next;do{var B=A,ee=B.destroy;B=B.tag,ee!==void 0&&(B&2||B&4)&&xS(y,h,ee),A=A.next}while(A!==I)}Oc(l,h,y);break;case 1:if(!di&&(Sd(y,h),I=y.stateNode,typeof I.componentWillUnmount=="function"))try{I.props=y.memoizedProps,I.state=y.memoizedState,I.componentWillUnmount()}catch(se){sr(y,h,se)}Oc(l,h,y);break;case 21:Oc(l,h,y);break;case 22:y.mode&1?(di=(I=di)||y.memoizedState!==null,Oc(l,h,y),di=I):Oc(l,h,y);break;default:Oc(l,h,y)}}function JT(l){var h=l.updateQueue;if(h!==null){l.updateQueue=null;var y=l.stateNode;y===null&&(y=l.stateNode=new MW),h.forEach(function(I){var A=BW.bind(null,l,I);y.has(I)||(y.add(I),I.then(A,A))})}}function mo(l,h){var y=h.deletions;if(y!==null)for(var I=0;I<y.length;I++){var A=y[I];try{var B=l,ee=h,se=ee;e:for(;se!==null;){switch(se.tag){case 5:Ur=se.stateNode,go=!1;break e;case 3:Ur=se.stateNode.containerInfo,go=!0;break e;case 4:Ur=se.stateNode.containerInfo,go=!0;break e}se=se.return}if(Ur===null)throw Error(t(160));QT(B,ee,A),Ur=null,go=!1;var le=A.alternate;le!==null&&(le.return=null),A.return=null}catch(be){sr(A,h,be)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)ek(h,l),h=h.sibling}function ek(l,h){var y=l.alternate,I=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(mo(h,l),Jo(l),I&4){try{ff(3,l,l.return),Xg(3,l)}catch(Je){sr(l,l.return,Je)}try{ff(5,l,l.return)}catch(Je){sr(l,l.return,Je)}}break;case 1:mo(h,l),Jo(l),I&512&&y!==null&&Sd(y,y.return);break;case 5:if(mo(h,l),Jo(l),I&512&&y!==null&&Sd(y,y.return),l.flags&32){var A=l.stateNode;try{Q(A,"")}catch(Je){sr(l,l.return,Je)}}if(I&4&&(A=l.stateNode,A!=null)){var B=l.memoizedProps,ee=y!==null?y.memoizedProps:B,se=l.type,le=l.updateQueue;if(l.updateQueue=null,le!==null)try{se==="input"&&B.type==="radio"&&B.name!=null&&Kt(A,B),Rt(se,ee);var be=Rt(se,B);for(ee=0;ee<le.length;ee+=2){var ke=le[ee],Ae=le[ee+1];ke==="style"?ut(A,Ae):ke==="dangerouslySetInnerHTML"?K(A,Ae):ke==="children"?Q(A,Ae):E(A,ke,Ae,be)}switch(se){case"input":_t(A,B);break;case"textarea":tn(A,B);break;case"select":var Me=A._wrapperState.wasMultiple;A._wrapperState.wasMultiple=!!B.multiple;var We=B.value;We!=null?Et(A,!!B.multiple,We,!1):Me!==!!B.multiple&&(B.defaultValue!=null?Et(A,!!B.multiple,B.defaultValue,!0):Et(A,!!B.multiple,B.multiple?[]:"",!1))}A[tf]=B}catch(Je){sr(l,l.return,Je)}}break;case 6:if(mo(h,l),Jo(l),I&4){if(l.stateNode===null)throw Error(t(162));A=l.stateNode,B=l.memoizedProps;try{A.nodeValue=B}catch(Je){sr(l,l.return,Je)}}break;case 3:if(mo(h,l),Jo(l),I&4&&y!==null&&y.memoizedState.isDehydrated)try{Kl(h.containerInfo)}catch(Je){sr(l,l.return,Je)}break;case 4:mo(h,l),Jo(l);break;case 13:mo(h,l),Jo(l),A=l.child,A.flags&8192&&(B=A.memoizedState!==null,A.stateNode.isHidden=B,!B||A.alternate!==null&&A.alternate.memoizedState!==null||(PS=xn())),I&4&&JT(l);break;case 22:if(ke=y!==null&&y.memoizedState!==null,l.mode&1?(di=(be=di)||ke,mo(h,l),di=be):mo(h,l),Jo(l),I&8192){if(be=l.memoizedState!==null,(l.stateNode.isHidden=be)&&!ke&&l.mode&1)for(qe=l,ke=l.child;ke!==null;){for(Ae=qe=ke;qe!==null;){switch(Me=qe,We=Me.child,Me.tag){case 0:case 11:case 14:case 15:ff(4,Me,Me.return);break;case 1:Sd(Me,Me.return);var Ve=Me.stateNode;if(typeof Ve.componentWillUnmount=="function"){I=Me,y=Me.return;try{h=I,Ve.props=h.memoizedProps,Ve.state=h.memoizedState,Ve.componentWillUnmount()}catch(Je){sr(I,y,Je)}}break;case 5:Sd(Me,Me.return);break;case 22:if(Me.memoizedState!==null){rk(Ae);continue}}We!==null?(We.return=Me,qe=We):rk(Ae)}ke=ke.sibling}e:for(ke=null,Ae=l;;){if(Ae.tag===5){if(ke===null){ke=Ae;try{A=Ae.stateNode,be?(B=A.style,typeof B.setProperty=="function"?B.setProperty("display","none","important"):B.display="none"):(se=Ae.stateNode,le=Ae.memoizedProps.style,ee=le!=null&&le.hasOwnProperty("display")?le.display:null,se.style.display=ye("display",ee))}catch(Je){sr(l,l.return,Je)}}}else if(Ae.tag===6){if(ke===null)try{Ae.stateNode.nodeValue=be?"":Ae.memoizedProps}catch(Je){sr(l,l.return,Je)}}else if((Ae.tag!==22&&Ae.tag!==23||Ae.memoizedState===null||Ae===l)&&Ae.child!==null){Ae.child.return=Ae,Ae=Ae.child;continue}if(Ae===l)break e;for(;Ae.sibling===null;){if(Ae.return===null||Ae.return===l)break e;ke===Ae&&(ke=null),Ae=Ae.return}ke===Ae&&(ke=null),Ae.sibling.return=Ae.return,Ae=Ae.sibling}}break;case 19:mo(h,l),Jo(l),I&4&&JT(l);break;case 21:break;default:mo(h,l),Jo(l)}}function Jo(l){var h=l.flags;if(h&2){try{e:{for(var y=l.return;y!==null;){if(XT(y)){var I=y;break e}y=y.return}throw Error(t(160))}switch(I.tag){case 5:var A=I.stateNode;I.flags&32&&(Q(A,""),I.flags&=-33);var B=ZT(l);IS(l,B,A);break;case 3:case 4:var ee=I.stateNode.containerInfo,se=ZT(l);_S(l,se,ee);break;default:throw Error(t(161))}}catch(le){sr(l,l.return,le)}l.flags&=-3}h&4096&&(l.flags&=-4097)}function kW(l,h,y){qe=l,tk(l)}function tk(l,h,y){for(var I=(l.mode&1)!==0;qe!==null;){var A=qe,B=A.child;if(A.tag===22&&I){var ee=A.memoizedState!==null||Yg;if(!ee){var se=A.alternate,le=se!==null&&se.memoizedState!==null||di;se=Yg;var be=di;if(Yg=ee,(di=le)&&!be)for(qe=A;qe!==null;)ee=qe,le=ee.child,ee.tag===22&&ee.memoizedState!==null?ik(A):le!==null?(le.return=ee,qe=le):ik(A);for(;B!==null;)qe=B,tk(B),B=B.sibling;qe=A,Yg=se,di=be}nk(l)}else A.subtreeFlags&8772&&B!==null?(B.return=A,qe=B):nk(l)}}function nk(l){for(;qe!==null;){var h=qe;if(h.flags&8772){var y=h.alternate;try{if(h.flags&8772)switch(h.tag){case 0:case 11:case 15:di||Xg(5,h);break;case 1:var I=h.stateNode;if(h.flags&4&&!di)if(y===null)I.componentDidMount();else{var A=h.elementType===h.type?y.memoizedProps:po(h.type,y.memoizedProps);I.componentDidUpdate(A,y.memoizedState,I.__reactInternalSnapshotBeforeUpdate)}var B=h.updateQueue;B!==null&&rT(h,B,I);break;case 3:var ee=h.updateQueue;if(ee!==null){if(y=null,h.child!==null)switch(h.child.tag){case 5:y=h.child.stateNode;break;case 1:y=h.child.stateNode}rT(h,ee,y)}break;case 5:var se=h.stateNode;if(y===null&&h.flags&4){y=se;var le=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":le.autoFocus&&y.focus();break;case"img":le.src&&(y.src=le.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var be=h.alternate;if(be!==null){var ke=be.memoizedState;if(ke!==null){var Ae=ke.dehydrated;Ae!==null&&Kl(Ae)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}di||h.flags&512&&bS(h)}catch(Me){sr(h,h.return,Me)}}if(h===l){qe=null;break}if(y=h.sibling,y!==null){y.return=h.return,qe=y;break}qe=h.return}}function rk(l){for(;qe!==null;){var h=qe;if(h===l){qe=null;break}var y=h.sibling;if(y!==null){y.return=h.return,qe=y;break}qe=h.return}}function ik(l){for(;qe!==null;){var h=qe;try{switch(h.tag){case 0:case 11:case 15:var y=h.return;try{Xg(4,h)}catch(le){sr(h,y,le)}break;case 1:var I=h.stateNode;if(typeof I.componentDidMount=="function"){var A=h.return;try{I.componentDidMount()}catch(le){sr(h,A,le)}}var B=h.return;try{bS(h)}catch(le){sr(h,B,le)}break;case 5:var ee=h.return;try{bS(h)}catch(le){sr(h,ee,le)}}}catch(le){sr(h,h.return,le)}if(h===l){qe=null;break}var se=h.sibling;if(se!==null){se.return=h.return,qe=se;break}qe=h.return}}var AW=Math.ceil,Zg=M.ReactCurrentDispatcher,ES=M.ReactCurrentOwner,Hs=M.ReactCurrentBatchConfig,Zt=0,Ar=null,xr=null,$r=0,vs=0,xd=kc(0),Cr=0,pf=null,Jl=0,Qg=0,CS=0,gf=null,Yi=null,PS=0,bd=1/0,Fa=null,Jg=!1,MS=null,Lc=null,em=!1,Nc=null,tm=0,mf=0,TS=null,nm=-1,rm=0;function Di(){return Zt&6?xn():nm!==-1?nm:nm=xn()}function Bc(l){return l.mode&1?Zt&2&&$r!==0?$r&-$r:pW.transition!==null?(rm===0&&(rm=pg()),rm):(l=Gt,l!==0||(l=window.event,l=l===void 0?16:hr(l.type)),l):1}function yo(l,h,y,I){if(50<mf)throw mf=0,TS=null,Error(t(185));$l(l,y,I),(!(Zt&2)||l!==Ar)&&(l===Ar&&(!(Zt&2)&&(Qg|=y),Cr===4&&Fc(l,$r)),Xi(l,I),y===1&&Zt===0&&!(h.mode&1)&&(bd=xn()+500,Ag&&Rc()))}function Xi(l,h){var y=l.callbackNode;mv(l,h);var I=Ul(l,l===Ar?$r:0);if(I===0)y!==null&&Wi(y),l.callbackNode=null,l.callbackPriority=0;else if(h=I&-I,l.callbackPriority!==h){if(y!=null&&Wi(y),h===1)l.tag===0?fW(ok.bind(null,l)):KM(ok.bind(null,l)),lW(function(){!(Zt&6)&&Rc()}),y=null;else{switch(Aa(I)){case 1:y=ka;break;case 4:y=ao;break;case 16:y=Ho;break;case 536870912:y=Ai;break;default:y=Ho}y=pk(y,sk.bind(null,l))}l.callbackPriority=h,l.callbackNode=y}}function sk(l,h){if(nm=-1,rm=0,Zt&6)throw Error(t(327));var y=l.callbackNode;if(_d()&&l.callbackNode!==y)return null;var I=Ul(l,l===Ar?$r:0);if(I===0)return null;if(I&30||I&l.expiredLanes||h)h=im(l,I);else{h=I;var A=Zt;Zt|=2;var B=ck();(Ar!==l||$r!==h)&&(Fa=null,bd=xn()+500,tu(l,h));do try{DW();break}catch(se){ak(l,se)}while(!0);Gv(),Zg.current=B,Zt=A,xr!==null?h=0:(Ar=null,$r=0,h=Cr)}if(h!==0){if(h===2&&(A=zh(l),A!==0&&(I=A,h=kS(l,A))),h===1)throw y=pf,tu(l,0),Fc(l,I),Xi(l,xn()),y;if(h===6)Fc(l,I);else{if(A=l.current.alternate,!(I&30)&&!RW(A)&&(h=im(l,I),h===2&&(B=zh(l),B!==0&&(I=B,h=kS(l,B))),h===1))throw y=pf,tu(l,0),Fc(l,I),Xi(l,xn()),y;switch(l.finishedWork=A,l.finishedLanes=I,h){case 0:case 1:throw Error(t(345));case 2:nu(l,Yi,Fa);break;case 3:if(Fc(l,I),(I&130023424)===I&&(h=PS+500-xn(),10<h)){if(Ul(l,0)!==0)break;if(A=l.suspendedLanes,(A&I)!==I){Di(),l.pingedLanes|=l.suspendedLanes&A;break}l.timeoutHandle=Lv(nu.bind(null,l,Yi,Fa),h);break}nu(l,Yi,Fa);break;case 4:if(Fc(l,I),(I&4194240)===I)break;for(h=l.eventTimes,A=-1;0<I;){var ee=31-Fr(I);B=1<<ee,ee=h[ee],ee>A&&(A=ee),I&=~B}if(I=A,I=xn()-I,I=(120>I?120:480>I?480:1080>I?1080:1920>I?1920:3e3>I?3e3:4320>I?4320:1960*AW(I/1960))-I,10<I){l.timeoutHandle=Lv(nu.bind(null,l,Yi,Fa),I);break}nu(l,Yi,Fa);break;case 5:nu(l,Yi,Fa);break;default:throw Error(t(329))}}}return Xi(l,xn()),l.callbackNode===y?sk.bind(null,l):null}function kS(l,h){var y=gf;return l.current.memoizedState.isDehydrated&&(tu(l,h).flags|=256),l=im(l,h),l!==2&&(h=Yi,Yi=y,h!==null&&AS(h)),l}function AS(l){Yi===null?Yi=l:Yi.push.apply(Yi,l)}function RW(l){for(var h=l;;){if(h.flags&16384){var y=h.updateQueue;if(y!==null&&(y=y.stores,y!==null))for(var I=0;I<y.length;I++){var A=y[I],B=A.getSnapshot;A=A.value;try{if(!ho(B(),A))return!1}catch{return!1}}}if(y=h.child,h.subtreeFlags&16384&&y!==null)y.return=h,h=y;else{if(h===l)break;for(;h.sibling===null;){if(h.return===null||h.return===l)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Fc(l,h){for(h&=~CS,h&=~Qg,l.suspendedLanes|=h,l.pingedLanes&=~h,l=l.expirationTimes;0<h;){var y=31-Fr(h),I=1<<y;l[y]=-1,h&=~I}}function ok(l){if(Zt&6)throw Error(t(327));_d();var h=Ul(l,0);if(!(h&1))return Xi(l,xn()),null;var y=im(l,h);if(l.tag!==0&&y===2){var I=zh(l);I!==0&&(h=I,y=kS(l,I))}if(y===1)throw y=pf,tu(l,0),Fc(l,h),Xi(l,xn()),y;if(y===6)throw Error(t(345));return l.finishedWork=l.current.alternate,l.finishedLanes=h,nu(l,Yi,Fa),Xi(l,xn()),null}function RS(l,h){var y=Zt;Zt|=1;try{return l(h)}finally{Zt=y,Zt===0&&(bd=xn()+500,Ag&&Rc())}}function eu(l){Nc!==null&&Nc.tag===0&&!(Zt&6)&&_d();var h=Zt;Zt|=1;var y=Hs.transition,I=Gt;try{if(Hs.transition=null,Gt=1,l)return l()}finally{Gt=I,Hs.transition=y,Zt=h,!(Zt&6)&&Rc()}}function jS(){vs=xd.current,Bn(xd)}function tu(l,h){l.finishedWork=null,l.finishedLanes=0;var y=l.timeoutHandle;if(y!==-1&&(l.timeoutHandle=-1,cW(y)),xr!==null)for(y=xr.return;y!==null;){var I=y;switch($v(I),I.tag){case 1:I=I.type.childContextTypes,I!=null&&Tg();break;case 3:wd(),Bn(qi),Bn(ci),tS();break;case 5:Jv(I);break;case 4:wd();break;case 13:Bn(Zn);break;case 19:Bn(Zn);break;case 10:Vv(I.type._context);break;case 22:case 23:jS()}y=y.return}if(Ar=l,xr=l=zc(l.current,null),$r=vs=h,Cr=0,pf=null,CS=Qg=Jl=0,Yi=gf=null,Xl!==null){for(h=0;h<Xl.length;h++)if(y=Xl[h],I=y.interleaved,I!==null){y.interleaved=null;var A=I.next,B=y.pending;if(B!==null){var ee=B.next;B.next=A,I.next=ee}y.pending=I}Xl=null}return l}function ak(l,h){do{var y=xr;try{if(Gv(),Ug.current=Kg,$g){for(var I=Qn.memoizedState;I!==null;){var A=I.queue;A!==null&&(A.pending=null),I=I.next}$g=!1}if(Ql=0,kr=Er=Qn=null,cf=!1,lf=0,ES.current=null,y===null||y.return===null){Cr=1,pf=h,xr=null;break}e:{var B=l,ee=y.return,se=y,le=h;if(h=$r,se.flags|=32768,le!==null&&typeof le=="object"&&typeof le.then=="function"){var be=le,ke=se,Ae=ke.tag;if(!(ke.mode&1)&&(Ae===0||Ae===11||Ae===15)){var Me=ke.alternate;Me?(ke.updateQueue=Me.updateQueue,ke.memoizedState=Me.memoizedState,ke.lanes=Me.lanes):(ke.updateQueue=null,ke.memoizedState=null)}var We=RT(ee);if(We!==null){We.flags&=-257,jT(We,ee,se,B,h),We.mode&1&&AT(B,be,h),h=We,le=be;var Ve=h.updateQueue;if(Ve===null){var Je=new Set;Je.add(le),h.updateQueue=Je}else Ve.add(le);break e}else{if(!(h&1)){AT(B,be,h),DS();break e}le=Error(t(426))}}else if(qn&&se.mode&1){var pr=RT(ee);if(pr!==null){!(pr.flags&65536)&&(pr.flags|=256),jT(pr,ee,se,B,h),Kv(vd(le,se));break e}}B=le=vd(le,se),Cr!==4&&(Cr=2),gf===null?gf=[B]:gf.push(B),B=ee;do{switch(B.tag){case 3:B.flags|=65536,h&=-h,B.lanes|=h;var pe=TT(B,le,h);nT(B,pe);break e;case 1:se=le;var de=B.type,ve=B.stateNode;if(!(B.flags&128)&&(typeof de.getDerivedStateFromError=="function"||ve!==null&&typeof ve.componentDidCatch=="function"&&(Lc===null||!Lc.has(ve)))){B.flags|=65536,h&=-h,B.lanes|=h;var je=kT(B,se,h);nT(B,je);break e}}B=B.return}while(B!==null)}uk(y)}catch(tt){h=tt,xr===y&&y!==null&&(xr=y=y.return);continue}break}while(!0)}function ck(){var l=Zg.current;return Zg.current=Kg,l===null?Kg:l}function DS(){(Cr===0||Cr===3||Cr===2)&&(Cr=4),Ar===null||!(Jl&268435455)&&!(Qg&268435455)||Fc(Ar,$r)}function im(l,h){var y=Zt;Zt|=2;var I=ck();(Ar!==l||$r!==h)&&(Fa=null,tu(l,h));do try{jW();break}catch(A){ak(l,A)}while(!0);if(Gv(),Zt=y,Zg.current=I,xr!==null)throw Error(t(261));return Ar=null,$r=0,Cr}function jW(){for(;xr!==null;)lk(xr)}function DW(){for(;xr!==null&&!Ol();)lk(xr)}function lk(l){var h=fk(l.alternate,l,vs);l.memoizedProps=l.pendingProps,h===null?uk(l):xr=h,ES.current=null}function uk(l){var h=l;do{var y=h.alternate;if(l=h.return,h.flags&32768){if(y=PW(y,h),y!==null){y.flags&=32767,xr=y;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{Cr=6,xr=null;return}}else if(y=CW(y,h,vs),y!==null){xr=y;return}if(h=h.sibling,h!==null){xr=h;return}xr=h=l}while(h!==null);Cr===0&&(Cr=5)}function nu(l,h,y){var I=Gt,A=Hs.transition;try{Hs.transition=null,Gt=1,OW(l,h,y,I)}finally{Hs.transition=A,Gt=I}return null}function OW(l,h,y,I){do _d();while(Nc!==null);if(Zt&6)throw Error(t(327));y=l.finishedWork;var A=l.finishedLanes;if(y===null)return null;if(l.finishedWork=null,l.finishedLanes=0,y===l.current)throw Error(t(177));l.callbackNode=null,l.callbackPriority=0;var B=y.lanes|y.childLanes;if(yv(l,B),l===Ar&&(xr=Ar=null,$r=0),!(y.subtreeFlags&2064)&&!(y.flags&2064)||em||(em=!0,pk(Ho,function(){return _d(),null})),B=(y.flags&15990)!==0,y.subtreeFlags&15990||B){B=Hs.transition,Hs.transition=null;var ee=Gt;Gt=1;var se=Zt;Zt|=4,ES.current=null,TW(l,y),ek(y,l),tW(Dv),he=!!jv,Dv=jv=null,l.current=y,kW(y),Ll(),Zt=se,Gt=ee,Hs.transition=B}else l.current=y;if(em&&(em=!1,Nc=l,tm=A),B=l.pendingLanes,B===0&&(Lc=null),Fl(y.stateNode),Xi(l,xn()),h!==null)for(I=l.onRecoverableError,y=0;y<h.length;y++)A=h[y],I(A.value,{componentStack:A.stack,digest:A.digest});if(Jg)throw Jg=!1,l=MS,MS=null,l;return tm&1&&l.tag!==0&&_d(),B=l.pendingLanes,B&1?l===TS?mf++:(mf=0,TS=l):mf=0,Rc(),null}function _d(){if(Nc!==null){var l=Aa(tm),h=Hs.transition,y=Gt;try{if(Hs.transition=null,Gt=16>l?16:l,Nc===null)var I=!1;else{if(l=Nc,Nc=null,tm=0,Zt&6)throw Error(t(331));var A=Zt;for(Zt|=4,qe=l.current;qe!==null;){var B=qe,ee=B.child;if(qe.flags&16){var se=B.deletions;if(se!==null){for(var le=0;le<se.length;le++){var be=se[le];for(qe=be;qe!==null;){var ke=qe;switch(ke.tag){case 0:case 11:case 15:ff(8,ke,B)}var Ae=ke.child;if(Ae!==null)Ae.return=ke,qe=Ae;else for(;qe!==null;){ke=qe;var Me=ke.sibling,We=ke.return;if(YT(ke),ke===be){qe=null;break}if(Me!==null){Me.return=We,qe=Me;break}qe=We}}}var Ve=B.alternate;if(Ve!==null){var Je=Ve.child;if(Je!==null){Ve.child=null;do{var pr=Je.sibling;Je.sibling=null,Je=pr}while(Je!==null)}}qe=B}}if(B.subtreeFlags&2064&&ee!==null)ee.return=B,qe=ee;else e:for(;qe!==null;){if(B=qe,B.flags&2048)switch(B.tag){case 0:case 11:case 15:ff(9,B,B.return)}var pe=B.sibling;if(pe!==null){pe.return=B.return,qe=pe;break e}qe=B.return}}var de=l.current;for(qe=de;qe!==null;){ee=qe;var ve=ee.child;if(ee.subtreeFlags&2064&&ve!==null)ve.return=ee,qe=ve;else e:for(ee=de;qe!==null;){if(se=qe,se.flags&2048)try{switch(se.tag){case 0:case 11:case 15:Xg(9,se)}}catch(tt){sr(se,se.return,tt)}if(se===ee){qe=null;break e}var je=se.sibling;if(je!==null){je.return=se.return,qe=je;break e}qe=se.return}}if(Zt=A,Rc(),si&&typeof si.onPostCommitFiberRoot=="function")try{si.onPostCommitFiberRoot(Wo,l)}catch{}I=!0}return I}finally{Gt=y,Hs.transition=h}}return!1}function dk(l,h,y){h=vd(y,h),h=TT(l,h,1),l=Dc(l,h,1),h=Di(),l!==null&&($l(l,1,h),Xi(l,h))}function sr(l,h,y){if(l.tag===3)dk(l,l,y);else for(;h!==null;){if(h.tag===3){dk(h,l,y);break}else if(h.tag===1){var I=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof I.componentDidCatch=="function"&&(Lc===null||!Lc.has(I))){l=vd(y,l),l=kT(h,l,1),h=Dc(h,l,1),l=Di(),h!==null&&($l(h,1,l),Xi(h,l));break}}h=h.return}}function LW(l,h,y){var I=l.pingCache;I!==null&&I.delete(h),h=Di(),l.pingedLanes|=l.suspendedLanes&y,Ar===l&&($r&y)===y&&(Cr===4||Cr===3&&($r&130023424)===$r&&500>xn()-PS?tu(l,0):CS|=y),Xi(l,h)}function hk(l,h){h===0&&(l.mode&1?(h=Ko,Ko<<=1,!(Ko&130023424)&&(Ko=4194304)):h=1);var y=Di();l=La(l,h),l!==null&&($l(l,h,y),Xi(l,y))}function NW(l){var h=l.memoizedState,y=0;h!==null&&(y=h.retryLane),hk(l,y)}function BW(l,h){var y=0;switch(l.tag){case 13:var I=l.stateNode,A=l.memoizedState;A!==null&&(y=A.retryLane);break;case 19:I=l.stateNode;break;default:throw Error(t(314))}I!==null&&I.delete(h),hk(l,y)}var fk;fk=function(l,h,y){if(l!==null)if(l.memoizedProps!==h.pendingProps||qi.current)Vi=!0;else{if(!(l.lanes&y)&&!(h.flags&128))return Vi=!1,EW(l,h,y);Vi=!!(l.flags&131072)}else Vi=!1,qn&&h.flags&1048576&&qM(h,jg,h.index);switch(h.lanes=0,h.tag){case 2:var I=h.type;Vg(l,h),l=h.pendingProps;var A=dd(h,ci.current);yd(h,y),A=iS(null,h,I,l,A,y);var B=sS();return h.flags|=1,typeof A=="object"&&A!==null&&typeof A.render=="function"&&A.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,Gi(I)?(B=!0,kg(h)):B=!1,h.memoizedState=A.state!==null&&A.state!==void 0?A.state:null,Zv(h),A.updater=qg,h.stateNode=A,A._reactInternals=h,dS(h,I,l,y),h=gS(null,h,I,!0,B,y)):(h.tag=0,qn&&B&&Uv(h),ji(null,h,A,y),h=h.child),h;case 16:I=h.elementType;e:{switch(Vg(l,h),l=h.pendingProps,A=I._init,I=A(I._payload),h.type=I,A=h.tag=zW(I),l=po(I,l),A){case 0:h=pS(null,h,I,l,y);break e;case 1:h=FT(null,h,I,l,y);break e;case 11:h=DT(null,h,I,l,y);break e;case 14:h=OT(null,h,I,po(I.type,l),y);break e}throw Error(t(306,I,""))}return h;case 0:return I=h.type,A=h.pendingProps,A=h.elementType===I?A:po(I,A),pS(l,h,I,A,y);case 1:return I=h.type,A=h.pendingProps,A=h.elementType===I?A:po(I,A),FT(l,h,I,A,y);case 3:e:{if(zT(h),l===null)throw Error(t(387));I=h.pendingProps,B=h.memoizedState,A=B.element,tT(l,h),Fg(h,I,null,y);var ee=h.memoizedState;if(I=ee.element,B.isDehydrated)if(B={element:I,isDehydrated:!1,cache:ee.cache,pendingSuspenseBoundaries:ee.pendingSuspenseBoundaries,transitions:ee.transitions},h.updateQueue.baseState=B,h.memoizedState=B,h.flags&256){A=vd(Error(t(423)),h),h=UT(l,h,I,y,A);break e}else if(I!==A){A=vd(Error(t(424)),h),h=UT(l,h,I,y,A);break e}else for(ws=Tc(h.stateNode.containerInfo.firstChild),ys=h,qn=!0,fo=null,y=JM(h,null,I,y),h.child=y;y;)y.flags=y.flags&-3|4096,y=y.sibling;else{if(pd(),I===A){h=Ba(l,h,y);break e}ji(l,h,I,y)}h=h.child}return h;case 5:return iT(h),l===null&&Wv(h),I=h.type,A=h.pendingProps,B=l!==null?l.memoizedProps:null,ee=A.children,Ov(I,A)?ee=null:B!==null&&Ov(I,B)&&(h.flags|=32),BT(l,h),ji(l,h,ee,y),h.child;case 6:return l===null&&Wv(h),null;case 13:return $T(l,h,y);case 4:return Qv(h,h.stateNode.containerInfo),I=h.pendingProps,l===null?h.child=gd(h,null,I,y):ji(l,h,I,y),h.child;case 11:return I=h.type,A=h.pendingProps,A=h.elementType===I?A:po(I,A),DT(l,h,I,A,y);case 7:return ji(l,h,h.pendingProps,y),h.child;case 8:return ji(l,h,h.pendingProps.children,y),h.child;case 12:return ji(l,h,h.pendingProps.children,y),h.child;case 10:e:{if(I=h.type._context,A=h.pendingProps,B=h.memoizedProps,ee=A.value,Tn(Lg,I._currentValue),I._currentValue=ee,B!==null)if(ho(B.value,ee)){if(B.children===A.children&&!qi.current){h=Ba(l,h,y);break e}}else for(B=h.child,B!==null&&(B.return=h);B!==null;){var se=B.dependencies;if(se!==null){ee=B.child;for(var le=se.firstContext;le!==null;){if(le.context===I){if(B.tag===1){le=Na(-1,y&-y),le.tag=2;var be=B.updateQueue;if(be!==null){be=be.shared;var ke=be.pending;ke===null?le.next=le:(le.next=ke.next,ke.next=le),be.pending=le}}B.lanes|=y,le=B.alternate,le!==null&&(le.lanes|=y),Yv(B.return,y,h),se.lanes|=y;break}le=le.next}}else if(B.tag===10)ee=B.type===h.type?null:B.child;else if(B.tag===18){if(ee=B.return,ee===null)throw Error(t(341));ee.lanes|=y,se=ee.alternate,se!==null&&(se.lanes|=y),Yv(ee,y,h),ee=B.sibling}else ee=B.child;if(ee!==null)ee.return=B;else for(ee=B;ee!==null;){if(ee===h){ee=null;break}if(B=ee.sibling,B!==null){B.return=ee.return,ee=B;break}ee=ee.return}B=ee}ji(l,h,A.children,y),h=h.child}return h;case 9:return A=h.type,I=h.pendingProps.children,yd(h,y),A=Us(A),I=I(A),h.flags|=1,ji(l,h,I,y),h.child;case 14:return I=h.type,A=po(I,h.pendingProps),A=po(I.type,A),OT(l,h,I,A,y);case 15:return LT(l,h,h.type,h.pendingProps,y);case 17:return I=h.type,A=h.pendingProps,A=h.elementType===I?A:po(I,A),Vg(l,h),h.tag=1,Gi(I)?(l=!0,kg(h)):l=!1,yd(h,y),PT(h,I,A),dS(h,I,A,y),gS(null,h,I,!0,l,y);case 19:return WT(l,h,y);case 22:return NT(l,h,y)}throw Error(t(156,h.tag))};function pk(l,h){return _c(l,h)}function FW(l,h,y,I){this.tag=l,this.key=y,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=I,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ws(l,h,y,I){return new FW(l,h,y,I)}function OS(l){return l=l.prototype,!(!l||!l.isReactComponent)}function zW(l){if(typeof l=="function")return OS(l)?1:0;if(l!=null){if(l=l.$$typeof,l===V)return 11;if(l===k)return 14}return 2}function zc(l,h){var y=l.alternate;return y===null?(y=Ws(l.tag,h,l.key,l.mode),y.elementType=l.elementType,y.type=l.type,y.stateNode=l.stateNode,y.alternate=l,l.alternate=y):(y.pendingProps=h,y.type=l.type,y.flags=0,y.subtreeFlags=0,y.deletions=null),y.flags=l.flags&14680064,y.childLanes=l.childLanes,y.lanes=l.lanes,y.child=l.child,y.memoizedProps=l.memoizedProps,y.memoizedState=l.memoizedState,y.updateQueue=l.updateQueue,h=l.dependencies,y.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},y.sibling=l.sibling,y.index=l.index,y.ref=l.ref,y}function sm(l,h,y,I,A,B){var ee=2;if(I=l,typeof l=="function")OS(l)&&(ee=1);else if(typeof l=="string")ee=5;else e:switch(l){case H:return ru(y.children,A,B,h);case L:ee=8,A|=8;break;case U:return l=Ws(12,y,h,A|2),l.elementType=U,l.lanes=B,l;case N:return l=Ws(13,y,h,A),l.elementType=N,l.lanes=B,l;case _:return l=Ws(19,y,h,A),l.elementType=_,l.lanes=B,l;case W:return om(y,A,B,h);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case z:ee=10;break e;case Y:ee=9;break e;case V:ee=11;break e;case k:ee=14;break e;case O:ee=16,I=null;break e}throw Error(t(130,l==null?l:typeof l,""))}return h=Ws(ee,y,h,A),h.elementType=l,h.type=I,h.lanes=B,h}function ru(l,h,y,I){return l=Ws(7,l,I,h),l.lanes=y,l}function om(l,h,y,I){return l=Ws(22,l,I,h),l.elementType=W,l.lanes=y,l.stateNode={isHidden:!1},l}function LS(l,h,y){return l=Ws(6,l,null,h),l.lanes=y,l}function NS(l,h,y){return h=Ws(4,l.children!==null?l.children:[],l.key,h),h.lanes=y,h.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},h}function UW(l,h,y,I,A){this.tag=h,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ed(0),this.expirationTimes=ed(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ed(0),this.identifierPrefix=I,this.onRecoverableError=A,this.mutableSourceEagerHydrationData=null}function BS(l,h,y,I,A,B,ee,se,le){return l=new UW(l,h,y,se,le),h===1?(h=1,B===!0&&(h|=8)):h=0,B=Ws(3,null,null,h),l.current=B,B.stateNode=l,B.memoizedState={element:I,isDehydrated:y,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zv(B),l}function $W(l,h,y){var I=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:I==null?null:""+I,children:l,containerInfo:h,implementation:y}}function gk(l){if(!l)return Ac;l=l._reactInternals;e:{if(Bs(l)!==l||l.tag!==1)throw Error(t(170));var h=l;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(Gi(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(l.tag===1){var y=l.type;if(Gi(y))return HM(l,y,h)}return h}function mk(l,h,y,I,A,B,ee,se,le){return l=BS(y,I,!0,l,A,B,ee,se,le),l.context=gk(null),y=l.current,I=Di(),A=Bc(y),B=Na(I,A),B.callback=h??null,Dc(y,B,A),l.current.lanes=A,$l(l,A,I),Xi(l,I),l}function am(l,h,y,I){var A=h.current,B=Di(),ee=Bc(A);return y=gk(y),h.context===null?h.context=y:h.pendingContext=y,h=Na(B,ee),h.payload={element:l},I=I===void 0?null:I,I!==null&&(h.callback=I),l=Dc(A,h,ee),l!==null&&(yo(l,A,ee,B),Bg(l,A,ee)),ee}function cm(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function yk(l,h){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var y=l.retryLane;l.retryLane=y!==0&&y<h?y:h}}function FS(l,h){yk(l,h),(l=l.alternate)&&yk(l,h)}function HW(){return null}var wk=typeof reportError=="function"?reportError:function(l){console.error(l)};function zS(l){this._internalRoot=l}lm.prototype.render=zS.prototype.render=function(l){var h=this._internalRoot;if(h===null)throw Error(t(409));am(l,h,null,null)},lm.prototype.unmount=zS.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var h=l.containerInfo;eu(function(){am(null,l,null,null)}),h[Ra]=null}};function lm(l){this._internalRoot=l}lm.prototype.unstable_scheduleHydration=function(l){if(l){var h=mg();l={blockedOn:null,target:l,priority:h};for(var y=0;y<Vo.length&&h!==0&&h<Vo[y].priority;y++);Vo.splice(y,0,l),y===0&&Wh(l)}};function US(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function um(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function vk(){}function WW(l,h,y,I,A){if(A){if(typeof I=="function"){var B=I;I=function(){var be=cm(ee);B.call(be)}}var ee=mk(h,I,l,0,null,!1,!1,"",vk);return l._reactRootContainer=ee,l[Ra]=ee.current,Jh(l.nodeType===8?l.parentNode:l),eu(),ee}for(;A=l.lastChild;)l.removeChild(A);if(typeof I=="function"){var se=I;I=function(){var be=cm(le);se.call(be)}}var le=BS(l,0,!1,null,null,!1,!1,"",vk);return l._reactRootContainer=le,l[Ra]=le.current,Jh(l.nodeType===8?l.parentNode:l),eu(function(){am(h,le,y,I)}),le}function dm(l,h,y,I,A){var B=y._reactRootContainer;if(B){var ee=B;if(typeof A=="function"){var se=A;A=function(){var le=cm(ee);se.call(le)}}am(h,ee,l,A)}else ee=WW(y,h,l,A,I);return cm(ee)}gg=function(l){switch(l.tag){case 3:var h=l.stateNode;if(h.current.memoizedState.isDehydrated){var y=Ic(h.pendingLanes);y!==0&&(td(h,y|1),Xi(h,xn()),!(Zt&6)&&(bd=xn()+500,Rc()))}break;case 13:eu(function(){var I=La(l,1);if(I!==null){var A=Di();yo(I,l,1,A)}}),FS(l,1)}},Uh=function(l){if(l.tag===13){var h=La(l,134217728);if(h!==null){var y=Di();yo(h,l,134217728,y)}FS(l,134217728)}},co=function(l){if(l.tag===13){var h=Bc(l),y=La(l,h);if(y!==null){var I=Di();yo(y,l,h,I)}FS(l,h)}},mg=function(){return Gt},yg=function(l,h){var y=Gt;try{return Gt=l,h()}finally{Gt=y}},ii=function(l,h,y){switch(h){case"input":if(_t(l,y),h=y.name,y.type==="radio"&&h!=null){for(y=l;y.parentNode;)y=y.parentNode;for(y=y.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<y.length;h++){var I=y[h];if(I!==l&&I.form===l.form){var A=Mg(I);if(!A)throw Error(t(90));Ze(I),_t(I,A)}}}break;case"textarea":tn(l,y);break;case"select":h=y.value,h!=null&&Et(l,!!y.multiple,h,!1)}},Ta=RS,Sn=eu;var KW={usingClientEntryPoint:!1,Events:[nf,ld,Mg,dn,vn,RS]},yf={findFiberByHostInstance:ql,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qW={bundleType:yf.bundleType,version:yf.version,rendererPackageName:yf.rendererPackageName,rendererConfig:yf.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=xc(l),l===null?null:l.stateNode},findFiberByHostInstance:yf.findFiberByHostInstance||HW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hm.isDisabled&&hm.supportsFiber)try{Wo=hm.inject(qW),si=hm}catch{}}return Zi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=KW,Zi.createPortal=function(l,h){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!US(h))throw Error(t(200));return $W(l,h,null,y)},Zi.createRoot=function(l,h){if(!US(l))throw Error(t(299));var y=!1,I="",A=wk;return h!=null&&(h.unstable_strictMode===!0&&(y=!0),h.identifierPrefix!==void 0&&(I=h.identifierPrefix),h.onRecoverableError!==void 0&&(A=h.onRecoverableError)),h=BS(l,1,!1,null,null,y,!1,I,A),l[Ra]=h.current,Jh(l.nodeType===8?l.parentNode:l),new zS(h)},Zi.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var h=l._reactInternals;if(h===void 0)throw typeof l.render=="function"?Error(t(188)):(l=Object.keys(l).join(","),Error(t(268,l)));return l=xc(h),l=l===null?null:l.stateNode,l},Zi.flushSync=function(l){return eu(l)},Zi.hydrate=function(l,h,y){if(!um(h))throw Error(t(200));return dm(null,l,h,!0,y)},Zi.hydrateRoot=function(l,h,y){if(!US(l))throw Error(t(405));var I=y!=null&&y.hydratedSources||null,A=!1,B="",ee=wk;if(y!=null&&(y.unstable_strictMode===!0&&(A=!0),y.identifierPrefix!==void 0&&(B=y.identifierPrefix),y.onRecoverableError!==void 0&&(ee=y.onRecoverableError)),h=mk(h,null,l,1,y??null,A,!1,B,ee),l[Ra]=h.current,Jh(l),I)for(l=0;l<I.length;l++)y=I[l],A=y._getVersion,A=A(y._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[y,A]:h.mutableSourceEagerHydrationData.push(y,A);return new lm(h)},Zi.render=function(l,h,y){if(!um(h))throw Error(t(200));return dm(null,l,h,!1,y)},Zi.unmountComponentAtNode=function(l){if(!um(l))throw Error(t(40));return l._reactRootContainer?(eu(function(){dm(null,null,l,!1,function(){l._reactRootContainer=null,l[Ra]=null})}),!0):!1},Zi.unstable_batchedUpdates=RS,Zi.unstable_renderSubtreeIntoContainer=function(l,h,y,I){if(!um(y))throw Error(t(200));if(l==null||l._reactInternals===void 0)throw Error(t(38));return dm(l,h,y,!1,I)},Zi.version="18.3.1-next-f1338f8080-20240426",Zi}var Pk;function k4(){if(Pk)return WS.exports;Pk=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),WS.exports=nK(),WS.exports}var Mk;function rK(){if(Mk)return fm;Mk=1;var n=k4();return fm.createRoot=n.createRoot,fm.hydrateRoot=n.hydrateRoot,fm}var A4=rK();const GS="__TLDRAW_LIBRARY_VERSIONS__";function iK(){if(globalThis[GS])return globalThis[GS];const n={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,GS,{value:n,writable:!1,configurable:!1,enumerable:!1}),n}function xa(n,e,t){if(!n||!e||!t)throw new Error("Missing name/version/module system in built version of tldraw library");const r=iK();if(r.versions.push({name:n,version:e,modules:t}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,Tk(r)},100)}catch{Tk(r)}}function Tk(n){if(!n.versions.length||n.didWarn)return;const e=n.versions.sort((a,c)=>kk(a.version,c.version)),t=e[e.length-1].version,r=new Set,i=new Map;for(const a of e){if(i.has(a.name)){r.delete(a.name),VS(i,a.name,new Set).add(a.version);continue}a.version===t?r.add(a.name):(r.delete(a.name),VS(i,a.name,new Set).add(a.version))}if(i.size>0){const a=[`${za("[tldraw]",["bold","bgRed","textWhite"])} ${za("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${za(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,c=>`    ${za(c,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(i,([c,u])=>{const d=Array.from(u).sort(kk).map(f=>za(`v${f}`,f===t?["textGreen"]:["textRed"]));return`    ${za(c,["bold"])} (${d.join(", ")})`})];console.log(a.join(`
`)),n.didWarn=!0;return}const s=new Map;for(const a of e)VS(s,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const o=new Map;for(const[a,c]of s)c.modules.length>1&&o.set(a,c);if(o.size>0){const a=[`${za("[tldraw]",["bold","bgRed","textWhite"])} ${za("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([c,u])=>{const d=u.modules.map((f,g)=>f==="esm"?`      ${g+1}. ES Modules`:`      ${g+1}. CommonJS`).join(`
`);return`    ${za(c,["bold"])} v${u.version}: 
${d}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),n.didWarn=!0;return}}function kk(n,e){const t=n.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!r?n.localeCompare(e):t[1]!==r[1]?Number(t[1])-Number(r[1]):t[2]!==r[2]?Number(t[2])-Number(r[2]):t[3]!==r[3]?Number(t[3])-Number(r[3]):t[4]&&r[4]?t[4].localeCompare(r[4]):t[4]?1:r[4]?-1:0}const sK={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function za(n,e=[]){return`\x1B[${e.map(t=>sK[t]).join(";")}m${n}\x1B[m`}function VS(n,e,t){return n.has(e)?n.get(e):(n.set(e,t),t)}var YS,Ak;function oK(){if(Ak)return YS;Ak=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,i=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof cs=="object"&&cs&&cs.Object===Object&&cs,u=typeof self=="object"&&self&&self.Object===Object&&self,d=c||u||Function("return this")(),f=Object.prototype,g=f.toString,m=Math.max,v=Math.min,w=function(){return d.Date.now()};function S(D,H,L){var U,z,Y,V,N,_,k=0,O=!1,W=!1,q=!0;if(typeof D!="function")throw new TypeError(n);H=j(H)||0,x(L)&&(O=!!L.leading,W="maxWait"in L,Y=W?m(j(L.maxWait)||0,H):Y,q="trailing"in L?!!L.trailing:q);function X(fe){var _e=U,Le=z;return U=z=void 0,k=fe,V=D.apply(Le,_e),V}function ne(fe){return k=fe,N=setTimeout(R,H),O?X(fe):V}function $(fe){var _e=fe-_,Le=fe-k,Ne=H-_e;return W?v(Ne,Y-Le):Ne}function C(fe){var _e=fe-_,Le=fe-k;return _===void 0||_e>=H||_e<0||W&&Le>=Y}function R(){var fe=w();if(C(fe))return Z(fe);N=setTimeout(R,$(fe))}function Z(fe){return N=void 0,q&&U?X(fe):(U=z=void 0,V)}function J(){N!==void 0&&clearTimeout(N),k=0,U=_=z=N=void 0}function oe(){return N===void 0?V:Z(w())}function ue(){var fe=w(),_e=C(fe);if(U=arguments,z=this,_=fe,_e){if(N===void 0)return ne(_);if(W)return N=setTimeout(R,H),X(_)}return N===void 0&&(N=setTimeout(R,H)),V}return ue.cancel=J,ue.flush=oe,ue}function b(D,H,L){var U=!0,z=!0;if(typeof D!="function")throw new TypeError(n);return x(L)&&(U="leading"in L?!!L.leading:U,z="trailing"in L?!!L.trailing:z),S(D,H,{leading:U,maxWait:H,trailing:z})}function x(D){var H=typeof D;return!!D&&(H=="object"||H=="function")}function E(D){return!!D&&typeof D=="object"}function M(D){return typeof D=="symbol"||E(D)&&g.call(D)==t}function j(D){if(typeof D=="number")return D;if(M(D))return e;if(x(D)){var H=typeof D.valueOf=="function"?D.valueOf():D;D=x(H)?H+"":H}if(typeof D!="string")return D===0?D:+D;D=D.replace(r,"");var L=s.test(D);return L||o.test(D)?a(D.slice(2),L?2:8):i.test(D)?e:+D}return YS=b,YS}var aK=oK();const R4=fs(aK);var XS,Rk;function cK(){if(Rk)return XS;Rk=1;var n=200,e="__lodash_hash_undefined__",t=1/0,r="[object Function]",i="[object GeneratorFunction]",s=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=typeof cs=="object"&&cs&&cs.Object===Object&&cs,c=typeof self=="object"&&self&&self.Object===Object&&self,u=a||c||Function("return this")();function d(Q,re){var ce=Q?Q.length:0;return!!ce&&g(Q,re,0)>-1}function f(Q,re,ce,ye){for(var ut=Q.length,st=ce+-1;++st<ut;)if(re(Q[st],st,Q))return st;return-1}function g(Q,re,ce){if(re!==re)return f(Q,m,ce);for(var ye=ce-1,ut=Q.length;++ye<ut;)if(Q[ye]===re)return ye;return-1}function m(Q){return Q!==Q}function v(Q,re){return Q.has(re)}function w(Q,re){return Q==null?void 0:Q[re]}function S(Q){var re=!1;if(Q!=null&&typeof Q.toString!="function")try{re=!!(Q+"")}catch{}return re}function b(Q){var re=-1,ce=Array(Q.size);return Q.forEach(function(ye){ce[++re]=ye}),ce}var x=Array.prototype,E=Function.prototype,M=Object.prototype,j=u["__core-js_shared__"],D=function(){var Q=/[^.]+$/.exec(j&&j.keys&&j.keys.IE_PROTO||"");return Q?"Symbol(src)_1."+Q:""}(),H=E.toString,L=M.hasOwnProperty,U=M.toString,z=RegExp("^"+H.call(L).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Y=x.splice,V=Et(u,"Map"),N=Et(u,"Set"),_=Et(Object,"create");function k(Q){var re=-1,ce=Q?Q.length:0;for(this.clear();++re<ce;){var ye=Q[re];this.set(ye[0],ye[1])}}function O(){this.__data__=_?_(null):{}}function W(Q){return this.has(Q)&&delete this.__data__[Q]}function q(Q){var re=this.__data__;if(_){var ce=re[Q];return ce===e?void 0:ce}return L.call(re,Q)?re[Q]:void 0}function X(Q){var re=this.__data__;return _?re[Q]!==void 0:L.call(re,Q)}function ne(Q,re){var ce=this.__data__;return ce[Q]=_&&re===void 0?e:re,this}k.prototype.clear=O,k.prototype.delete=W,k.prototype.get=q,k.prototype.has=X,k.prototype.set=ne;function $(Q){var re=-1,ce=Q?Q.length:0;for(this.clear();++re<ce;){var ye=Q[re];this.set(ye[0],ye[1])}}function C(){this.__data__=[]}function R(Q){var re=this.__data__,ce=Kt(re,Q);if(ce<0)return!1;var ye=re.length-1;return ce==ye?re.pop():Y.call(re,ce,1),!0}function Z(Q){var re=this.__data__,ce=Kt(re,Q);return ce<0?void 0:re[ce][1]}function J(Q){return Kt(this.__data__,Q)>-1}function oe(Q,re){var ce=this.__data__,ye=Kt(ce,Q);return ye<0?ce.push([Q,re]):ce[ye][1]=re,this}$.prototype.clear=C,$.prototype.delete=R,$.prototype.get=Z,$.prototype.has=J,$.prototype.set=oe;function ue(Q){var re=-1,ce=Q?Q.length:0;for(this.clear();++re<ce;){var ye=Q[re];this.set(ye[0],ye[1])}}function fe(){this.__data__={hash:new k,map:new(V||$),string:new k}}function _e(Q){return At(this,Q).delete(Q)}function Le(Q){return At(this,Q).get(Q)}function Ne(Q){return At(this,Q).has(Q)}function Ze(Q,re){return At(this,Q).set(Q,re),this}ue.prototype.clear=fe,ue.prototype.delete=_e,ue.prototype.get=Le,ue.prototype.has=Ne,ue.prototype.set=Ze;function dt(Q){var re=-1,ce=Q?Q.length:0;for(this.__data__=new ue;++re<ce;)this.add(Q[re])}function et(Q){return this.__data__.set(Q,e),this}function Xe(Q){return this.__data__.has(Q)}dt.prototype.add=dt.prototype.push=et,dt.prototype.has=Xe;function Kt(Q,re){for(var ce=Q.length;ce--;)if(nn(Q[ce][0],re))return ce;return-1}function _t(Q){if(!F(Q)||qt(Q))return!1;var re=te(Q)||S(Q)?z:o;return re.test(tn(Q))}function Ut(Q,re,ce){var ye=-1,ut=d,st=Q.length,at=!0,Rt=[],Qe=Rt;if(st>=n){var $t=ur(Q);if($t)return b($t);at=!1,ut=v,Qe=new dt}else Qe=Rt;e:for(;++ye<st;){var ii=Q[ye],Ht=ii;if(ii=ii!==0?ii:0,at&&Ht===Ht){for(var rn=Qe.length;rn--;)if(Qe[rn]===Ht)continue e;Rt.push(ii)}else ut(Qe,Ht,ce)||(Qe!==Rt&&Qe.push(Ht),Rt.push(ii))}return Rt}var ur=N&&1/b(new N([,-0]))[1]==t?function(Q){return new N(Q)}:K;function At(Q,re){var ce=Q.__data__;return On(re)?ce[typeof re=="string"?"string":"hash"]:ce.map}function Et(Q,re){var ce=w(Q,re);return _t(ce)?ce:void 0}function On(Q){var re=typeof Q;return re=="string"||re=="number"||re=="symbol"||re=="boolean"?Q!=="__proto__":Q===null}function qt(Q){return!!D&&D in Q}function tn(Q){if(Q!=null){try{return H.call(Q)}catch{}try{return Q+""}catch{}}return""}function dr(Q){return Q&&Q.length?Ut(Q):[]}function nn(Q,re){return Q===re||Q!==Q&&re!==re}function te(Q){var re=F(Q)?U.call(Q):"";return re==r||re==i}function F(Q){var re=typeof Q;return!!Q&&(re=="object"||re=="function")}function K(){}return XS=dr,XS}var lK=cK();const uK=fs(lK),Ff={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},dK=Ff.Good;class j4{constructor(){G(this,"startTime",0);G(this,"name","");G(this,"frames",0);G(this,"started",!1);G(this,"frame",null);G(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),r=t>55?Ff.Good:t>30?Ff.Mid:Ff.Poor,i=r===Ff.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${t}%c fps`,`color: white; background: ${dK};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${i};`,"font-weight: normal")}isStarted(){return this.started}}function dC(n,e){const t=[];e:for(const r of n){for(const i of t)if(e?e(r,i):r===i)continue e;t.push(r)}return t}function St(n){return n.filter(e=>e!=null)}function Gr(n){return n[n.length-1]}function hK(n,e){let t,r=1/0;for(const i of n){const s=e(i);s<r&&(t=i,r=s)}return t}function fK(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function D4(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const dp=()=>{},ll={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function Pr(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const bt=D4((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),ss=D4((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function hC(){let n,e;const t=new Promise((r,i)=>{n=r,e=i});return Object.assign(t,{resolve:n,reject:e})}function xI(n){return new Promise(e=>setTimeout(e,n))}function ls(...n){if(n.length===2){const[e,t]=n;t.addInitializer(function(){bt(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const i=e.bind(this),s=Reflect.defineProperty(this,t.name,{value:i,writable:!0,configurable:!0});bt(s,"Cannot bind a non-configurable class method.")})}else{const[e,t,r]=n;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const i=r.value.bind(this);return Object.defineProperty(this,t,{value:i,configurable:!0,writable:!0}),i}}}}class ha{constructor(){G(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function H0(n,e){let t;const r=(...i)=>(t||(t={},t.promise=new Promise((s,o)=>{t.resolve=s,t.reject=o})),clearTimeout(t.timeout),t.latestArgs=i,t.timeout=setTimeout(()=>{const s=t;t=void 0;try{s.resolve(n(...s.latestArgs))}catch(o){s.reject(o)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const jk=new WeakMap;function fC(n,e){if(typeof n!="object"||n===null)return;let t=jk.get(n);t||(t={tags:{},extras:{}},jk.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function fa(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const hp=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class Io{static async dataUrlToArrayBuffer(e){return fa(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,r)=>{if(e){const i=new FileReader;i.onload=()=>t(i.result),i.onerror=s=>r(s),i.onabort=s=>r(s),i.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function bI(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function Dk(n){const e=new DataView(n);let t=0;for(let r=0;r<e.byteLength;r++)t=(t<<5)-t+e.getUint8(r),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const Ok=globalThis.crypto,pK="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",gK=128;let ou,Ud;function mK(n){!ou||ou.length<n?(ou=new Uint8Array(n*gK),Ok.getRandomValues(ou),Ud=0):Ud+n>ou.length&&(Ok.getRandomValues(ou),Ud=0),Ud+=n}function yK(n=21){mK(n-=0);let e="";for(let t=Ud-n;t<Ud;t++)e+=pK[ou[t]&63];return e}let wK=yK;function Jt(n){return wK(n)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function vK(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(s,o,a,c,u=1024){if(!o)return-1;o=new RegExp(o,"g");const d=o.source.length,f=new TextDecoder,g=s.length;if(typeof c>"u"&&(c=g),a>=g||c<=0||a>=c)return-1;s=s.subarray(a,c);let m=-1,v=0,w=0,S="";e:for(;v<s.length;){const b=v+u,x=s.subarray(v,b),E=f.decode(x,{stream:!0}),M=S+E;let j,D=-1;for(;(j=o.exec(M))!==null;){D=j.index-S.length,m=w+D;break e}v=b,w+=E.length;const H=D>-1?D+d:E.length-d;S=E.slice(H)}return m>=0&&(m+=a>=0?a:g+a),m}const i=r(e,"IDAT",12);return i>=12?r(e,"acTL",8,i)>=8:!1}const SK=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function Lk(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function xK(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function bK(n){const e=new Uint8Array(n);let t,r,i=0,s=0;if(!xK(n))return!1;for(t=e[10]&128,r=e[10]&7,i+=6,i+=7,i+=t?3*Math.pow(2,r+1):0;s<2&&i<e.length;)switch(e[i]){case 44:s+=1,t=e[i+9]&128,r=e[i+9]&7,i+=10,i+=t?3*Math.pow(2,r+1):0,i+=Lk(e,i+1)+1;break;case 33:i+=2,i+=Lk(e,i);break;case 59:i=e.length;break;default:i=e.length;break}return s>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let _I=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(_I=new Int32Array(_I));const _K=(n,e)=>{let t=~~e^-1;for(let r=0;r<n.length;r++)t=_I[(t^n[r])&255]^t>>>8;return t^-1},Nk=4,Bk=4;class sa{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!sa.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const i=t,s=e.getInt32(t);t+=4;const o=sa.getChunkType(e,t);if(o==="IDAT"&&r[o]){t+=s+Nk+Bk;continue}if(o==="IEND")break;r[o]={start:i,dataOffset:t+4,size:s},t+=s+Nk+Bk}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return sa.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let i=46,s=0;const o=sa.findChunk(e,"pHYs");o&&(i=o.start,s=o.size);const a=sa.findChunk(e,"IDAT");a&&(i=a.start,s=0);const c=new ArrayBuffer(21),u=new DataView(c);u.setUint32(0,9),u.setUint8(4,112),u.setUint8(5,72),u.setUint8(6,89),u.setUint8(7,115);const d=2835.5;u.setInt32(8,d*t),u.setInt32(12,d*t),u.setInt8(16,1);const f=new Uint8Array(c.slice(4,17));u.setInt32(17,_K(f));const g=e.buffer.slice(0,i),m=e.buffer.slice(i+s);return new Blob([g,c,m],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function IK(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function EK(n){const e=new Uint8Array(n);return!IK(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const O4=Object.freeze(["image/svg+xml"]),L4=Object.freeze(["image/jpeg","image/png","image/webp"]),N4=Object.freeze(["image/gif","image/apng","image/avif"]),W0=Object.freeze([...L4,...O4,...N4]),pC=Object.freeze(["video/mp4","video/webm","video/quicktime"]),CK=[...W0,...pC].join(",");class Ps{static loadVideo(e){return new Promise((t,r)=>{const i=document.createElement("video");i.onloadeddata=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load video"))},i.crossOrigin="anonymous",i.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const r=hC();let i=!1;const s=()=>{if(!i)if(e.readyState>=e.HAVE_METADATA)i=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const c=a.getContext("2d");if(!c)throw new Error("Could not get 2d context");c.drawImage(e,0,0),r.resolve(a.toDataURL())}},o=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",s),e.addEventListener("loadeddata",s),e.addEventListener("canplay",s),e.addEventListener("seeked",s),e.addEventListener("error",o),e.addEventListener("stalled",o),s();try{return await r}finally{e.removeEventListener("loadedmetadata",s),e.removeEventListener("loadeddata",s),e.removeEventListener("canplay",s),e.removeEventListener("seeked",s),e.removeEventListener("error",o),e.removeEventListener("stalled",o)}}static loadImage(e){return new Promise((t,r)=>{const i=hp();i.onload=()=>t(i),i.onerror=s=>{console.error(s),r(new Error("Could not load image"))},i.crossOrigin="anonymous",i.referrerPolicy="strict-origin-when-cross-origin",i.src=e})}static async getVideoSize(e){return Ps.usingObjectURL(e,async t=>{const r=await Ps.loadVideo(t);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const t=await Ps.usingObjectURL(e,Ps.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(sa.isPng(r,0)){const i=sa.findChunk(r,"pHYs");if(i){const s=sa.parsePhys(r,i.dataOffset);if(s.unit===0&&s.ppux===s.ppuy){const o=Math.max(s.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/o),h:Math.round(t.naturalHeight/o)}}}}}}catch(r){return console.error(r),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?bK(await e.arrayBuffer()):e.type==="image/avif"?SK(await e.arrayBuffer()):e.type==="image/webp"?EK(await e.arrayBuffer()):e.type==="image/apng"?vK(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return N4.includes(e||"")}static isStaticImageType(e){return L4.includes(e||"")}static isVectorImageType(e){return O4.includes(e||"")}static isImageType(e){return W0.includes(e)}static async usingObjectURL(e,t){const r=URL.createObjectURL(e);try{return await t(r)}finally{URL.revokeObjectURL(r)}}}function zt(n,e,t){return n+(e-n)*t}function No(n=""){let e=0,t=0,r=0,i=0;function s(){const o=e^e<<11;return e=t,t=r,r=i,i^=(i>>>19^o^o>>>8)>>>0,i/4294967296*2}for(let o=0;o<n.length+64;o++)e^=n.charCodeAt(o)|0,s();return s}function ch(n,e,t,r=!1){const[i,s]=e,[o,a]=t,c=o+(n-i)/(s-i)*(a-o);return r?o<a?Math.max(Math.min(c,a),o):Math.max(Math.min(c,o),a):c}function Mo(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ei(n,e){if(Mo(n,e))return n[e]}function Fk(n){return Object.keys(n)}function Vn(n){return Object.values(n)}function Jr(n){return Object.entries(n)}function gC(n){return Object.fromEntries(n)}function Jf(n,e){const t={};let r=!1;for(const[i,s]of Jr(n))e(i,s)?t[i]=s:r=!0;return r?t:n}function Np(n,e){const t={};for(const[r,i]of Jr(n)){const s=e(r,i);t[r]=s}return t}function mC(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const i of t)if(!r.has(i)||!Object.is(n[i],e[i]))return!1;return!0}function PK(n){const e=MK(n.chars),t=TK(e,n.firstPositive,n.mostPositive,n.mostNegative),r=n.jitterRange??Math.floor(Math.pow(e.length,3)/5),i=kK(r,e.length);return{chars:n.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:t.firstPositive,mostPositive:t.mostPositive,firstNegative:t.firstNegative,mostNegative:t.mostNegative,jitterRange:r,paddingDict:i}}function MK(n){const e={},t={},r=n.length;for(let i=0;i<r;i++){const s=n[i];e[i]=s,t[s]=i}return{byCode:e,byChar:t,length:r}}function TK(n,e,t,r){const i=e?n.byChar[e]:Math.ceil(n.length/2),s=t?n.byChar[t]:n.length-1,o=r?n.byChar[r]:0;if(i===void 0||s===void 0||o===void 0)throw new Error("invalid charSet");if(s-i<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(i-o<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:n.byCode[i],mostPositive:n.byCode[s],firstNegative:n.byCode[i-1],mostNegative:n.byCode[o]}}function kK(n,e){const t={};for(let r=0;r<100&&(t[r]=Math.pow(e,r),!(t[r]>n));r++);return t}var ZS=null;function yC(){return ZS||(ZS=PK({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function il(n,e,t){const r=t.byChar[n],i=t.byChar[e];return Math.abs(r-i)}function wC(n,e){const t=n[0];if(t>e.mostPositive||t<e.mostNegative)throw new Error("invalid firstChar on key");return t===e.mostPositive?il(t,e.firstPositive,e)+1+Vy(n.slice(1),"positive",e):t===e.mostNegative?il(t,e.firstNegative,e)+1+Vy(n.slice(1),"negative",e):t>=e.firstPositive?il(t,e.firstPositive,e)+2:il(t,e.firstNegative,e)+2}function Vy(n,e,t){const r=n[0];if(r>t.mostPositive||r<t.mostNegative)throw new Error("invalid firstChar on key");return r===t.mostPositive&&e==="positive"?il(r,t.mostNegative,t)+1+Vy(n.slice(1),e,t):r===t.mostNegative&&e==="negative"?il(r,t.mostPositive,t)+1+Vy(n.slice(1),e,t):e==="positive"?il(r,t.mostNegative,t)+2:il(r,t.mostPositive,t)+2}function K0(n,e,t,r,i){const s=Math.max(n.length,e.length);return t==="start"?[n.padStart(s,r),e.padStart(s,r)]:[n.padEnd(s,r),e.padEnd(s,r)]}function AK(n,e,t){let[r,i]=K0(n,e,"end",t.first),s=II(r,i,t);s===1&&(r=r.padEnd(r.length+1,t.first),s=t.length);const o=z4(Math.floor(s/2),t);return vC(r,o,t)}function II(n,e,t){const[r,i]=K0(n,e,"end",t.first).sort(),s=B4(i,r,t);return RK(s,t)}function vC(n,e,t){const r=t.length,[i,s]=K0(n,e,"start",t.first),o=[];let a=0;for(let c=i.length-1;c>=0;c--){const u=t.byChar[i[c]],d=t.byChar[s[c]],f=u+d+a;a=Math.floor(f/r);const g=f%r;o.unshift(t.byCode[g])}return a>0&&o.unshift(t.byCode[a]),o.join("")}function B4(n,e,t){const r=t.length,[i,s]=K0(n,e,"start",t.first),o=[];let a=0;for(let c=i.length-1;c>=0;c--){let u=t.byChar[i[c]];const d=t.byChar[s[c]]+a;u<d?(a=1,u+=r):a=0;const f=u-d;o.unshift(t.byCode[f])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;o.length>1&&o[0]===t.byCode[0];)o.shift();return o.join("")}function F4(n,e){return vC(n,e.byCode[1],e)}function EI(n,e){return B4(n,e.byCode[1],e)}function z4(n,e){if(n===0)return e.byCode[0];let t="";const r=e.length;for(;n>0;)t=e.byCode[n%r]+t,n=Math.floor(n/r);return t}function RK(n,e){let t=0;const r=n.length,i=e.length;for(let s=0;s<r;s++)t+=e.byChar[n[s]]*Math.pow(i,r-s-1);return t}function jK(n){return n.firstPositive+n.byCode[0]}function DK(n,e){return wC(n,e)===n.length}function zk(n,e){Yy(n,e)}function Yy(n,e){const t=H4(n,e),r=wC(t,e);if(r>n.length)throw new Error("invalid order key length: "+n);return n.slice(0,r)}function U4(n,e){if(!DK(n,e))throw new Error("invalid integer length: "+n)}function $4(n,e){U4(n,e);const[t,r]=W4(n,e);if(r.split("").some(o=>o!==e.byCode[e.length-1])){const o=F4(r,e);return t+o}const s=LK(t,e);return K4(s,"lower",e)}function OK(n,e){U4(n,e);const[t,r]=W4(n,e);if(r.split("").some(o=>o!==e.byCode[0])){const o=EI(r,e);return t+o}const s=NK(t,e);return K4(s,"upper",e)}function H4(n,e){let t=0;if(n[0]===e.mostPositive)for(;n[t]===e.mostPositive;)t=t+1;if(n[0]===e.mostNegative)for(;n[t]===e.mostNegative;)t=t+1;return n.slice(0,t+1)}function W4(n,e){const t=H4(n,e),r=n.slice(t.length);return[t,r]}function LK(n,e){const t=n>=e.firstPositive,r=F4(n,e),i=n[n.length-1]===e.mostPositive,s=r[r.length-1]===e.mostPositive;return t&&s?r+e.mostNegative:!t&&i?n.slice(0,n.length-1):r}function NK(n,e){const t=n>=e.firstPositive,r=n[n.length-1]===e.mostNegative;if(t&&r){const i=n.slice(0,n.length-1);return EI(i,e)}return!t&&r?n+e.mostPositive:EI(n,e)}function K4(n,e,t){const r=wC(n,t),i=e==="upper"?t.byCode[t.length-1]:t.byCode[0];return n+i.repeat(r-n.length)}function q4(n,e){const t=z4(Math.floor(Math.random()*e.jitterRange),e);return vC(n,t,e)}function BK(n,e,t){const r=n.padEnd(n.length+e,t.first);return q4(r,t)}function FK(n,e,t){const r=Yy(n,t),i=$4(r,t);let s=0;if(e!==null){const a=II(n,e,t);a<t.jitterRange+1&&(s=Math.max(s,Uk(a,t)))}const o=II(n,i,t);return o<t.jitterRange+1&&(s=Math.max(s,Uk(o,t))),s}function Uk(n,e){const t=e.jitterRange-n,r=Object.entries(e.paddingDict).find(([i,s])=>s>t);return r?parseInt(r[0]):0}function zK(n,e,t=yC()){if(n!==null&&zk(n,t),e!==null&&zk(e,t),n===null&&e===null)return jK(t);if(n===null){const r=Yy(e,t);return OK(r,t)}if(e===null){const r=Yy(n,t);return $4(r,t)}if(n>=e)throw new Error(n+" >= "+e);return AK(n,e,t)}function G4(n,e,t=yC()){const r=zK(n,e,t),i=FK(r,e,t);return i?BK(r,i,t):q4(r,t)}function V4(n,e,t,r=yC()){return UK(n,e,t,r,G4,V4)}function UK(n,e,t,r,i,s){if(t===0)return[];if(t===1)return[i(n,e,r)];if(e==null){let c=i(n,e,r);const u=[c];for(let d=0;d<t-1;d++)c=i(c,e,r),u.push(c);return u}if(n==null){let c=i(n,e,r);const u=[c];for(let d=0;d<t-1;d++)c=i(n,c,r),u.push(c);return u.reverse(),u}const o=Math.floor(t/2),a=i(n,e,r);return[...s(n,a,o,r),a,...s(a,e,t-o-1,r)]}const _h=V4,Y4="a0";function $K(n){try{G4(n,null)}catch{throw new Error("invalid index: "+n)}}function lh(n,e,t){return _h(n??null,e??null,t)}function QS(n,e){return _h(n??null,null,e)}function fp(n,e){return _h(n??null,e??null,1)[0]}function aa(n=null){return _h(n,null,1)[0]}function HK(n=null){return _h(null,n,1)[0]}function pp(n,e="a1"){return[e,..._h(e,null,n)]}function _i(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function WK(n,e){return n.id>e.id?1:-1}function SC(n){try{return localStorage.getItem(n)}catch{return null}}function xC(n,e){try{localStorage.setItem(n,e)}catch{}}function KK(){try{localStorage.clear()}catch{}}function X4(n){try{return sessionStorage.getItem(n)}catch{return null}}function bC(n,e){try{sessionStorage.setItem(n,e)}catch{}}function Z4(n){try{sessionStorage.removeItem(n)}catch{}}function qK(){try{sessionStorage.clear()}catch{}}const Q4=()=>typeof process<"u"&&!1,ca=[],GK=60,ep=Math.ceil(1e3/GK);let lu,JS=0,Xy=0;const VK=()=>{const n=ca.splice(0,ca.length);for(const e of n)e()};function _C(){if(lu)return;const n=Date.now(),e=n-Xy;if(JS+e<ep){lu=requestAnimationFrame(()=>{lu=void 0,_C()});return}lu=requestAnimationFrame(()=>{lu=void 0,Xy=n,JS=Math.min(JS+e-ep,ep*10),VK()})}let Zy=!1;function $k(n){if(Q4())return n.cancel=()=>lu&&cancelAnimationFrame(lu),n;const e=()=>{ca.includes(n)||(ca.push(n),Zy||(Zy=!0,Xy=Date.now()-ep-1),_C())};return e.cancel=()=>{const t=ca.indexOf(n);t>-1&&ca.splice(t,1)},e}function J4(n){return Q4()?(n(),()=>{}):(ca.includes(n)||(ca.push(n),Zy||(Zy=!0,Xy=Date.now()-ep-1),_C()),()=>{const e=ca.indexOf(n);e>-1&&ca.splice(e,1)})}class YK{constructor(){G(this,"timeouts",new Map);G(this,"intervals",new Map);G(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,r,...i){const s=window.setTimeout(t,r,i),o=this.timeouts.get(e)??[];return this.timeouts.set(e,[...o,s]),s}setInterval(e,t,r,...i){const s=window.setInterval(t,r,i),o=this.intervals.get(e)??[];return this.intervals.set(e,[...o,s]),s}requestAnimationFrame(e,t){const r=window.requestAnimationFrame(t),i=this.rafs.get(e)??[];return this.rafs.set(e,[...i,r]),r}dispose(e){var t,r,i;(t=this.timeouts.get(e))==null||t.forEach(s=>clearTimeout(s)),(r=this.intervals.get(e))==null||r.forEach(s=>clearInterval(s)),(i=this.rafs.get(e))==null||i.forEach(s=>cancelAnimationFrame(s)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,r,...i)=>this.setTimeout(e,t,r,i),setInterval:(t,r,...i)=>this.setInterval(e,t,r,i),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const yt=(n,e)=>{try{return new URL(n,e)}catch{return}};function XK(n){return n!==void 0}function ZK(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const eL=ZK(),Un=eL[0];eL[1];const QK=Object.getPrototypeOf(Un({})),Hk=new Set;function JK(n){Hk.has(n)||(Hk.add(n),console.warn(`[tldraw] ${n}`))}xa("@tldraw/utils","3.5.1","esm");var Wk={},vf,Kk;function Ni(){if(Kk)return vf;Kk=1;var n=function(e){return e&&e.Math===Math&&e};return vf=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof cs=="object"&&cs)||n(typeof vf=="object"&&vf)||function(){return this}()||Function("return this")(),vf}var e1={},t1,qk;function Bi(){return qk||(qk=1,t1=function(n){try{return!!n()}catch{return!0}}),t1}var n1,Gk;function _l(){if(Gk)return n1;Gk=1;var n=Bi();return n1=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),n1}var r1,Vk;function q0(){if(Vk)return r1;Vk=1;var n=Bi();return r1=!n(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),r1}var i1,Yk;function mc(){if(Yk)return i1;Yk=1;var n=q0(),e=Function.prototype.call;return i1=n?e.bind(e):function(){return e.apply(e,arguments)},i1}var s1={},Xk;function eq(){if(Xk)return s1;Xk=1;var n={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!n.call({1:2},1);return s1.f=t?function(i){var s=e(this,i);return!!s&&s.enumerable}:n,s1}var o1,Zk;function tL(){return Zk||(Zk=1,o1=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}}),o1}var a1,Qk;function Nr(){if(Qk)return a1;Qk=1;var n=q0(),e=Function.prototype,t=e.call,r=n&&e.bind.bind(t,t);return a1=n?r:function(i){return function(){return t.apply(i,arguments)}},a1}var c1,Jk;function Ih(){if(Jk)return c1;Jk=1;var n=Nr(),e=n({}.toString),t=n("".slice);return c1=function(r){return t(e(r),8,-1)},c1}var l1,eA;function tq(){if(eA)return l1;eA=1;var n=Nr(),e=Bi(),t=Ih(),r=Object,i=n("".split);return l1=e(function(){return!r("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?i(s,""):r(s)}:r,l1}var u1,tA;function G0(){return tA||(tA=1,u1=function(n){return n==null}),u1}var d1,nA;function Eh(){if(nA)return d1;nA=1;var n=G0(),e=TypeError;return d1=function(t){if(n(t))throw new e("Can't call method on "+t);return t},d1}var h1,rA;function V0(){if(rA)return h1;rA=1;var n=tq(),e=Eh();return h1=function(t){return n(e(t))},h1}var f1,iA;function Fi(){if(iA)return f1;iA=1;var n=typeof document=="object"&&document.all;return f1=typeof n>"u"&&n!==void 0?function(e){return typeof e=="function"||e===n}:function(e){return typeof e=="function"},f1}var p1,sA;function Nu(){if(sA)return p1;sA=1;var n=Fi();return p1=function(e){return typeof e=="object"?e!==null:n(e)},p1}var g1,oA;function Y0(){if(oA)return g1;oA=1;var n=Ni(),e=Fi(),t=function(r){return e(r)?r:void 0};return g1=function(r,i){return arguments.length<2?t(n[r]):n[r]&&n[r][i]},g1}var m1,aA;function nL(){if(aA)return m1;aA=1;var n=Nr();return m1=n({}.isPrototypeOf),m1}var y1,cA;function nq(){if(cA)return y1;cA=1;var n=Ni(),e=n.navigator,t=e&&e.userAgent;return y1=t?String(t):"",y1}var w1,lA;function rq(){if(lA)return w1;lA=1;var n=Ni(),e=nq(),t=n.process,r=n.Deno,i=t&&t.versions||r&&r.version,s=i&&i.v8,o,a;return s&&(o=s.split("."),a=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&e&&(o=e.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=e.match(/Chrome\/(\d+)/),o&&(a=+o[1]))),w1=a,w1}var v1,uA;function rL(){if(uA)return v1;uA=1;var n=rq(),e=Bi(),t=Ni(),r=t.String;return v1=!!Object.getOwnPropertySymbols&&!e(function(){var i=Symbol("symbol detection");return!r(i)||!(Object(i)instanceof Symbol)||!Symbol.sham&&n&&n<41}),v1}var S1,dA;function iL(){if(dA)return S1;dA=1;var n=rL();return S1=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol",S1}var x1,hA;function sL(){if(hA)return x1;hA=1;var n=Y0(),e=Fi(),t=nL(),r=iL(),i=Object;return x1=r?function(s){return typeof s=="symbol"}:function(s){var o=n("Symbol");return e(o)&&t(o.prototype,i(s))},x1}var b1,fA;function iq(){if(fA)return b1;fA=1;var n=String;return b1=function(e){try{return n(e)}catch{return"Object"}},b1}var _1,pA;function IC(){if(pA)return _1;pA=1;var n=Fi(),e=iq(),t=TypeError;return _1=function(r){if(n(r))return r;throw new t(e(r)+" is not a function")},_1}var I1,gA;function EC(){if(gA)return I1;gA=1;var n=IC(),e=G0();return I1=function(t,r){var i=t[r];return e(i)?void 0:n(i)},I1}var E1,mA;function sq(){if(mA)return E1;mA=1;var n=mc(),e=Fi(),t=Nu(),r=TypeError;return E1=function(i,s){var o,a;if(s==="string"&&e(o=i.toString)&&!t(a=n(o,i))||e(o=i.valueOf)&&!t(a=n(o,i))||s!=="string"&&e(o=i.toString)&&!t(a=n(o,i)))return a;throw new r("Can't convert object to primitive value")},E1}var C1={exports:{}},P1,yA;function oL(){return yA||(yA=1,P1=!1),P1}var M1,wA;function CC(){if(wA)return M1;wA=1;var n=Ni(),e=Object.defineProperty;return M1=function(t,r){try{e(n,t,{value:r,configurable:!0,writable:!0})}catch{n[t]=r}return r},M1}var vA;function PC(){if(vA)return C1.exports;vA=1;var n=oL(),e=Ni(),t=CC(),r="__core-js_shared__",i=C1.exports=e[r]||t(r,{});return(i.versions||(i.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"}),C1.exports}var T1,SA;function MC(){if(SA)return T1;SA=1;var n=PC();return T1=function(e,t){return n[e]||(n[e]=t||{})},T1}var k1,xA;function Bp(){if(xA)return k1;xA=1;var n=Eh(),e=Object;return k1=function(t){return e(n(t))},k1}var A1,bA;function Il(){if(bA)return A1;bA=1;var n=Nr(),e=Bp(),t=n({}.hasOwnProperty);return A1=Object.hasOwn||function(i,s){return t(e(i),s)},A1}var R1,_A;function aL(){if(_A)return R1;_A=1;var n=Nr(),e=0,t=Math.random(),r=n(1 .toString);return R1=function(i){return"Symbol("+(i===void 0?"":i)+")_"+r(++e+t,36)},R1}var j1,IA;function yc(){if(IA)return j1;IA=1;var n=Ni(),e=MC(),t=Il(),r=aL(),i=rL(),s=iL(),o=n.Symbol,a=e("wks"),c=s?o.for||o:o&&o.withoutSetter||r;return j1=function(u){return t(a,u)||(a[u]=i&&t(o,u)?o[u]:c("Symbol."+u)),a[u]},j1}var D1,EA;function oq(){if(EA)return D1;EA=1;var n=mc(),e=Nu(),t=sL(),r=EC(),i=sq(),s=yc(),o=TypeError,a=s("toPrimitive");return D1=function(c,u){if(!e(c)||t(c))return c;var d=r(c,a),f;if(d){if(u===void 0&&(u="default"),f=n(d,c,u),!e(f)||t(f))return f;throw new o("Can't convert object to primitive value")}return u===void 0&&(u="number"),i(c,u)},D1}var O1,CA;function cL(){if(CA)return O1;CA=1;var n=oq(),e=sL();return O1=function(t){var r=n(t,"string");return e(r)?r:r+""},O1}var L1,PA;function lL(){if(PA)return L1;PA=1;var n=Ni(),e=Nu(),t=n.document,r=e(t)&&e(t.createElement);return L1=function(i){return r?t.createElement(i):{}},L1}var N1,MA;function uL(){if(MA)return N1;MA=1;var n=_l(),e=Bi(),t=lL();return N1=!n&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),N1}var TA;function dL(){if(TA)return e1;TA=1;var n=_l(),e=mc(),t=eq(),r=tL(),i=V0(),s=cL(),o=Il(),a=uL(),c=Object.getOwnPropertyDescriptor;return e1.f=n?c:function(d,f){if(d=i(d),f=s(f),a)try{return c(d,f)}catch{}if(o(d,f))return r(!e(t.f,d,f),d[f])},e1}var B1={},F1,kA;function hL(){if(kA)return F1;kA=1;var n=_l(),e=Bi();return F1=n&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),F1}var z1,AA;function Bu(){if(AA)return z1;AA=1;var n=Nu(),e=String,t=TypeError;return z1=function(r){if(n(r))return r;throw new t(e(r)+" is not an object")},z1}var RA;function Fp(){if(RA)return B1;RA=1;var n=_l(),e=uL(),t=hL(),r=Bu(),i=cL(),s=TypeError,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,c="enumerable",u="configurable",d="writable";return B1.f=n?t?function(g,m,v){if(r(g),m=i(m),r(v),typeof g=="function"&&m==="prototype"&&"value"in v&&d in v&&!v[d]){var w=a(g,m);w&&w[d]&&(g[m]=v.value,v={configurable:u in v?v[u]:w[u],enumerable:c in v?v[c]:w[c],writable:!1})}return o(g,m,v)}:o:function(g,m,v){if(r(g),m=i(m),r(v),e)try{return o(g,m,v)}catch{}if("get"in v||"set"in v)throw new s("Accessors not supported");return"value"in v&&(g[m]=v.value),g},B1}var U1,jA;function TC(){if(jA)return U1;jA=1;var n=_l(),e=Fp(),t=tL();return U1=n?function(r,i,s){return e.f(r,i,t(1,s))}:function(r,i,s){return r[i]=s,r},U1}var $1={exports:{}},H1,DA;function aq(){if(DA)return H1;DA=1;var n=_l(),e=Il(),t=Function.prototype,r=n&&Object.getOwnPropertyDescriptor,i=e(t,"name"),s=i&&(function(){}).name==="something",o=i&&(!n||n&&r(t,"name").configurable);return H1={EXISTS:i,PROPER:s,CONFIGURABLE:o},H1}var W1,OA;function fL(){if(OA)return W1;OA=1;var n=Nr(),e=Fi(),t=PC(),r=n(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(i){return r(i)}),W1=t.inspectSource,W1}var K1,LA;function cq(){if(LA)return K1;LA=1;var n=Ni(),e=Fi(),t=n.WeakMap;return K1=e(t)&&/native code/.test(String(t)),K1}var q1,NA;function pL(){if(NA)return q1;NA=1;var n=MC(),e=aL(),t=n("keys");return q1=function(r){return t[r]||(t[r]=e(r))},q1}var G1,BA;function kC(){return BA||(BA=1,G1={}),G1}var V1,FA;function gL(){if(FA)return V1;FA=1;var n=cq(),e=Ni(),t=Nu(),r=TC(),i=Il(),s=PC(),o=pL(),a=kC(),c="Object already initialized",u=e.TypeError,d=e.WeakMap,f,g,m,v=function(x){return m(x)?g(x):f(x,{})},w=function(x){return function(E){var M;if(!t(E)||(M=g(E)).type!==x)throw new u("Incompatible receiver, "+x+" required");return M}};if(n||s.state){var S=s.state||(s.state=new d);S.get=S.get,S.has=S.has,S.set=S.set,f=function(x,E){if(S.has(x))throw new u(c);return E.facade=x,S.set(x,E),E},g=function(x){return S.get(x)||{}},m=function(x){return S.has(x)}}else{var b=o("state");a[b]=!0,f=function(x,E){if(i(x,b))throw new u(c);return E.facade=x,r(x,b,E),E},g=function(x){return i(x,b)?x[b]:{}},m=function(x){return i(x,b)}}return V1={set:f,get:g,has:m,enforce:v,getterFor:w},V1}var zA;function lq(){if(zA)return $1.exports;zA=1;var n=Nr(),e=Bi(),t=Fi(),r=Il(),i=_l(),s=aq().CONFIGURABLE,o=fL(),a=gL(),c=a.enforce,u=a.get,d=String,f=Object.defineProperty,g=n("".slice),m=n("".replace),v=n([].join),w=i&&!e(function(){return f(function(){},"length",{value:8}).length!==8}),S=String(String).split("String"),b=$1.exports=function(x,E,M){g(d(E),0,7)==="Symbol("&&(E="["+m(d(E),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),M&&M.getter&&(E="get "+E),M&&M.setter&&(E="set "+E),(!r(x,"name")||s&&x.name!==E)&&(i?f(x,"name",{value:E,configurable:!0}):x.name=E),w&&M&&r(M,"arity")&&x.length!==M.arity&&f(x,"length",{value:M.arity});try{M&&r(M,"constructor")&&M.constructor?i&&f(x,"prototype",{writable:!1}):x.prototype&&(x.prototype=void 0)}catch{}var j=c(x);return r(j,"source")||(j.source=v(S,typeof E=="string"?E:"")),x};return Function.prototype.toString=b(function(){return t(this)&&u(this).source||o(this)},"toString"),$1.exports}var Y1,UA;function mL(){if(UA)return Y1;UA=1;var n=Fi(),e=Fp(),t=lq(),r=CC();return Y1=function(i,s,o,a){a||(a={});var c=a.enumerable,u=a.name!==void 0?a.name:s;if(n(o)&&t(o,u,a),a.global)c?i[s]=o:r(s,o);else{try{a.unsafe?i[s]&&(c=!0):delete i[s]}catch{}c?i[s]=o:e.f(i,s,{value:o,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return i},Y1}var X1={},Z1,$A;function uq(){if($A)return Z1;$A=1;var n=Math.ceil,e=Math.floor;return Z1=Math.trunc||function(r){var i=+r;return(i>0?e:n)(i)},Z1}var Q1,HA;function Fu(){if(HA)return Q1;HA=1;var n=uq();return Q1=function(e){var t=+e;return t!==t||t===0?0:n(t)},Q1}var J1,WA;function dq(){if(WA)return J1;WA=1;var n=Fu(),e=Math.max,t=Math.min;return J1=function(r,i){var s=n(r);return s<0?e(s+i,0):t(s,i)},J1}var ex,KA;function yL(){if(KA)return ex;KA=1;var n=Fu(),e=Math.min;return ex=function(t){var r=n(t);return r>0?e(r,9007199254740991):0},ex}var tx,qA;function zp(){if(qA)return tx;qA=1;var n=yL();return tx=function(e){return n(e.length)},tx}var nx,GA;function hq(){if(GA)return nx;GA=1;var n=V0(),e=dq(),t=zp(),r=function(i){return function(s,o,a){var c=n(s),u=t(c);if(u===0)return!i&&-1;var d=e(a,u),f;if(i&&o!==o){for(;u>d;)if(f=c[d++],f!==f)return!0}else for(;u>d;d++)if((i||d in c)&&c[d]===o)return i||d||0;return!i&&-1}};return nx={includes:r(!0),indexOf:r(!1)},nx}var rx,VA;function wL(){if(VA)return rx;VA=1;var n=Nr(),e=Il(),t=V0(),r=hq().indexOf,i=kC(),s=n([].push);return rx=function(o,a){var c=t(o),u=0,d=[],f;for(f in c)!e(i,f)&&e(c,f)&&s(d,f);for(;a.length>u;)e(c,f=a[u++])&&(~r(d,f)||s(d,f));return d},rx}var ix,YA;function AC(){return YA||(YA=1,ix=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),ix}var XA;function fq(){if(XA)return X1;XA=1;var n=wL(),e=AC(),t=e.concat("length","prototype");return X1.f=Object.getOwnPropertyNames||function(i){return n(i,t)},X1}var sx={},ZA;function pq(){return ZA||(ZA=1,sx.f=Object.getOwnPropertySymbols),sx}var ox,QA;function gq(){if(QA)return ox;QA=1;var n=Y0(),e=Nr(),t=fq(),r=pq(),i=Bu(),s=e([].concat);return ox=n("Reflect","ownKeys")||function(a){var c=t.f(i(a)),u=r.f;return u?s(c,u(a)):c},ox}var ax,JA;function mq(){if(JA)return ax;JA=1;var n=Il(),e=gq(),t=dL(),r=Fp();return ax=function(i,s,o){for(var a=e(s),c=r.f,u=t.f,d=0;d<a.length;d++){var f=a[d];!n(i,f)&&!(o&&n(o,f))&&c(i,f,u(s,f))}},ax}var cx,eR;function yq(){if(eR)return cx;eR=1;var n=Bi(),e=Fi(),t=/#|\.prototype\./,r=function(c,u){var d=s[i(c)];return d===a?!0:d===o?!1:e(u)?n(u):!!u},i=r.normalize=function(c){return String(c).replace(t,".").toLowerCase()},s=r.data={},o=r.NATIVE="N",a=r.POLYFILL="P";return cx=r,cx}var lx,tR;function Ch(){if(tR)return lx;tR=1;var n=Ni(),e=dL().f,t=TC(),r=mL(),i=CC(),s=mq(),o=yq();return lx=function(a,c){var u=a.target,d=a.global,f=a.stat,g,m,v,w,S,b;if(d?m=n:f?m=n[u]||i(u,{}):m=n[u]&&n[u].prototype,m)for(v in c){if(S=c[v],a.dontCallGetSet?(b=e(m,v),w=b&&b.value):w=m[v],g=o(d?v:u+(f?".":"#")+v,a.forced),!g&&w!==void 0){if(typeof S==typeof w)continue;s(S,w)}(a.sham||w&&w.sham)&&t(S,"sham",!0),r(m,v,S,a)}},lx}var ux={},dx,nR;function wq(){if(nR)return dx;nR=1;var n=wL(),e=AC();return dx=Object.keys||function(r){return n(r,e)},dx}var rR;function vq(){if(rR)return ux;rR=1;var n=_l(),e=hL(),t=Fp(),r=Bu(),i=V0(),s=wq();return ux.f=n&&!e?Object.defineProperties:function(a,c){r(a);for(var u=i(c),d=s(c),f=d.length,g=0,m;f>g;)t.f(a,m=d[g++],u[m]);return a},ux}var hx,iR;function Sq(){if(iR)return hx;iR=1;var n=Y0();return hx=n("document","documentElement"),hx}var fx,sR;function vL(){if(sR)return fx;sR=1;var n=Bu(),e=vq(),t=AC(),r=kC(),i=Sq(),s=lL(),o=pL(),a=">",c="<",u="prototype",d="script",f=o("IE_PROTO"),g=function(){},m=function(x){return c+d+a+x+c+"/"+d+a},v=function(x){x.write(m("")),x.close();var E=x.parentWindow.Object;return x=null,E},w=function(){var x=s("iframe"),E="java"+d+":",M;return x.style.display="none",i.appendChild(x),x.src=String(E),M=x.contentWindow.document,M.open(),M.write(m("document.F=Object")),M.close(),M.F},S,b=function(){try{S=new ActiveXObject("htmlfile")}catch{}b=typeof document<"u"?document.domain&&S?v(S):w():v(S);for(var x=t.length;x--;)delete b[u][t[x]];return b()};return r[f]=!0,fx=Object.create||function(E,M){var j;return E!==null?(g[u]=n(E),j=new g,g[u]=null,j[f]=E):j=b(),M===void 0?j:e.f(j,M)},fx}var px,oR;function RC(){if(oR)return px;oR=1;var n=yc(),e=vL(),t=Fp().f,r=n("unscopables"),i=Array.prototype;return i[r]===void 0&&t(i,r,{configurable:!0,value:e(null)}),px=function(s){i[r][s]=!0},px}var aR;function xq(){if(aR)return Wk;aR=1;var n=Ch(),e=Bp(),t=zp(),r=Fu(),i=RC();return n({target:"Array",proto:!0},{at:function(o){var a=e(this),c=t(a),u=r(o),d=u>=0?u:c+u;return d<0||d>=c?void 0:a[d]}}),i("at"),Wk}var gx,cR;function Up(){if(cR)return gx;cR=1;var n=Ni(),e=Nr();return gx=function(t,r){return e(n[t].prototype[r])},gx}var mx,lR;function bq(){if(lR)return mx;lR=1,xq();var n=Up();return mx=n("Array","at"),mx}var yx,uR;function _q(){if(uR)return yx;uR=1;var n=bq();return yx=n,yx}_q();var dR={},wx,hR;function SL(){if(hR)return wx;hR=1;var n=Ih();return wx=Array.isArray||function(t){return n(t)==="Array"},wx}var vx,fR;function Iq(){if(fR)return vx;fR=1;var n=TypeError,e=9007199254740991;return vx=function(t){if(t>e)throw n("Maximum allowed index exceeded");return t},vx}var Sx,pR;function Eq(){if(pR)return Sx;pR=1;var n=Ih(),e=Nr();return Sx=function(t){if(n(t)==="Function")return e(t)},Sx}var xx,gR;function Cq(){if(gR)return xx;gR=1;var n=Eq(),e=IC(),t=q0(),r=n(n.bind);return xx=function(i,s){return e(i),s===void 0?i:t?r(i,s):function(){return i.apply(s,arguments)}},xx}var bx,mR;function xL(){if(mR)return bx;mR=1;var n=SL(),e=zp(),t=Iq(),r=Cq(),i=function(s,o,a,c,u,d,f,g){for(var m=u,v=0,w=f?r(f,g):!1,S,b;v<c;)v in a&&(S=w?w(a[v],v,o):a[v],d>0&&n(S)?(b=e(S),m=i(s,o,S,b,m,d-1)-1):(t(m+1),s[m]=S),m++),v++;return m};return bx=i,bx}var _x,yR;function Pq(){if(yR)return _x;yR=1;var n=yc(),e=n("toStringTag"),t={};return t[e]="z",_x=String(t)==="[object z]",_x}var Ix,wR;function bL(){if(wR)return Ix;wR=1;var n=Pq(),e=Fi(),t=Ih(),r=yc(),i=r("toStringTag"),s=Object,o=t(function(){return arguments}())==="Arguments",a=function(c,u){try{return c[u]}catch{}};return Ix=n?t:function(c){var u,d,f;return c===void 0?"Undefined":c===null?"Null":typeof(d=a(u=s(c),i))=="string"?d:o?t(u):(f=t(u))==="Object"&&e(u.callee)?"Arguments":f},Ix}var Ex,vR;function Mq(){if(vR)return Ex;vR=1;var n=Nr(),e=Bi(),t=Fi(),r=bL(),i=Y0(),s=fL(),o=function(){},a=i("Reflect","construct"),c=/^\s*(?:class|function)\b/,u=n(c.exec),d=!c.test(o),f=function(v){if(!t(v))return!1;try{return a(o,[],v),!0}catch{return!1}},g=function(v){if(!t(v))return!1;switch(r(v)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!u(c,s(v))}catch{return!0}};return g.sham=!0,Ex=!a||e(function(){var m;return f(f.call)||!f(Object)||!f(function(){m=!0})||m})?g:f,Ex}var Cx,SR;function Tq(){if(SR)return Cx;SR=1;var n=SL(),e=Mq(),t=Nu(),r=yc(),i=r("species"),s=Array;return Cx=function(o){var a;return n(o)&&(a=o.constructor,e(a)&&(a===s||n(a.prototype))?a=void 0:t(a)&&(a=a[i],a===null&&(a=void 0))),a===void 0?s:a},Cx}var Px,xR;function _L(){if(xR)return Px;xR=1;var n=Tq();return Px=function(e,t){return new(n(e))(t===0?0:t)},Px}var bR;function kq(){if(bR)return dR;bR=1;var n=Ch(),e=xL(),t=IC(),r=Bp(),i=zp(),s=_L();return n({target:"Array",proto:!0},{flatMap:function(a){var c=r(this),u=i(c),d;return t(a),d=s(c,0),d.length=e(d,c,c,u,0,1,a,arguments.length>1?arguments[1]:void 0),d}}),dR}var _R={},IR;function Aq(){if(IR)return _R;IR=1;var n=RC();return n("flatMap"),_R}var Mx,ER;function Rq(){if(ER)return Mx;ER=1,kq(),Aq();var n=Up();return Mx=n("Array","flatMap"),Mx}var Tx,CR;function jq(){if(CR)return Tx;CR=1;var n=Rq();return Tx=n,Tx}jq();var PR={},MR;function Dq(){if(MR)return PR;MR=1;var n=Ch(),e=xL(),t=Bp(),r=zp(),i=Fu(),s=_L();return n({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,c=t(this),u=r(c),d=s(c,0);return d.length=e(d,c,c,u,0,a===void 0?1:i(a)),d}}),PR}var TR={},kR;function Oq(){if(kR)return TR;kR=1;var n=RC();return n("flat"),TR}var kx,AR;function Lq(){if(AR)return kx;AR=1,Dq(),Oq();var n=Up();return kx=n("Array","flat"),kx}var Ax,RR;function Nq(){if(RR)return Ax;RR=1;var n=Lq();return Ax=n,Ax}Nq();var jR={},Rx,DR;function $p(){if(DR)return Rx;DR=1;var n=bL(),e=String;return Rx=function(t){if(n(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},Rx}var OR;function Bq(){if(OR)return jR;OR=1;var n=Ch(),e=Nr(),t=Eh(),r=Fu(),i=$p(),s=Bi(),o=e("".charAt),a=s(function(){return"".at(-2)!=="\uD842"});return n({target:"String",proto:!0,forced:a},{at:function(u){var d=i(t(this)),f=d.length,g=r(u),m=g>=0?g:f+g;return m<0||m>=f?void 0:o(d,m)}}),jR}var jx,LR;function Fq(){if(LR)return jx;LR=1,Bq();var n=Up();return jx=n("String","at"),jx}var Dx,NR;function zq(){if(NR)return Dx;NR=1;var n=Fq();return Dx=n,Dx}zq();var BR={},Ox,FR;function IL(){if(FR)return Ox;FR=1;var n=Bu();return Ox=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Ox}var Lx,zR;function Uq(){if(zR)return Lx;zR=1;var n=Bi(),e=Ni(),t=e.RegExp,r=n(function(){var o=t("a","y");return o.lastIndex=2,o.exec("abcd")!==null}),i=r||n(function(){return!t("a","y").sticky}),s=r||n(function(){var o=t("^r","gy");return o.lastIndex=2,o.exec("str")!==null});return Lx={BROKEN_CARET:s,MISSED_STICKY:i,UNSUPPORTED_Y:r},Lx}var Nx,UR;function $q(){if(UR)return Nx;UR=1;var n=Bi(),e=Ni(),t=e.RegExp;return Nx=n(function(){var r=t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),Nx}var Bx,$R;function Hq(){if($R)return Bx;$R=1;var n=Bi(),e=Ni(),t=e.RegExp;return Bx=n(function(){var r=t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),Bx}var Fx,HR;function jC(){if(HR)return Fx;HR=1;var n=mc(),e=Nr(),t=$p(),r=IL(),i=Uq(),s=MC(),o=vL(),a=gL().get,c=$q(),u=Hq(),d=s("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,g=f,m=e("".charAt),v=e("".indexOf),w=e("".replace),S=e("".slice),b=function(){var j=/a/,D=/b*/g;return n(f,j,"a"),n(f,D,"a"),j.lastIndex!==0||D.lastIndex!==0}(),x=i.BROKEN_CARET,E=/()??/.exec("")[1]!==void 0,M=b||E||x||c||u;return M&&(g=function(D){var H=this,L=a(H),U=t(D),z=L.raw,Y,V,N,_,k,O,W;if(z)return z.lastIndex=H.lastIndex,Y=n(g,z,U),H.lastIndex=z.lastIndex,Y;var q=L.groups,X=x&&H.sticky,ne=n(r,H),$=H.source,C=0,R=U;if(X&&(ne=w(ne,"y",""),v(ne,"g")===-1&&(ne+="g"),R=S(U,H.lastIndex),H.lastIndex>0&&(!H.multiline||H.multiline&&m(U,H.lastIndex-1)!==`
`)&&($="(?: "+$+")",R=" "+R,C++),V=new RegExp("^(?:"+$+")",ne)),E&&(V=new RegExp("^"+$+"$(?!\\s)",ne)),b&&(N=H.lastIndex),_=n(f,X?V:H,R),X?_?(_.input=S(_.input,C),_[0]=S(_[0],C),_.index=H.lastIndex,H.lastIndex+=_[0].length):H.lastIndex=0:b&&_&&(H.lastIndex=H.global?_.index+_[0].length:N),E&&_&&_.length>1&&n(d,_[0],V,function(){for(k=1;k<arguments.length-2;k++)arguments[k]===void 0&&(_[k]=void 0)}),_&&q)for(_.groups=O=o(null),k=0;k<q.length;k++)W=q[k],O[W[0]]=_[W[1]];return _}),Fx=g,Fx}var WR;function EL(){if(WR)return BR;WR=1;var n=Ch(),e=jC();return n({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),BR}var KR={},zx,qR;function Wq(){if(qR)return zx;qR=1;var n=q0(),e=Function.prototype,t=e.apply,r=e.call;return zx=typeof Reflect=="object"&&Reflect.apply||(n?r.bind(t):function(){return r.apply(t,arguments)}),zx}var Ux,GR;function Kq(){if(GR)return Ux;GR=1,EL();var n=mc(),e=mL(),t=jC(),r=Bi(),i=yc(),s=TC(),o=i("species"),a=RegExp.prototype;return Ux=function(c,u,d,f){var g=i(c),m=!r(function(){var b={};return b[g]=function(){return 7},""[c](b)!==7}),v=m&&!r(function(){var b=!1,x=/a/;return c==="split"&&(x={},x.constructor={},x.constructor[o]=function(){return x},x.flags="",x[g]=/./[g]),x.exec=function(){return b=!0,null},x[g](""),!b});if(!m||!v||d){var w=/./[g],S=u(g,""[c],function(b,x,E,M,j){var D=x.exec;return D===t||D===a.exec?m&&!j?{done:!0,value:n(w,x,E,M)}:{done:!0,value:n(b,E,x,M)}:{done:!1}});e(String.prototype,c,S[0]),e(a,g,S[1])}f&&s(a[g],"sham",!0)},Ux}var $x,VR;function qq(){if(VR)return $x;VR=1;var n=Nr(),e=Fu(),t=$p(),r=Eh(),i=n("".charAt),s=n("".charCodeAt),o=n("".slice),a=function(c){return function(u,d){var f=t(r(u)),g=e(d),m=f.length,v,w;return g<0||g>=m?c?"":void 0:(v=s(f,g),v<55296||v>56319||g+1===m||(w=s(f,g+1))<56320||w>57343?c?i(f,g):v:c?o(f,g,g+2):(v-55296<<10)+(w-56320)+65536)}};return $x={codeAt:a(!1),charAt:a(!0)},$x}var Hx,YR;function Gq(){if(YR)return Hx;YR=1;var n=qq().charAt;return Hx=function(e,t,r){return t+(r?n(e,t).length:1)},Hx}var Wx,XR;function CL(){if(XR)return Wx;XR=1;var n=Nr(),e=Bp(),t=Math.floor,r=n("".charAt),i=n("".replace),s=n("".slice),o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return Wx=function(c,u,d,f,g,m){var v=d+c.length,w=f.length,S=a;return g!==void 0&&(g=e(g),S=o),i(m,S,function(b,x){var E;switch(r(x,0)){case"$":return"$";case"&":return c;case"`":return s(u,0,d);case"'":return s(u,v);case"<":E=g[s(x,1,-1)];break;default:var M=+x;if(M===0)return b;if(M>w){var j=t(M/10);return j===0?b:j<=w?f[j-1]===void 0?r(x,1):f[j-1]+r(x,1):b}E=f[M-1]}return E===void 0?"":E})},Wx}var Kx,ZR;function Vq(){if(ZR)return Kx;ZR=1;var n=mc(),e=Bu(),t=Fi(),r=Ih(),i=jC(),s=TypeError;return Kx=function(o,a){var c=o.exec;if(t(c)){var u=n(c,o,a);return u!==null&&e(u),u}if(r(o)==="RegExp")return n(i,o,a);throw new s("RegExp#exec called on incompatible receiver")},Kx}var QR;function Yq(){if(QR)return KR;QR=1;var n=Wq(),e=mc(),t=Nr(),r=Kq(),i=Bi(),s=Bu(),o=Fi(),a=G0(),c=Fu(),u=yL(),d=$p(),f=Eh(),g=Gq(),m=EC(),v=CL(),w=Vq(),S=yc(),b=S("replace"),x=Math.max,E=Math.min,M=t([].concat),j=t([].push),D=t("".indexOf),H=t("".slice),L=function(V){return V===void 0?V:String(V)},U=function(){return"a".replace(/./,"$0")==="$0"}(),z=function(){return/./[b]?/./[b]("a","$0")==="":!1}(),Y=!i(function(){var V=/./;return V.exec=function(){var N=[];return N.groups={a:"7"},N},"".replace(V,"$<a>")!=="7"});return r("replace",function(V,N,_){var k=z?"$":"$0";return[function(W,q){var X=f(this),ne=a(W)?void 0:m(W,b);return ne?e(ne,W,X,q):e(N,d(X),W,q)},function(O,W){var q=s(this),X=d(O);if(typeof W=="string"&&D(W,k)===-1&&D(W,"$<")===-1){var ne=_(N,q,X,W);if(ne.done)return ne.value}var $=o(W);$||(W=d(W));var C=q.global,R;C&&(R=q.unicode,q.lastIndex=0);for(var Z=[],J;J=w(q,X),!(J===null||(j(Z,J),!C));){var oe=d(J[0]);oe===""&&(q.lastIndex=g(X,u(q.lastIndex),R))}for(var ue="",fe=0,_e=0;_e<Z.length;_e++){J=Z[_e];for(var Le=d(J[0]),Ne=x(E(c(J.index),X.length),0),Ze=[],dt,et=1;et<J.length;et++)j(Ze,L(J[et]));var Xe=J.groups;if($){var Kt=M([Le],Ze,Ne,X);Xe!==void 0&&j(Kt,Xe),dt=d(n(W,void 0,Kt))}else dt=v(Le,X,Ne,Ze,Xe,W);Ne>=fe&&(ue+=H(X,fe,Ne)+dt,fe=Ne+Le.length)}return ue+H(X,fe)}]},!Y||!U||z),KR}var JR={},qx,e3;function Xq(){if(e3)return qx;e3=1;var n=Nu(),e=Ih(),t=yc(),r=t("match");return qx=function(i){var s;return n(i)&&((s=i[r])!==void 0?!!s:e(i)==="RegExp")},qx}var Gx,t3;function Zq(){if(t3)return Gx;t3=1;var n=mc(),e=Il(),t=nL(),r=IL(),i=RegExp.prototype;return Gx=function(s){var o=s.flags;return o===void 0&&!("flags"in i)&&!e(s,"flags")&&t(i,s)?n(r,s):o},Gx}var n3;function Qq(){if(n3)return JR;n3=1;var n=Ch(),e=mc(),t=Nr(),r=Eh(),i=Fi(),s=G0(),o=Xq(),a=$p(),c=EC(),u=Zq(),d=CL(),f=yc(),g=oL(),m=f("replace"),v=TypeError,w=t("".indexOf),S=t("".replace),b=t("".slice),x=Math.max;return n({target:"String",proto:!0},{replaceAll:function(M,j){var D=r(this),H,L,U,z,Y,V,N,_,k,O,W=0,q="";if(!s(M)){if(H=o(M),H&&(L=a(r(u(M))),!~w(L,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(U=c(M,m),U)return e(U,M,D,j);if(g&&H)return S(a(D),M,j)}for(z=a(D),Y=a(M),V=i(j),V||(j=a(j)),N=Y.length,_=x(1,N),k=w(z,Y);k!==-1;)O=V?a(j(Y,k,z)):d(Y,z,k,[],void 0,j),q+=b(z,W,k)+O,W=k+N,k=k+_>z.length?-1:w(z,Y,k+_);return W<z.length&&(q+=b(z,W)),q}}),JR}var Vx,r3;function Jq(){if(r3)return Vx;r3=1,EL(),Yq(),Qq();var n=Up();return Vx=n("String","replaceAll"),Vx}var Yx,i3;function eG(){if(i3)return Yx;i3=1;var n=Jq();return Yx=n,Yx}eG();function PL(n){return n&&typeof n=="object"&&"parents"in n}function ML(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}function Qy(n,e){if(n.children.remove(e)&&n.children.isEmpty&&PL(n))for(let t=0,r=n.parents.length;t<r;t++)Qy(n.parents[t],n)}function DC(n,e){if(n.children.add(e)&&PL(n))for(let t=0,r=n.parents.length;t<r;t++)DC(n.parents[t],n)}function TL(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function El(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const ic=El("empty_array",()=>Object.freeze([])),s3=8;class Jy{constructor(){G(this,"arraySize",0);G(this,"array",Array(s3));G(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<s3?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const Ts=Symbol.for("com.tldraw.state/RESET_VALUE");class kL{constructor(e){G(this,"index",0);G(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===Ts){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:i}=this;for(let s=0;s<r;s++){const o=(t-1+r-s)%r,a=i[o];if(!a)return Ts;const[c,u]=a;if(s===0&&e>=u)return[];if(c<=e&&e<u){const d=s+1,f=new Array(d);for(let g=0;g<d;g++)f[g]=i[(o+g)%r][2];return f}}return Ts}}class tG{constructor(e,t){G(this,"offset",0);G(this,"maybeRemoved");this.below=e,this.child=t}}const Gn=El("capture",()=>({stack:null}));function pm(n){const e=Gn.stack;Gn.stack=null;try{return n()}finally{Gn.stack=e}}function AL(n){Gn.stack=new tG(Gn.stack,n),n.parentSet.clear()}function RL(){const n=Gn.stack;if(Gn.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||Qy(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||Qy(t,n.child)}}function e0(n){if(Gn.stack){if(Gn.stack.child.parentSet.has(n))return;if(Gn.stack.child.parentSet.add(n),Gn.stack.child.isActivelyListening&&DC(n,Gn.stack.child),Gn.stack.offset<Gn.stack.child.parents.length){const t=Gn.stack.child.parents[Gn.stack.offset];t!==n&&(Gn.stack.maybeRemoved?Gn.stack.maybeRemoved.push(t):Gn.stack.maybeRemoved=[t])}Gn.stack.child.parents[Gn.stack.offset]=n,Gn.stack.child.parentEpochs[Gn.stack.offset]=n.lastChangedEpoch,Gn.stack.offset++}}const sl=-1;class nG{constructor(e,t,r){G(this,"_isActivelyListening",!1);G(this,"lastTraversedEpoch",sl);G(this,"lastReactedEpoch",sl);G(this,"_scheduleCount",0);G(this,"parentSet",new Jy);G(this,"parentEpochs",[]);G(this,"parents",[]);G(this,"_scheduleEffect");G(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==rs()){if(this.parents.length&&!ML(this)){this.lastReactedEpoch=rs();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)DC(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Qy(this.parents[e],this)}execute(){try{AL(this);const e=rs(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{RL()}}}const Ph=El("EffectScheduler",()=>nG);function To(n,e,t){const r=new Ph(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function rG(n,e,t){const r=new Ph(n,e,t);return{scheduler:r,start:i=>{const s=(i==null?void 0:i.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let iG=class{constructor(e){G(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(cn.globalIsReacting)for(const e of this.initialAtomValues.keys())DL(e);else this.isRoot?jL(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){cn.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}};const cn=El("transactions",()=>({globalEpoch:sl+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:sl+1}));function sG(){return cn.reactionEpoch}function rs(){return cn.globalEpoch}function oG(){return cn.globalIsReacting}function OC(n,e){e.lastTraversedEpoch!==cn.globalEpoch&&(e.lastTraversedEpoch=cn.globalEpoch,e instanceof Ph?n.add(e):e.children.visit(t=>OC(n,t)))}function jL(n){var t;if(cn.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=cn.currentTransaction;try{cn.currentTransaction=null,cn.globalIsReacting=!0,cn.reactionEpoch=cn.globalEpoch;const r=new Set;for(const s of n)s.children.visit(o=>OC(r,o));for(const s of r)s.maybeScheduleEffect();let i=0;for(;(t=cn.cleanupReactors)!=null&&t.size;){if(i++>1e3)throw new Error("Reaction update depth limit exceeded");const s=cn.cleanupReactors;cn.cleanupReactors=null;for(const o of s)o.maybeScheduleEffect()}}finally{cn.cleanupReactors=null,cn.globalIsReacting=!1,cn.currentTransaction=e}}function aG(n,e){cn.currentTransaction?cn.currentTransaction.initialAtomValues.has(n)||cn.currentTransaction.initialAtomValues.set(n,e):cn.globalIsReacting?DL(n):jL([n])}function DL(n){const e=cn.cleanupReactors??(cn.cleanupReactors=new Set);n.children.visit(t=>OC(e,t))}function cG(){cn.globalEpoch++}function lG(n){const e=new iG(cn.currentTransaction);cn.currentTransaction=e;try{let t,r=!1;try{t=n(()=>r=!0)}catch(i){throw e.abort(),i}return r?e.abort():e.commit(),t}finally{cn.currentTransaction=cn.currentTransaction.parent}}function Js(n){return cn.currentTransaction?n():lG(n)}class uG{constructor(e,t,r){G(this,"isEqual");G(this,"computeDiff");G(this,"lastChangedEpoch",rs());G(this,"children",new Jy);G(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new kL(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return e0(this),this.current}set(e,t){var i,s;if(((i=this.isEqual)==null?void 0:i.call(this,this.current,e))??TL(this.current,e))return this.current;cG(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,rs(),t??((s=this.computeDiff)==null?void 0:s.call(this,this.current,e,this.lastChangedEpoch,rs()))??Ts),this.lastChangedEpoch=rs();const r=this.current;return this.current=e,aG(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return e0(this),e>=this.lastChangedEpoch?ic:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Ts}}const OL=El("Atom",()=>uG);function cr(n,e,t){return new OL(n,e,t)}let o3=!1;function dG(){o3||(o3=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const zf=Symbol.for("com.tldraw.state/UNINITIALIZED");function yu(n){return n===zf}const CI=El("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function Uf(n,e){return new CI(n,e)}class hG{constructor(e,t,r){G(this,"lastChangedEpoch",sl);G(this,"lastTraversedEpoch",sl);G(this,"lastCheckedEpoch",sl);G(this,"parentSet",new Jy);G(this,"parents",[]);G(this,"parentEpochs",[]);G(this,"children",new Jy);G(this,"historyBuffer");G(this,"state",zf);G(this,"error",null);G(this,"computeDiff");G(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new kL(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??TL}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var i;const t=this.lastChangedEpoch===sl,r=rs();if(!t&&(this.lastCheckedEpoch===r||this.isActivelyListening&&oG()&&this.lastTraversedEpoch<sG()||!ML(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{AL(this);const s=this.derive(this.state,this.lastCheckedEpoch),o=s instanceof CI?s.value:s,a=this.state===zf;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const c=s instanceof CI?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,rs(),c??((i=this.computeDiff)==null?void 0:i.call(this,this.state,o,this.lastCheckedEpoch,rs()))??Ts)}this.lastChangedEpoch=rs(),this.state=o}return this.error=null,this.lastCheckedEpoch=rs(),this.state}catch(s){if(this.state!==zf&&(this.state=zf,this.lastChangedEpoch=rs()),this.lastCheckedEpoch=rs(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{RL()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{e0(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),e0(this),e>=this.lastChangedEpoch?ic:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??Ts}}const Hp=El("Computed",()=>hG);function fG(n={},e,t,r){const i=r.value,s=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let o=this[s];return o||(o=new Hp(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r.value[LL]=!0,r}function pG(n={},e,t,r){const i=r.get,s=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let o=this[s];return o||(o=new Hp(t,i.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r}function gG(n,e,t){bt(t.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(t.name)),i=function(){let s=this[r];return s||(s=new Hp(String(t.name),e.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()};return i[LL]=!0,i}function a3(n={},e){if(e.length===2){const[t,r]=e;return gG(n,t,r)}else{const[t,r,i]=e;return i.get?(dG(),pG(n,t,r,i)):fG(n,t,r,i)}}const LL="@@__isComputedMethod__@@";function Ie(){if(arguments.length===1){const n=arguments[0];return(...e)=>a3(n,e)}else return typeof arguments[0]=="string"?new Hp(arguments[0],arguments[1],arguments[2]):a3(void 0,arguments)}function mG(n){return n instanceof OL||n instanceof Hp}const NL=1,yG=El("apiVersion",()=>NL);if(yG!==NL)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");xa("@tldraw/state","3.5.1","esm");var P=uC();const Ce=fs(P),wG=XW({__proto__:null,default:Ce},[P]);function X0(n,e){const t=Ce.useRef(e);t.current=e;const[r,i,s]=Ce.useMemo(()=>{let o=null;const a=d=>(o=d,()=>{o=null}),c=new Ph(`useStateTracking(${n})`,()=>{var d;return(d=t.current)==null?void 0:d.call(t)},{scheduleEffect(){o==null||o()}});return[c,a,()=>c.scheduleCount]},[n]);return Ce.useSyncExternalStore(i,s,s),Ce.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const c3={apply(n,e,t){return X0(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},vG=Symbol.for("react.memo"),SG=Symbol.for("react.forward_ref");function ti(n){let e=null;const t=n.$$typeof;return t===vG&&(n=n.type,e=n.compare),t===SG?P.memo(P.forwardRef(new Proxy(n.render,c3))):P.memo(new Proxy(n,c3),e)}function LC(n,e,t){return P.useState(()=>{const r=typeof e=="function"?e():e;return cr(`useAtom(${n})`,r,t)})[0]}function xG(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return P.useMemo(()=>Ie(`useComputed(${n})`,e,t),r)}function ul(n,e,t=ic){P.useEffect(()=>{const r=new Ph(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function xe(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=P.useRef(!0);r.current=!0;const i=P.useMemo(()=>n.length===1?n[0]:Ie(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:s,getSnapshot:o}=P.useMemo(()=>({subscribe:a=>To(`useValue(${t})`,()=>{i.get(),a()}),getSnapshot:()=>i.get()}),[i]);return P.useSyncExternalStore(s,o,o)}finally{r.current=!1}}xa("@tldraw/state-react","3.5.1","esm");class ay{constructor(e){G(this,"nextValue");G(this,"diff");this.previousValue=e}get(){var r,i,s,o;const e=((i=(r=this.diff)==null?void 0:r.removed)==null?void 0:i.size)??0,t=((o=(s=this.diff)==null?void 0:s.added)==null?void 0:o.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((i=this.diff).added??(i.added=new Set),this.diff.added.add(e))}add(e){var i,s,o;const t=this.previousValue.has(e);if(t)return((s=(i=this.diff)==null?void 0:i.removed)==null?void 0:s.has(e))?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,i;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(i=this.diff.added)==null||i.delete(e)}remove(e){var i,s,o,a;const t=this.previousValue.has(e);if(!t)return((s=(i=this.diff)==null?void 0:i.added)==null?void 0:s.has(e))?this._remove(e,t):void 0;(a=(o=this.diff)==null?void 0:o.removed)!=null&&a.has(e)||this._remove(e,t)}}class Z0{constructor(e,t){G(this,"createDefaultProperties");G(this,"validator");G(this,"ephemeralKeys");G(this,"ephemeralKeySet");G(this,"scope");this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:i=>i},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[i,s]of Jr(t.ephemeralKeys))s&&r.add(i);this.ephemeralKeySet=r}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,i]of Object.entries(e))i!==void 0&&(t[r]=i);return t.typeName=this.typeName,t}clone(e){return{...Un(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Jt())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new Z0(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function ba(n,e){return new Z0(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function t0(){return{added:{},updated:{},removed:{}}}function gp(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,r]of Object.values(n.updated))e.updated[t.id]=[r,t];return e}function BL(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function Q0(n){const e={added:{},removed:{},updated:{}};return tp(e,n),e}function tp(n,e){for(const t of e){for(const[r,i]of Jr(t.added))if(n.removed[r]){const s=n.removed[r];delete n.removed[r],s!==i&&(n.updated[r]=[s,i])}else n.added[r]=i;for(const[r,[i,s]]of Jr(t.updated)){if(n.added[r]){n.added[r]=s,delete n.updated[r],delete n.removed[r];continue}if(n.updated[r]){n.updated[r]=[n.updated[r][0],s],delete n.removed[r];continue}n.updated[r]=t.updated[r],delete n.removed[r]}for(const[r,i]of Jr(t.removed))n.added[r]?delete n.added[r]:n.updated[r]?(n.removed[r]=n.updated[r][0],delete n.updated[r]):n.removed[r]=i}}var $f={exports:{}};$f.exports;var l3;function bG(){return l3||(l3=1,function(n,e){var t=200,r="__lodash_hash_undefined__",i=1,s=2,o=9007199254740991,a="[object Arguments]",c="[object Array]",u="[object AsyncFunction]",d="[object Boolean]",f="[object Date]",g="[object Error]",m="[object Function]",v="[object GeneratorFunction]",w="[object Map]",S="[object Number]",b="[object Null]",x="[object Object]",E="[object Promise]",M="[object Proxy]",j="[object RegExp]",D="[object Set]",H="[object String]",L="[object Symbol]",U="[object Undefined]",z="[object WeakMap]",Y="[object ArrayBuffer]",V="[object DataView]",N="[object Float32Array]",_="[object Float64Array]",k="[object Int8Array]",O="[object Int16Array]",W="[object Int32Array]",q="[object Uint8Array]",X="[object Uint8ClampedArray]",ne="[object Uint16Array]",$="[object Uint32Array]",C=/[\\^$.*+?()[\]{}|]/g,R=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,J={};J[N]=J[_]=J[k]=J[O]=J[W]=J[q]=J[X]=J[ne]=J[$]=!0,J[a]=J[c]=J[Y]=J[d]=J[V]=J[f]=J[g]=J[m]=J[w]=J[S]=J[x]=J[j]=J[D]=J[H]=J[z]=!1;var oe=typeof cs=="object"&&cs&&cs.Object===Object&&cs,ue=typeof self=="object"&&self&&self.Object===Object&&self,fe=oe||ue||Function("return this")(),_e=e&&!e.nodeType&&e,Le=_e&&!0&&n&&!n.nodeType&&n,Ne=Le&&Le.exports===_e,Ze=Ne&&oe.process,dt=function(){try{return Ze&&Ze.binding&&Ze.binding("util")}catch{}}(),et=dt&&dt.isTypedArray;function Xe(ie,he){for(var Pe=-1,Ke=ie==null?0:ie.length,fn=0,vt=[];++Pe<Ke;){var Pn=ie[Pe];he(Pn,Pe,ie)&&(vt[fn++]=Pn)}return vt}function Kt(ie,he){for(var Pe=-1,Ke=he.length,fn=ie.length;++Pe<Ke;)ie[fn+Pe]=he[Pe];return ie}function _t(ie,he){for(var Pe=-1,Ke=ie==null?0:ie.length;++Pe<Ke;)if(he(ie[Pe],Pe,ie))return!0;return!1}function Ut(ie,he){for(var Pe=-1,Ke=Array(ie);++Pe<ie;)Ke[Pe]=he(Pe);return Ke}function ur(ie){return function(he){return ie(he)}}function At(ie,he){return ie.has(he)}function Et(ie,he){return ie==null?void 0:ie[he]}function On(ie){var he=-1,Pe=Array(ie.size);return ie.forEach(function(Ke,fn){Pe[++he]=[fn,Ke]}),Pe}function qt(ie,he){return function(Pe){return ie(he(Pe))}}function tn(ie){var he=-1,Pe=Array(ie.size);return ie.forEach(function(Ke){Pe[++he]=Ke}),Pe}var dr=Array.prototype,nn=Function.prototype,te=Object.prototype,F=fe["__core-js_shared__"],K=nn.toString,Q=te.hasOwnProperty,re=function(){var ie=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||"");return ie?"Symbol(src)_1."+ie:""}(),ce=te.toString,ye=RegExp("^"+K.call(Q).replace(C,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ut=Ne?fe.Buffer:void 0,st=fe.Symbol,at=fe.Uint8Array,Rt=te.propertyIsEnumerable,Qe=dr.splice,$t=st?st.toStringTag:void 0,ii=Object.getOwnPropertySymbols,Ht=ut?ut.isBuffer:void 0,rn=qt(Object.keys,Object),Ma=Aa(fe,"DataView"),dn=Aa(fe,"Map"),vn=Aa(fe,"Promise"),Ta=Aa(fe,"Set"),Sn=Aa(fe,"WeakMap"),ln=Aa(Object,"create"),jl=oi(Ma),mn=oi(dn),En=oi(vn),$o=oi(Ta),Hn=oi(Sn),hn=st?st.prototype:void 0,oo=hn?hn.valueOf:void 0;function Yt(ie){var he=-1,Pe=ie==null?0:ie.length;for(this.clear();++he<Pe;){var Ke=ie[he];this.set(Ke[0],Ke[1])}}function Cn(){this.__data__=ln?ln(null):{},this.size=0}function Zu(ie){var he=this.has(ie)&&delete this.__data__[ie];return this.size-=he?1:0,he}function Wn(ie){var he=this.__data__;if(ln){var Pe=he[ie];return Pe===r?void 0:Pe}return Q.call(he,ie)?he[ie]:void 0}function Kn(ie){var he=this.__data__;return ln?he[ie]!==void 0:Q.call(he,ie)}function Bs(ie,he){var Pe=this.__data__;return this.size+=this.has(ie)?0:1,Pe[ie]=ln&&he===void 0?r:he,this}Yt.prototype.clear=Cn,Yt.prototype.delete=Zu,Yt.prototype.get=Wn,Yt.prototype.has=Kn,Yt.prototype.set=Bs;function Xt(ie){var he=-1,Pe=ie==null?0:ie.length;for(this.clear();++he<Pe;){var Ke=ie[he];this.set(Ke[0],Ke[1])}}function Ln(){this.__data__=[],this.size=0}function Dl(ie){var he=this.__data__,Pe=Qu(he,ie);if(Pe<0)return!1;var Ke=he.length-1;return Pe==Ke?he.pop():Qe.call(he,Pe,1),--this.size,!0}function xc(ie){var he=this.__data__,Pe=Qu(he,ie);return Pe<0?void 0:he[Pe][1]}function bc(ie){return Qu(this.__data__,ie)>-1}function _c(ie,he){var Pe=this.__data__,Ke=Qu(Pe,ie);return Ke<0?(++this.size,Pe.push([ie,he])):Pe[Ke][1]=he,this}Xt.prototype.clear=Ln,Xt.prototype.delete=Dl,Xt.prototype.get=xc,Xt.prototype.has=bc,Xt.prototype.set=_c;function Wi(ie){var he=-1,Pe=ie==null?0:ie.length;for(this.clear();++he<Pe;){var Ke=ie[he];this.set(Ke[0],Ke[1])}}function Ol(){this.size=0,this.__data__={hash:new Yt,map:new(dn||Xt),string:new Yt}}function Ll(ie){var he=Gt(this,ie).delete(ie);return this.size-=he?1:0,he}function xn(ie){return Gt(this,ie).get(ie)}function Nl(ie){return Gt(this,ie).has(ie)}function ka(ie,he){var Pe=Gt(this,ie),Ke=Pe.size;return Pe.set(ie,he),this.size+=Pe.size==Ke?0:1,this}Wi.prototype.clear=Ol,Wi.prototype.delete=Ll,Wi.prototype.get=xn,Wi.prototype.has=Nl,Wi.prototype.set=ka;function ao(ie){var he=-1,Pe=ie==null?0:ie.length;for(this.__data__=new Wi;++he<Pe;)this.add(ie[he])}function Ho(ie){return this.__data__.set(ie,r),this}function Bl(ie){return this.__data__.has(ie)}ao.prototype.add=ao.prototype.push=Ho,ao.prototype.has=Bl;function Ai(ie){var he=this.__data__=new Xt(ie);this.size=he.size}function Wo(){this.__data__=new Xt,this.size=0}function si(ie){var he=this.__data__,Pe=he.delete(ie);return this.size=he.size,Pe}function Fl(ie){return this.__data__.get(ie)}function Fr(ie){return this.__data__.has(ie)}function zl(ie,he){var Pe=this.__data__;if(Pe instanceof Xt){var Ke=Pe.__data__;if(!dn||Ke.length<t-1)return Ke.push([ie,he]),this.size=++Pe.size,this;Pe=this.__data__=new Wi(Ke)}return Pe.set(ie,he),this.size=Pe.size,this}Ai.prototype.clear=Wo,Ai.prototype.delete=si,Ai.prototype.get=Fl,Ai.prototype.has=Fr,Ai.prototype.set=zl;function pv(ie,he){var Pe=Go(ie),Ke=!Pe&&Hl(ie),fn=!Pe&&!Ke&&Hh(ie),vt=!Pe&&!Ke&&!fn&&Kh(ie),Pn=Pe||Ke||fn||vt,hr=Pn?Ut(ie.length,String):[],Mn=hr.length;for(var bn in ie)Q.call(ie,bn)&&!(Pn&&(bn=="length"||fn&&(bn=="offset"||bn=="parent")||vt&&(bn=="buffer"||bn=="byteLength"||bn=="byteOffset")||mg(bn,Mn)))&&hr.push(bn);return hr}function Qu(ie,he){for(var Pe=ie.length;Pe--;)if(lo(ie[Pe][0],he))return Pe;return-1}function Ju(ie,he,Pe){var Ke=he(ie);return Go(ie)?Ke:Kt(Ke,Pe(ie))}function Ko(ie){return ie==null?ie===void 0?U:b:$t&&$t in Object(ie)?gg(ie):qo(ie)}function Ic(ie){return Yo(ie)&&Ko(ie)==a}function Ul(ie,he,Pe,Ke,fn){return ie===he?!0:ie==null||he==null||!Yo(ie)&&!Yo(he)?ie!==ie&&he!==he:gv(ie,he,Pe,Ke,Ul,fn)}function gv(ie,he,Pe,Ke,fn,vt){var Pn=Go(ie),hr=Go(he),Mn=Pn?c:co(ie),bn=hr?c:co(he);Mn=Mn==a?x:Mn,bn=bn==a?x:bn;var Tr=Mn==x,Ki=bn==x,fr=Mn==bn;if(fr&&Hh(ie)){if(!Hh(he))return!1;Pn=!0,Tr=!1}if(fr&&!Tr)return vt||(vt=new Ai),Pn||Kh(ie)?ed(ie,he,Pe,Ke,fn,vt):$l(ie,he,Mn,Pe,Ke,fn,vt);if(!(Pe&i)){var zr=Tr&&Q.call(ie,"__wrapped__"),Ri=Ki&&Q.call(he,"__wrapped__");if(zr||Ri){var ir=zr?ie.value():ie,ai=Ri?he.value():he;return vt||(vt=new Ai),fn(ir,ai,Pe,Ke,vt)}}return fr?(vt||(vt=new Ai),yv(ie,he,Pe,Ke,fn,vt)):!1}function mv(ie){if(!Wh(ie)||$h(ie))return!1;var he=Ec(ie)?ye:R;return he.test(oi(ie))}function zh(ie){return Yo(ie)&&vg(ie.length)&&!!J[Ko(ie)]}function pg(ie){if(!nd(ie))return rn(ie);var he=[];for(var Pe in Object(ie))Q.call(ie,Pe)&&Pe!="constructor"&&he.push(Pe);return he}function ed(ie,he,Pe,Ke,fn,vt){var Pn=Pe&i,hr=ie.length,Mn=he.length;if(hr!=Mn&&!(Pn&&Mn>hr))return!1;var bn=vt.get(ie);if(bn&&vt.get(he))return bn==he;var Tr=-1,Ki=!0,fr=Pe&s?new ao:void 0;for(vt.set(ie,he),vt.set(he,ie);++Tr<hr;){var zr=ie[Tr],Ri=he[Tr];if(Ke)var ir=Pn?Ke(Ri,zr,Tr,he,ie,vt):Ke(zr,Ri,Tr,ie,he,vt);if(ir!==void 0){if(ir)continue;Ki=!1;break}if(fr){if(!_t(he,function(ai,uo){if(!At(fr,uo)&&(zr===ai||fn(zr,ai,Pe,Ke,vt)))return fr.push(uo)})){Ki=!1;break}}else if(!(zr===Ri||fn(zr,Ri,Pe,Ke,vt))){Ki=!1;break}}return vt.delete(ie),vt.delete(he),Ki}function $l(ie,he,Pe,Ke,fn,vt,Pn){switch(Pe){case V:if(ie.byteLength!=he.byteLength||ie.byteOffset!=he.byteOffset)return!1;ie=ie.buffer,he=he.buffer;case Y:return!(ie.byteLength!=he.byteLength||!vt(new at(ie),new at(he)));case d:case f:case S:return lo(+ie,+he);case g:return ie.name==he.name&&ie.message==he.message;case j:case H:return ie==he+"";case w:var hr=On;case D:var Mn=Ke&i;if(hr||(hr=tn),ie.size!=he.size&&!Mn)return!1;var bn=Pn.get(ie);if(bn)return bn==he;Ke|=s,Pn.set(ie,he);var Tr=ed(hr(ie),hr(he),Ke,fn,vt,Pn);return Pn.delete(ie),Tr;case L:if(oo)return oo.call(ie)==oo.call(he)}return!1}function yv(ie,he,Pe,Ke,fn,vt){var Pn=Pe&i,hr=td(ie),Mn=hr.length,bn=td(he),Tr=bn.length;if(Mn!=Tr&&!Pn)return!1;for(var Ki=Mn;Ki--;){var fr=hr[Ki];if(!(Pn?fr in he:Q.call(he,fr)))return!1}var zr=vt.get(ie);if(zr&&vt.get(he))return zr==he;var Ri=!0;vt.set(ie,he),vt.set(he,ie);for(var ir=Pn;++Ki<Mn;){fr=hr[Ki];var ai=ie[fr],uo=he[fr];if(Ke)var Cc=Pn?Ke(uo,ai,fr,he,ie,vt):Ke(ai,uo,fr,ie,he,vt);if(!(Cc===void 0?ai===uo||fn(ai,uo,Pe,Ke,vt):Cc)){Ri=!1;break}ir||(ir=fr=="constructor")}if(Ri&&!ir){var rd=ie.constructor,Pc=he.constructor;rd!=Pc&&"constructor"in ie&&"constructor"in he&&!(typeof rd=="function"&&rd instanceof rd&&typeof Pc=="function"&&Pc instanceof Pc)&&(Ri=!1)}return vt.delete(ie),vt.delete(he),Ri}function td(ie){return Ju(ie,wv,Uh)}function Gt(ie,he){var Pe=ie.__data__;return yg(he)?Pe[typeof he=="string"?"string":"hash"]:Pe.map}function Aa(ie,he){var Pe=Et(ie,he);return mv(Pe)?Pe:void 0}function gg(ie){var he=Q.call(ie,$t),Pe=ie[$t];try{ie[$t]=void 0;var Ke=!0}catch{}var fn=ce.call(ie);return Ke&&(he?ie[$t]=Pe:delete ie[$t]),fn}var Uh=ii?function(ie){return ie==null?[]:(ie=Object(ie),Xe(ii(ie),function(he){return Rt.call(ie,he)}))}:Wl,co=Ko;(Ma&&co(new Ma(new ArrayBuffer(1)))!=V||dn&&co(new dn)!=w||vn&&co(vn.resolve())!=E||Ta&&co(new Ta)!=D||Sn&&co(new Sn)!=z)&&(co=function(ie){var he=Ko(ie),Pe=he==x?ie.constructor:void 0,Ke=Pe?oi(Pe):"";if(Ke)switch(Ke){case jl:return V;case mn:return w;case En:return E;case $o:return D;case Hn:return z}return he});function mg(ie,he){return he=he??o,!!he&&(typeof ie=="number"||Z.test(ie))&&ie>-1&&ie%1==0&&ie<he}function yg(ie){var he=typeof ie;return he=="string"||he=="number"||he=="symbol"||he=="boolean"?ie!=="__proto__":ie===null}function $h(ie){return!!re&&re in ie}function nd(ie){var he=ie&&ie.constructor,Pe=typeof he=="function"&&he.prototype||te;return ie===Pe}function qo(ie){return ce.call(ie)}function oi(ie){if(ie!=null){try{return K.call(ie)}catch{}try{return ie+""}catch{}}return""}function lo(ie,he){return ie===he||ie!==ie&&he!==he}var Hl=Ic(function(){return arguments}())?Ic:function(ie){return Yo(ie)&&Q.call(ie,"callee")&&!Rt.call(ie,"callee")},Go=Array.isArray;function Vo(ie){return ie!=null&&vg(ie.length)&&!Ec(ie)}var Hh=Ht||Kl;function wg(ie,he){return Ul(ie,he)}function Ec(ie){if(!Wh(ie))return!1;var he=Ko(ie);return he==m||he==v||he==u||he==M}function vg(ie){return typeof ie=="number"&&ie>-1&&ie%1==0&&ie<=o}function Wh(ie){var he=typeof ie;return ie!=null&&(he=="object"||he=="function")}function Yo(ie){return ie!=null&&typeof ie=="object"}var Kh=et?ur(et):zh;function wv(ie){return Vo(ie)?pv(ie):pg(ie)}function Wl(){return[]}function Kl(){return!1}n.exports=wg}($f,$f.exports)),$f.exports}var _G=bG();const gl=fs(_G);function IG(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const i of e)t.every(s=>s.has(i))&&r.add(i);return r}function EG(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function u3(n,e){for(const[t,r]of Object.entries(n)){const i=r,s=e[t];if("eq"in i&&s!==i.eq||"neq"in i&&s===i.neq||"gt"in i&&(typeof s!="number"||s<=i.gt))return!1}return!0}function d3(n,e,t){const r=Object.fromEntries(Object.keys(t).map(i=>[i,new Set]));for(const[i,s]of Object.entries(t))if("eq"in s){const a=n.index(e,i).get().get(s.eq);if(a)for(const c of a)r[i].add(c)}else if("neq"in s){const o=n.index(e,i);for(const[a,c]of o.get())if(a!==s.neq)for(const u of c)r[i].add(u)}else if("gt"in s){const o=n.index(e,i);for(const[a,c]of o.get())if(a>s.gt)for(const u of c)r[i].add(u)}return IG(Object.values(r))}class CG{constructor(e,t){G(this,"indexCache",new Map);G(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=Ie("filterHistory:"+e,(r,i)=>{if(yu(r))return this.history.get();const s=this.history.getDiffSince(i);if(s===Ts)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,c=0,u=0;for(const d of s){for(const f of Vn(d.added))if(f.typeName===e)if(o.removed[f.id]){const g=o.removed[f.id];delete o.removed[f.id],c--,g!==f&&(o.updated[f.id]=[g,f],u++)}else o.added[f.id]=f,a++;for(const[f,g]of Vn(d.updated))g.typeName===e&&(o.added[g.id]?o.added[g.id]=g:o.updated[g.id]?o.updated[g.id]=[o.updated[g.id][0],g]:(o.updated[g.id]=[f,g],u++));for(const f of Vn(d.removed))f.typeName===e&&(o.added[f.id]?(delete o.added[f.id],a--):o.updated[f.id]?(o.removed[f.id]=o.updated[f.id][0],delete o.updated[f.id],u--,c++):(o.removed[f.id]=f,c++))}return a||c||u?Uf(this.history.get(),o):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const i=this.__uncached_createIndex(e,t);return this.indexCache.set(r,i),i}__uncached_createIndex(e,t){const r=this.filterHistory(e),i=()=>{r.get();const s=new Map;for(const o of Vn(this.atoms.get())){const a=o.get();if(a.typeName===e){const c=a[t];s.has(c)||s.set(c,new Set),s.get(c).add(a.id)}}return s};return Ie("index:"+e+":"+t,(s,o)=>{if(yu(s))return i();const a=r.getDiffSince(o);if(a===Ts)return i();const c=new Map,u=(m,v)=>{let w=c.get(m);w||(w=new ay(s.get(m)??new Set)),w.add(v),c.set(m,w)},d=(m,v)=>{let w=c.get(m);w||(w=new ay(s.get(m)??new Set)),w.remove(v),c.set(m,w)};for(const m of a){for(const v of Vn(m.added))if(v.typeName===e){const w=v[t];u(w,v.id)}for(const[v,w]of Vn(m.updated))if(w.typeName===e){const S=v[t],b=w[t];S!==b&&(d(S,w.id),u(b,w.id))}for(const v of Vn(m.removed))if(v.typeName===e){const w=v[t];d(w,v.id)}}let f,g;for(const[m,v]of c){const w=v.get();w&&(f||(f=new Map(s)),g||(g=new Map),w.value.size===0?f.delete(m):f.set(m,w.value),g.set(m,w.diff))}return f&&g?Uf(f,g):s},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,r);return Ie(r,()=>{var s;for(const o of i.get())return(s=this.atoms.get()[o])==null?void 0:s.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const i=this.ids(e,t,"ids:"+r);return Ie(r,()=>[...i.get()].map(s=>{const o=this.atoms.get()[s];if(!o)throw new Error("no atom found for record id: "+s);return o.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const i=this.filterHistory(e),s=()=>{i.get();const c=t();return Object.keys(c).length===0?new Set(Vn(this.atoms.get()).flatMap(u=>{const d=u.get();return d.typeName===e?d.id:[]})):d3(this,e,c)},o=c=>{const u=s(),d=EG(c,u);return d?Uf(u,d):c},a=Ie("ids_query:"+r,t,{isEqual:gl});return Ie("query:"+r,(c,u)=>{const d=a.get();if(yu(c))return s();if(u<a.lastChangedEpoch)return o(c);const f=i.getDiffSince(u);if(f===Ts)return o(c);const g=new ay(c);for(const v of f){for(const w of Vn(v.added))w.typeName===e&&u3(d,w)&&g.add(w.id);for(const[w,S]of Vn(v.updated))S.typeName===e&&(u3(d,S)?g.add(S.id):g.remove(S.id));for(const w of Vn(v.removed))w.typeName===e&&g.remove(w.id)}const m=g.get();return m?Uf(m.value,m.diff):c},{historyLength:50})}exec(e,t){const r=d3(this,e,t);if(r.size===0)return ic;const i=this.atoms.get();return[...r].map(s=>i[s].get())}}class PG{constructor(e){G(this,"_beforeCreateHandlers",{});G(this,"_afterCreateHandlers",{});G(this,"_beforeChangeHandlers",{});G(this,"_afterChangeHandlers",{});G(this,"_beforeDeleteHandlers",{});G(this,"_afterDeleteHandlers",{});G(this,"_operationCompleteHandlers",[]);G(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let i=e;for(const s of r)i=s(i,t);return i}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleBeforeChange(e,t,r){if(!this._isEnabled)return t;const i=this._beforeChangeHandlers[t.typeName];if(i){let s=t;for(const o of i)s=o(e,s,r);return s}return t}handleAfterChange(e,t,r){if(!this._isEnabled)return;const i=this._afterChangeHandlers[t.typeName];if(i)for(const s of i)s(e,t,r)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const i of r)if(i(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const i of r)i(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[r,i]of Object.entries(e))i!=null&&i.beforeCreate&&t.push(this.registerBeforeCreateHandler(r,i.beforeCreate)),i!=null&&i.afterCreate&&t.push(this.registerAfterCreateHandler(r,i.afterCreate)),i!=null&&i.beforeChange&&t.push(this.registerBeforeChangeHandler(r,i.beforeChange)),i!=null&&i.afterChange&&t.push(this.registerAfterChangeHandler(r,i.afterChange)),i!=null&&i.beforeDelete&&t.push(this.registerBeforeDeleteHandler(r,i.beforeDelete)),i!=null&&i.afterDelete&&t.push(this.registerAfterDeleteHandler(r,i.afterDelete));return()=>{for(const r of t)r()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>iu(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>iu(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>iu(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>iu(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>iu(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>iu(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>iu(this._operationCompleteHandlers,e)}}function iu(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class NC{constructor(e){G(this,"id");G(this,"atoms",cr("store_atoms",{}));G(this,"history",cr("history",0,{historyLength:1e3}));G(this,"query",new CG(this.atoms,this.history));G(this,"listeners",new Set);G(this,"historyAccumulator",new TG);G(this,"historyReactor");G(this,"schema");G(this,"props");G(this,"scopedTypes");G(this,"sideEffects",new PG(this));G(this,"isMergingRemoteChanges",!1);G(this,"_integrityChecker");G(this,"_isPossiblyCorrupted",!1);G(this,"pendingAfterEvents",null);G(this,"_isInAtomicOp",!1);const{initialData:t,schema:r,id:i}=e;this.id=i??Jt(),this.schema=r,this.props=e.props,t&&this.atoms.set(gC(Jr(t).map(([s,o])=>[s,cr("atom:"+s,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=rG("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=J4(s)}),this.scopedTypes={document:new Set(Vn(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(Vn(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(Vn(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let i=null,s=null,o=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(s??(s=this.filterChangesByScope(t,"document")),!s)continue;a({changes:s,source:r})}else if(c.scope==="session"){if(i??(i=this.filterChangesByScope(t,"session")),!i)continue;a({changes:i,source:r})}else{if(o??(o=this.filterChangesByScope(t,"presence")),!o)continue;a({changes:o,source:r})}else a({changes:t,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const r={added:Jf(e.added,(i,s)=>this.scopedTypes[t].has(s.typeName)),updated:Jf(e.updated,(i,s)=>this.scopedTypes[t].has(s[1].typeName)),removed:Jf(e.removed,(i,s)=>this.scopedTypes[t].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const r={},i={},s=this.atoms.__unsafe__getWithoutCapture();let o=null,a,c=!1;const u=this.isMergingRemoteChanges?"remote":"user";for(let d=0,f=e.length;d<f;d++){a=e[d];const g=(o??s)[a.id];if(g){const m=g.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(m,a,u),this.schema.validateRecord(this,a,t??"updateRecord",m)===m)continue;g.set(a),c=!0;const w=g.__unsafe__getWithoutCapture();r[a.id]=[m,w],this.addDiffForAfterEvent(m,w)}else a=this.sideEffects.handleBeforeCreate(a,u),c=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),i[a.id]=a,this.addDiffForAfterEvent(null,a),o||(o={...s}),o[a.id]=cr("atom:"+a.id,a)}o&&this.atoms.set(o),c&&this.updateHistory({added:i,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const o=this.atoms.__unsafe__getWithoutCapture()[s];o&&this.sideEffects.handleBeforeDelete(o.get(),r)===!1&&t.add(s)}let i;this.atoms.update(s=>{let o;for(const a of e){if(t.has(a)||!(a in s))continue;o||(o={...s}),i||(i={}),delete o[a];const c=s[a].get();i[a]=c,this.addDiffForAfterEvent(c,null)}return o??s}),i&&this.updateHistory({added:{},updated:{},removed:i})})}get(e){var t;return(t=this.atoms.get()[e])==null?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()}serialize(e="document"){const t={};for(const[r,i]of Jr(this.atoms.get())){const s=i.get();(e==="all"||this.scopedTypes[e].has(s.typeName))&&(t[r]=s)}return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return Vn(this.atoms.get()).map(e=>e.get())}clear(){this.remove(Fk(this.atoms.get()))}update(e,t){const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,t){this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,Js(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],r=this.historyAccumulator.addInterceptor(i=>t.push(i.changes));try{return Js(e),Q0(t)}finally{r()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const i=Vn(e.added);for(const[o,a]of Vn(e.updated)){const c=this.schema.getType(a.typeName);if(r&&c.ephemeralKeySet.size){const u=this.get(a.id);if(!u){i.push(a);continue}let d=null;for(const[f,g]of Object.entries(a))c.ephemeralKeySet.has(f)||Object.is(g,Ei(u,f))||(d||(d={...u}),d[f]=g);d&&i.push(d)}else i.push(a)}const s=Fk(e.removed);i.length&&this.put(i),s.length&&this.remove(s)},t)}createComputedCache(e,t,r){const i=new ha;return{get:s=>{const o=this.atoms.get()[s];if(o)return i.get(o,()=>{const a=r?Ie(o.name+":equals",()=>o.get(),{isEqual:r}):o;return Ie(e+":"+s,()=>t(a.get()))}).get()}}}createSelectedComputedCache(e,t,r){const i=new ha;return{get:s=>{const o=this.atoms.get()[s];if(o)return i.get(o,()=>{const a=Ie(e+":"+s+":selector",()=>t(o.get()));return Ie(e+":"+s,()=>r(a.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(bt(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&bt(e.id===t.id),!e&&!t))return;const r=(e||t).id,i=this.pendingAfterEvents.get(r);i?i.after=t:this.pendingAfterEvents.set(r,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:i,after:s}of r.values())i&&s?this.sideEffects.handleAfterChange(i,s,t):i&&!s?this.sideEffects.handleAfterDelete(i,t):!i&&s&&this.sideEffects.handleAfterCreate(s,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return Js(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0;try{const i=e();return this.flushAtomicCallbacks(),i}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function MG(n){if(n.length===0)return[];const e=[];let t=[n[0]],r;for(let i=1,s=n.length;i<s;i++)r=n[i],t[0].source!==r.source&&(e.push(t),t=[]),t.push(r);return e.push(t),e.map(i=>({source:i[0].source,changes:Q0(i.map(s=>s.changes))}))}class TG{constructor(){G(this,"_history",[]);G(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=MG(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function kG(n,e,t){const r=new ha;return{get(i,s){return r.get(i,()=>(i instanceof NC?i:i.store).createComputedCache(n,c=>e(i,c),t)).get(s)}}}function AG(n){const e=[];for(let t=n.length-1;t>=0;t--){const r=n[t];if("id"in r)e.unshift(r);else{const i=r.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:i.concat(s.dependsOn??[])})}}return e}function Qd({sequence:n,sequenceId:e,retroactive:t=!0}){const r={sequenceId:e,retroactive:t,sequence:AG(n)};return FL(r),r}function ps(n,e){return Object.fromEntries(Jr(e).map(([t,r])=>[t,`${n}/${r}`]))}function Os(n){const e=n.sequenceId;return Qd({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:r=>{var i,s;return r.typeName===n.recordType&&(((i=t.filter)==null?void 0:i.call(t,r))??!0)&&(((s=n.filter)==null?void 0:s.call(n,r))??!0)}}:t)})}function RG(n){const e=new Map(n.map(s=>[s.id,s])),t=new Set,r=[];function i(s){bt(!t.has(s.id),`Circular dependency in migrations: ${s.id}`),t.add(s.id);const{version:o,sequenceId:a}=n0(s.id),c=e.get(`${a}/${o-1}`);if(c&&i(c),s.dependsOn)for(const u of s.dependsOn){const d=e.get(u);d&&i(d)}e.delete(s.id),r.push(s)}for(const s of e.values())i(s);return r}function n0(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function h3(n,e){e&&bt(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),bt(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function FL(n){if(bt(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),bt(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;h3(n.sequence[0].id,n.sequenceId);let e=n0(n.sequence[0].id).version;bt(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const r=n.sequence[t].id;h3(r,n.sequenceId);const i=n0(r).version;bt(i===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=i}}var Zc=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(Zc||{});function jG(n){if(n.schemaVersion>2||n.schemaVersion<1)return ll.err("Bad schema version");if(n.schemaVersion===2)return ll.ok(n);const e={schemaVersion:2,sequences:{"com.tldraw.store":n.storeVersion}};for(const[t,r]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=r.version,"subTypeKey"in r)for(const[i,s]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${t}.${i}`]=s;return ll.ok(e)}class BC{constructor(e,t){G(this,"migrations",{});G(this,"sortedMigrations");var i;this.types=e,this.options=t;for(const s of t.migrations??[])bt(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),FL(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=RG(r);for(const s of this.sortedMigrations)if((i=s.dependsOn)!=null&&i.length)for(const o of s.dependsOn){const a=r.find(c=>c.id===o);bt(a,`Migration '${s.id}' depends on missing migration '${o}'`)}}static create(e,t){return new BC(e,t??{})}validateRecord(e,t,r,i){try{const s=Ei(this.types,t.typeName);if(!s)throw new Error(`Missing definition for record type ${t.typeName}`);return s.validate(t,i??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:i,error:s});throw s}}getMigrationsSince(e){const t=jG(e);if(!t.ok)return t;const r=t.value,i=new Set(Object.keys(r.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)r.sequences[o]===void 0&&this.migrations[o].retroactive&&i.add(o);if(i.size===0)return ll.ok([]);const s=new Set;for(const o of i){const a=r.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const d of this.migrations[o].sequence)s.add(d.id);continue}const c=`${o}/${a}`,u=this.migrations[o].sequence.findIndex(d=>d.id===c);if(u===-1)return ll.err("Incompatible schema?");for(const d of this.migrations[o].sequence.slice(u+1))s.add(d.id)}return ll.ok(this.sortedMigrations.filter(({id:o})=>s.has(o)))}migratePersistedRecord(e,t,r="up"){const i=this.getMigrationsSince(t);if(!i.ok)return console.error("Error migrating record",i.error),{type:"error",reason:Zc.MigrationError};let s=i.value;if(s.length===0)return{type:"success",value:e};if(s.some(o=>o.scope==="store"))return{type:"error",reason:r==="down"?Zc.TargetVersionTooOld:Zc.TargetVersionTooNew};if(r==="down"){if(!s.every(o=>o.down))return{type:"error",reason:Zc.TargetVersionTooOld};s=s.slice().reverse()}e=Un(e);try{for(const o of s){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const c=o[r](e);c&&(e=Un(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:Zc.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:Zc.MigrationError};const i=r.value;if(i.length===0)return{type:"success",value:t};t=Un(t);try{for(const s of i)if(s.scope==="record")for(const[o,a]of Object.entries(t)){if(!(s.filter?s.filter(a):!0))continue;const u=s.up(a);u&&(t[o]=Un(u))}else if(s.scope==="store"){const o=s.up(t);o&&(t=Un(o))}else Pr(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:Zc.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?n0(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Ei(this.types,e);return bt(t,"record type does not exists"),t}}xa("@tldraw/store","3.5.1","esm");function DG(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Wt extends Error{constructor(t,r=[]){const i=DG(r),s=t.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(r?`At ${i}: ${s}`:s);G(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function ds(n,e){try{return e()}catch(t){throw t instanceof Wt?new Wt(t.rawMessage,[n,...t.path]):new Wt(t.toString(),[n])}}function ml(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Pr(e)}}class zi{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return zG(this)}optional(){return UL(this)}refine(e){return new zi(t=>e(this.validate(t)),(t,r)=>{const i=this.validateUsingKnownGoodVersion(t,r);return Object.is(t,i)?t:e(i)})}check(e,t){return typeof e=="string"?this.refine(r=>(ds(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class OG extends zi{constructor(e){super(t=>{const r=f3.validate(t);for(let i=0;i<r.length;i++)ds(i,()=>e.validate(r[i]));return r},(t,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const i=f3.validate(r);let s=t.length!==i.length;for(let o=0;o<i.length;o++){const a=i[o];if(o>=t.length){s=!0,ds(o,()=>e.validate(a));continue}if(Object.is(t[o],a))continue;const c=ds(o,()=>e.validateUsingKnownGoodVersion(t[o],a));Object.is(c,t[o])||(s=!0)}return s?r:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Wt("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Wt("Expected an array with length greater than 1")})}}class r0 extends zi{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new Wt(`Expected object, got ${ml(r)}`);for(const[i,s]of Object.entries(e))ds(i,()=>{s.validate(Ei(r,i))});if(!t){for(const i of Object.keys(r))if(!Mo(e,i))throw new Wt("Unexpected property",[i])}return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Wt(`Expected object, got ${ml(i)}`);let s=!1;for(const[o,a]of Object.entries(e)){const c=Ei(r,o),u=Ei(i,o);if(Object.is(c,u))continue;const d=ds(o,()=>{const f=a;return f.validateUsingKnownGoodVersion?f.validateUsingKnownGoodVersion(c,u):f.validate(u)});Object.is(d,c)||(s=!0)}if(!t){for(const o of Object.keys(i))if(!Mo(e,o))throw new Wt("Unexpected property",[o])}for(const o of Object.keys(r))if(!Mo(i,o)){s=!0;break}return s?i:r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new r0(this.config,!0)}extend(e){return new r0({...this.config,...e})}}class J0 extends zi{constructor(e,t,r,i){super(s=>{this.expectObject(s);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(s);return o===void 0?this.unknownValueValidation(s,a):ds(`(${e} = ${a})`,()=>o.validate(s))},(s,o)=>{this.expectObject(o),this.expectObject(s);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,c):Ei(s,e)!==Ei(o,e)?ds(`(${e} = ${c})`,()=>a.validate(o)):ds(`(${e} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(s,o):a.validate(o))}),this.key=e,this.config=t,this.unknownValueValidation=r,this.useNumberKeys=i}expectObject(e){if(typeof e!="object"||e===null)throw new Wt(`Expected an object, got ${ml(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Ei(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new Wt(`Expected a string for key "${this.key}", got ${ml(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new Wt(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Mo(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new J0(this.key,this.config,e,this.useNumberKeys)}}class LG extends zi{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new Wt(`Expected object, got ${ml(r)}`);for(const[i,s]of Object.entries(r))ds(i,()=>{e.validate(i),t.validate(s)});return r},(r,i)=>{if(typeof i!="object"||i===null)throw new Wt(`Expected object, got ${ml(i)}`);let s=!1;for(const[o,a]of Object.entries(i)){if(!Mo(r,o)){s=!0,ds(o,()=>{e.validate(o),t.validate(a)});continue}const c=Ei(r,o),u=a;if(Object.is(c,u))continue;const d=ds(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(c,u):t.validate(u));Object.is(d,c)||(s=!0)}for(const o of Object.keys(r))if(!Mo(i,o)){s=!0;break}return s?i:r}),this.keyValidator=e,this.valueValidator=t}}function FC(n){return new zi(e=>{if(typeof e!==n)throw new Wt(`Expected ${n}, got ${ml(e)}`);return e})}const NG=new zi(n=>n),xt=FC("string"),mt=FC("number").check(n=>{if(Number.isNaN(n))throw new Wt("Expected a number, got NaN");if(!Number.isFinite(n))throw new Wt(`Expected a finite number, got ${n}`)}),i0=mt.check(n=>{if(n<0)throw new Wt(`Expected a positive number, got ${n}`)}),vr=mt.check(n=>{if(n<=0)throw new Wt(`Expected a non-zero positive number, got ${n}`)}),zL=mt.check(n=>{if(!Number.isInteger(n))throw new Wt(`Expected an integer, got ${n}`)}),cy=zL.check(n=>{if(n<0)throw new Wt(`Expected a positive integer, got ${n}`)}),BG=zL.check(n=>{if(n<=0)throw new Wt(`Expected a non-zero positive integer, got ${n}`)}),Dt=FC("boolean");function Mi(n){return new zi(e=>{if(e!==n)throw new Wt(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const f3=new zi(n=>{if(!Array.isArray(n))throw new Wt(`Expected an array, got ${ml(n)}`);return n});function Xr(n){return new OG(n)}function Lt(n){return new r0(n)}function PI(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===QK)}function MI(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(MI):PI(n)?Object.values(n).every(MI):!1}const Zr=new zi(n=>{if(MI(n))return n;throw new Wt(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let r=0;r<e.length;r++){if(r>=n.length){t=!0,Zr.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const o=Zr.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}return t?e:n}else if(PI(n)&&PI(e)){let t=!1;for(const r of Object.keys(e)){if(!Mo(n,r)){t=!0,Zr.validate(e[r]);continue}const i=n[r],s=e[r];if(Object.is(i,s))continue;const o=Zr.validateUsingKnownGoodVersion(i,s);Object.is(o,i)||(t=!0)}for(const r of Object.keys(n))if(!Mo(e,r)){t=!0;break}return t?e:n}else return Zr.validate(e)});function s0(n,e){return new LG(n,e)}function zC(n,e){return new J0(n,e,(t,r)=>{throw new Wt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!1)}function FG(n,e){return new J0(n,e,(t,r)=>{throw new Wt(`Expected one of ${Object.keys(e).map(i=>JSON.stringify(i)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!0)}function _a(n,e){return new zi(t=>ds(n,()=>e.validate(t)),(t,r)=>ds(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,r):e.validate(r)))}function ew(n){return new zi(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new Wt(`Expected ${t}, got ${e}`)}return e})}function UL(n){return new zi(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function zG(n){return new zi(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function tw(...n){return ew(new Set(n))}function UC(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new Wt(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new Wt(`Expected a valid url, got ${JSON.stringify(n)}`)}}const UG=new Set(["http:","https:","mailto:"]),js=xt.check(n=>{if(n==="")return;const e=UC(n);if(!UG.has(e.protocol.toLowerCase()))throw new Wt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),$G=new Set(["http:","https:","data:","asset:"]),bu=xt.check(n=>{if(n==="")return;const e=UC(n);if(!$G.has(e.protocol.toLowerCase()))throw new Wt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});xt.check(n=>{if(n==="")return;if(!UC(n).protocol.toLowerCase().match(/^https?:$/))throw new Wt(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const $C=xt.refine(n=>{try{return $K(n),n}catch{throw new Wt(`Expected an index key, got ${JSON.stringify(n)}`)}});xa("@tldraw/validate","3.5.1","esm");function ks(n){return xt.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const nw=ks("asset");function HC(n,e){return Lt({id:nw,typeName:Mi("asset"),type:Mi(n),props:e,meta:Zr})}const _u=Lt({x:mt,y:mt,z:mt.optional()}),np=Lt({x:mt,y:mt,w:mt,h:mt}),$L=mt.check(n=>{if(n<0||n>1)throw new Wt("Opacity must be between 0 and 1")}),HG=xt.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),Gs=ks("shape");function WG(n,e,t){return Lt({id:Gs,typeName:Mi("shape"),x:mt,y:mt,rotation:mt,index:$C,parentId:HG,type:Mi(n),isLocked:Dt,opacity:$L,props:e?Lt(e):Zr,meta:t?Lt(t):Zr})}const KG=ks("binding");function qG(n,e,t){return Lt({id:KG,typeName:Mi("binding"),type:Mi(n),fromId:Gs,toId:Gs,props:e?Lt(e):Zr,meta:t?Lt(t):Zr})}ps("com.tldraw.binding",{});Os({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function wu(n){return`binding:${Jt()}`}function GG(n){return ba("binding",{scope:"document",validator:_a("binding",zC("type",Np(n,(e,{props:t,meta:r})=>qG(e,t,r))))}).withDefaultProperties(()=>({meta:{}}))}class ni{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:i=NG}=t;return new ni(e,r,i)}static defineEnum(e,t){const{defaultValue:r,values:i}=t;return new VG(e,r,i)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class VG extends ni{constructor(e,t,r){super(e,t,tw(...r)),this.values=r}}const gm=ps("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),YG=Os({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:gm.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:gm.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:gm.AddMeta,up:n=>{n.meta={}}},{id:gm.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function $d(n){return n?n.typeName==="shape":!1}function is(n){return n?n.startsWith("shape:"):!1}function wn(n){return`shape:${n??Jt()}`}function HL(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof ni){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function Bo(n,e){return Np(e,(t,r)=>`com.tldraw.shape.${n}/${r}`)}function XG(n){return ba("shape",{scope:"document",validator:_a("shape",zC("type",Np(n,(e,{props:t,meta:r})=>WG(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function p3(n,e){const t=[];for(const[r,{migrations:i}]of Object.entries(e)){const s=`com.tldraw.${n}.${r}`;i?"sequenceId"in i?(bt(s===i.sequenceId,`sequenceId mismatch for ${r} ${Z0} migrations. Expected '${s}', got '${i.sequenceId}'`),t.push(i)):"sequence"in i?t.push(Qd({sequenceId:s,retroactive:!1,sequence:i.sequence.map(o=>"id"in o?WL(n,r,o):o)})):t.push(Qd({sequenceId:s,retroactive:!1,sequence:Object.keys(i.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${s}/${o}`,scope:"record",filter:a=>a.typeName===n&&a.type===r,up:a=>{const c=i.migrators[o].up(a);if(c)return c},down:a=>{const c=i.migrators[o].down(a);if(c)return c}}))})):t.push(Qd({sequenceId:s,retroactive:!1,sequence:[]}))}return t}function WL(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:r=>r.typeName===n&&r.type===e,up:r=>{const i=t.up(r.props);i&&(r.props=i)},down:typeof t.down=="function"?r=>{const i=t.down(r.props);i&&(r.props=i)}:void 0}}const KL=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],o0={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function wc(n){return n.isDarkMode?o0.darkMode:o0.lightMode}const hs=ni.defineEnum("tldraw:color",{defaultValue:"black",values:KL}),WC=ni.defineEnum("tldraw:labelColor",{defaultValue:"black",values:KL}),Iu=ni.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Eu=ni.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),pa=ni.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),qL={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Ro=ni.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),GL=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],a0=ni.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:GL}),c0=ni.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:GL}),VL={labelColor:WC,color:hs,fill:Eu,dash:Iu,size:Ro,arrowheadStart:a0,arrowheadEnd:c0,font:pa,start:_u,end:_u,bend:mt,text:xt,labelPosition:mt,scale:vr},Ld=Bo("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function mm(n){return WL("shape","arrow",n)}const YL=Qd({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[mm({id:Ld.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),mm({id:Ld.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),mm({id:Ld.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:Ld.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:r,end:i}=t.props;if(r.type==="binding"){const s=wu(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[s]=o,t.props.start={x:0,y:0}}else delete t.props.start.type;if(i.type==="binding"){const s=wu(),o={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:i.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:i.normalizedAnchor,isExact:i.isExact,isPrecise:i.isPrecise}};n[s]=o,t.props.end={x:0,y:0}}else delete t.props.end.type}}},mm({id:Ld.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),XL={terminal:tw("start","end"),normalizedAnchor:_u,isExact:Dt,isPrecise:Dt},ZL={sequence:[{dependsOn:[Ld.ExtractBindings]}]},ZG=_a("camera",Lt({typeName:Mi("camera"),id:ks("camera"),x:mt,y:mt,z:mt,meta:Zr})),QG=ps("com.tldraw.camera",{AddMeta:1}),JG=Os({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:QG.AddMeta,up:n=>{n.meta={}}}]}),Eo=ba("camera",{validator:ZG,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),eV=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),QL=ew(eV),tV=Lt({type:QL,rotation:mt}),nV=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),rV=ew(nV),iV=new Set(["starting","paused","active","stopping"]),JL=Lt({id:xt,points:Xr(_u),size:i0,color:rV,opacity:mt,state:ew(iV),delay:mt,shrink:mt,taper:Dt}),mp=ks("page"),sV=_a("page",Lt({typeName:Mi("page"),id:mp,name:xt,index:$C,meta:Zr})),oV=ps("com.tldraw.page",{AddMeta:1}),aV=Os({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:oV.AddMeta,up:n=>{n.meta={}}}]}),Ds=ba("page",{validator:sV,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function es(n){return Ds.isId(n)}const cV={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function eN(n){return n?Jf(n,e=>cV[e]):null}ks("instance");function lV(n){const e={};for(const[r,i]of n)e[r]=UL(i);const t=_a("instance",Lt({typeName:Mi("instance"),id:ks("instance"),currentPageId:mp,followingUserId:xt.nullable(),brush:np.nullable(),opacityForNextShape:$L,stylesForNextShape:Lt(e),cursor:tV,scribbles:Xr(JL),isFocusMode:Dt,isDebugMode:Dt,isToolLocked:Dt,exportBackground:Dt,screenBounds:np,insets:Xr(Dt),zoomBrush:np.nullable(),isPenMode:Dt,isGridMode:Dt,chatMessage:xt,isChatting:Dt,highlightedUserIds:Xr(xt),isFocused:Dt,devicePixelRatio:mt,isCoarsePointer:Dt,isHoveringCanvas:Dt.nullable(),openMenus:Xr(xt),isChangingStyle:Dt,isReadonly:Dt,meta:Zr,duplicateProps:Lt({shapeIds:Xr(ks("shape")),offset:Lt({x:mt,y:mt})}).nullable()}));return ba("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Fn=ps("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),uV=Os({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Fn.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:Fn.RemoveDialog,up:({dialog:n,...e})=>e},{id:Fn.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:Fn.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Fn.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:Fn.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:Fn.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:Fn.AddZoom,up:n=>({...n,zoomBrush:null})},{id:Fn.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:Fn.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:Fn.RemoveUserId,up:({userId:n,...e})=>e},{id:Fn.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:Fn.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:Fn.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:Fn.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:Fn.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:Fn.AddMeta,up:n=>({...n,meta:{}})},{id:Fn.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:Fn.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Fn.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:Fn.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:Fn.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:Fn.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:Fn.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:Fn.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),xi="instance:instance",dV=_a("instance_page_state",Lt({typeName:Mi("instance_page_state"),id:ks("instance_page_state"),pageId:mp,selectedShapeIds:Xr(Gs),hintingShapeIds:Xr(Gs),erasingShapeIds:Xr(Gs),hoveredShapeId:Gs.nullable(),editingShapeId:Gs.nullable(),croppingShapeId:Gs.nullable(),focusedGroupId:Gs.nullable(),meta:Zr})),Sf=ps("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),hV=Os({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Sf.AddCroppingId,up(n){n.croppingShapeId=null}},{id:Sf.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:Sf.AddMeta,up:n=>{n.meta={}}},{id:Sf.RenameProperties,up:n=>{},down:n=>{}},{id:Sf.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Zs=ba("instance_page_state",{validator:dV,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),fV=_a("pointer",Lt({typeName:Mi("pointer"),id:ks("pointer"),x:mt,y:mt,lastActivityTimestamp:mt,meta:Zr})),pV=ps("com.tldraw.pointer",{AddMeta:1}),gV=Os({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:pV.AddMeta,up:n=>{n.meta={}}}]}),KC=ba("pointer",{validator:fV,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),yp=KC.createId("pointer"),mV=_a("instance_presence",Lt({typeName:Mi("instance_presence"),id:ks("instance_presence"),userId:xt,userName:xt,lastActivityTimestamp:mt,followingUserId:xt.nullable(),cursor:Lt({x:mt,y:mt,type:QL,rotation:mt}),color:xt,camera:Lt({x:mt,y:mt,z:mt}),screenBounds:np,selectedShapeIds:Xr(ks("shape")),currentPageId:ks("page"),brush:np.nullable(),scribbles:Xr(JL),chatMessage:xt,meta:Zr})),xf=ps("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),yV=Os({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:xf.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:xf.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:xf.AddChatMessage,up:n=>{n.chatMessage=""}},{id:xf.AddMeta,up:n=>{n.meta={}}},{id:xf.RenameSelectedShapeIds,up:n=>{}}]}),TI=ba("instance_presence",{validator:mV,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}}));function wV(n,e){return t=>Ie("instancePresence",()=>{const r=t.get(xi),i=t.get(Zs.createId(r==null?void 0:r.currentPageId)),s=t.get(Eo.createId(r==null?void 0:r.currentPageId)),o=t.get(yp),a=n.get();return!i||!r||!s||!o||!a?null:TI.create({id:TI.createId(t.id),selectedShapeIds:i.selectedShapeIds,brush:r.brush,scribbles:r.scribbles,userId:a.id,userName:a.name,followingUserId:r.followingUserId,camera:{x:s.x,y:s.y,z:s.z},color:a.color,currentPageId:r.currentPageId,cursor:{x:o.x,y:o.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:o.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}})})}const vV=_a("document",Lt({typeName:Mi("document"),id:Mi("document:document"),gridSize:mt,name:xt,meta:Zr})),g3=ps("com.tldraw.document",{AddName:1,AddMeta:2}),SV=Os({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:g3.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:g3.AddMeta,up:n=>{n.meta={}}}]}),qC=ba("document",{validator:vV,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),kI=qC.createId("document");function xV(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function m3(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}function bV({error:n,phase:e,record:t,recordBefore:r}){throw fC(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?m3(Un(r)):void 0,recordAfter:m3(Un(t))}}),n}function _V(){return[Ds.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function IV(n){const e=n.query.ids("page"),t=n.query.records("instance_page_state"),r=()=>{if(!n.has(kI))return n.put([qC.create({id:kI,name:n.props.defaultName})]),r();if(!n.has(yp))return n.put([KC.create({id:yp})]),r();const i=e.get();if(i.size===0)return n.put(_V()),r();const s=()=>[...i].map(d=>n.get(d)).sort(xV)[0].id,o=n.get(xi);if(o){if(!i.has(o.currentPageId))return n.put([{...o,currentPageId:s()}]),r()}else return n.put([n.schema.types.instance.create({id:xi,currentPageId:s(),exportBackground:!0})]),r();const a=new Set,c=new Set;for(const d of i){const f=Zs.createId(d);n.get(f)||a.add(f);const m=Eo.createId(d);n.has(m)||c.add(m)}a.size>0&&n.put([...a].map(d=>Zs.create({id:d,pageId:Zs.parseId(d)}))),c.size>0&&n.put([...c].map(d=>Eo.create({id:d})));const u=t.get();for(const d of u){if(!i.has(d.pageId)){n.remove([d.id]);continue}if(d.croppingShapeId&&!n.has(d.croppingShapeId))return n.put([{...d,croppingShapeId:null}]),r();if(d.focusedGroupId&&!n.has(d.focusedGroupId))return n.put([{...d,focusedGroupId:null}]),r();if(d.hoveredShapeId&&!n.has(d.hoveredShapeId))return n.put([{...d,hoveredShapeId:null}]),r();const f=d.selectedShapeIds.filter(v=>n.has(v));if(f.length!==d.selectedShapeIds.length)return n.put([{...d,selectedShapeIds:f}]),r();const g=d.hintingShapeIds.filter(v=>n.has(v));if(g.length!==d.hintingShapeIds.length)return n.put([{...d,hintingShapeIds:g}]),r();const m=d.erasingShapeIds.filter(v=>n.has(v));if(m.length!==d.erasingShapeIds.length)return n.put([{...d,erasingShapeIds:m}]),r()}};return r}const EV=HC("bookmark",Lt({title:xt,description:xt,image:xt,favicon:xt,src:bu.nullable()})),y3=ps("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),CV=Os({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:y3.MakeUrlsValid,up:n=>{bu.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:y3.AddFavicon,up:n=>{bu.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),PV=HC("image",Lt({w:mt,h:mt,name:xt,isAnimated:Dt,mimeType:xt.nullable(),src:bu.nullable(),fileSize:vr.optional()})),bf=ps("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),MV=Os({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:bf.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:bf.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:bf.MakeUrlsValid,up:n=>{bu.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:bf.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:bf.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),TV=HC("video",Lt({w:mt,h:mt,name:xt,isAnimated:Dt,mimeType:xt.nullable(),src:bu.nullable(),fileSize:mt.optional()})),_f=ps("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),kV=Os({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:_f.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:_f.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:_f.MakeUrlsValid,up:n=>{bu.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:_f.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:_f.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),AV=_a("asset",zC("type",{image:PV,video:TV,bookmark:EV})),RV=ps("com.tldraw.asset",{AddMeta:1}),jV=Os({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:RV.AddMeta,up:n=>{n.meta={}}}]}),tl=ba("asset",{validator:AV,scope:"document"}).withDefaultProperties(()=>({meta:{}})),tN={w:vr,h:vr,assetId:nw.nullable(),url:js},w3=Bo("bookmark",{NullAssetId:1,MakeUrlsValid:2}),nN={sequence:[{id:w3.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:w3.MakeUrlsValid,up:n=>{js.isValid(n.url)||(n.url="")},down:n=>{}}]},rN=Lt({type:tw("free","straight"),points:Xr(_u)}),iN={color:hs,fill:Eu,dash:Iu,size:Ro,segments:Xr(rN),isComplete:Dt,isClosed:Dt,isPen:Dt,scale:vr},v3=Bo("draw",{AddInPen:1,AddScale:2}),sN={sequence:[{id:v3.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:v3.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},DV=/(^\/r\/[^/]+\/?$)/,OV=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(DV))return n}},{hostnames:["figma.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:n=>{const e=yt(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:n=>{const e=yt(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:n=>{const e=yt(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:n=>{const e=yt(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{hostnames:["replit.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hash.match(/#room=/))return n}},{hostnames:["observablehq.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],oN={w:vr,h:vr,url:xt},ym=Bo("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),aN={sequence:[{id:ym.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let r;for(const i of OV)if(i.hostnames.includes(t))try{r=i.fromEmbedUrl(e)}catch(s){console.warn(s)}n.tmpOldUrl=n.url,n.url=r??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:ym.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:ym.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:ym.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},cN={w:vr,h:vr,name:xt},lN={sequence:[]},l0=ni.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),u0=ni.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Co=ni.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),uN={geo:Co,labelColor:WC,color:hs,fill:Eu,dash:Iu,size:Ro,font:pa,align:l0,verticalAlign:u0,url:js,w:vr,h:vr,growY:i0,text:xt,scale:vr},Ua=Bo("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),dN={sequence:[{id:Ua.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Ua.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:Ua.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Ua.AddCheckBox,up:n=>{},down:"retired"},{id:Ua.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Ua.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:Ua.AddCloud,up:n=>{},down:"retired"},{id:Ua.MakeUrlsValid,up:n=>{js.isValid(n.url)||(n.url="")},down:n=>{}},{id:Ua.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},hN={},fN={sequence:[]},pN={color:hs,size:Ro,segments:Xr(rN),isComplete:Dt,isPen:Dt,scale:vr},LV=Bo("highlight",{AddScale:1}),gN={sequence:[{id:LV.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},NV=Lt({topLeft:_u,bottomRight:_u}),mN={w:vr,h:vr,playing:Dt,url:js,assetId:nw.nullable(),crop:NV.nullable(),flipX:Dt,flipY:Dt},wm=Bo("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),yN={sequence:[{id:wm.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:wm.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:wm.MakeUrlsValid,up:n=>{js.isValid(n.url)||(n.url="")},down:n=>{}},{id:wm.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},d0=ni.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),BV=Lt({id:xt,index:$C,x:mt,y:mt}),wN={color:hs,dash:Iu,size:Ro,spline:d0,points:s0(xt,BV),scale:vr},If=Bo("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),vN={sequence:[{id:If.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:If.RemoveExtraHandleProps,up:n=>{n.handles=gC(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,r])=>({index:t,...r})).sort(_i);n.handles=Object.fromEntries(e.map((t,r)=>{const i=r===0?"start":r===e.length-1?"end":`handle:${t.index}`;return[i,{id:i,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:If.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:r,y:i}])=>({x:r,y:i,index:t})).sort(_i);n.points=e.map(({x:t,y:r})=>({x:t,y:r})),delete n.handles},down:n=>{const e=pp(n.points.length);n.handles=Object.fromEntries(n.points.map((t,r)=>[e[r],{x:t.x,y:t.y}])),delete n.points}},{id:If.PointIndexIds,up:n=>{const e=pp(n.points.length);n.points=Object.fromEntries(n.points.map((t,r)=>{const i=e[r];return[i,{id:i,index:i,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(_i);n.points=e.map(({x:t,y:r})=>({x:t,y:r}))}},{id:If.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},SN={color:hs,labelColor:WC,size:Ro,font:pa,fontSizeAdjustment:i0,align:l0,verticalAlign:u0,growY:i0,url:js,text:xt,scale:vr},$c=Bo("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),xN={sequence:[{id:$c.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:$c.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:$c.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:$c.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:$c.MakeUrlsValid,up:n=>{js.isValid(n.url)||(n.url="")},down:n=>{}},{id:$c.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:$c.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}},{id:$c.AddLabelColor,up:n=>{n.labelColor="black"},down:n=>{delete n.labelColor}}]},AI=ni.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),bN={color:hs,size:Ro,font:pa,textAlign:AI,w:vr,text:xt,scale:vr,autoSize:Dt},S3=Bo("text",{RemoveJustify:1,AddTextAlign:2}),_N={sequence:[{id:S3.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:S3.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},IN={w:vr,h:vr,time:mt,playing:Dt,url:js,assetId:nw.nullable()},x3=Bo("video",{AddUrlProp:1,MakeUrlsValid:2}),EN={sequence:[{id:x3.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:x3.MakeUrlsValid,up:n=>{js.isValid(n.url)||(n.url="")},down:n=>{}}]},vm=ps("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),FV=Qd({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:vm.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of Jr(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:vm.AddInstancePresenceType,scope:"store",up(n){}},{id:vm.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of Jr(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:vm.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of Jr(n))t.typeName.match("user_document")&&delete n[e]}}]}),zV={arrow:{migrations:YL,props:VL},bookmark:{migrations:nN,props:tN},draw:{migrations:sN,props:iN},embed:{migrations:aN,props:oN},frame:{migrations:lN,props:cN},geo:{migrations:dN,props:uN},group:{migrations:fN,props:hN},highlight:{migrations:gN,props:pN},image:{migrations:yN,props:mN},line:{migrations:vN,props:wN},note:{migrations:xN,props:SN},text:{migrations:_N,props:bN},video:{migrations:EN,props:IN}},UV={arrow:{migrations:ZL,props:XL}};function $V({shapes:n=zV,bindings:e=UV,migrations:t}={}){const r=new Map;for(const a of Vn(n))for(const c of HL(a.props??{}).keys()){if(r.has(c.id)&&r.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);r.set(c.id,c)}const i=XG(n),s=GG(e),o=lV(r);return BC.create({asset:tl,binding:s,camera:Eo,document:qC,instance:o,instance_page_state:Zs,page:Ds,instance_presence:TI,pointer:KC,shape:i},{migrations:[FV,jV,JG,SV,uV,hV,aV,yV,gV,YG,CV,MV,kV,...p3("shape",n),...p3("binding",e),...t??[]],onValidationFailure:bV,createIntegrityChecker:IV})}const wp=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Catal"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function HV(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return WV(n)}function WV(n){for(const e of n){const t=KV(e);if(t)return t}return"en"}const b3={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function KV(n){const e=wp.find(i=>i.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(i=>i.toLowerCase());if(r){const i=wp.find(s=>s.locale===t);if(i)return i.locale}return t in b3?b3[t]:null}xa("@tldraw/tlschema","3.5.1","esm");var Xx={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var _3;function qV(){return _3||(_3=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(s=i(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var o="";for(var a in s)e.call(s,a)&&s[a]&&(o=i(o,a));return o}function i(s,o){return o?s?s+" "+o:s+o:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(Xx)),Xx.exports}var GV=qV();const rt=fs(GV),CN="3.5.1",I3={major:"2024-09-13T14:36:29.063Z",minor:"2024-11-26T11:43:05.889Z",patch:"2024-11-30T22:04:36.728Z"},VV={error:null};class GC extends P.Component{constructor(){super(...arguments);G(this,"state",VV)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,i;(i=(r=this.props).onError)==null||i.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return p.jsx(r,{error:t})}return this.props.children}}function vp({children:n,fallback:e,...t}){return e===null?n:p.jsx(GC,{fallback:e,...t,children:n})}function VC(n,e){return rw(`${n}_${e}`)}function Mh(n){return rw(`${P.useId()}${n??""}`)}function ko(n){const e=ss(P.useContext(PN));return rw(`${e}_${n}`)}function rw(n){return n.replace(/:/g,"_")}const PN=P.createContext(null);function YV({children:n}){const e=Mh();return p.jsx(PN.Provider,{value:e,children:n})}const YC=P.createContext(null);function me(){const n=Ce.useContext(YC);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function Cl(){return Ce.useContext(YC)}function XC({editor:n,children:e}){return p.jsx(YC.Provider,{value:n,children:p.jsx(YV,{children:e})})}function XV(){return p.jsx("div",{className:"tl-background"})}function Th(n,e,t,r,i,s){P.useLayoutEffect(()=>{const o=n.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),i!==void 0&&(a+=` rotate(${i}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),o.style.transform=a})}const Or={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class T{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,i=Math.sin(e),s=Math.cos(e);return this.x=t*s-r*i,this.y=t*i+r*s,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,i=this.y-e.y,s=Math.sin(t),o=Math.cos(t);return this.x=e.x+(r*o-i*s),this.y=e.y+(r*s+i*o),this}clone(){const{x:e,y:t,z:r}=this;return new T(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=T.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return T.Dpr(this,e)}cpr(e){return T.Cpr(this,e)}len2(){return T.Len2(this)}len(){return T.Len(this)}pry(e){return T.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return T.Uni(this)}tan(e){return T.Tan(this,e)}dist(e){return T.Dist(this,e)}distanceToLineSegment(e,t){return T.DistanceToLineSegment(e,t,this)}slope(e){return T.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return T.Angle(this,e)}toAngle(){return T.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return T.Equals(this,e)}equalsXY(e,t){return T.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return T.ToFixed(this)}toString(){return T.ToString(T.ToFixed(this))}toJson(){return T.ToJson(this)}toArray(){return T.ToArray(this)}static Add(e,t){return new T(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new T(e.x+t,e.y+r)}static Sub(e,t){return new T(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new T(e.x-t,e.y-r)}static AddScalar(e,t){return new T(e.x+t,e.y+t)}static SubScalar(e,t){return new T(e.x-t,e.y-t)}static Div(e,t){return new T(e.x/t,e.y/t)}static Mul(e,t){return new T(e.x*t,e.y*t)}static DivV(e,t){return new T(e.x/t.x,e.y/t.y)}static MulV(e,t){return new T(e.x*t.x,e.y*t.y)}static Neg(e){return new T(-e.x,-e.y)}static Per(e){return new T(e.y,-e.x)}static Abs(e){return new T(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,r){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<r**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new T(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return T.Dpr(e,t)/T.Len(t)}static Uni(e){return T.Div(e,T.Len(e))}static Tan(e,t){return T.Uni(T.Sub(e,t))}static Min(e,t){return new T(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new T(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new T(e,t,r)}static FromArray(e){return new T(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),i=Math.cos(t);return new T(e.x*i-e.y*r,e.x*r+e.y*i)}static RotWith(e,t,r){const i=e.x-t.x,s=e.y-t.y,o=Math.sin(r),a=Math.cos(r);return new T(t.x+(i*a-s*o),t.y+(i*o+s*a))}static NearestPointOnLineThroughPoint(e,t,r){return T.Mul(t,T.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,i=!0){if(T.Equals(e,r)||T.Equals(t,r))return T.From(r);const s=T.Tan(t,e),o=T.Add(e,T.Mul(s,T.Sub(r,e).pry(s)));if(i){if(o.x<Math.min(e.x,t.x))return T.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return T.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return T.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return T.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,r){return T.Dist(r,T.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,i=!0){return T.Dist(r,T.NearestPointOnLineSegment(e,t,r,i))}static Snap(e,t=1){return new T(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof T?e:T.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return T.Sub(t,e).mul(r).add(e)}static Med(e,t){return new T((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=T.Len(e);return new T(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return T.Sub(e,r).mul(t).add(r)}static ToFixed(e){return new T(Ya(e.x),Ya(e.y))}static ToInt(e){return new T(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,r){return T.Add(e,T.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new T(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:i}=e;return{x:t,y:r,z:i}}static Average(e){const t=e.length,r=new T(0,0);if(t===0)return r;for(let i=0;i<t;i++)r.add(e[i]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new T(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new T(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const i=[];for(let s=0;s<r;s++){const o=Or.easeInQuad(s/(r-1)),a=T.Lrp(e,t,o);a.z=Math.min(1,.5+Math.abs(.5-ZV(o))*.65),i.push(a)}return i}static SnapToGrid(e,t=8){return new T(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const ZV=n=>n<.5?2*n*n:-1+(4-2*n)*n;function Qt(n){return`${ge(n.x)},${ge(n.y)} `}function os(n,e){return`${ge((n.x+e.x)/2)},${ge((n.y+e.y)/2)} `}const en=Math.PI,jn=en/2,un=en*2,QV=Math.sin;function Wr(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function Sm(n,e=1e10){return n?Math.round(n*e)/e:0}function dl(n,e,t=1e-6){return Math.abs(n-e)<=t}function MN(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return en*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function vu(n){return n=n%un,n<0?n=n+un:n===0&&(n=0),n}function Wp(n,e){return n=vu(n),e=vu(e),n>e&&(e+=un),e-n}function TN(n,e){return un-Wp(n,e)}function ly(n,e){const t=(e-n)%un;return 2*t%un-t}function RI(n){return(un+n)%un}function h0(n,e){const t=un/e;let r=Math.floor((RI(n)+t/2)/t)*t%un;return r<en&&(r+=un),r>en&&(r-=un),r}function kN(n,e){return n===e||dl(n%(Math.PI/2)-e%(Math.PI/2),0)}function JV(n){return n*en/180}function eY(n){return n*180/en}function Cu(n,e,t){return new T(n.x,n.y).add(T.FromAngle(t,e))}function Zx(n,e,t){const r=n/2,i=e/2,s=[];let o=1/0,a=-1/0,c=1/0,u=-1/0;for(let v=0;v<t;v++){const w=un/t,S=-jn+v*w,b=r+r*Math.cos(S),x=i+i*Math.sin(S);b<o&&(o=b),x<c&&(c=x),b>a&&(a=b),x>u&&(u=x),s.push(new T(b,x))}const d=a-o,f=u-c,g=n-d,m=e-f;if(g!==0||m!==0)for(let v=0;v<s.length;v++){const w=s[v];w.x=(w.x-o)/d*n,w.y=(w.y-c)/f*e}return s}function Ef(n,e,t,r){return n<r&&t<e}function So(n,e,t,r){const i=Math.max(n,t),s=Math.min(e,r);return i<=s?[i,s]:null}function E3(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function As(n,e){let t=0,r,i;for(let s=0;s<e.length;s++){if(r=e[s],r.x===n.x&&r.y===n.y||(i=e[(s+1)%e.length],T.Dist(n,r)+T.Dist(n,i)===T.Dist(r,i)))return!0;r.y<=n.y?i.y>n.y&&E3(r,i,n)>0&&(t+=1):i.y<=n.y&&E3(r,i,n)<0&&(t-=1)}return t!==0}function ge(n){return Math.round(n*1e4)/1e4}function Ya(n){return Math.round(n*100)/100}const C3=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function nl(n,e,t){return t<0?Wp(n,e):TN(n,e)}function jI(n,e,t,r){let i;if(Math.abs(n)>en){i=ly(e,r);const s=ly(r,t);return Math.abs(i)<Math.abs(s)?i/n:(n-s)/n}else{i=ly(e,r);const s=i/n;return Math.sign(i)!==Math.sign(n)?Math.abs(s)>.5?1:0:s}}function tY(n,e,t,r){const i=2*((e-n)%un)%un-(e-n)%un;return r?(un-Math.abs(i))*(t?1:-1):i}function ZC(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),i=((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,s=((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r;return!Number.isFinite(i)||!Number.isFinite(s)?null:new T(i,s)}function nY(n,e,t,r,i){if(t===null)return[T.From(n),T.From(e)];const s=[],o=T.Angle(t,n),a=T.Angle(t,e),c=Wp(o,a);for(let u=0;u<i;u++){const d=u/(i-1),f=o+c*d,g=Cu(t,r,f);s.push(g)}return s}const Qx=({brush:n,color:e,opacity:t,className:r})=>{const i=P.useRef(null);Th(i,n.x,n.y);const s=ge(Math.max(1,n.w)),o=ge(Math.max(1,n.h));return p.jsx("svg",{className:"tl-overlays__item",ref:i,children:e?p.jsxs("g",{className:"tl-brush",opacity:t,children:[p.jsx("rect",{width:s,height:o,fill:e,opacity:.75}),p.jsx("rect",{width:s,height:o,fill:"none",stroke:e,opacity:.1})]}):p.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:o})})},_n={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(_n.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),_n.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),_n.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),_n.isFirefox=/firefox/i.test(navigator.userAgent),_n.isAndroid=/android/i.test(navigator.userAgent),_n.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const P3={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},Jx={duration:0,easing:Or.easeInOutCubic},M3={CAMERA_MOVE:-10},rY=["top","right","bottom","left"],T3=0,QC=2,xm=1,k3=5,iY=128;var eb={};const sY={},AN=Ji("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),mr={logPreventDefaults:Ji("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Ji("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Ji("logElementRemoves",{defaults:{all:!1}}),debugSvg:Ji("debugSvg",{defaults:{all:!1}}),showFps:Ji("showFps",{defaults:{all:!1}}),measurePerformance:Ji("measurePerformance",{defaults:{all:!1}}),throwToBlob:Ji("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Ji("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Ji("debugCursors",{defaults:{all:!1}}),forceSrgb:Ji("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Ji("debugGeometry",{defaults:{all:!1}}),hideShapes:Ji("hideShapes",{defaults:{all:!1}}),editOnType:Ji("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;To("element removal logging",()=>{mr.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Ji(n,{defaults:e,shouldStoreForSession:t=!0}){return oY({name:n,defaults:e,shouldStoreForSession:t})}function oY(n){const e=cY(n),t=n.shouldStoreForSession?aY(n.name):null,r=cr(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&To(`debug:${n.name}`,()=>{const i=r.get();i===e?Z4(`tldraw_debug:${n.name}`):bC(`tldraw_debug:${n.name}`,JSON.stringify(i))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,i=>i.toUpperCase())}`,{get(){return r.get()},set(i){r.set(i)},configurable:!0})),Object.assign(r,n)}function aY(n){try{return JSON.parse(X4(`tldraw_debug:${n}`)??"null")}catch{return null}}function tb(n){try{return n()}catch{return null}}function cY(n){switch(tb(()=>eb.TLDRAW_ENV)??tb(()=>eb.VERCEL_PUBLIC_TLDRAW_ENV)??tb(()=>eb.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function f0(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return f0(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function kt(n){n.preventDefault(),mr.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Kp(n,e){if(n.setPointerCapture(e.pointerId),mr.logPointerCaptures.get()){const t=AN.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function qp(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),mr.logPointerCaptures.get())){const t=AN.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const Sr=n=>n.stopPropagation(),yi=(n,e,t)=>{n&&n.style.setProperty(e,t)},Ii=n=>_n.isDarwin?n.metaKey:n.ctrlKey||n.metaKey;function Ms(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,metaKey:n.metaKey,accelKey:Ii(n),pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function JC(){const n=me();return P.useMemo(function(){let r,i;function s(w){if(!w.isKilled){if(w.button===QC){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Ms(w)});return}w.button!==0&&w.button!==1&&w.button!==5||(Kp(w.currentTarget,w),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Ms(w)}))}}function o(w){w.isKilled||w.clientX===r&&w.clientY===i||(r=w.clientX,i=w.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Ms(w)}))}function a(w){w.isKilled||w.button!==0&&w.button!==1&&w.button!==2&&w.button!==5||(r=w.clientX,i=w.clientY,qp(w.currentTarget,w),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Ms(w)}))}function c(w){if(w.isKilled||n.getInstanceState().isPenMode&&w.pointerType!=="pen")return;const S=w.pointerType==="mouse"||w.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:S?!0:null})}function u(w){if(w.isKilled||n.getInstanceState().isPenMode&&w.pointerType!=="pen")return;const S=w.pointerType==="mouse"||w.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:S?!1:null})}function d(w){w.isKilled=!0,kt(w)}function f(w){w.isKilled=!0,w.target instanceof HTMLElement&&w.target.tagName!=="A"&&w.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&w.target.className.includes("tl-text-content"))&&kt(w)}function g(w){kt(w)}async function m(w){var b,x;if(kt(w),Sr(w),!((x=(b=w.dataTransfer)==null?void 0:b.files)!=null&&x.length))return;const S=Array.from(w.dataTransfer.files);await n.putExternalContent({type:"files",files:S,point:n.screenToPage({x:w.clientX,y:w.clientY}),ignoreParent:!1})}function v(w){Sr(w)}return{onPointerDown:s,onPointerMove:o,onPointerUp:a,onPointerEnter:c,onPointerLeave:u,onDragOver:g,onDrop:m,onTouchStart:d,onTouchEnd:f,onClick:v}},[n])}function lY(){const n=me();P.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),i=_n.isFirefox&&!_n.isAndroid&&!_n.isIos,s=()=>{const o=i?!1:r.matches;e===o&&(e=o,n.updateInstanceState({isCoarsePointer:o}))};return r&&(r.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),r&&r.removeEventListener("change",s)}},[n])}const RN=P.createContext(null);function jN({container:n,children:e}){return p.jsx(RN.Provider,{value:n,children:e})}function Mr(){return ss(P.useContext(RN),"useContainer used outside of <Tldraw />")}function uY(){const n=me(),e=Mr(),t=xe("isFocused",()=>n.getIsFocused(),[n]);P.useEffect(()=>{if(!e)return;function r(i){if(i.isSpecialRedispatchedEvent)return;kt(i),Sr(i);const s=e.querySelector(".tl-canvas");if(!s)return;const o=new DragEvent(i.type,i);o.isSpecialRedispatchedEvent=!0,s.dispatchEvent(o)}return e.addEventListener("dragover",r),e.addEventListener("drop",r),()=>{e.removeEventListener("dragover",r),e.removeEventListener("drop",r)}},[e]),P.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const i=()=>{r!=null&&r();const s=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(s),a=c=>{c.type==="change"&&i()};o.addEventListener?o.addEventListener("change",i):o.addListener&&o.addListener(a),r=()=>{o.removeEventListener?o.removeEventListener("change",i):o.removeListener&&o.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return i(),()=>{r==null||r()}},[n]),P.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!bm(n)&&kt(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){kt(a);return}break}case"Tab":{if(bm(n))return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&kt(a),n.menus.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(bm(n))return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Ii(a)};n.dispatch(c)},i=a=>{if(a.isKilled||(a.isKilled=!0,bm(n))||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Ii(a)};n.dispatch(c)};function s(a){var c,u;if(e.contains(a.target)){const d=a.touches[0].pageX,f=a.touches[0].radiusX||0;(d-f<10||d+f>n.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((u=a.target)==null||u.click()),kt(a))}}const o=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&kt(a)};return e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",kt),document.addEventListener("gesturechange",kt),document.addEventListener("gestureend",kt),e.addEventListener("keydown",r),e.addEventListener("keyup",i),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",kt),document.removeEventListener("gesturechange",kt),document.removeEventListener("gestureend",kt),e.removeEventListener("keydown",r),e.removeEventListener("keyup",i)}},[n,e,t])}const dY=["input","select","button","textarea"];function bm(n){const{activeElement:e}=document;return n.menus.hasOpenMenus()||e&&(e.getAttribute("contenteditable")||dY.indexOf(e.tagName.toLowerCase())>-1)}const hY=["textarea","input"];function fY(n){const e=me();P.useEffect(()=>{const t=n.current;if(!t)return;const r=i=>{var s;if(i instanceof PointerEvent&&i.pointerType==="pen"){i.isKilled=!0;const{target:o}=i;if(hY.includes((s=o.tagName)==null?void 0:s.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;kt(i)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function pY(n,e,t){return Math.max(e,Math.min(n,t))}const Qr={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function A3(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function R3(n,e,t,r=.15){return r===0?pY(n,e,t):n<e?-A3(e-n,t-e,r)+e:n>t?+A3(n-t,t-e,r)+t:n}function gY(n,[e,t],[r,i]){const[[s,o],[a,c]]=n;return[R3(e,s,o,r),R3(t,a,c,i)]}function mY(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function yY(n){var e=mY(n,"string");return typeof e=="symbol"?e:String(e)}function vi(n,e,t){return e=yY(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function j3(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function tr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?j3(Object(t),!0).forEach(function(r){vi(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):j3(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const DN={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function D3(n){return n?n[0].toUpperCase()+n.slice(1):""}const wY=["enter","leave"];function vY(n=!1,e){return n&&!wY.includes(e)}function SY(n,e="",t=!1){const r=DN[n],i=r&&r[e]||e;return"on"+D3(n)+D3(i)+(vY(t,i)?"Capture":"")}const xY=["gotpointercapture","lostpointercapture"];function bY(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=xY.includes(e)?"capturecapture":"capture",i=!!~e.indexOf(r);return i&&(e=e.replace("capture","")),{device:e,capture:i,passive:t}}function _Y(n,e=""){const t=DN[n],r=t&&t[e]||e;return n+r}function ON(n){return"touches"in n}function IY(n){return ON(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function EY(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function DI(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,i=(e.clientX+n.clientX)/2,s=(e.clientY+n.clientY)/2,o=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:o,origin:[i,s]}}catch{}return null}function CY(n){return EY(n).map(e=>e.identifier)}function O3(n,e){const[t,r]=Array.from(n.touches).filter(i=>e.includes(i.identifier));return DI(t,r)}const L3=40,N3=800;function LN(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=L3,t*=L3):r===2&&(e*=N3,t*=N3),[e,t]}function PY(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:i,ctrlKey:s})}return e}function p0(n,...e){return typeof n=="function"?n(...e):n}function MY(){}function TY(...n){return n.length===0?MY:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function B3(n,e){return Object.assign({},e,n||{})}const kY=32;class NN{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?p0(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:i}=this;t.args=this.args;let s=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,PY(e)),i.down=i.pressed=i.buttons%2===1||i.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const D=t._delta.map(Math.abs);Qr.addTo(t._distance,D)}this.axisIntent&&this.axisIntent(e);const[o,a]=t._movement,[c,u]=r.threshold,{_step:d,values:f}=t;if(r.hasCustomTransform?(d[0]===!1&&(d[0]=Math.abs(o)>=c&&f[0]),d[1]===!1&&(d[1]=Math.abs(a)>=u&&f[1])):(d[0]===!1&&(d[0]=Math.abs(o)>=c&&Math.sign(o)*c),d[1]===!1&&(d[1]=Math.abs(a)>=u&&Math.sign(a)*u)),t.intentional=d[0]!==!1||d[1]!==!1,!t.intentional)return;const g=[0,0];if(r.hasCustomTransform){const[D,H]=f;g[0]=d[0]!==!1?D-d[0]:0,g[1]=d[1]!==!1?H-d[1]:0}else g[0]=d[0]!==!1?o-d[0]:0,g[1]=d[1]!==!1?a-d[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(g);const m=t.offset,v=t._active&&!t._blocked||t.active;v&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=p0(r.bounds,t)),this.setup&&this.setup()),t.movement=g,this.computeOffset()));const[w,S]=t.offset,[[b,x],[E,M]]=t._bounds;t.overflow=[w<b?-1:w>x?1:0,S<E?-1:S>M?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const j=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=gY(t._bounds,t.offset,j),t.delta=Qr.sub(t.offset,m),this.computeMovement(),v&&(!t.last||s>kY)){t.delta=Qr.sub(t.offset,m);const D=t.delta.map(Math.abs);Qr.addTo(t.distance,D),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[D[0]/s,D[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const i=this.handler(tr(tr(tr({},t),e),{},{[this.aliasKey]:e.values}));i!==void 0&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function AY([n,e],t){const r=Math.abs(n),i=Math.abs(e);if(r>i&&r>t)return"x";if(i>r&&i>t)return"y"}class RY extends NN{constructor(...e){super(...e),vi(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=Qr.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=Qr.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const i=typeof r.axisThreshold=="object"?r.axisThreshold[IY(e)]:r.axisThreshold;t.axis=AY(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const jY=n=>n,F3=.15,BN={enabled(n=!0){return n},eventOptions(n,e,t){return tr(tr({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[F3,F3];case!1:return[0,0];default:return Qr.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return Qr.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||jY},threshold(n){return Qr.toVector(n,0)}},DY=0,Gp=tr(tr({},BN),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=DY){return n},bounds(n={}){if(typeof n=="function")return s=>Gp.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:i=1/0}=n;return[[e,t],[r,i]]}}),Vp=typeof window<"u"&&window.document&&window.document.createElement;function FN(){return Vp&&"ontouchstart"in window}function OY(){return FN()||Vp&&window.navigator.maxTouchPoints>1}function LY(){return Vp&&"onpointerdown"in window}function NY(){return Vp&&"exitPointerLock"in window.document}function BY(){try{return"constructor"in GestureEvent}catch{return!1}}const Ys={isBrowser:Vp,gesture:BY(),touch:FN(),touchscreen:OY(),pointer:LY(),pointerLock:NY()},FY=250,zY=180,UY=.5,$Y=50,HY=250,WY=10,z3={mouse:0,touch:0,pen:8};tr(tr({},Gp),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:i=!1}={}}){return this.pointerLock=r&&Ys.pointerLock,Ys.touch&&t?"touch":this.pointerLock?"mouse":Ys.pointer&&!i?"pointer":Ys.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?FY:void 0,!(!Ys.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:i=void 0}){const s=Qr.toVector(n,t?r:i?1:0);return this.filterTaps=t,this.tapsThreshold=r,s},swipe({velocity:n=UY,distance:e=$Y,duration:t=HY}={}){return{velocity:this.transform(Qr.toVector(n)),distance:this.transform(Qr.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return zY;case!1:return 0;default:return n}},axisThreshold(n){return n?tr(tr({},z3),n):z3},keyboardDisplacement(n=WY){return n}});function zN(n){const[e,t]=n.overflow,[r,i]=n._delta,[s,o]=n._direction;(e<0&&r>0&&s<0||e>0&&r<0&&s>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&i>0&&o<0||t>0&&i<0&&o>0)&&(n._movement[1]=n._movementBound[1])}const KY=30,qY=100;class GY extends NN{constructor(...e){super(...e),vi(this,"ingKey","pinching"),vi(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=Qr.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const i=Math.abs(t)*KY-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const i=O3(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(o=>i.has(o))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=DI(...Array.from(r.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=O3(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=DI(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,i=r._values[1],s=t.angle-i;let o=0;Math.abs(s)>270&&(o+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*o]),r.origin=t.origin,r.turns=o,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=Qr.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(r=>e[r]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-LN(e)[1]/qY*r.offset[0],0],Qr.addTo(r._movement,r._delta),zN(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const VY=tr(tr({},BN),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Ys.touch&&Ys.gesture)return"gesture";if(Ys.touch&&r)return"touch";if(Ys.touchscreen){if(Ys.pointer)return"pointer";if(Ys.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const i=o=>{const a=B3(p0(t,o),{min:-1/0,max:1/0});return[a.min,a.max]},s=o=>{const a=B3(p0(r,o),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[i(),s()]:o=>[i(o),s(o)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",Qr.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});tr(tr({},Gp),{},{mouseOnly:(n=!0)=>n});class YY extends RY{constructor(...e){super(...e),vi(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=LN(e),Qr.addTo(t._movement,t._delta),zN(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const XY=Gp;tr(tr({},Gp),{},{mouseOnly:(n=!0)=>n});const e2=new Map,OI=new Map;function ZY(n){e2.set(n.key,n.engine),OI.set(n.key,n.resolver)}const QY={key:"pinch",engine:GY,resolver:VY},JY={key:"wheel",engine:YY,resolver:XY};function eX(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function tX(n,e){if(n==null)return{};var t=eX(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const nX={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Ys.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},rX=["target","eventOptions","window","enabled","transform"];function uy(n={},e){const t={};for(const[r,i]of Object.entries(e))switch(typeof i){case"function":t[r]=i.call(t,n[r],r,n);break;case"object":t[r]=uy(n[r],i);break;case"boolean":i&&(t[r]=n[r]);break}return t}function iX(n,e,t={}){const r=n,{target:i,eventOptions:s,window:o,enabled:a,transform:c}=r,u=tX(r,rX);if(t.shared=uy({target:i,eventOptions:s,window:o,enabled:a,transform:c},nX),e){const d=OI.get(e);t[e]=uy(tr({shared:t.shared},u),d)}else for(const d in u){const f=OI.get(d);f&&(t[d]=uy(tr({shared:t.shared},u[d]),f))}return t}class UN{constructor(e,t){vi(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,s){const o=this._listeners,a=_Y(t,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=tr(tr({},c),s);e.addEventListener(a,i,u);const d=()=>{e.removeEventListener(a,i,u),o.delete(d)};return o.add(d),d}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class sX{constructor(){vi(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class oX{constructor(e){vi(this,"gestures",new Set),vi(this,"_targetEventStore",new UN(this)),vi(this,"gestureEventStores",{}),vi(this,"gestureTimeoutStores",{}),vi(this,"handlers",{}),vi(this,"config",{}),vi(this,"pointerIds",new Set),vi(this,"touchIds",new Set),vi(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),aX(this,e)}setEventIds(e){if(ON(e))return this.touchIds=new Set(CY(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=iX(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let i;if(!(t.target&&(i=t.target(),!i))){if(t.enabled){for(const o of this.gestures){const a=this.config[o],c=U3(r,a.eventOptions,!!i);if(a.enabled){const u=e2.get(o);new u(this,e,o).bind(c)}}const s=U3(r,t.eventOptions,!!i);for(const o in this.nativeHandlers)s(o,"",a=>this.nativeHandlers[o](tr(tr({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=TY(...r[s]);if(!i)return r;for(const s in r){const{device:o,capture:a,passive:c}=bY(s);this._targetEventStore.add(i,o,"",r[s],{capture:a,passive:c})}}}}function Id(n,e){n.gestures.add(e),n.gestureEventStores[e]=new UN(n,e),n.gestureTimeoutStores[e]=new sX}function aX(n,e){e.drag&&Id(n,"drag"),e.wheel&&Id(n,"wheel"),e.scroll&&Id(n,"scroll"),e.move&&Id(n,"move"),e.pinch&&Id(n,"pinch"),e.hover&&Id(n,"hover")}const U3=(n,e,t)=>(r,i,s,o={},a=!1)=>{var c,u;const d=(c=o.capture)!==null&&c!==void 0?c:e.capture,f=(u=o.passive)!==null&&u!==void 0?u:e.passive;let g=a?r:SY(r,i,d);t&&f&&(g+="Passive"),n[g]=n[g]||[],n[g].push(s)},cX=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function lX(n){const e={},t={},r=new Set;for(let i in n)cX.test(i)?(r.add(RegExp.lastMatch),t[i]=n[i]):e[i]=n[i];return[t,e,r]}function Ed(n,e,t,r,i,s){if(!n.has(t)||!e2.has(r))return;const o=t+"Start",a=t+"End",c=u=>{let d;return u.first&&o in e&&e[o](u),t in e&&(d=e[t](u)),u.last&&a in e&&e[a](u),d};i[r]=c,s[r]=s[r]||{}}function uX(n,e){const[t,r,i]=lX(n),s={};return Ed(i,t,"onDrag","drag",s,e),Ed(i,t,"onWheel","wheel",s,e),Ed(i,t,"onScroll","scroll",s,e),Ed(i,t,"onPinch","pinch",s,e),Ed(i,t,"onMove","move",s,e),Ed(i,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:r}}function dX(n,e={},t,r){const i=Ce.useMemo(()=>new oX(n),[]);if(i.applyHandlers(n,r),i.applyConfig(e,t),Ce.useEffect(i.effect.bind(i)),Ce.useEffect(()=>i.clean.bind(i),[]),e.target===void 0)return i.bind.bind(i)}function hX(n){return n.forEach(ZY),function(t,r){const{handlers:i,nativeHandlers:s,config:o}=uX(t,r||{});return dX(i,o,void 0,s)}}const $3=10,fX=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function $N(n){let{deltaY:e,deltaX:t}=n,r=0;return n.ctrlKey||n.altKey||n.metaKey?r=(Math.abs(e)>$3?$3*Math.sign(e):e)/100:n.shiftKey&&!fX&&(t=e,e=0),{x:-t,y:-e,z:-r}}const pX=hX([JY,QY]);let Cd;const gX=n=>Cd===void 0?(Cd=n,!1):n-Cd>120&&n-Cd<160?(Cd=n,!0):(Cd=n,!1);function mX(n){const e=me(),t=P.useMemo(()=>{let r="not sure";const i=({event:w})=>{if(!e.getInstanceState().isFocused||(r="not sure",gX(Date.now())))return;const S=e.getEditingShapeId();if(S){const E=e.getShape(S);if(E&&e.getShapeUtil(E).canScroll(E)){const j=e.getShapePageBounds(S);if(j!=null&&j.containsPoint(e.inputs.currentPagePoint))return}}kt(w),Sr(w);const b=$N(w);if(b.x===0&&b.y===0)return;const x={type:"wheel",name:"wheel",delta:b,point:new T(w.clientX,w.clientY),shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey,metaKey:w.metaKey,accelKey:Ii(w)};e.dispatch(x)};let s=1,o=1,a=1,c=0;const u=new T,d=new T,f=w=>{const S=n.current;r="not sure";const{event:b,origin:x,da:E}=w;b instanceof WheelEvent||(b.target===S||S!=null&&S.contains(b.target))&&(d.x=x[0],d.y=x[1],u.x=x[0],u.y=x[1],s=E[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:x[0],y:x[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Ii(b)}))},g=w=>{if(w&&(r="zooming"),r==="zooming")return;const S=Math.abs(c-s),b=T.Dist(u,d);switch(r){case"not sure":{S>24?r="zooming":b>16&&(r="panning");break}case"panning":{S>64&&(r="zooming");break}}};return{onWheel:i,onPinchStart:f,onPinchEnd:w=>{const S=n.current,{event:b,origin:x,offset:E}=w;if(b instanceof WheelEvent||!(b.target===S||S!=null&&S.contains(b.target)))return;const M=E[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:x[0],y:x[1],z:M},delta:{x:x[0],y:x[1]},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Ii(b)})})},onPinch:w=>{const S=n.current,{event:b,origin:x,offset:E,da:M}=w;if(b instanceof WheelEvent||!(b.target===S||S!=null&&S.contains(b.target)))return;const j=w.type==="gesturechange"||w.type==="gestureend";c=M[0];const D=x[0]-d.x,H=x[1]-d.y;switch(d.x=x[0],d.y=x[1],g(j),r){case"zooming":{a=E[0],e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:a},delta:{x:D,y:H},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Ii(b)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:o},delta:{x:D,y:H},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Ii(b)});break}}}}},[e,n]);pX(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const r=e.getBaseZoom(),i=e.getCameraOptions().zoomSteps,s=i[0]*r,o=i[i.length-1]*r;return{from:e.getZoomLevel(),max:o,min:s}}}})}function nb(n,e,t){const r=n.getShape(e),i=n.getShapeHandles(r);return{shape:r,handle:i.find(s=>s.id===t)}}function yX(n,e){const t=me();return P.useMemo(()=>{const r=c=>{if(c.isKilled)return;const u=f0(c.currentTarget);Kp(u,c);const{shape:d,handle:f}=nb(t,n,e);f&&t.dispatch({type:"pointer",target:"handle",handle:f,shape:d,name:"pointer_down",...Ms(c)})};let i,s;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===i&&c.clientY===s)return;i=c.clientX,s=c.clientY;const{shape:u,handle:d}=nb(t,n,e);d&&t.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_move",...Ms(c)})},onPointerUp:c=>{if(c.isKilled)return;const u=f0(c.currentTarget);qp(u,c);const{shape:d,handle:f}=nb(t,n,e);f&&t.dispatch({type:"pointer",target:"handle",handle:f,shape:d,name:"pointer_up",...Ms(c)})}}},[t,n,e])}function wX(n){const e=me();P.useLayoutEffect(()=>{const t=R4(()=>{n.current&&e.updateViewportScreenBounds(n.current)},200,{trailing:!0}),r=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const i=new ResizeObserver(a=>{a[0].contentRect&&t()}),s=n.current;let o=null;return s&&(i.observe(s),o=vX(s),o.addEventListener("scroll",t)),()=>{clearInterval(r),window.removeEventListener("resize",t),i.disconnect(),o==null||o.removeEventListener("scroll",t),t.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const vX=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};class De{constructor(e=0,t=0,r=0,i=0){G(this,"x",0);G(this,"y",0);G(this,"w",0);G(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=i}get point(){return new T(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new T(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new T(this.minX,this.minY),new T(this.maxX,this.minY),new T(this.maxX,this.maxY),new T(this.minX,this.maxY)]}get cornersAndCenter(){return[new T(this.minX,this.minY),new T(this.maxX,this.minY),new T(this.maxX,this.maxY),new T(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new T(this.w,this.h)}toFixed(){return this.x=Sm(this.x),this.y=Sm(this.y),this.w=Sm(this.w),this.h=Sm(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,i=0){return this.x=e,this.y=t,this.w=r,this.h=i,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),i=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=i-t,this.h=s-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:i}=this;return new De(e,t,r,i)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,i=Math.round(this.maxX/e)*e,s=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,i-t),this.height=Math.max(1,s-r)}collides(e){return De.Collides(this,e)}contains(e){return De.Contains(this,e)}includes(e){return De.Includes(this,e)}containsPoint(e,t=0){return De.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new T(this.minX,this.minY);case"top_right":return new T(this.maxX,this.minY);case"bottom_left":return new T(this.minX,this.maxY);case"bottom_right":return new T(this.maxX,this.maxY);case"top":return new T(this.midX,this.minY);case"right":return new T(this.maxX,this.midY);case"bottom":return new T(this.midX,this.maxY);case"left":return new T(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:i,minY:s,maxX:o,maxY:a}=this;let{minX:c,minY:u,maxX:d,maxY:f}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=t;break}case"right":case"top_right":case"bottom_right":{d+=t;break}}switch(e){case"top":case"top_left":case"top_right":{u+=r;break}case"bottom":case"bottom_left":case"bottom_right":{f+=r;break}}const g=(d-c)/(o-i),m=(f-u)/(a-s),v=g<0,w=m<0;if(v){const S=d;d=c,c=S}if(w){const S=f;f=u,u=S}this.minX=c,this.minY=u,this.width=Math.abs(d-c),this.height=Math.abs(f-u)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),i=Math.max(this.maxX,e.w+e.x),s=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=i-t,this.height=s-r,this}static From(e){return new De(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new De(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new De;let t=1/0,r=1/0,i=-1/0,s=-1/0,o;for(let a=0,c=e.length;a<c;a++)o=e[a],t=Math.min(o.x,t),r=Math.min(o.y,r),i=Math.max(o.x,i),s=Math.max(o.y,s);return new De(t,r,i-t,s-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),i=Math.min(t.minY,e.minY),s=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new De(r,i,s-r,o-i)}static ExpandBy(e,t){return new De(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return De.Collides(e,t)||De.Contains(e,t)}static ContainsPoint(e,t,r=0){return!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)}static Common(e){let t=1/0,r=1/0,i=-1/0,s=-1/0;for(let o=0;o<e.length;o++){const a=e[o];t=Math.min(t,a.minX),r=Math.min(r,a.minY),i=Math.max(i,a.maxX),s=Math.max(s,a.maxY)}return new De(t,r,i-t,s-r)}static Sides(e,t=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,t,r,i,s=!1){const{minX:o,minY:a,maxX:c,maxY:u}=e;let{minX:d,minY:f,maxX:g,maxY:m}=e;switch(t){case"left":case"top_left":case"bottom_left":{d+=r;break}case"right":case"top_right":case"bottom_right":{g+=r;break}}switch(t){case"top":case"top_left":case"top_right":{f+=i;break}case"bottom":case"bottom_left":case"bottom_right":{m+=i;break}}const v=(g-d)/(c-o),w=(m-f)/(u-a),S=v<0,b=w<0;if(s){const E=(c-o)/(u-a),M=Math.abs(g-d),j=Math.abs(m-f),D=M*(w<0?1:-1)*(1/E),H=j*(v<0?1:-1)*E,L=E<M/j;switch(t){case"top_left":{L?f=m+D:d=g+H;break}case"top_right":{L?f=m+D:g=d-H;break}case"bottom_right":{L?m=f-D:g=d-H;break}case"bottom_left":{L?m=f-D:d=g+H;break}case"bottom":case"top":{const U=(d+g)/2,z=j*E;d=U-z/2,g=U+z/2;break}case"left":case"right":{const U=(f+m)/2,z=M/E;f=U-z/2,m=U+z/2;break}}}if(S){const E=g;g=d,d=E}if(b){const E=m;m=f,f=E}const x=new De(d,f,Math.abs(g-d),Math.abs(m-f));return{box:x,scaleX:+(x.width/e.width*(v>0?1:-1)).toFixed(5),scaleY:+(x.height/e.height*(w>0?1:-1)).toFixed(5)}}equals(e){return De.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new De(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function SX(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function xX(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function bX(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}class Re{constructor(e,t,r,i,s,o){G(this,"a",1);G(this,"b",0);G(this,"c",0);G(this,"d",1);G(this,"e",0);G(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=i,this.e=s,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:i,c:s,d:o,e:a,f:c}=this;return this.a=r*t.a+s*t.b,this.c=r*t.c+s*t.d,this.e=r*t.e+s*t.f+a,this.b=i*t.a+o*t.b,this.d=i*t.c+o*t.d,this.f=i*t.e+o*t.f+c,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(Re.Rotate(e)):this.translate(t,r).multiply(Re.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(Re.Translate(e,t))}scale(e,t){return this.multiply(Re.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:i,e:s,f:o}=this,a=e*i-t*r;return this.a=i/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(i*s-r*o)/-a,this.f=(t*s-e*o)/a,this}applyToPoint(e){return Re.applyToPoint(this,e)}applyToPoints(e){return Re.applyToPoints(this,e)}rotation(){return Re.Rotation(this)}point(){return Re.Point(this)}decomposed(){return Re.Decompose(this)}toCssString(){return Re.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Re.Decompose(this)}clone(){return new Re(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Re(1,0,0,1,0,0)}static Translate(e,t){return new Re(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return Re.Identity();const i=Math.cos(e),s=Math.sin(e),o=new Re(i,s,-s,i,0,0);return t===void 0?o:Re.Compose(Re.Translate(t,r),o,Re.Translate(-t,-r))}static Scale(e,t,r,i){const s=new Re(e,0,0,t,0,0);return r===void 0?s:Re.Compose(Re.Translate(r,i),s,Re.Translate(-r,-i))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=Re.Identity();for(let r=0,i=e.length;r<i;r++)t.multiply(e[r]);return t}static Point(e){return new T(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=jn+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return RI(t)}static Decompose(e){let t,r,i;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=s,r=(e.a*e.d-e.b*e.c)/s,i=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,r=s,i=jn+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,r=0,i=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:RI(i)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${ge(e.a)}, ${ge(e.b)}, ${ge(e.c)}, ${ge(e.d)}, ${ge(e.e)}, ${ge(e.f)})`}static applyToPoint(e,t){return new T(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new T(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new De(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Re(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Re?e:Re.From(e)}}class Pl{constructor(e){G(this,"isFilled",!1);G(this,"isClosed",!0);G(this,"isLabel",!1);G(this,"debugColor");G(this,"ignore");G(this,"_vertices");G(this,"_bounds");G(this,"_area");G(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,r=!1){return this.isClosed&&(this.isFilled||r)&&As(e,this.vertices)?!0:T.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&As(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:r}=this;let i,s=1/0,o,a,c;for(let u=0;u<r.length;u++)a=r[u],c=T.NearestPointOnLineSegment(e,t,a,!0),o=T.Dist2(a,c),o<s&&(s=o,i=c);if(!i)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&As(i,this.vertices)?-s:s}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){const{vertices:r}=this;let i,s=1/0,o,a,c;for(let u=0;u<r.length;u++)a=r[u],c=T.NearestPointOnLineSegment(e,t,a,!0),o=T.Dist2(a,c),o<s&&(s=o,i=c);if(!i)throw Error("nearest point not found");return i}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return De.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,i=e.length;r<i;r++){const s=e[r],o=e[(r+1)%i];t+=s.x*o.y-o.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let i=1;i<r;i++)e+=`L${t[i].x},${t[i].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,r=e[0],i=0;for(let s=1;s<e.length;s++)t=e[s],i+=T.Dist2(r,t),r=t;return Math.sqrt(i)}}class to extends Pl{constructor(t){super({...t,isClosed:!0,isFilled:!1});G(this,"children",[]);G(this,"ignoredChildren",[]);for(const r of t.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,i;const{children:s}=this;if(s.length===0)throw Error("no children");let o,a;for(const c of s)o=c.nearestPoint(t),a=T.Dist2(o,t),a<r&&(r=a,i=o);if(!i)throw Error("nearest point not found");return i}distanceToPoint(t,r=!1){return Math.min(...this.children.map((i,s)=>i.distanceToPoint(t,r||s>0)))}hitTestPoint(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(t,r,i))}hitTestLineSegment(t,r,i){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(t,r,i))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const i of this.children)t+=i.toSimpleSvgPath();const r=De.FromPoints(this.vertices).corners;for(let i=0,s=r.length;i<s;i++){const o=r[i],a=r[(i-1+s)%s],c=o.dist(a),u=r[(i+1)%s],d=o.dist(u),f=o.clone().lrp(a,4/c),g=o,m=o.clone().lrp(u,4/d);t+=`M${f.x},${f.y} L${g.x},${g.y} L${m.x},${m.y} `}return t}getLength(){return this.children.reduce((t,r)=>r.isLabel?t:t+r.length,0)}getSvgPathData(){return this.children.map((t,r)=>t.isLabel?"":t.getSvgPathData(r===0)).join(" ")}}function _X(n=!0){const[e,t]=P.useState(0),r=me();P.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const IX=ti(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){const i=me();_X(r);const s=i.getZoomLevel(),o=i.getRenderingShapes(),{inputs:{currentPagePoint:a}}=i;return p.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const u=i.getShape(c.id);if(u.type==="group")return null;const d=i.getShapeGeometry(u),f=i.getShapePageTransform(u),g=i.getPointInShapeSpace(u,a),m=d.nearestPoint(g),v=d.distanceToPoint(g,!0),w=Math.abs(v)*s,S=v<0,{vertices:b}=d;return p.jsxs("g",{transform:f.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&p.jsx("g",{stroke:d.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:p.jsx(HN,{geometry:d})}),t&&b.map((x,E)=>p.jsx("circle",{cx:x.x,cy:x.y,r:2/s,fill:`hsl(${ch(E,[0,b.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${E}`)),r&&w<150&&p.jsx("line",{x1:m.x,y1:m.y,x2:g.x,y2:g.y,opacity:1-w/150,stroke:S?"goldenrod":"dodgerblue",strokeWidth:2/s})]},c.id+"_outline")})})});function HN({geometry:n}){return n instanceof to?p.jsx(p.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>p.jsx(HN,{geometry:e},t))}):p.jsx("path",{d:n.toSimpleSvgPath()})}function WN(n){return uK(n)}function KN(){const n=me(),e=xG("userIds",()=>WN(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,r)=>{var i;return t.join(",")===((i=r.join)==null?void 0:i.call(r,","))}},[n]);return xe(e)}function iw(n){const e=me();return xe(`latestPresence:${n}`,()=>e.getCollaborators().find(r=>r.userId===n),[e,n])??null}const EX=ti(function(){return KN().map(t=>p.jsx(CX,{collaboratorId:t},t))}),CX=ti(function({collaboratorId:e}){const t=me(),r=iw(e),i=MX(t,r);if(!(r&&r.currentPageId===t.getCurrentPageId()))return null;switch(i){case"inactive":{const{followingUserId:s,highlightedUserIds:o}=t.getInstanceState();if(!(s===r.userId||o.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=t.getInstanceState();if(r.followingUserId===t.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return p.jsx(PX,{latestPresence:r})}),PX=ti(function({latestPresence:e}){const t=me(),{CollaboratorBrush:r,CollaboratorScribble:i,CollaboratorCursor:s,CollaboratorHint:o,CollaboratorShapeIndicator:a}=$n(),c=t.getZoomLevel(),u=t.getViewportPageBounds(),{userId:d,chatMessage:f,brush:g,scribbles:m,selectedShapeIds:v,userName:w,cursor:S,color:b}=e,x=!(S.x<u.minX-12/c||S.y<u.minY-16/c||S.x>u.maxX-12/c||S.y>u.maxY-16/c);return p.jsxs(p.Fragment,{children:[g&&r?p.jsx(r,{className:"tl-collaborator__brush",brush:g,color:b,opacity:.1},d+"_brush"):null,x&&s?p.jsx(s,{className:"tl-collaborator__cursor",point:S,color:b,zoom:c,name:w!=="New User"?w:null,chatMessage:f},d+"_cursor"):o?p.jsx(o,{className:"tl-collaborator__cursor-hint",point:S,color:b,zoom:c,viewport:u},d+"_cursor_hint"):null,i&&m.length?p.jsx(p.Fragment,{children:m.map(E=>p.jsx(i,{className:"tl-collaborator__scribble",scribble:E,color:b,zoom:c,opacity:E.color==="laser"?.5:.1},d+"_scribble_"+E.id))}):null,a&&v.filter(E=>!t.isShapeHidden(E)).map(E=>p.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:E,color:b,opacity:.5},d+"_"+E))]})});function H3(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function MX(n,e){const t=P.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,i]=P.useState(()=>H3(n,Date.now()-t.current));return P.useEffect(()=>{const s=n.timers.setInterval(()=>{i(H3(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[n]),e&&(t.current=e.lastActivityTimestamp),r}function TX(){const n=me(),e=xe("is menu open",()=>n.menus.hasAnyOpenMenus(),[n]),[t,r]=P.useState(!1),i=e||t,s=JC(),o=P.useRef({isDown:!1,isDragging:!1,start:new T}),a=P.useCallback(d=>{d.button===0&&(r(!0),o.current={isDown:!0,isDragging:!1,start:new T(d.clientX,d.clientY)}),n.menus.clearOpenMenus()},[n]),c=P.useCallback(d=>{var f,g,m;if(o.current.isDown){if(o.current.isDragging){(f=s.onPointerMove)==null||f.call(s,d);return}if(T.Dist2(o.current.start,new T(d.clientX,d.clientY))>n.options.dragDistanceSquared){o.current={...o.current,isDown:!0,isDragging:!0};const{x:v,y:w}=o.current.start;(g=s.onPointerDown)==null||g.call(s,{...d,clientX:v,clientY:w,button:0}),(m=s.onPointerMove)==null||m.call(s,d)}}},[s,n]),u=P.useCallback(d=>{var f;(f=s.onPointerUp)==null||f.call(s,d),r(!1),o.current={isDown:!1,isDragging:!1,start:new T(d.clientX,d.clientY)}},[s]);return i&&p.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...s,onPointerDown:a,onPointerMove:c,onPointerUp:u})}const qN=P.memo(function({id:e,shape:t,util:r,index:i,backgroundIndex:s,opacity:o}){const a=me(),{ShapeErrorFallback:c}=$n(),u=P.useRef(null),d=P.useRef(null),f=P.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});ul("set shape stuff",()=>{const v=a.getShape(e);if(!v)return;const w=f.current,S=a.getShapeClipPath(e)??"none";S!==w.clipPath&&(yi(u.current,"clip-path",S),yi(d.current,"clip-path",S),w.clipPath=S);const b=a.getShapePageTransform(e),x=Re.toCssString(b),E=a.getShapeGeometry(v).bounds;x!==w.transform&&(yi(u.current,"transform",x),yi(d.current,"transform",x),w.transform=x);const M=Math.max(E.width,1),j=Math.max(E.height,1);(M!==w.width||j!==w.height)&&(yi(u.current,"width",M+"px"),yi(u.current,"height",j+"px"),yi(d.current,"width",M+"px"),yi(d.current,"height",j+"px"),w.width=M,w.height=j)},[a]),ul("set opacity and z-index",()=>{const v=u.current,w=d.current;yi(v,"opacity",o),yi(w,"opacity",o),yi(v,"z-index",i),yi(w,"z-index",s)},[o,i,s]),ul("set display",()=>{if(!a.getShape(e))return;const S=a.getCulledShapes().has(e);S!==f.current.isCulled&&(yi(u.current,"display",S?"none":"block"),yi(d.current,"display",S?"none":"block"),f.current.isCulled=S)},[a]);const g=P.useCallback(v=>a.annotateError(v,{origin:"shape",willCrashApp:!1}),[a]);if(!t)return null;const m="fill"in t.props&&t.props.fill!=="none";return p.jsxs(p.Fragment,{children:[r.backgroundComponent&&p.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:p.jsx(vp,{fallback:c,onError:g,children:p.jsx(VN,{shape:t,util:r})})}),p.jsx("div",{ref:u,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":m,"data-shape-id":t.id,draggable:!1,children:p.jsx(vp,{fallback:c,onError:g,children:p.jsx(GN,{shape:t,util:r})})})]})}),GN=P.memo(function({shape:e,util:t}){return X0("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),VN=P.memo(function({shape:e,util:t}){return X0("InnerShape:"+e.type,()=>{var r;return(r=t.backgroundComponent)==null?void 0:r.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function kX({className:n}){const e=me(),{Background:t,SvgDefs:r,ShapeIndicators:i}=$n(),s=P.useRef(null),o=P.useRef(null),a=P.useRef(null),c=Mr();wX(s),uY(),lY(),mX(s),fY(s);const u=P.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});ul("position layers",function(){const{x,y:E,z:M}=e.getCamera();if(u.current.allowTextOutline&&_n.isSafari&&(c.style.setProperty("--tl-text-outline","none"),u.current.allowTextOutline=!1),u.current.allowTextOutline&&M<e.options.textShadowLod!==u.current.lodDisableTextOutline){const H=M<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",H?"none":"var(--tl-text-outline-reference)"),u.current.lodDisableTextOutline=H}const j=M>=1?ch(M,[1,8],[.125,.5],!0):ch(M,[.1,1],[-2,.125],!0),D=`scale(${ge(M)}) translate(${ge(x+j)}px,${ge(E+j)}px)`;yi(o.current,"transform",D),yi(a.current,"transform",D)},[e,c]);const d=JC(),f=xe("shapeSvgDefs",()=>{const b=new Map;for(const x of Vn(e.shapeUtils)){if(!x)return;const E=x.getCanvasSvgDefs();for(const{key:M,component:j}of E)b.has(M)||b.set(M,p.jsx(j,{},M))}return[...b.values()]},[e]),g=xe("debug_shapes",()=>mr.hideShapes.get(),[mr]),m=xe("debug_svg",()=>mr.debugSvg.get(),[mr]),v=xe("debug_geometry",()=>mr.debugGeometry.get(),[mr]),w=xe("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),S=xe("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return p.jsxs(p.Fragment,{children:[p.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":w,"data-isselectinganything":S,className:rt("tl-canvas",n),"data-testid":"canvas",...d,children:[p.jsx("svg",{className:"tl-svg-context",children:p.jsxs("defs",{children:[f,p.jsx(WX,{}),p.jsx(KX,{}),r&&p.jsx(r,{})]})}),t&&p.jsx("div",{className:"tl-background__wrapper",children:p.jsx(t,{})}),p.jsx(RX,{}),p.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[p.jsx(YX,{}),p.jsx(VX,{}),g?null:m?p.jsx(zX,{}):p.jsx($X,{})]}),p.jsx("div",{className:"tl-overlays",children:p.jsxs("div",{ref:a,className:"tl-html-layer",children:[v?p.jsx(IX,{}):null,p.jsx(NX,{}),p.jsx(DX,{}),p.jsx(jX,{}),p.jsx(OX,{}),i&&p.jsx(i,{}),p.jsx(HX,{}),p.jsx(LX,{}),p.jsx(GX,{}),p.jsx(EX,{})]})}),p.jsx(XX,{})]}),p.jsx(TX,{}),p.jsx(AX,{})]})}function AX(){const{InFrontOfTheCanvas:n}=$n();return n?p.jsx(n,{}):null}function RX(){const n=me(),e=xe("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:i}=xe("camera",()=>n.getCamera(),[n]),s=xe("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:o}=$n();return o&&s?p.jsx(o,{x:t,y:r,z:i,size:e}):null}function jX(){const n=me(),e=xe("scribbles",()=>n.getInstanceState().scribbles,[n]),t=xe("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=$n();return r&&e.length?e.map(i=>p.jsx(r,{className:"tl-user-scribble",scribble:i,zoom:t},i.id)):null}function DX(){const n=me(),e=xe("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=$n();return t&&e?p.jsx(t,{className:"tl-user-brush",brush:e}):null}function OX(){const n=me(),e=xe("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=$n();return t&&e?p.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function LX(){const n=me(),e=xe("snapLines",()=>n.snaps.getIndicators(),[n]),t=xe("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:r}=$n();return r&&e.length>0?e.map(i=>p.jsx(r,{className:"tl-user-snapline",line:i,zoom:t},i.id)):null}function NX(){const n=me(),e=xe("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:r}=n.getInstanceState();if(t||r)return!1;const i=n.getOnlySelectedShape();return!i||!n.getShapeHandles(i)?!1:i.id},[n]);return e?p.jsx(BX,{shapeId:e}):null}function BX({shapeId:n}){const e=me(),{Handles:t}=$n(),r=xe("zoomLevel",()=>e.getZoomLevel(),[e]),i=xe("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=xe("handles transform",()=>e.getShapePageTransform(n),[e,n]),o=xe("handles",()=>{const c=e.getShapeHandles(n);if(!c)return null;const u=(i?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return c.filter(d=>d.type!=="virtual"||!c.some(f=>f!==d&&f.type==="vertex"&&T.Dist(d,f)<u)).sort(d=>d.type==="vertex"?1:-1)},[e,r,i,n]),a=xe("isHidden",()=>e.isShapeHidden(n),[e,n]);return!t||!o||!s||a?null:p.jsx(t,{children:p.jsx("g",{transform:Re.toCssString(s),children:o.map(c=>p.jsx(FX,{shapeId:n,handle:c,zoom:r,isCoarse:i},c.id))})})}function FX({shapeId:n,handle:e,zoom:t,isCoarse:r}){const i=yX(n,e.id),{Handle:s}=$n();return s?p.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...i,children:p.jsx(s,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function zX(){const n=me();return xe("rendering shapes",()=>n.getRenderingShapes(),[n]).map(t=>p.jsxs(P.Fragment,{children:[p.jsx(qN,{...t}),p.jsx(qX,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function UX(){const n=me(),e=P.useRef(new Set);return ul("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(i=>e.current.has(i)))return;e.current=t;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[n]),null}function $X(){const n=me(),e=xe("rendering shapes",()=>n.getRenderingShapes(),[n]);return p.jsxs(p.Fragment,{children:[e.map(t=>p.jsx(qN,{...t},t.id+"_shape")),_n.isSafari&&p.jsx(UX,{})]})}function HX(){const n=me(),{ShapeIndicator:e}=$n(),t=xe("hinting shape ids",()=>dC(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(r=>p.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function WX(){return p.jsxs("g",{id:ko("cursor"),children:[p.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),p.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function KX(){const n=ko("cursor_hint");return p.jsx("path",{id:n,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function qX({id:n,mode:e}){const t=me(),[r,i]=P.useState(null),s=xe("is in root",()=>{const o=t.getShape(n);return(o==null?void 0:o.parentId)===t.getCurrentPageId()},[t,n]);return P.useEffect(()=>{if(!s)return;let o=null;const a=To("shape to svg",async()=>{const c=Math.random();o=c;const d=t.isShapeOfType(n,"frame")?0:10;let f=t.getShapePageBounds(n);if(!f)return;f=f.clone().expandBy(d);const g=await t.getSvgString([n],{padding:d,background:t.getInstanceState().exportBackground});if(o!==c||!g)return;const m=`data:image/svg+xml;utf8,${encodeURIComponent(g.svg)}`;i({src:m,bounds:f})});return()=>{o=null,a()}},[t,n,s]),!s||!r?null:e==="iframe"?p.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):p.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function GX(){const n=me(),e=xe("selection rotation",()=>n.getSelectionRotation(),[n]),t=xe("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=$n();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function VX(){const n=me(),e=xe("selection rotation",()=>n.getSelectionRotation(),[n]),t=xe("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=$n();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function YX(){const{OnTheCanvas:n}=$n();return n?p.jsx(n,{}):null}function XX(){const n=me(),e=xe("camera state",()=>n.getCameraState(),[n]);return p.jsx("div",{className:rt("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function ZX({className:n,zoom:e,point:t,color:r,viewport:i,opacity:s=1}){const o=P.useRef(null);Th(o,Wr(t.x,i.minX+5/e,i.maxX-5/e),Wr(t.y,i.minY+5/e,i.maxY-5/e),1/e,T.Angle(i.center,t));const a=ko("cursor_hint");return p.jsxs("svg",{ref:o,className:rt("tl-overlays__item",n),children:[p.jsx("use",{href:`#${a}`,color:r,strokeWidth:3,stroke:"var(--color-background)"}),p.jsx("use",{href:`#${a}`,color:r,opacity:s})]})}const W3=P.memo(function({className:e,zoom:t,point:r,color:i,name:s,chatMessage:o}){const a=P.useRef(null);Th(a,r==null?void 0:r.x,r==null?void 0:r.y,1/t);const c=ko("cursor");return r?p.jsxs("div",{ref:a,className:rt("tl-overlays__item",e),children:[p.jsx("svg",{className:"tl-cursor",children:p.jsx("use",{href:`#${c}`,color:i})}),o?p.jsxs(p.Fragment,{children:[s&&p.jsx("div",{className:"tl-nametag-title",style:{color:i},children:s}),p.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:i},children:o})]}):s&&p.jsx("div",{className:"tl-nametag",style:{backgroundColor:i},children:s})]}):null});function QX({x:n,y:e,z:t,size:r}){const i=Mh("grid"),s=me(),{gridSteps:o}=s.options;return p.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[p.jsx("defs",{children:o.map(({min:a,mid:c,step:u},d)=>{const f=u*r*t,g=.5+n*t,m=.5+e*t,v=g>0?g%f:f+g%f,w=m>0?m%f:f+m%f,S=t<c?ch(t,[a,c],[0,1]):1;return p.jsx("pattern",{id:VC(i,`${u}`),width:f,height:f,patternUnits:"userSpaceOnUse",children:p.jsx("circle",{className:"tl-grid-dot",cx:v,cy:w,r:1,opacity:S})},d)})}),o.map(({step:a},c)=>p.jsx("rect",{width:"100%",height:"100%",fill:`url(#${i}_${a})`},c))]})}function JX({handle:n,isCoarse:e,className:t,zoom:r}){const i=me(),s=(e?i.options.coarseHandleRadius:i.options.handleRadius)/r;if(n.type==="clone"){const a=3/r,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,u=rY.indexOf(n.id);return p.jsxs("g",{className:rt(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*u})`})]})}const o=(n.type==="create"&&e?3:4)/Math.max(r,.25);return p.jsxs("g",{className:rt(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("circle",{className:"tl-handle__fg",r:o})]})}const eZ=({children:n})=>p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),tZ=()=>{const{Spinner:n}=$n();return p.jsx(x2,{children:n?p.jsx(n,{}):null})};function t2(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],i=n[1];if(t===2)return`M${Qt(r)}L${Qt(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)r=n[o],i=n[o+1],s+=os(r,i);return e?`M${os(n[0],n[1])}Q${Qt(n[1])}${os(n[1],n[2])}T${s}${os(n[t-1],n[0])}${os(n[0],n[1])}Z`:`M${Qt(n[0])}Q${Qt(n[1])}${os(n[1],n[2])}${n.length>3?"T":""}${s}L${Qt(n[t-1])}`}function K3({scribble:n,zoom:e,color:t,opacity:r,className:i}){return n.points.length?p.jsx("svg",{className:i&&rt("tl-overlays__item",i),children:p.jsx("path",{className:"tl-scribble",d:t2(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null}function YN({bounds:n,rotation:e}){const t=P.useRef(null);return Th(t,n.x,n.y,1,e),P.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=ge(Math.max(1,n.width))+"px",r.style.height=ge(Math.max(1,n.height))+"px")},[n.width,n.height]),p.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function nZ({bounds:n,rotation:e}){const t=me(),r=P.useRef(null),i=xe("only selected shape",()=>t.getOnlySelectedShape(),[t]),s=i?t.getShapeUtil(i).expandSelectionOutlinePx(i):0;return Th(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-s,y:-s}),n=n.clone().expandBy(s).zeroFix(),p.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsx("rect",{className:rt("tl-selection__fg__outline"),width:ge(n.width),height:ge(n.height)})})}const rZ=()=>p.jsx("div",{className:"tl-shape-error-boundary"}),iZ=({shape:n,util:e})=>X0("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),sZ=({editor:n,id:e})=>{const t=xe("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:r}=$n();return!t||t.isLocked?null:p.jsx(vp,{fallback:r,onError:i=>n.annotateError(i,{origin:"react.shapeIndicator",willCrashApp:!1}),children:p.jsx(iZ,{shape:t,util:n.getShapeUtil(t)},t.id)})},q3=P.memo(function({shapeId:e,className:t,color:r,hidden:i,opacity:s}){const o=me(),a=P.useRef(null);return ul("indicator transform",()=>{const c=a.current;if(!c)return;const u=o.getShapePageTransform(e);u&&c.style.setProperty("transform",u.toCssString())},[o,e]),P.useLayoutEffect(()=>{const c=a.current;c&&c.style.setProperty("display",i?"none":"block")},[i]),p.jsx("svg",{ref:a,className:rt("tl-overlays__item",t),children:p.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:s,children:p.jsx(sZ,{editor:o,id:e})})})}),oZ=()=>p.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),XN=P.memo(function(){const e=me(),t=P.useRef(new Set),r=xe("should display selected ids",()=>{const o=t.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const u of c)a.add(u);if(e.isInAny("select.idle","select.editing_shape")){const u=e.getInstanceState();if(u.isHoveringCanvas&&!u.isCoarsePointer){const d=e.getHoveredShapeId();d&&a.add(d)}}}if(o.size!==a.size)return t.current=a,a;for(const c of a)if(!o.has(c))return t.current=a,a;return o},[e]),i=xe("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:s}=$n();return s?i.map(({id:o})=>p.jsx(s,{shapeId:o,hidden:!r.has(o)},o+"_indicator")):null});function aZ({points:n,zoom:e}){const t=2.5/e,r=n.reduce((g,m)=>Math.min(g,m.x),1/0),i=n.reduce((g,m)=>Math.max(g,m.x),-1/0),s=n.reduce((g,m)=>Math.min(g,m.y),1/0),o=n.reduce((g,m)=>Math.max(g,m.y),-1/0),a=n.some(g=>g.x===r&&g.y===s);let c,u,d,f;return a?(c=r,u=s,d=i,f=o):(c=r,u=o,d=i,f=s),p.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[p.jsx("line",{x1:c,y1:u,x2:d,y2:f}),n.map((g,m)=>p.jsx("g",{transform:`translate(${g.x},${g.y})`,children:p.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},m))]})}function cZ({gaps:n,direction:e,zoom:t}){const r=3.5/t;let i=[-1/0,1/0],s=null;const o=e==="horizontal";for(const c of n){if(s=So(i[0],i[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),s)i=s;else continue;if(s=So(i[0],i[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),s)i=s;else continue}if(i===null)return null;const a=(i[0]+i[1])/2;return p.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:c,endEdge:u},d)=>p.jsx(P.Fragment,{children:o?p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),p.jsx("line",{x1:u[0].x,y1:a-2*r,x2:u[1].x,y2:a+2*r}),p.jsx("line",{x1:c[0].x,y1:a,x2:u[0].x,y2:a}),p.jsx("line",{x1:(c[0].x+u[0].x)/2,y1:a-r,x2:(c[0].x+u[0].x)/2,y2:a+r})]}):p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),p.jsx("line",{x1:a-2*r,y1:u[0].y,x2:a+2*r,y2:u[1].y}),p.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:u[0].y}),p.jsx("line",{x1:a-r,y1:(c[0].y+u[0].y)/2,x2:a+r,y2:(c[0].y+u[0].y)/2})]})},d))})}function lZ({className:n,line:e,zoom:t}){return p.jsx("svg",{className:rt("tl-overlays__item",n),children:e.type==="points"?p.jsx(aZ,{...e,zoom:t}):e.type==="gaps"?p.jsx(cZ,{...e,zoom:t}):null})}function n2(){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const uZ=()=>null;function ZN(n,e){const t=P.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}const dZ=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:fK(n,e));function rl(n){return ZN(n,dZ)}const hZ=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:mC(n,e));function zu(n){return ZN(n,hZ)}const QN=P.createContext(null);function fZ({overrides:n={},children:e}){const t=zu(n),r=P.useMemo(()=>({Background:XV,SvgDefs:uZ,Brush:Qx,ZoomBrush:Qx,CollaboratorBrush:Qx,Cursor:W3,CollaboratorCursor:W3,CollaboratorHint:ZX,CollaboratorShapeIndicator:q3,Grid:QX,Scribble:K3,SnapIndicator:lZ,Handles:eZ,Handle:JX,CollaboratorScribble:K3,ErrorFallback:e5,ShapeErrorFallback:rZ,ShapeIndicatorErrorFallback:oZ,Spinner:n2,SelectionBackground:YN,SelectionForeground:nZ,ShapeIndicators:XN,ShapeIndicator:q3,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:kX,LoadingScreen:tZ,...t}),[t]);return p.jsx(QN.Provider,{value:r,children:e})}function $n(){const n=P.useContext(QN);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const sw={openWindow(n,e){window.open(n,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function JN(){sw.hardReset()}function pZ(){sw.refreshPage()}const gZ="https://github.com/tldraw/tldraw/issues/new",e5=({error:n,editor:e})=>{const t=P.useRef(null),[r,i]=P.useState(!1),[s,o]=P.useState(!1),[a,c]=P.useState(!1);let u=null;try{u=$n().Canvas??null}catch{}const d=n instanceof Error?n.message:String(n),f=n instanceof Error?n.stack:null,g=xe("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[m,v]=P.useState(null);P.useLayoutEffect(()=>{var j;g!==null&&v(g);let E=(j=t.current)==null?void 0:j.parentElement,M=!1;for(;E;){if(E.classList.contains("tl-theme__dark")||E.classList.contains("tl-theme__light")){M=!0;break}E=E.parentElement}if(M){v(null);return}typeof window<"u"&&"matchMedia"in window&&v(window.matchMedia("(prefers-color-scheme: dark)").matches)},[g]),P.useEffect(()=>{if(s){const E=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(E)}},[s,e]);const w=()=>{const E=document.createElement("textarea");E.value=f??d,document.body.appendChild(E),E.select(),document.execCommand("copy"),E.remove(),o(!0)},S=()=>{pZ()},b=async()=>{JN()},x=new URL(gZ);return x.searchParams.set("title",d),x.searchParams.set("labels","bug"),x.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${f??d}
\`\`\`

My browser: ${navigator.userAgent}`),p.jsxs("div",{ref:t,className:rt("tl-container tl-error-boundary",m===null?"":m?"tl-theme__dark":"tl-theme__light"),children:[p.jsx("div",{className:"tl-error-boundary__overlay"}),e&&p.jsx(GC,{onError:dp,fallback:()=>null,children:p.jsx(XC,{editor:e,children:p.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:u?p.jsx(u,{}):null})})}),p.jsx("div",{className:rt("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Are you sure?"}),p.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),p.jsx("button",{className:"tl-error-boundary__reset",onClick:b,children:"Reset data"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Something went wrong"}),p.jsx("p",{children:"Please refresh the page to continue."}),p.jsxs("p",{children:["If you keep seeing this screen, you can create a"," ",p.jsx("a",{href:x.toString(),children:"GitHub issue"})," or ask for help on"," ",p.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),r&&p.jsxs(p.Fragment,{children:["Message:",p.jsx("h4",{children:p.jsx("code",{children:d})}),"Stack trace:",p.jsxs("div",{className:"tl-error-boundary__content__error",children:[p.jsx("pre",{children:p.jsx("code",{children:f??d})}),p.jsx("button",{onClick:w,children:s?"Copied!":"Copy"})]})]}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),p.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[p.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),p.jsx("button",{className:"tl-error-boundary__refresh",onClick:S,children:"Refresh Page"})]})]})]})})]})},t5="TLDRAW_USER_DATA_v3",n5=Lt({id:xt,name:xt.nullable().optional(),color:xt.nullable().optional(),locale:xt.nullable().optional(),animationSpeed:mt.nullable().optional(),edgeScrollSpeed:mt.nullable().optional(),colorScheme:tw("light","dark","system").optional(),isSnapMode:Dt.nullable().optional(),isWrapMode:Dt.nullable().optional(),isDynamicSizeMode:Dt.nullable().optional(),isPasteAtCursorMode:Dt.nullable().optional()}),Wa={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},r2=Math.max(...Object.values(Wa));function mZ(n){n.version<Wa.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<Wa.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<Wa.MakeFieldsNullable,n.version<Wa.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<Wa.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<Wa.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<Wa.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<Wa.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=r2}const LI=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function r5(){return LI[Math.floor(Math.random()*LI.length)]}function yZ(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const qs=Object.freeze({name:"New User",locale:HV(),color:r5(),edgeScrollSpeed:1,animationSpeed:yZ()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function rb(){return{id:Jt(),color:r5()}}function i5(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return rb();const e=Un(n);mZ(e);try{return n5.validate(e.user)}catch{return rb()}}function wZ(){const n=JSON.parse(SC(t5)||"null")??null;return i5(n)}const ow=cr("globalUserData",null);function vZ(){xC(t5,JSON.stringify({version:r2,user:ow.get()}))}function s5(n){n5.validate(n),ow.set(n),vZ(),xZ()}const SZ=typeof process<"u"&&!1,Jd=typeof BroadcastChannel<"u"&&!SZ?new BroadcastChannel("tldraw-user-sync"):null;Jd==null||Jd.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===a5&&(e==null?void 0:e.origin)!==o5()&&ow.set(i5(e.data))});let ib=null;function o5(){return ib===null&&(ib=Jt()),ib}const a5="tldraw-user-preferences-change";function xZ(){Jd==null||Jd.postMessage({type:a5,origin:o5(),data:{user:i2(),version:r2}})}function i2(){let n=ow.get();return n||(n=wZ(),s5(n)),n}const bZ=Ie("defaultLocalStorageUserPrefs",()=>i2());function c5(n={}){return{userPreferences:n.userPreferences??bZ,setUserPreferences:n.setUserPreferences??s5}}var sb={exports:{}},G3;function _Z(){return G3||(G3=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function s(c,u,d,f,g){if(typeof d!="function")throw new TypeError("The listener must be a function");var m=new i(d,f||c,g),v=t?t+u:u;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],m]:c._events[v].push(m):(c._events[v]=m,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)e.call(d,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},a.prototype.listeners=function(u){var d=t?t+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,m=f.length,v=new Array(m);g<m;g++)v[g]=f[g].fn;return v},a.prototype.listenerCount=function(u){var d=t?t+u:u,f=this._events[d];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,d,f,g,m,v){var w=t?t+u:u;if(!this._events[w])return!1;var S=this._events[w],b=arguments.length,x,E;if(S.fn){switch(S.once&&this.removeListener(u,S.fn,void 0,!0),b){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,f),!0;case 4:return S.fn.call(S.context,d,f,g),!0;case 5:return S.fn.call(S.context,d,f,g,m),!0;case 6:return S.fn.call(S.context,d,f,g,m,v),!0}for(E=1,x=new Array(b-1);E<b;E++)x[E-1]=arguments[E];S.fn.apply(S.context,x)}else{var M=S.length,j;for(E=0;E<M;E++)switch(S[E].once&&this.removeListener(u,S[E].fn,void 0,!0),b){case 1:S[E].fn.call(S[E].context);break;case 2:S[E].fn.call(S[E].context,d);break;case 3:S[E].fn.call(S[E].context,d,f);break;case 4:S[E].fn.call(S[E].context,d,f,g);break;default:if(!x)for(j=1,x=new Array(b-1);j<b;j++)x[j-1]=arguments[j];S[E].fn.apply(S[E].context,x)}}return!0},a.prototype.on=function(u,d,f){return s(this,u,d,f,!1)},a.prototype.once=function(u,d,f){return s(this,u,d,f,!0)},a.prototype.removeListener=function(u,d,f,g){var m=t?t+u:u;if(!this._events[m])return this;if(!d)return o(this,m),this;var v=this._events[m];if(v.fn)v.fn===d&&(!g||v.once)&&(!f||v.context===f)&&o(this,m);else{for(var w=0,S=[],b=v.length;w<b;w++)(v[w].fn!==d||g&&!v[w].once||f&&v[w].context!==f)&&S.push(v[w]);S.length?this._events[m]=S.length===1?S[0]:S:o(this,m)}return this},a.prototype.removeAllListeners=function(u){var d;return u?(d=t?t+u:u,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(sb)),sb.exports}var IZ=_Z();const l5=fs(IZ),eh="TLDRAW_TAB_ID_v2",sc=globalThis.window;function EZ(){return sc?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(sc.navigator.platform)||_n.isDarwin&&"ontouchend"in document:!1}const Sp=sc?sc[eh]??X4(eh)??"TLDRAW_INSTANCE_STATE_V1_"+Jt():"<error>";sc&&(sc[eh]=Sp,EZ()?bC(eh,Sp):Z4(eh));sc==null||sc.addEventListener("beforeunload",()=>{bC(eh,Sp)});const u5={Initial:0},aw=Math.max(...Object.values(u5));function CZ(n){n.version<u5.Initial,n.version=aw}const d5=Lt({version:mt,currentPageId:mp.optional(),isFocusMode:Dt.optional(),exportBackground:Dt.optional(),isDebugMode:Dt.optional(),isToolLocked:Dt.optional(),isGridMode:Dt.optional(),pageStates:Xr(Lt({pageId:mp,camera:Lt({x:mt,y:mt,z:mt}).optional(),selectedShapeIds:Xr(Gs).optional(),focusedGroupId:Gs.nullable().optional()})).optional()});function PZ(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==aw&&(n=Un(n),CZ(n));try{return d5.validate(n)}catch(e){return console.warn(e),null}}function s2(n){const e=n.query.ids("page");return Ie("sessionStateSnapshot",()=>{const t=n.get(xi);if(!t)return null;const r=[...e.get()];return{version:aw,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(i=>{const s=n.get(Zs.createId(i)),o=n.get(Eo.createId(i));return{pageId:i,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}},{isEqual:gl})}function NI(n,e,t){const r=PZ(e);if(!r)return;const i=eN(n.get(xi)),s=t!=null&&t.forceOverwrite?r:i,o=t!=null&&t.forceOverwrite?i:r,a=n.schema.types.instance.create({id:xi,...i,currentPageId:r.currentPageId,isDebugMode:(s==null?void 0:s.isDebugMode)??(o==null?void 0:o.isDebugMode),isFocusMode:(s==null?void 0:s.isFocusMode)??(o==null?void 0:o.isFocusMode),isToolLocked:(s==null?void 0:s.isToolLocked)??(o==null?void 0:o.isToolLocked),isGridMode:(s==null?void 0:s.isGridMode)??(o==null?void 0:o.isGridMode),exportBackground:(s==null?void 0:s.exportBackground)??(o==null?void 0:o.exportBackground)});n.atomic(()=>{var c,u,d;for(const f of r.pageStates??[]){if(!n.has(f.pageId))continue;const g=Eo.createId(f.pageId),m=Zs.createId(f.pageId),v=n.get(g),w=n.get(m);n.put([Eo.create({id:g,x:((c=f.camera)==null?void 0:c.x)??(v==null?void 0:v.x),y:((u=f.camera)==null?void 0:u.y)??(v==null?void 0:v.y),z:((d=f.camera)==null?void 0:d.z)??(v==null?void 0:v.z)}),Zs.create({id:m,pageId:f.pageId,selectedShapeIds:f.selectedShapeIds??(w==null?void 0:w.selectedShapeIds),focusedGroupId:f.focusedGroupId??(w==null?void 0:w.focusedGroupId)})])}n.put([a]),n.ensureStoreIsUsable()})}function MZ(n){var i;const e=[];for(const s of Object.values(n))(i=s.typeName)!=null&&i.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const t=e.filter(s=>s.typeName==="instance"&&s.id!==xi)[0];if(!t)return null;const r={version:aw,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===t.id).map(s=>{const o=n[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return d5.validate(r),r}catch{return null}}function h5(n,e,t){let r={};if("store"in e){const o=n.schema.migrateStoreSnapshot(e);if(o.type!=="success")throw new Error("Failed to migrate store snapshot: "+o.reason);r.document={schema:n.schema.serialize(),store:Jf(o.value,(a,{typeName:c})=>n.scopedTypes.document.has(c))}}else r=e;const i=eN(n.get(xi)),s=f5.get(n,s2).get();n.atomic(()=>{r.document&&n.loadStoreSnapshot(r.document),i&&n.update(xi,o=>({...o,...i})),s&&NI(n,s),r.session&&NI(n,r.session,{forceOverwrite:t==null?void 0:t.forceOverwriteSessionState})})}const f5=new ha;function TZ(n){const t=f5.get(n,s2).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function p5(n){const e=[],t=new Set;for(const r of n){if(t.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function yl({children:n,className:e="",...t}){return p.jsx("svg",{...t,className:rt("tl-svg-container",e),children:n})}function o2(n,e,t,r){const i=n.x-t.x,s=n.y-t.y,o=r.x-t.x,a=r.y-t.y,c=e.x-n.x,u=e.y-n.y,d=o*s-a*i,f=c*s-u*i,g=a*c-o*u;if(d===0||f===0||g===0)return null;if(g!==0){const m=d/g,v=f/g;if(0<=m&&m<=1&&0<=v&&v<=1)return T.AddXY(n,m*c,m*u)}return null}function Yp(n,e,t,r){const i=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),s=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),o=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=s*s-4*i*o;if(a<0||a===0)return null;const c=Math.sqrt(a),u=(-s+c)/(2*i),d=(-s-c)/(2*i);if((u<0||u>1)&&(d<0||d>1))return null;const f=[];return 0<=u&&u<=1&&f.push(T.Lrp(n,e,u)),0<=d&&d<=1&&f.push(T.Lrp(n,e,d)),f.length===0?null:f}function kZ(n,e,t){const r=[];let i;for(let s=0,o=t.length-1;s<o;s++)i=o2(n,e,t[s],t[s+1]),i&&r.push(i);return r.length===0?null:r}function a2(n,e,t){const r=[];let i;for(let s=1,o=t.length;s<o+1;s++)i=o2(n,e,t[s-1],t[s%t.length]),i&&r.push(i);return r.length===0?null:r}function AZ(n,e,t,r){let i=t.x-n.x,s=t.y-n.y;const o=Math.sqrt(i*i+s*s),a=(o*o-r*r+e*e)/(2*o),c=Math.sqrt(e*e-a*a);return i/=o,s/=o,[new T(n.x+i*a-s*c,n.y+s*a+i*c),new T(n.x+i*a+s*c,n.y+s*a-i*c)]}function BI(n,e,t){const r=[];let i,s,o;for(let a=0,c=t.length;a<c;a++)i=t[a],s=t[(a+1)%t.length],o=Yp(i,s,n,e),o&&r.push(...o);return r.length===0?null:r}function V3(n,e,t){const r=[];let i,s,o;for(let a=1,c=t.length;a<c;a++)i=t[a-1],s=t[a],o=Yp(i,s,n,e),o&&r.push(...o);return r.length===0?null:r}function _m(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function c2(n,e,t,r){return _m(n,t,r)!==_m(e,t,r)&&_m(n,e,t)!==_m(n,e,r)}function Y3(n,e){const t=new Map;let r,i,s,o;for(let a=0,c=n.length;a<c;a++)if(r=n[a],As(r,e)){const u=ob(r);t.has(u)||t.set(u,r)}for(let a=0,c=e.length;a<c;a++)if(r=e[a],As(r,n)){const u=ob(r);t.has(u)||t.set(u,r)}for(let a=0,c=n.length;a<c;a++){r=n[a],i=n[(a+1)%n.length];for(let u=0,d=e.length;u<d;u++){s=e[u],o=e[(u+1)%e.length];const f=o2(r,i,s,o);if(f!==null){const g=ob(f);t.has(g)||t.set(g,f)}}}return t.size===0?null:RZ([...t.values()])}function ob(n){return`${n.x},${n.y}`}function RZ(n){const e=T.Average(n);return n.sort((t,r)=>T.Angle(e,t)-T.Angle(e,r))}function l2(n,e){let t,r,i,s;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let c=0,u=e.length;c<u;c++)if(i=e[c],s=e[(c+1)%u],c2(t,r,i,s))return!0}return!1}function jZ(n,e){let t,r,i,s;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let c=1,u=e.length;c<u;c++)if(i=e[c-1],s=e[c],c2(t,r,i,s))return!0}return!1}class ec extends Pl{constructor(t){super({...t,isClosed:!1,isFilled:!1});G(this,"start");G(this,"end");G(this,"d");G(this,"u");G(this,"ul");const{start:r,end:i}=t;this.start=r,this.end=i,this.d=r.clone().sub(i),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:i,d:s,u:o,ul:a}=this;if(s.len()===0||a===0)return r;const c=T.Sub(t,r).dpr(o)/a,u=r.x+o.x*c;if(u<Math.min(r.x,i.x))return r.x<i.x?r:i;if(u>Math.max(r.x,i.x))return r.x>i.x?r:i;const d=r.y+o.y*c;return d<Math.min(r.y,i.y)?r.y<i.y?r:i:d>Math.max(r.y,i.y)?r.y>i.y?r:i:new T(u,d)}hitTestLineSegment(t,r,i=0){return c2(t,r,this.start,this.end)||this.distanceToLineSegment(t,r)<=i}getSvgPathData(t=!0){const{start:r,end:i}=this;return`${t?`M${r.toFixed()}`:""} L${i.toFixed()}`}}class kh extends Pl{constructor(t){super({isClosed:!1,isFilled:!1,...t});G(this,"points");G(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,i=t.length-1;r<i;r++){const s=t[r],o=t[r+1];this._segments.push(new ec({start:s,end:o}))}this.isClosed&&this._segments.push(new ec({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let i=this.points[0],s=1/0,o,a;for(let c=0;c<r.length;c++)o=r[c].nearestPoint(t),a=T.Dist2(o,t),a<s&&(i=o,s=a);if(!i)throw Error("nearest point not found");return i}hitTestLineSegment(t,r,i=0){const{segments:s}=this;for(let o=0,a=s.length;o<a;o++)if(s[o].hitTestLineSegment(t,r,i))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((r,i,s)=>s===0?`M ${i.x} ${i.y}`:`${r} L ${i.x} ${i.y}`,"")}}class gr extends kh{constructor(e){super({...e}),this.isClosed=!0}}class ga extends gr{constructor(t){const{x:r=0,y:i=0,width:s,height:o}=t;super({...t,points:[new T(r,i),new T(r+s,i),new T(r+s,i+o),new T(r,i+o)]});G(this,"x");G(this,"y");G(this,"w");G(this,"h");this.x=r,this.y=i,this.w=s,this.h=o}getBounds(){return new De(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:r,w:i,h:s}=this;return`M${t},${r} h${i} v${s} h-${i}z`}}class Ao{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}G(Ao,"props"),G(Ao,"migrations"),G(Ao,"type");function bo(n,e,t={}){const{closed:r=!1,snap:i=1,start:s="outset",end:o="outset",lengthRatio:a=2,style:c="dashed",forceSolid:u=!1}=t;let d=0,f=0,g=1,m=0,v=0;if(u)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(c){case"dashed":{g=1,d=Math.min(e*a,n/4);break}case"dotted":{g=100,d=e/g;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(n+=d/2,v+=d/2):s==="skip"&&(n-=d,v-=d),o==="outset"?n+=d/2:o==="skip"&&(n-=d)),f=Math.floor(n/d/(2*g)),f-=f%i,f<3&&c==="dashed"?n/e<4?(d=n,f=1,m=0):(d=n*(1/3),m=n*(1/3)):(d=n/f/(2*g),r?(v=d/2,m=(n-f*d)/f):m=(n-f*d)/Math.max(1,f-1)),{strokeDasharray:[d,m].join(" "),strokeDashoffset:v.toString()}}function X3({bounds:n,className:e}){const t=me(),r=xe("zoom level",()=>t.getZoomLevel(),[t]);return p.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((i,s)=>{const{strokeDasharray:o,strokeDashoffset:a}=bo(i[0].dist(i[1]),1/r,{style:"dashed",lengthRatio:4});return p.jsx("line",{x1:i[0].x,y1:i[0].y,x2:i[1].x,y2:i[1].y,strokeDasharray:o,strokeDashoffset:a},s)})})}class dy extends Ao{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new ga({width:1,height:1,isFilled:!1}):new to({children:t.map(r=>{const i=this.editor.getShape(r),s=this.editor.getShapeGeometry(r),o=this.editor.getShapeLocalTransform(i).applyToPoints(s.vertices);return s.isClosed?new gr({points:o,isFilled:!0}):new kh({points:o})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),i=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||i))return null;const o=this.editor.getShapeGeometry(e).bounds;return p.jsx(yl,{children:p.jsx(X3,{className:"tl-group",bounds:o})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return p.jsx(X3,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}G(dy,"type","group"),G(dy,"props",hN),G(dy,"migrations",fN);const g5=[dy],DZ=new Set(g5.map(n=>n.type));function m5(n){const e=[...g5],t=new Set;for(const r of n){if(DZ.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}var wl=k4();const OZ=fs(wl);function y5(n,e){const t=new Map;return async function(i){const s=t.get(i);if(s)return s;const o=(async()=>{try{const a=await fa(i,e);return bt(a.ok),await n(a)}catch(a){return console.error(a),null}})();return t.set(i,o),o}}const cw=y5(async n=>await Io.blobToDataUrl(await n.blob())),LZ=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,NZ=/@font-face\s*{([^}]+)}/gi,w5=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,BZ=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function FZ(n){return Array.from(n.matchAll(LZ),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function v5(n,e){return Array.from(n.matchAll(NZ),t=>{const r=t[1],i=Array.from(r.matchAll(w5),o=>{var c;const a=o[1]||o[2]||o[3];return{original:a,resolved:((c=yt(a,e))==null?void 0:c.href)??null}}),s=new Set(Array.from(r.matchAll(BZ),o=>(o[1]||o[2]||o[3]).toLowerCase()));return{fontFace:r,urls:i,fontFamilies:s}})}function zZ(n){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,r=new Set;for(;;){const i=e.exec(n);if(!i)break;const s=i[1]||i[2]||i[3];if(r.add(s.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(n))break;e.lastIndex=t.lastIndex}return r}function S5(n){return!(n.startsWith("-")||n.startsWith("animation")||n.startsWith("transition")||n==="cursor"||n==="pointer-events"||n==="user-select"||n==="touch-action")}function UZ(n,e){return{imports:FZ(n),fontFaces:v5(n,e)}}function $Z(n){return Array.from(n.matchAll(w5),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const HZ=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function x5(n){return HZ.has(n)}var WZ=Object.create,b5=Object.defineProperty,KZ=Object.getOwnPropertyDescriptor,qZ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),_5=n=>{throw TypeError(n)},I5=(n,e,t)=>e in n?b5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,GZ=n=>[,,,WZ(null)],E5=["class","method","getter","setter","accessor","field","value","get","set"],C5=n=>n!==void 0&&typeof n!="function"?_5("Function expected"):n,VZ=(n,e,t,r,i)=>({kind:E5[n],name:e,metadata:r,addInitializer:s=>t._?_5("Already initialized"):i.push(C5(s||null))}),YZ=(n,e)=>I5(e,qZ("metadata"),n[3]),XZ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},ZZ=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=E5[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,KZ(i,t)),b=r.length-1;b>=0;b--)c=VZ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,C5(o)&&(S[v]=o);return S&&b5(i,t,S),i},Im=(n,e,t)=>I5(n,typeof e!="symbol"?e+"":e,t),P5,lw;P5=[ls];class u2{constructor(){XZ(lw,5,this),Im(this,"fontFacesPromise",null),Im(this,"foundFontNames",new Set),Im(this,"fontFacesToEmbed",new Set),Im(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){bt(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=QZ()}onFontFamilyValue(e){bt(this.fontFacesPromise,"FontEmbedder not started");const t=zZ(e);for(const r of t){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(i=>{const s=i.filter(o=>o.fontFamilies.has(r));for(const o of s)if(!this.fontFacesToEmbed.has(o)){this.fontFacesToEmbed.add(o);for(const a of o.urls)!a.resolved||a.embedded||(a.embedded=cw(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let r=`@font-face {${t.fontFace}}`;for(const i of t.urls){if(!i.embedded)continue;const s=await i.embedded;s&&(r=r.replace(i.original,s))}e+=r}return e}}lw=GZ();ZZ(lw,1,"onFontFamilyValue",P5,u2);YZ(lw,u2);async function QZ(){const n=[];for(const e of document.styleSheets){let t;try{t=e.cssRules}catch{}if(t)for(const r of e.cssRules)r instanceof CSSFontFaceRule?n.push(v5(r.cssText,e.href??document.baseURI)):r instanceof CSSImportRule&&n.push(FI(r.href));else e.href&&n.push(FI(e.href))}return St(await Promise.all(n)).flat()}const FI=y5(async n=>{const e=UZ(await n.text(),n.url),t=await Promise.all(e.imports.map(({url:r})=>FI(new URL(r,n.url).href)));return[...e.fontFaces,...St(t).flat()]});function M5(n){if(n.shadowRoot)return n.shadowRoot.childNodes;if(nQ(n)){const e=n.assignedNodes();if(e!=null&&e.length)return e}return n.childNodes}function*zI(n){for(const e of M5(n))JZ(e)&&(yield e)}function uw(n){var e;return((e=n.ownerDocument)==null?void 0:e.defaultView)??globalThis}function JZ(n){return n instanceof uw(n).Element}function eQ(n){return n instanceof uw(n).ShadowRoot}function tQ(n){return"getRootNode"in n&&eQ(n.getRootNode())}function nQ(n){return tQ(n)&&n instanceof uw(n).HTMLSlotElement}function rQ(n){return n.style}function d2(n,e){return uw(n).getComputedStyle(n,e)}const Su={};class iQ{constructor(e){G(this,"styles",new Map);G(this,"fonts",new u2);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(zI(e));for(;t.length;){const r=t.pop();t.push(...zI(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:r=!0}){var a;const i=t?cQ(e.tagName.toLowerCase()):Su,s=r?((a=this.styles.get(e.parentElement))==null?void 0:a.self)??Su:Su,o={self:sQ(e,{defaultStyles:i,parentStyles:s}),before:Z3(e,"::before"),after:Z3(e,"::after")};this.styles.set(e,o)}fetchResources(){const e=[];for(const t of this.styles.values())for(const r of Vn(t))if(r)for(const[i,s]of Object.entries(r)){if(!s)continue;i==="font-family"&&this.fonts.onFontFamilyValue(s);const o=$Z(s);o.length!==0&&e.push(...o.map(async({url:a,original:c})=>{const u=await cw(a)??"data:";r[i]=s.replace(c,`url("${u}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(r,i)=>{if(e.has(r))return;e.add(r);const s=r.shadowRoot;if(s){const o=document.createElement("div");this.styles.set(o,this.styles.get(r)),o.setAttribute("data-tl-custom-element",r.tagName),(i??r.parentElement).appendChild(o);for(const a of s.childNodes)a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0));r.remove()}else if(i){if(r.tagName.toLowerCase()==="style")return;const o=r.cloneNode(!1);this.styles.set(o,this.styles.get(r)),i.appendChild(o);for(const a of M5(r))a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())t(r,null)}embedStyles(){let e="";for(const[t,r]of this.styles){if(r.after||r.before){const s=`pseudo-${Jt()}`;t.classList.add(s),r.before&&(e+=`.${s}::before {${Q3(r.before)}}
`),r.after&&(e+=`.${s}::after {${Q3(r.after)}}
`)}const i=rQ(t);for(const[s,o]of Object.entries(r.self))o&&i.setProperty(s,o);i.fontKerning==="auto"&&(i.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){aQ()}}function sQ(n,{defaultStyles:e,parentStyles:t}){return n.computedStyleMap?T5(n.computedStyleMap(),{defaultStyles:e,parentStyles:t}):h2(d2(n),{defaultStyles:e,parentStyles:t})}function Z3(n,e){const t=d2(n,e),r=t.getPropertyValue("content");if(!(r===""||r==="none"))return h2(t,{defaultStyles:Su,parentStyles:Su})}function T5(n,{defaultStyles:e,parentStyles:t}){const r={};for(const i of n.keys()){if(!S5(i))continue;const s=n.get(i).toString();e[i]!==s&&(t[i]===s&&x5(i)||(r[i]=s))}return r}function h2(n,{defaultStyles:e,parentStyles:t}){const r={};for(const i of n){if(!S5(i))continue;const s=n.getPropertyValue(i);e[i]!==s&&(t[i]===s&&x5(i)||(r[i]=s))}return r}function Q3(n){let e="";for(const[t,r]of Object.entries(n))e+=`${t}: ${r};`;return e}let th;const J3={};function oQ(){if(!th){const n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n);const e=ss(n.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(r),e.body.appendChild(t),th={iframe:n,foreignObject:r,document:e}}return th}function aQ(){th&&(document.body.removeChild(th.iframe),th=void 0)}const ej={defaultStyles:Su,parentStyles:Su};function cQ(n){let e=J3[n];if(!e){const{foreignObject:t,document:r}=oQ(),i=r.createElement(n);t.appendChild(i),e=i.computedStyleMap?T5(i.computedStyleMap(),ej):h2(d2(i),ej),t.removeChild(i),J3[n]=e}return e}function lQ(n,e){Array.from(n.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function tj(n,e){return n.replaceWith(e),e}async function rp(n,e){const t=document.createElement("img");e&&lQ(e,t),t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function uQ(n){try{const e=n.toDataURL();return await rp(e,n)}catch{return await rp(null,n)}}async function dQ(n){try{const e=await Ps.getVideoFrameAsDataUrl(n);return rp(e,n)}catch(e){console.error("Could not get video frame",e)}if(n.poster){const e=await cw(n.poster);return rp(e,n)}return rp(null,n)}async function k5(n){if(n instanceof HTMLCanvasElement)return tj(n,await uQ(n));if(n instanceof HTMLVideoElement)return tj(n,await dQ(n));if(n instanceof HTMLImageElement){const e=n.currentSrc||n.src,t=await cw(e);n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}else n instanceof HTMLInputElement?n.setAttribute("value",n.value):n instanceof HTMLTextAreaElement&&(n.textContent=n.value);await Promise.all(Array.from(zI(n),e=>k5(e)))}function dw(n){const e=P.useRef();return P.useLayoutEffect(()=>{e.current=n}),P.useDebugValue(n),P.useCallback((...t)=>{const r=e.current;return bt(r,"fn does not exist"),r(...t)},[])}const f2=P.createContext(null);function hQ({context:n,editor:e,children:t}){const r=e.options.exportProvider;return p.jsx(XC,{editor:e,children:p.jsx(jN,{container:e.getContainer(),children:p.jsx(f2.Provider,{value:n,children:p.jsx(r,{children:t})})})})}function Xp(){return P.useContext(f2)}function fQ(){const n=P.useContext(f2),[e]=P.useState(hC);return P.useEffect(()=>(n==null||n.waitUntil(e),()=>{e.resolve()}),[e,n]),dw(()=>{e.resolve()})}var pQ=Object.create,A5=Object.defineProperty,gQ=Object.getOwnPropertyDescriptor,mQ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),R5=n=>{throw TypeError(n)},j5=(n,e,t)=>e in n?A5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,yQ=n=>[,,,pQ(null)],D5=["class","method","getter","setter","accessor","field","value","get","set"],O5=n=>n!==void 0&&typeof n!="function"?R5("Function expected"):n,wQ=(n,e,t,r,i)=>({kind:D5[n],name:e,metadata:r,addInitializer:s=>t._?R5("Already initialized"):i.push(O5(s||null))}),vQ=(n,e)=>j5(e,mQ("metadata"),n[3]),SQ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},xQ=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=D5[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,gQ(i,t)),b=r.length-1;b>=0;b--)c=wQ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,O5(o)&&(S[v]=o);return S&&A5(i,t,S),i},nj=(n,e,t)=>j5(n,typeof e!="symbol"?e+"":e,t),L5,hw;L5=[ls];class p2{constructor(e){this.maxDelayTimeMs=e,SQ(hw,5,this),nj(this,"isResolved",!1),nj(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error whilst waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await xI(0)}async resolve(){const e=xI(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}hw=yQ();xQ(hw,1,"waitUntil",L5,p2);vQ(hw,p2);function bQ(n,e,t={}){var b,x;if(!window.document)throw Error("No document");const{scale:r=1,background:i=!1,padding:s=n.options.defaultSvgPadding,preserveAspectRatio:o}=t,a=t.darkMode??n.user.getIsDarkMode(),c=n.getShapeAndDescendantIds(e),u=n.getUnorderedRenderingShapes(!1).filter(({id:E})=>c.has(E));let d=null;if(t.bounds)d=t.bounds;else for(const{id:E}of u){const M=n.getShapeMaskedPageBounds(E);M&&(d?d.union(M):d=M.clone())}if(!d)return;const f=e.length===1&&n.isShapeOfType(n.getShape(e[0]),"frame")?e[0]:null;f||d.expandBy(s);const g=d.width*r,m=d.height*r;try{(x=(b=document.body).focus)==null||x.call(b)}catch{}const v=new p2(n.options.maxExportDelayMs),w=hC();return v.waitUntil(w),{jsx:p.jsx(_Q,{editor:n,preserveAspectRatio:o,scale:r,bbox:d,background:i,singleFrameShapeId:f,isDarkMode:a,renderingShapes:u,onMount:w.resolve,waitUntil:v.waitUntil}),width:g,height:m,exportDelay:v}}function _Q({editor:n,preserveAspectRatio:e,scale:t,bbox:r,background:i,singleFrameShapeId:s,isDarkMode:o,renderingShapes:a,onMount:c,waitUntil:u}){const d=Mh(),f=wc({isDarkMode:o}),[g,m]=P.useState({}),v=dw(E=>{Mo(g,E.key)||u((async()=>{const M=await E.getElement();M&&wl.flushSync(()=>m(j=>({...j,[E.key]:M})))})())}),w=P.useMemo(()=>({isDarkMode:o,waitUntil:u,addExportDef:v}),[o,u,v]),[S,b]=P.useState(null),x=P.useRef(!1);return P.useLayoutEffect(()=>{if(x.current)throw new Error("SvgExport should only render once - do not use with react strict mode");x.current=!0,(async()=>{const E={},M=a.map(async({id:D,opacity:H,index:L,backgroundIndex:U})=>{var N,_;if(D===s)return[];const z=n.getShape(D);if(n.isShapeOfType(z,"group"))return[];const Y=[],V=n.getShapeUtil(z);if(V.toSvg||V.toBackgroundSvg){const[k,O]=await Promise.all([(N=V.toSvg)==null?void 0:N.call(V,z,w),(_=V.toBackgroundSvg)==null?void 0:_.call(V,z,w)]),W=n.getShapePageTransform(z);let q=W.toCssString();"scale"in z.props&&z.props.scale!==1&&(q=`${q} scale(${z.props.scale}, ${z.props.scale})`);const X=n.getShapeMask(z.id),ne=X?Re.From(Re.Inverse(W)).applyToPoints(X):null,$=VC(d,z.id);ne&&(E[$]=p.jsx("clipPath",{id:$,children:p.jsx("path",{d:`M${ne.map(({x:C,y:R})=>`${C},${R}`).join("L")}Z`})})),k&&Y.push({zIndex:L,element:p.jsx("g",{transform:q,opacity:H,clipPath:X?`url(#${$})`:void 0,children:k},`fg_${z.id}`)}),O&&Y.push({zIndex:U,element:p.jsx("g",{transform:q,opacity:H,clipPath:X?`url(#${$})`:void 0,children:O},`bg_${z.id}`)})}else Y.push({zIndex:L,element:p.jsx(rj,{shape:z,util:V,component:GN,className:"tl-shape",bbox:r,opacity:H},`fg_${z.id}`)}),V.backgroundComponent&&Y.push({zIndex:U,element:p.jsx(rj,{shape:z,util:V,component:VN,className:"tl-shape tl-shape-background",bbox:r,opacity:H},`bg_${z.id}`)});return Y}),j=(await Promise.all(M)).flat();wl.flushSync(()=>{b(j.sort((D,H)=>D.zIndex-H.zIndex).map(({element:D})=>D)),m(D=>({...D,...E}))})})()},[r,n,w,d,a,s]),P.useEffect(()=>{S!==null&&c()},[c,S]),p.jsx(hQ,{editor:n,context:w,children:p.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:r.width*t,height:r.height*t,viewBox:`${r.minX} ${r.minY} ${r.width} ${r.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:i?s?f.solid:f.background:"transparent"},"data-color-mode":o?"dark":"light",className:`tl-container tl-theme__force-sRGB ${o?"tl-theme__dark":"tl-theme__light"}`,children:[p.jsx("defs",{children:Object.entries(g).map(([E,M])=>p.jsx(P.Fragment,{children:M},E))}),S]})})}function rj({shape:n,util:e,className:t,component:r,bbox:i,opacity:s}){const o=me(),a=Re.Translate(-i.minX,-i.minY).multiply(o.getShapePageTransform(n.id)),c=o.getShapeGeometry(n.id).bounds,u=Math.max(c.width,1),d=Math.max(c.height,1);return p.jsx(GC,{fallback:()=>null,children:p.jsx("foreignObject",{x:i.minX,y:i.minY,width:i.w,height:i.h,className:"tl-shape-foreign-object",children:p.jsx("div",{className:t,"data-shape-type":n.type,style:{clipPath:o.getShapeClipPath(n.id),transform:a.toCssString(),width:u,height:d,opacity:s},children:p.jsx(r,{shape:n,util:e})})})})}let IQ=1;async function EQ(n,e,t={}){const r=bQ(n,e,t);if(!r)return;const i=n.getContainer(),s=document.createElement("div");s.className="tldraw-svg-export",s.inert=!0,s.tabIndex=-1,Object.assign(s.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),i.appendChild(s);const o=A4.createRoot(s,{identifierPrefix:`export_${IQ++}_`});try{wl.flushSync(()=>{o.render(r.jsx)}),await r.exportDelay.resolve();const a=s.firstElementChild;return bt(a instanceof SVGSVGElement,"Expected an SVG element"),await CQ(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{o.unmount(),i.removeChild(s)},0)}}async function CQ(n){const e=[...n.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const t=new iQ(n);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(s=>k5(s)));for(const s of e)t.readRootElementStyles(s);await t.fetchResources();const r=await t.getFontFaceCss();t.unwrapCustomElements();const i=t.embedStyles();if(r||i){const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent=`${r}
${i}`,n.prepend(s)}}finally{t.dispose()}}const xo={menus:cr("open menus",[]),getOpenMenus(n){return n?this.menus.get().filter(e=>e.endsWith("-"+n)):this.menus.get()},addOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)||(r.add(t),this.menus.set([...r]))},deleteOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)&&(r.delete(t),this.menus.set([...r]))},clearOpenMenus(n){this.menus.set(n?this.menus.get().filter(e=>!e.endsWith("-"+n)):[])},_hiddenMenus:[],hideOpenMenus(n){if(this._hiddenMenus=[...this.getOpenMenus(n)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,n)},showOpenMenus(n){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,n);this._hiddenMenus=[]}},isMenuOpen(n,e){return this.getOpenMenus(e).includes(n)},hasOpenMenus(n){return this.getOpenMenus(n).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(n){return{getOpenMenus:()=>this.getOpenMenus(n),addOpenMenu:e=>this.addOpenMenu(e,n),deleteOpenMenu:e=>this.deleteOpenMenu(e,n),clearOpenMenus:()=>this.clearOpenMenus(n),isMenuOpen:e=>this.isMenuOpen(e,n),hasOpenMenus:()=>this.hasOpenMenus(n),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},UI=new YK,PQ={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:P.Fragment};function ij(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Pr(n)}}class MQ{constructor(e){G(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,i]of this){if(!ij(i,e.get(r)))return!1;t.add(r)}for(const[r,i]of e)if(!t.has(r)&&!ij(i,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class $I extends MQ{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:Pr(r,"type")}}}function TQ(n,e,t){return fa(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}const kQ="https://cdn.tldraw.com";function ol(){return`${kQ}/${CN}`}function AQ(n){switch(n.type){case"shapes":return`s${n.shapeIds.map(t=>ab(t.slice(6))).join(".")}`;case"page":return"p"+ab(Ds.parseId(n.pageId));case"viewport":{const{bounds:e,pageId:t}=n;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(r+="."+ab(Ds.parseId(t))),r}default:Pr(n)}}function RQ(n){switch(n[0]){case"s":return{type:"shapes",shapeIds:n.slice(1).split(".").filter(Boolean).map(r=>wn(decodeURIComponent(r)))};case"p":return{type:"page",pageId:Ds.createId(decodeURIComponent(n.slice(1)))};case"v":{const[t,r,i,s,o]=n.slice(1).split(".");return{type:"viewport",bounds:new De(Number(t),Number(r),Number(i),Number(s)),pageId:o?Ds.createId(decodeURIComponent(o)):void 0}}default:throw Error("Invalid deep link string")}}function ab(n){return encodeURIComponent(n).replace(/\./g,"%2E")}function jQ(n,e){var i;let t=n;const r=new Set(e);for(;r.has(t);)t=(i=/^.*(\d+)$/.exec(t))!=null&&i[1]?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function Em(n,e,t,r){if(t.length===0)return[];const i=new Map;for(const o of St(t.map(a=>n.getShape(a)))){const{parentId:a}=o;i.has(a)||i.set(a,{children:St(n.getSortedChildIdsForParent(a).map(c=>n.getShape(c))),moving:new Set}),i.get(a).moving.add(o)}const s=[];switch(e){case"toBack":{i.forEach(({moving:o,children:a})=>DQ(o,a,s));break}case"toFront":{i.forEach(({moving:o,children:a})=>OQ(o,a,s));break}case"forward":{i.forEach(({moving:o,children:a})=>LQ(n,o,a,s,r));break}case"backward":{i.forEach(({moving:o,children:a})=>NQ(n,o,a,s,r));break}}return s}function DQ(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let o=0;o<r;o++){const a=e[o];if(n.has(a))i=a.index,n.delete(a);else{s=a.index;break}}if(n.size!==0){const o=lh(i,s,n.size);t.push(...Array.from(n.values()).sort(_i).map((a,c)=>({...a,index:o[c]})))}}function OQ(n,e,t){const r=e.length;if(n.size===r)return;let i,s;for(let o=r-1;o>-1;o--){const a=e[o];if(n.has(a))s=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const o=lh(i,s,n.size);t.push(...Array.from(n.values()).sort(_i).map((a,c)=>({...a,index:o[c]})))}}function sj(n,e){const t=n.getShapeGeometry(e),r=n.getShapePageTransform(e);return!t||!r?null:r.applyToPoints(t.vertices)}function N5(n,e){const t=Array.from(e).map(i=>{const s=sj(n,i);return s?{shape:i,vertices:s}:null}).filter(Boolean);return i=>{const s=sj(n,i);return s?t.some(o=>l2(o.vertices,s)):!1}}function LQ(n,e,t,r,i){var c;const s=N5(n,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let u=0;u<o;u++){const d=e.has(t[u]);switch(a.name){case"skipping":{if(!d)continue;a={name:"selecting",selectIndex:u};break}case"selecting":{if(d||!(i!=null&&i.considerAllShapes)&&!s(t[u]))continue;const{selectIndex:f}=a;lh(t[u].index,(c=t[u+1])==null?void 0:c.index,u-f).forEach((g,m)=>{const v=t[f+m];e.has(v)&&r.push({...v,index:g})}),a={name:"skipping"};break}}}}function NQ(n,e,t,r,i){var c;const s=N5(n,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let u=o-1;u>-1;u--){const d=e.has(t[u]);switch(a.name){case"skipping":{if(!d)continue;a={name:"selecting",selectIndex:u};break}case"selecting":{if(d||!(i!=null&&i.considerAllShapes)&&!s(t[u]))continue;lh((c=t[u-1])==null?void 0:c.index,t[u].index,a.selectIndex-u).forEach((f,g)=>{const m=t[u+g+1];e.has(m)&&r.push({...m,index:f})}),a={name:"skipping"};break}}}}function B5({editor:n,ids:e}){const t=St(e.map(o=>n.getShape(o))),r=n.getShapesSharedRotation(e),i=n.getShapesRotatedPageBounds(e);if(!i)return null;const s=i.center.clone().rotWith(i.point,r);return{pageCenter:s,initialCursorAngle:s.angle(n.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:t.map(o=>({shape:o,initialPagePoint:n.getShapePageTransform(o.id).point()}))}}function hy({delta:n,editor:e,snapshot:t,stage:r,centerOverride:i}){const{pageCenter:s,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:c,initialPagePoint:u})=>{const d=is(c.parentId)?e.getShapePageTransform(c.parentId):Re.Identity(),f=T.RotWith(u,i??s,n),g=Re.applyToPoint(Re.Inverse(d),f),m=vu(c.rotation+n);return{id:c.id,type:c.type,x:g.x,y:g.y,rotation:m}}));const a=[];o.forEach(({shape:c})=>{var g,m,v;const u=e.getShape(c.id);if(!u)return;const d=e.getShapeUtil(c);if(r==="start"||r==="one-off"){const w=(g=d.onRotateStart)==null?void 0:g.call(d,c);w&&a.push(w)}const f=(m=d.onRotate)==null?void 0:m.call(d,c,u);if(f&&a.push(f),r==="end"||r==="one-off"){const w=(v=d.onRotateEnd)==null?void 0:v.call(d,c,u);w&&a.push(w)}}),a.length>0&&e.updateShapes(a)}const BQ=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),r=e.query.records("binding");function i(){const s=r.get(),o=new Map;for(const a of s){const{fromId:c,toId:u}=a,d=o.get(c);d?d.push(a):o.set(c,[a]);const f=o.get(u);f?f.push(a):o.set(u,[a])}return o}return Ie("arrowBindingsIndex",(s,o)=>{if(yu(s))return i();const a=s,c=t.getDiffSince(o);if(c===Ts)return i();let u;function d(m){u??(u=new Map(a));const v=u.get(m.fromId),w=v==null?void 0:v.filter(x=>x.id!==m.id);w!=null&&w.length?u.set(m.fromId,w):u.delete(m.fromId);const S=u.get(m.toId),b=S==null?void 0:S.filter(x=>x.id!==m.id);b!=null&&b.length?u.set(m.toId,b):u.delete(m.toId)}function f(m){u??(u=new Map(a));let v=u.get(m);return v?v===a.get(m)&&(v=v.slice(0),u.set(m,v)):(v=[],u.set(m,v)),v}function g(m){f(m.fromId).push(m),f(m.toId).push(m)}for(const m of c){for(const v of Vn(m.added))g(v);for(const[v,w]of Vn(m.updated))d(v),g(w);for(const v of Vn(m.removed))d(v)}return u??a})};function FQ(n,e,t){const r=n.getShapeMaskedPageBounds(e);return r===void 0?!0:!t.includes(r)}const zQ=n=>{function e(t){const r=t.getCurrentPageShapeIds(),i=t.getViewportPageBounds(),s=new Set;return r.forEach(o=>{FQ(t,o,i)&&s.add(o)}),s}return Ie("getCulledShapes",t=>{if(yu(t))return e(n);const r=e(n);if(t.size!==r.size)return r;for(const i of t)if(!r.has(i))return r;return t})},UQ=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function r(){const i={},s=e.get(),o=Array(s.size);return s.forEach(a=>o.push(n.get(a))),o.sort(_i),o.forEach(a=>{i[a.parentId]||(i[a.parentId]=[]),i[a.parentId].push(a.id)}),i}return Ie("parentsToChildrenWithIndexes",(i,s)=>{if(yu(i))return r();const o=t.getDiffSince(s);if(o===Ts)return r();if(o.length===0)return i;let a=null;const c=f=>{a||(a={...i}),a[f]?a[f]===i[f]&&(a[f]=[...a[f]]):a[f]=[]},u=new Set;let d;for(let f=0,g=o.length;f<g;f++){d=o[f];for(const m of Object.values(d.added))$d(m)&&(c(m.parentId),a[m.parentId].push(m.id),u.add(a[m.parentId]));for(const[m,v]of Object.values(d.updated))if($d(v)&&$d(m)){if(m.parentId!==v.parentId)c(m.parentId),c(v.parentId),a[m.parentId].splice(a[m.parentId].indexOf(v.id),1),a[v.parentId].push(v.id),u.add(a[v.parentId]);else if(m.index!==v.index){c(v.parentId);const w=a[v.parentId].indexOf(v.id);a[v.parentId][w]=v.id,u.add(a[v.parentId])}}for(const m of Object.values(d.removed))$d(m)&&(c(m.parentId),a[m.parentId].splice(a[m.parentId].indexOf(m.id),1))}for(const f of u){const g=St(f.map(m=>n.get(m)));g.sort(_i),f.splice(0,f.length,...g.map(m=>m.id))}return a??i})},cb=(n,e,t)=>{for(;!es(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},$Q=(n,e)=>{const t=n.query.ids("shape");let r=null;function i(){const s=e();return r=s,new Set([...t.get()].filter(o=>cb(n,s,n.get(o))))}return Ie("_shapeIdsInCurrentPage",(s,o)=>{if(yu(s))return i();const a=e();if(a!==r)return i();const c=n.history.getDiffSince(o);if(c===Ts)return i();const u=new ay(s);for(const f of c){for(const g of Object.values(f.added))$d(g)&&cb(n,a,g)&&u.add(g.id);for(const[g,m]of Object.values(f.updated))$d(m)&&(cb(n,a,m)?u.add(m.id):u.remove(m.id));for(const g of Object.keys(f.removed))is(g)&&u.remove(g)}const d=u.get();return d?Uf(d.value,d.diff):s})};var HQ=Object.create,F5=Object.defineProperty,WQ=Object.getOwnPropertyDescriptor,KQ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),z5=n=>{throw TypeError(n)},U5=(n,e,t)=>e in n?F5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qQ=n=>[,,,HQ(null)],$5=["class","method","getter","setter","accessor","field","value","get","set"],H5=n=>n!==void 0&&typeof n!="function"?z5("Function expected"):n,GQ=(n,e,t,r,i)=>({kind:$5[n],name:e,metadata:r,addInitializer:s=>t._?z5("Already initialized"):i.push(H5(s||null))}),VQ=(n,e)=>U5(e,KQ("metadata"),n[3]),YQ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},W5=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=$5[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,WQ(i,t)),b=r.length-1;b>=0;b--)c=GQ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,H5(o)&&(S[v]=o);return S&&F5(i,t,S),i},Pd=(n,e,t)=>U5(n,typeof e!="symbol"?e+"":e,t),K5,q5,Zp;const XQ=40;q5=[ls],K5=[ls];class fw{constructor(e){this.editor=e,YQ(Zp,5,this),Pd(this,"_clickId",""),Pd(this,"_clickTimeout"),Pd(this,"_clickScreenPoint"),Pd(this,"_previousScreenPoint"),Pd(this,"_clickState","idle"),Pd(this,"lastPointerInfo",{})}_getClickTimeout(e,t=Jt()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._previousScreenPoint&&T.Dist2(this._previousScreenPoint,this._clickScreenPoint)>XQ**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=T.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&T.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}Zp=qQ();W5(Zp,1,"_getClickTimeout",q5,fw);W5(Zp,1,"cancelDoubleClickTimeout",K5,fw);VQ(Zp,fw);class ZQ{constructor(e){G(this,"_isEdgeScrolling",!1);G(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const i=t.options.edgeScrollEaseDuration>0?Or.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*i,y:r.y*i})}}getEdgeProximityFactors(e,t,r,i,s){const{editor:o}=this,a=o.options.edgeScrollDistance,c=r?o.options.coarsePointerWidth:0,u=e-c,d=e+c,f=i?0:a,g=s?t:t-a;return u<f?Math.min(1,(f-u)/a):d>g?-Math.min(1,(d-g)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:r}}}=e,i=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[o,a,c,u]}=e.getInstanceState(),d=this.getEdgeProximityFactors(t,i.w,s,u,a),f=this.getEdgeProximityFactors(r,i.h,s,o,c);return{x:d,y:f}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=t.getViewportScreenBounds(),i=r.w<1e3?.612:1,s=r.h<1e3?.612:1,o=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,c=a*e.x*i/o,u=a*e.y*s/o,{x:d,y:f,z:g}=t.getCamera();t.setCamera(new T(d+c,f+u,g))}}class QQ{constructor(e,t){G(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(i,s)=>{i.isFocused!==s.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;t!==r&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function Cf(n){return eJ}class JQ{constructor(){G(this,"length",0);G(this,"head",null);G(this,"tail",this)}push(e){return new g2(e,this)}toArray(){return ic}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const eJ=new JQ;class g2{constructor(e,t){G(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new g2(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class tJ{constructor(e){G(this,"store");G(this,"dispose");G(this,"state","recording");G(this,"pendingDiff",new rJ);G(this,"stacks",cr("HistoryManager.stacks",{undos:Cf(),redos:Cf()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));G(this,"annotateError");G(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??dp,this.dispose=this.store.addHistoryInterceptor((t,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:i})=>({undos:i,redos:Cf()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:Pr(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const r=this.state;r!=="paused"&&(t!=null&&t.history)&&(this.state=nJ[t.history]);try{if(this._isInBatch)return Js(e),this;this._isInBatch=!0;try{Js(e)}catch(i){throw this.annotateError(i),i}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:t=void 0}){var i;const r=this.state;this.state="paused";try{let{undos:s,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),c=BL(a),u=gp(a);e&&!c&&(o=o.push({type:"diff",diff:a}));let d=!1;if(c)for(;((i=s.head)==null?void 0:i.type)==="stop";){const f=s.head;if(s=s.tail,e&&(o=o.push(f)),f.id===t){d=!0;break}}if(!d)e:for(;s.head;){const f=s.head;switch(s=s.tail,e&&(o=o.push(f)),f.type){case"diff":tp(u,[gp(f.diff)]);break;case"stop":if(!t)break e;if(f.id===t){d=!0;break e}break;default:Pr(f)}}if(!d&&t)return this;this.store.applyDiff(u,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:o})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:i}=this.stacks.get();if(i.length===0)return this;for(;((t=i.head)==null?void 0:t.type)==="stop";)r=r.push(i.head),i=i.tail;const s=t0();for(;i.head;){const o=i.head;if(r=r.push(o),i=i.tail,o.type==="diff")tp(s,[o.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:i})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var s;let t=this.stacks.get().undos;const r=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&r.push(t.head.diff),t=t.tail;if(!t.head||((s=t.head)==null?void 0:s.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const i=t0();return tp(i,r.reverse()),this.stacks.update(({redos:o})=>({undos:t.push({type:"diff",diff:i}),redos:o})),this}_mark(e){Js(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:Cf(),redos:Cf()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const nJ={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class rJ{constructor(){G(this,"diff",t0());G(this,"isEmptyAtom",cr("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=t0(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){tp(this.diff,[e]),this.isEmptyAtom.set(BL(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class iJ{constructor(e){G(this,"scribbleItems",new Map);G(this,"state","paused");this.editor=e}addScribble(e,t=Jt()){const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,r,i=.5){const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:o}=s,a={x:t,y:r,z:i};return(!o||T.Dist(o,a)>=1)&&(s.next=a),s}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:c,prev:u}=t;c&&c!==u&&(t.prev=c,t.scribble.points.push(c)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:i,prev:s,next:o,scribble:a}=t;switch(a.state){case"active":{o&&o!==s?(t.prev=o,a.points.push(o),r===0&&a.points.length>8&&a.points.shift()):i===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&i===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var sJ=Object.create,G5=Object.defineProperty,oJ=Object.getOwnPropertyDescriptor,aJ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),V5=n=>{throw TypeError(n)},Y5=(n,e,t)=>e in n?G5(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,cJ=n=>[,,,sJ(null)],X5=["class","method","getter","setter","accessor","field","value","get","set"],Z5=n=>n!==void 0&&typeof n!="function"?V5("Function expected"):n,lJ=(n,e,t,r,i)=>({kind:X5[n],name:e,metadata:r,addInitializer:s=>t._?V5("Already initialized"):i.push(Z5(s||null))}),uJ=(n,e)=>Y5(e,aJ("metadata"),n[3]),dJ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},pw=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=X5[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,oJ(i,t)),b=r.length-1;b>=0;b--)c=lJ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,Z5(o)&&(S[v]=o);return S&&G5(i,t,S),i},hJ=(n,e,t)=>Y5(n,e+"",t),Q5,J5,e6,t6,Uu;const pt=n=>Math.round(n*10**8)/10**8;function Ka(n,e,t,r,i){const s=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&pt(a.length)===pt(t)&&So(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));if(s.length===0)return[];const o=new Set;return s.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!o.has(c)){o.add(c);const u=Ka(n,c,t,r,So(a.breadthIntersection[0],a.breadthIntersection[1],i[0],i[1]));s.push(...u)}}),s}function fJ(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const i=n[r];if(i.direction===t.direction&&t.gaps.every(s=>i.gaps.some(o=>pt(s.startEdge[0].x)===pt(o.startEdge[0].x)&&pt(s.startEdge[0].y)===pt(o.startEdge[0].y)&&pt(s.startEdge[1].x)===pt(o.startEdge[1].x)&&pt(s.startEdge[1].y)===pt(o.startEdge[1].y))&&i.gaps.some(o=>pt(s.endEdge[0].x)===pt(o.endEdge[0].x)&&pt(s.endEdge[0].y)===pt(o.endEdge[0].y)&&pt(s.endEdge[1].x)===pt(o.endEdge[1].x)&&pt(s.endEdge[1].y)===pt(o.endEdge[1].y)))){n.splice(e,1);break}}}}t6=[Ie],e6=[Ie],J5=[Ie],Q5=[Ie];class Ah{constructor(e){this.manager=e,dJ(Uu,5,this),hJ(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);if(!r)return;const s=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!r||!s))return s.map((o,a)=>{const{x:c,y:u}=Re.applyToPoint(r,o);return{x:c,y:u,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),r=[];for(const i of t){const s=e.get(i);s&&r.push(...s)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:ss(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let r,i;const s=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<s.length;a++){r=s[a];for(let c=a+1;c<s.length;c++)i=s[c],r.pageBounds.maxX<i.pageBounds.minX&&Ef(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)&&e.push({startNode:r,endNode:i,startEdge:[new T(r.pageBounds.maxX,r.pageBounds.minY),new T(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.minX,i.pageBounds.maxY)],length:i.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:So(r.pageBounds.minY,r.pageBounds.maxY,i.pageBounds.minY,i.pageBounds.maxY)})}const o=s.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<o.length;a++){r=o[a];for(let c=a+1;c<o.length;c++)i=o[c],r.pageBounds.maxY<i.pageBounds.minY&&Ef(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)&&t.push({startNode:r,endNode:i,startEdge:[new T(r.pageBounds.minX,r.pageBounds.maxY),new T(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new T(i.pageBounds.minX,i.pageBounds.minY),new T(i.pageBounds.maxX,i.pageBounds.minY)],length:i.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:So(r.pageBounds.minX,r.pageBounds.maxX,i.pageBounds.minX,i.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:i}){var S,b;const s=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(i),c=r.map(({x,y:E},M)=>({id:"selection:"+M,x:x+i.x,y:E+i.y})),u=o,d=[],f=[],g=new T(s,s);this.collectPointSnaps({minOffset:g,nearestSnapsX:d,nearestSnapsY:f,otherNodeSnapPoints:u,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:f,minOffset:g});const m=new T(e==="x"?0:((S=d[0])==null?void 0:S.nudge)??0,e==="y"?0:((b=f[0])==null?void 0:b.nudge)??0);g.x=0,g.y=0,d.length=0,f.length=0,c.forEach(x=>{x.x+=m.x,x.y+=m.y}),a.translate(m),this.collectPointSnaps({minOffset:g,nearestSnapsX:d,nearestSnapsY:f,otherNodeSnapPoints:u,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:f,minOffset:g});const v=this.getPointSnapLines({nearestSnapsX:d,nearestSnapsY:f}),w=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:d,nearestSnapsY:f});return this.manager.setIndicators([...w,...v]),{nudge:m}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:i,isResizingFromCenter:s}){var H,L;const o=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:u}=De.Resize(e,r,s?t.x*2:t.x,s?t.y*2:t.y,i);let d=r;c<0&&(d=xX(d)),u<0&&(d=SX(d)),s&&(a.center=e.center);const f=d==="top"||d==="bottom",g=d==="left"||d==="right",m=oj(d,a),v=this.getSnappablePoints(),w=[],S=[],b=new T(o,o);this.collectPointSnaps({minOffset:b,nearestSnapsX:w,nearestSnapsY:S,otherNodeSnapPoints:v,selectionSnapPoints:m});const x=new T(f?0:((H=w[0])==null?void 0:H.nudge)??0,g?0:((L=S[0])==null?void 0:L.nudge)??0);if(i&&bX(d)&&x.len()!==0){const U=w.length&&S.length?Math.abs(x.x)<Math.abs(x.y)?"x":"y":w.length?"x":"y",z=e.aspectRatio;U==="x"?(S.length=0,x.y=x.x/z,(d==="bottom_left"||d==="top_right")&&(x.y=-x.y)):(w.length=0,x.x=x.y*z,(d==="bottom_left"||d==="top_right")&&(x.x=-x.x))}const E=T.Add(t,x),{box:M}=De.Resize(e,r,s?E.x*2:E.x,s?E.y*2:E.y,i);s&&(M.center=e.center);const j=oj("any",M);w.length=0,S.length=0,b.x=0,b.y=0,this.collectPointSnaps({minOffset:b,nearestSnapsX:w,nearestSnapsY:S,otherNodeSnapPoints:v,selectionSnapPoints:j});const D=this.getPointSnapLines({nearestSnapsX:w,nearestSnapsY:S});return this.manager.setIndicators([...D]),{nudge:x}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:i,nearestSnapsY:s}){for(const o of e)for(const a of t){const c=T.Sub(o,a),u=Math.abs(c.x),d=Math.abs(c.y);pt(u)<=pt(r.x)&&(pt(u)<pt(r.x)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),r.x=u),pt(d)<=pt(r.y)&&(pt(d)<pt(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),r.y=d)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:i}){const{horizontal:s,vertical:o}=this.getVisibleGaps();for(const a of s){if(!Ef(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const u=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&pt(Math.abs(u))<=pt(t.x)){pt(Math.abs(u))<pt(t.x)&&(r.length=0),t.x=Math.abs(u);const b={type:"gap_center",gap:a,nudge:u},x=r.find(({type:M})=>M==="gap_center"),E=x&&So(a.breadthIntersection[0],a.breadthIntersection[1],x.gap.breadthIntersection[0],x.gap.breadthIntersection[1]);x&&x.gap.length>a.length&&E?r[r.indexOf(x)]=b:(!x||!E)&&r.push(b)}const f=a.startNode.pageBounds.minX-a.length,g=e.maxX,m=f-g;pt(Math.abs(m))<=pt(t.x)&&(pt(Math.abs(m))<pt(t.x)&&(r.length=0),t.x=Math.abs(m),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:m}));const v=a.endNode.pageBounds.maxX+a.length,w=e.minX,S=v-w;pt(Math.abs(S))<=pt(t.x)&&(pt(Math.abs(S))<pt(t.x)&&(r.length=0),t.x=Math.abs(S),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:S}))}for(const a of o){if(!Ef(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const u=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&pt(Math.abs(u))<=pt(t.y)){pt(Math.abs(u))<pt(t.y)&&(i.length=0),t.y=Math.abs(u);const b={type:"gap_center",gap:a,nudge:u},x=i.find(({type:M})=>M==="gap_center"),E=x&&Ef(x.gap.breadthIntersection[0],x.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);x&&x.gap.length>a.length&&E?i[i.indexOf(x)]=b:(!x||!E)&&i.push(b);continue}const f=a.startNode.pageBounds.minY-a.length,g=e.maxY,m=f-g;pt(Math.abs(m))<=pt(t.y)&&(pt(Math.abs(m))<pt(t.y)&&(i.length=0),t.y=Math.abs(m),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:m}));const v=a.endNode.pageBounds.maxY+a.length,w=e.minY,S=v-w;pt(Math.abs(S))<=pt(t.y)&&(pt(Math.abs(S))<pt(t.y)&&(i.length=0),t.y=Math.abs(S),i.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:S}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},i={};if(e.length>0){for(const s of e)if(s.type==="points"){const o=pt(s.points.otherPoint.x);r[o]||(r[o]=[]),r[o].push(s.points)}}if(t.length>0){for(const s of t)if(s.type==="points"){const o=pt(s.points.otherPoint.y);i[o]||(i[o]=[]),i[o].push(s.points)}}return Object.values(r).concat(Object.values(i)).map(s=>({id:Jt(),type:"points",points:dC(s.map(o=>T.From(o.otherPoint)).concat(s.map(o=>T.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:i,horizontal:s}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const c of t){if(c.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:d,startNode:f,endNode:g,length:m,endEdge:v}}=c;switch(c.type){case"gap_center":{const w=(m-e.width)/2,S=So(u[0],u[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Jt(),gaps:[...Ka(s,f.id,w,"backward",S),{startEdge:d,endEdge:o.left},{startEdge:o.right,endEdge:v},...Ka(s,g.id,w,"forward",S)]});break}case"gap_duplicate":{const w=So(u[0],u[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Jt(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:d.map(S=>S.clone().addXY(-f.pageBounds.width,0))},{startEdge:d,endEdge:v},...Ka(s,g.id,m,"forward",w)]:[...Ka(s,f.id,m,"backward",w),{startEdge:d,endEdge:v},{startEdge:v.map(S=>S.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:d,startNode:f,endNode:g,length:m,endEdge:v}}=c;switch(c.type){case"gap_center":{const w=(m-e.height)/2,S=So(u[0],u[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Jt(),gaps:[...Ka(i,f.id,w,"backward",S),{startEdge:d,endEdge:o.top},{startEdge:o.bottom,endEdge:v},...Ka(i,c.gap.endNode.id,w,"forward",S)]});break}case"gap_duplicate":{const w=So(u[0],u[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Jt(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:d.map(S=>S.clone().addXY(0,-f.pageBounds.height))},{startEdge:d,endEdge:v},...Ka(i,g.id,m,"forward",w)]:[...Ka(i,f.id,m,"backward",w),{startEdge:d,endEdge:v},{startEdge:v.map(S=>S.clone().addXY(0,g.pageBounds.height)),endEdge:o.top}]})}break}}return fJ(a),a}}Uu=cJ();pw(Uu,1,"getSnapPointsCache",t6,Ah);pw(Uu,1,"getSnappablePoints",e6,Ah);pw(Uu,1,"getSnappableGapNodes",J5,Ah);pw(Uu,1,"getVisibleGaps",Q5,Ah);uJ(Uu,Ah);function oj(n,e){const{minX:t,maxX:r,minY:i,maxY:s}=e,o=[];switch(n){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:t,y:i})}switch(n){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(n){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(n){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:t,y:s})}return o}var pJ=Object.create,n6=Object.defineProperty,gJ=Object.getOwnPropertyDescriptor,mJ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),r6=n=>{throw TypeError(n)},i6=(n,e,t)=>e in n?n6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,yJ=n=>[,,,pJ(null)],s6=["class","method","getter","setter","accessor","field","value","get","set"],o6=n=>n!==void 0&&typeof n!="function"?r6("Function expected"):n,wJ=(n,e,t,r,i)=>({kind:s6[n],name:e,metadata:r,addInitializer:s=>t._?r6("Already initialized"):i.push(o6(s||null))}),vJ=(n,e)=>i6(e,mJ("metadata"),n[3]),SJ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},xJ=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=s6[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,gJ(i,t)),b=r.length-1;b>=0;b--)c=wJ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,o6(o)&&(S[v]=o);return S&&n6(i,t,S),i},bJ=(n,e,t)=>i6(n,e+"",t),a6,gw;const _J=()=>null,IJ=()=>[];a6=[Ie];class m2{constructor(e){this.manager=e,SJ(gw,5,this),bJ(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const r=e.getShapeUtil(t).getHandleSnapGeometry(t),i=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):_J,s=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):IJ;return{outline:r.outline===void 0?e.getShapeGeometry(t):r.outline,points:r.points??[],getSelfSnapOutline:i,getSelfSnapPoints:s}})}*iterateSnapPointsInPageSpace(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapPoints(t);if(r&&r.length){const o=ss(this.editor.getShapePageTransform(e));for(const a of r)yield o.applyToPoint(a)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.points;if(!a||!a.length)continue;const c=ss(this.editor.getShapePageTransform(o));for(const u of a)yield c.applyToPoint(u)}}*iterateSnapOutlines(e,t){var i,s;const r=(i=this.getSnapGeometryCache().get(e))==null?void 0:i.getSelfSnapOutline(t);r&&(yield{shapeId:e,outline:r});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(s=this.getSnapGeometryCache().get(o))==null?void 0:s.outline;a&&(yield{shapeId:o,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r}){const i=this.manager.getSnapThreshold();let s=i,o=null;for(const u of this.iterateSnapPointsInPageSpace(e,t))T.DistMin(r,u,s)&&(s=T.Dist(r,u),o=u);if(o)return o;let a=i,c=null;for(const{shapeId:u,outline:d}of this.iterateSnapOutlines(e,t)){const f=ss(this.editor.getShapePageTransform(u)),g=this.editor.getPointInShapeSpace(u,r),m=d.nearestPoint(g),v=f.applyToPoint(m);T.DistMin(r,v,a)&&(a=T.Dist(r,v),c=v)}return c||null}snapHandle({currentShapeId:e,handle:t}){const i=ss(this.editor.getShapePageTransform(e)).applyToPoint(t),s=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:i});return s?(this.manager.setIndicators([{id:Jt(),type:"points",points:[s]}]),{nudge:T.Sub(s,i)}):null}}gw=yJ();xJ(gw,1,"getSnapGeometryCache",a6,m2);vJ(gw,m2);var EJ=Object.create,c6=Object.defineProperty,CJ=Object.getOwnPropertyDescriptor,PJ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),l6=n=>{throw TypeError(n)},u6=(n,e,t)=>e in n?c6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,MJ=n=>[,,,EJ(null)],d6=["class","method","getter","setter","accessor","field","value","get","set"],h6=n=>n!==void 0&&typeof n!="function"?l6("Function expected"):n,TJ=(n,e,t,r,i)=>({kind:d6[n],name:e,metadata:r,addInitializer:s=>t._?l6("Already initialized"):i.push(h6(s||null))}),kJ=(n,e)=>u6(e,PJ("metadata"),n[3]),AJ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},y2=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=d6[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,CJ(i,t)),b=r.length-1;b>=0;b--)c=TJ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,h6(o)&&(S[v]=o);return S&&c6(i,t,S),i},lb=(n,e,t)=>u6(n,typeof e!="symbol"?e+"":e,t),f6,p6,g6,Rh;g6=[Ie],p6=[Ie],f6=[Ie];class Qp{constructor(e){this.editor=e,AJ(Rh,5,this),lb(this,"shapeBounds"),lb(this,"handles"),lb(this,"_snapIndicators",cr("snapLines",void 0)),this.shapeBounds=new Ah(this),this.handles=new m2(this)}getIndicators(){return this._snapIndicators.get()??ic}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),i=new Set,s=o=>{if(is(o)){const c=e.getShape(o);c&&e.isShapeOfType(c,"frame")&&i.add(o)}const a=e.getSortedChildIdsForParent(o);for(const c of a){if(r.includes(c))continue;const u=e.getShape(c);if(!u||!e.getShapeUtil(u).canSnap(u))continue;const f=e.getShapePageBounds(c);if(f&&t.includes(f)){if(e.isShapeOfType(u,"group")){s(c);continue}i.add(c)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),i}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Rh=MJ();y2(Rh,1,"getSnapThreshold",g6,Qp);y2(Rh,1,"getSnappableShapes",p6,Qp);y2(Rh,1,"getCurrentCommonAncestor",f6,Qp);kJ(Rh,Qp);const RJ=/\r?\n|\r/g;function aj(n){return n.replace(RJ,`
`).split(`
`).map(e=>e||" ").join(`
`)}const jJ={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},DJ=/\s/;class OJ{constructor(e){G(this,"baseElm");this.editor=e;const t=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,t.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}measureText(e,t){var o;const r=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),r.style.setProperty("padding",t.padding),r.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=aj(e);const i=r.scrollWidth,s=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:s.width,h:s.height,scrollWidth:i}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],i=e.getBoundingClientRect(),s=-i.left,o=-i.top,a=new Range,c=e.childNodes[0];let u=0,d=null,f=null,g=0,m=0,v=!1;for(const w of e.childNodes)if(w.nodeType===Node.TEXT_NODE)for(const S of w.textContent??""){a.setStart(c,u),a.setEnd(c,u+S.length);const b=a.getClientRects(),x=b[b.length-1],E=x.top+o,M=x.left+s,j=x.right+s,D=M<m,H=DJ.test(S);if(H!==f||E!==g||!d){if(d){if(t&&E!==g){v=!0;break}r.push(d)}d={box:{x:M,y:E,w:x.width,h:x.height},text:S},m=M}else D&&(d.box.x=M),d.box.w=D?d.box.w+x.width:j-d.box.x,d.text+=S;S===`
`&&(m=0),f=H,g=E,u+=S.length}return d&&r.push(d),{spans:r,didTruncate:v}}measureTextSpans(e,t){var u;if(e==="")return[];const r=(u=this.baseElm)==null?void 0:u.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const i=Math.ceil(t.width-t.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${i}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${t.fontSize}px`),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),r.style.setProperty("text-align",jJ[t.textAlign]);const s=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";s&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const o=aj(e);r.textContent=o;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:s});if(t.overflow==="truncate-ellipsis"&&c){r.textContent="";const d=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${i-d}px`),r.textContent=o;const f=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,g=f[f.length-1];return f.push({text:"",box:{x:Math.min(g.box.x+g.box.w,t.width-t.padding-d),y:g.box.y,w:d,h:g.box.h}}),f}return r.remove(),a}}var LJ=Object.create,m6=Object.defineProperty,NJ=Object.getOwnPropertyDescriptor,BJ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),y6=n=>{throw TypeError(n)},w6=(n,e,t)=>e in n?m6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,FJ=n=>[,,,LJ(null)],v6=["class","method","getter","setter","accessor","field","value","get","set"],S6=n=>n!==void 0&&typeof n!="function"?y6("Function expected"):n,zJ=(n,e,t,r,i)=>({kind:v6[n],name:e,metadata:r,addInitializer:s=>t._?y6("Already initialized"):i.push(S6(s||null))}),UJ=(n,e)=>w6(e,BJ("metadata"),n[3]),$J=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},x6=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=v6[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,NJ(i,t)),b=r.length-1;b>=0;b--)c=zJ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,S6(o)&&(S[v]=o);return S&&m6(i,t,S),i},Cm=(n,e,t)=>w6(n,typeof e!="symbol"?e+"":e,t),b6,_6,Jp;const cj=(typeof process<"u",J4);_6=[ls],b6=[ls];class mw{constructor(e){this.editor=e,$J(Jp,5,this),Cm(this,"cancelRaf"),Cm(this,"isPaused",!0),Cm(this,"now",0),Cm(this,"prevPoint",new T),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=cj(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=cj(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:i}}}=this;if(e===0)return;const s=T.Sub(r,t);this.prevPoint=r.clone();const o=s.len(),a=o?s.div(o):new T(0,0),c=i.clone().lrp(a.mul(o/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),i.equals(c)||(this.editor.inputs.pointerVelocity=c)}}Jp=FJ();x6(Jp,1,"tick",_6,mw);x6(Jp,1,"dispose",b6,mw);UJ(Jp,mw);var HJ=Object.create,I6=Object.defineProperty,WJ=Object.getOwnPropertyDescriptor,KJ=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),E6=n=>{throw TypeError(n)},C6=(n,e,t)=>e in n?I6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qJ=n=>[,,,HJ(null)],P6=["class","method","getter","setter","accessor","field","value","get","set"],M6=n=>n!==void 0&&typeof n!="function"?E6("Function expected"):n,GJ=(n,e,t,r,i)=>({kind:P6[n],name:e,metadata:r,addInitializer:s=>t._?E6("Already initialized"):i.push(M6(s||null))}),VJ=(n,e)=>C6(e,KJ("metadata"),n[3]),YJ=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},ro=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=P6[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,WJ(i,t)),b=r.length-1;b>=0;b--)c=GJ(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,M6(o)&&(S[v]=o);return S&&I6(i,t,S),i},lj=(n,e,t)=>C6(n,typeof e!="symbol"?e+"":e,t),T6,k6,A6,R6,j6,D6,O6,L6,N6,B6,F6,z6,Ui;z6=[Ie],F6=[Ie],B6=[Ie],N6=[Ie],L6=[Ie],O6=[Ie],D6=[Ie],j6=[Ie],R6=[Ie],A6=[Ie],k6=[Ie],T6=[Ie];class gs{constructor(e,t){if(this.user=e,this.inferDarkMode=t,YJ(Ui,5,this),lj(this,"systemColorScheme",cr("systemColorScheme","light")),lj(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark");const i=s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r==null||r.addEventListener("change",i),this.disposables.add(()=>r==null?void 0:r.removeEventListener("change",i))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??qs.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??qs.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??qs.name}getLocale(){return this.user.userPreferences.get().locale??qs.locale}getColor(){return this.user.userPreferences.get().color??qs.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??qs.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??qs.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??qs.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??qs.isPasteAtCursorMode}}Ui=qJ();ro(Ui,1,"getUserPreferences",z6,gs);ro(Ui,1,"getIsDarkMode",F6,gs);ro(Ui,1,"getEdgeScrollSpeed",B6,gs);ro(Ui,1,"getAnimationSpeed",N6,gs);ro(Ui,1,"getId",L6,gs);ro(Ui,1,"getName",O6,gs);ro(Ui,1,"getLocale",D6,gs);ro(Ui,1,"getColor",j6,gs);ro(Ui,1,"getIsSnapMode",R6,gs);ro(Ui,1,"getIsWrapMode",A6,gs);ro(Ui,1,"getIsDynamicResizeMode",k6,gs);ro(Ui,1,"getIsPasteAtCursorMode",T6,gs);VJ(Ui,gs);const XJ={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},ZJ=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Ye{constructor(e,t){G(this,"performanceTracker");G(this,"id");G(this,"type");G(this,"shapeType");G(this,"initial");G(this,"children");G(this,"isLockable");G(this,"parent");G(this,"_path");G(this,"_current");G(this,"_isActive");G(this,"_currentToolIdMask",cr("curent tool id mask",void 0));this.editor=e;const{id:r,children:i,initial:s,isLockable:o}=this.constructor;this.id=r,this._isActive=cr("toolIsActive"+this.id,!1),this._current=cr("toolState"+this.id,void 0),this._path=Ie("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=t??{},this.parent?i&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(i().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&s&&(this.initial=s,this.children=Object.fromEntries(i().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new j4}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,t={}){var s;const r=e.split(".");let i=this;for(let o=0;o<r.length;o++){const a=r[o],c=i.getCurrent(),u=(s=i.children)==null?void 0:s[a];if(!u)throw Error(`${i.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==u.id&&(c==null||c.exit(t,a),i._current.set(u),u.enter(t,(c==null?void 0:c.id)||"initial"),!u.getIsActive()))break;i=u}return this}handleEvent(e){var i;const t=XJ[e.name],r=this._current.__unsafe__getWithoutCapture();(i=this[t])==null||i.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,t){var r;if(mr.measurePerformance.get()&&ZJ.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const i=this.children[this.initial];this._current.set(i),i.enter(e,t)}}exit(e,t){var r,i;mr.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||(i=this.getCurrent())==null||i.exit(e,t)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}G(Ye,"id"),G(Ye,"initial"),G(Ye,"children"),G(Ye,"isLockable",!0);class HI extends Ye{static children(){return[]}onKeyDown(e){var t;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((t=r.getCurrent())==null?void 0:t.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}G(HI,"id","root"),G(HI,"initial","");var QJ=Object.create,U6=Object.defineProperty,JJ=Object.getOwnPropertyDescriptor,$6=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),H6=n=>{throw TypeError(n)},W6=(n,e,t)=>e in n?U6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,eee=n=>[,,,QJ((n==null?void 0:n[$6("metadata")])??null)],K6=["class","method","getter","setter","accessor","field","value","get","set"],q6=n=>n!==void 0&&typeof n!="function"?H6("Function expected"):n,tee=(n,e,t,r,i)=>({kind:K6[n],name:e,metadata:r,addInitializer:s=>t._?H6("Already initialized"):i.push(q6(s||null))}),nee=(n,e)=>W6(e,$6("metadata"),n[3]),ree=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},He=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=K6[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,JJ(i,t)),b=r.length-1;b>=0;b--)c=tee(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,q6(o)&&(S[v]=o);return S&&U6(i,t,S),i},ct=(n,e,t)=>W6(n,typeof e!="symbol"?e+"":e,t),G6,V6,Y6,X6,Z6,Q6,J6,e8,t8,n8,r8,i8,s8,o8,a8,c8,l8,u8,d8,h8,f8,p8,g8,m8,y8,w8,v8,S8,x8,b8,_8,I8,E8,C8,P8,M8,T8,k8,A8,R8,j8,D8,O8,L8,N8,B8,F8,z8,U8,$8,H8,W8,K8,q8,G8,V8,Y8,X8,Z8,Q8,J8,eB,tB,nB,rB,iB,sB,oB,aB,cB,lB,uB,WI,Ue;class Fe extends(WI=l5,uB=[Ie],lB=[Ie],cB=[Ie],aB=[Ie],oB=[Ie],sB=[Ie],iB=[Ie],rB=[Ie],nB=[Ie],tB=[Ie],eB=[Ie],J8=[Ie],Q8=[Ie],Z8=[Ie],X8=[Ie],Y8=[Ie],V8=[Ie],G8=[Ie],q8=[Ie],K8=[Ie],W8=[Ie],H8=[Ie],$8=[Ie],U8=[Ie],z8=[Ie],F8=[Ie],B8=[Ie],N8=[Ie],L8=[Ie],O8=[Ie],D8=[Ie],j8=[Ie],R8=[Ie],A8=[Ie],k8=[Ie],T8=[Ie],M8=[Ie],P8=[Ie],C8=[Ie],E8=[Ie],I8=[Ie],_8=[Ie],b8=[Ie],x8=[Ie],S8=[Ie],v8=[Ie],w8=[Ie],y8=[Ie],m8=[Ie],g8=[Ie],p8=[Ie],f8=[Ie],h8=[Ie],d8=[Ie],u8=[Ie],l8=[Ie],c8=[Ie],a8=[Ie],o8=[Ie],s8=[Ie],i8=[Ie],r8=[Ie],n8=[Ie],t8=[Ie],e8=[Ie({isEqual:(e,t)=>e.equals(t)})],J6=[Ie],Q6=[Ie],Z6=[Ie],X6=[ls],Y6=[ls],V6=[ls],G6=[ls],WI){constructor({store:e,user:t,shapeUtils:r,bindingUtils:i,tools:s,getContainer:o,cameraOptions:a,initialState:c,autoFocus:u,inferDarkMode:d,options:f,isShapeHidden:g}){var U;super(),ree(Ue,5,this),ct(this,"_isShapeHiddenPredicate"),ct(this,"options"),ct(this,"contextId",Jt()),ct(this,"store"),ct(this,"root"),ct(this,"disposables",new Set),ct(this,"isDisposed",!1),ct(this,"_tickManager"),ct(this,"snaps"),ct(this,"timers",UI.forContext(this.contextId)),ct(this,"user"),ct(this,"textMeasure"),ct(this,"environment",_n),ct(this,"scribbles"),ct(this,"sideEffects"),ct(this,"edgeScrollManager"),ct(this,"focusManager"),ct(this,"getContainer"),ct(this,"shapeUtils"),ct(this,"styleProps"),ct(this,"bindingUtils"),ct(this,"history"),ct(this,"_shouldIgnoreShapeLock",!1),ct(this,"_crashingError",null),ct(this,"_isChangingStyleTimeout",-1),ct(this,"menus",xo.forContext(this.contextId)),ct(this,"_cameraOptions",cr("camera options",P3)),ct(this,"_viewportAnimation",null),ct(this,"_willSetInitialBounds",!0),ct(this,"_isLockedOnFollowingUser",cr("isLockedOnFollowingUser",!1)),ct(this,"_cameraState",cr("camera state","idle")),ct(this,"_cameraStateTimeoutRemaining",0),ct(this,"_currentPageShapeIds"),ct(this,"_parentIdsToChildIds"),ct(this,"animatingShapes",new Map),ct(this,"externalAssetContentHandlers",{file:null,url:null}),ct(this,"temporaryAssetPreview",new Map),ct(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),ct(this,"inputs",{originPagePoint:new T,originScreenPoint:new T,previousPagePoint:new T,previousScreenPoint:new T,currentPagePoint:new T,currentScreenPoint:new T,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new T}),ct(this,"_clickManager",new fw(this)),ct(this,"_prevCursor","default"),ct(this,"_shiftKeyTimeout",-1),ct(this,"_altKeyTimeout",-1),ct(this,"_ctrlKeyTimeout",-1),ct(this,"_metaKeyTimeout",-1),ct(this,"_restoreToolId","select"),ct(this,"_pinchStart",1),ct(this,"_didPinch",!1),ct(this,"_selectedShapeIdsAtPointerDown",[]),ct(this,"_longPressTimeout",-1),ct(this,"capturedPointerId",null),ct(this,"performanceTracker"),ct(this,"performanceTrackerTimeout",-1),ct(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=g,this.options={...PQ,...f},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new tJ({store:e,annotateError:z=>{this.annotateError(z,{origin:"history.batch",willCrashApp:!0}),this.crash(z)}}),this.snaps=new Qp(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...P3,...a}),this.user=new gs(t??c5(),d??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=o,this.textMeasure=new OJ(this),this._tickManager=new mw(this);class m extends HI{}G(m,"initial",c??""),this.root=new m(this),this.root.children={};const v=m5(r),w={},S={},b=new Map;for(const z of v){const Y=new z(this);w[z.type]=Y;const V=HL(z.props??{});S[z.type]=V;for(const N of V.keys())if(!b.has(N.id))b.set(N.id,N);else if(b.get(N.id)!==N)throw Error(`Multiple style props with id "${N.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=w,this.styleProps=S;const x=p5(i),E={};for(const z of x){const Y=new z(this);E[z.type]=Y}this.bindingUtils=E;for(const z of[...s]){if(Mo(this.root.children,z.id))throw Error(`Can't override tool with id "${z.id}"`);this.root.children[z.id]=new z(this,this.root)}this.scribbles=new iJ(this);const M=(z,Y)=>{let V=null;const N=z.selectedShapeIds.filter(O=>!Y.has(O));N.length!==z.selectedShapeIds.length&&(V||(V={...z}),V.selectedShapeIds=N);const _=z.erasingShapeIds.filter(O=>!Y.has(O));_.length!==z.erasingShapeIds.length&&(V||(V={...z}),V.erasingShapeIds=_),z.hoveredShapeId&&Y.has(z.hoveredShapeId)&&(V||(V={...z}),V.hoveredShapeId=null),z.editingShapeId&&Y.has(z.editingShapeId)&&(V||(V={...z}),V.editingShapeId=null);const k=z.hintingShapeIds.filter(O=>!Y.has(O));return k.length!==z.hintingShapeIds.length&&(V||(V={...z}),V.hintingShapeIds=k),z.focusedGroupId&&Y.has(z.focusedGroupId)&&(V||(V={...z}),V.focusedGroupId=null),V};this.sideEffects=this.store.sideEffects;let j=new Map;const D=new Set,H=new Set;let L=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var z,Y,V,N;D.clear();for(const _ of H){H.delete(_);const k=this.getShape(_);if(!k)continue;const O=this.getShapeUtil(k),W=(z=O.onChildrenChange)==null?void 0:z.call(O,k);W!=null&&W.length&&this.updateShapes(W)}if(L.size){const _=L;L=new Set;for(const k of _){const O=this.getBindingUtil(k);(Y=O.onOperationComplete)==null||Y.call(O)}}if(j.size){const _=j;j=new Map;for(const k of _.values())(N=(V=this.getBindingUtil(k.binding)).onAfterDelete)==null||N.call(V,k)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(z,Y)=>{var V,N,_,k;for(const O of this.getBindingsInvolvingShape(Y))L.add(O.type),O.fromId===Y.id&&((N=(V=this.getBindingUtil(O)).onAfterChangeFromShape)==null||N.call(V,{binding:O,shapeBefore:z,shapeAfter:Y})),O.toId===Y.id&&((k=(_=this.getBindingUtil(O)).onAfterChangeToShape)==null||k.call(_,{binding:O,shapeBefore:z,shapeAfter:Y}));if(z.parentId!==Y.parentId){const O=W=>{var X,ne,$,C;const q=this.getShape(W);if(q)for(const R of this.getBindingsInvolvingShape(q))L.add(R.type),R.fromId===q.id&&((ne=(X=this.getBindingUtil(R)).onAfterChangeFromShape)==null||ne.call(X,{binding:R,shapeBefore:q,shapeAfter:q})),R.toId===q.id&&((C=($=this.getBindingUtil(R)).onAfterChangeToShape)==null||C.call($,{binding:R,shapeBefore:q,shapeAfter:q}))};O(Y.id),this.visitDescendants(Y.id,O)}if(z.parentId!==Y.parentId&&es(Y.parentId)){const O=new Set([z.id]);this.visitDescendants(z.id,W=>{O.add(W)});for(const W of this.getPageStates()){if(W.pageId===Y.parentId)continue;const q=M(W,O);q&&this.store.put([q])}}z.parentId&&is(z.parentId)&&H.add(z.parentId),Y.parentId!==z.parentId&&is(Y.parentId)&&H.add(Y.parentId)},beforeDelete:z=>{var _,k,O,W;if(D.has(z.id))return;z.parentId&&is(z.parentId)&&H.add(z.parentId),D.add(z.id);const Y=[];for(const q of this.getBindingsInvolvingShape(z)){L.add(q.type),Y.push(q.id);const X=this.getBindingUtil(q);q.fromId===z.id?((_=X.onBeforeIsolateToShape)==null||_.call(X,{binding:q,removedShape:z}),(k=X.onBeforeDeleteFromShape)==null||k.call(X,{binding:q,shape:z})):((O=X.onBeforeIsolateFromShape)==null||O.call(X,{binding:q,removedShape:z}),(W=X.onBeforeDeleteToShape)==null||W.call(X,{binding:q,shape:z}))}Y.length&&this.deleteBindings(Y);const V=new Set([z.id]),N=St(this.getPageStates().map(q=>M(q,V)));N.length&&this.store.put(N)}},binding:{beforeCreate:z=>{var V,N;const Y=(N=(V=this.getBindingUtil(z)).onBeforeCreate)==null?void 0:N.call(V,{binding:z});return Y||z},afterCreate:z=>{var Y,V;L.add(z.type),(V=(Y=this.getBindingUtil(z)).onAfterCreate)==null||V.call(Y,{binding:z})},beforeChange:(z,Y)=>{var N,_;const V=(_=(N=this.getBindingUtil(Y)).onBeforeChange)==null?void 0:_.call(N,{bindingBefore:z,bindingAfter:Y});return V||Y},afterChange:(z,Y)=>{var V,N;L.add(Y.type),(N=(V=this.getBindingUtil(Y)).onAfterChange)==null||N.call(V,{bindingBefore:z,bindingAfter:Y})},beforeDelete:z=>{var Y,V;(V=(Y=this.getBindingUtil(z)).onBeforeDelete)==null||V.call(Y,{binding:z})},afterDelete:z=>{var Y,V;(V=(Y=this.getBindingUtil(z)).onAfterDelete)==null||V.call(Y,{binding:z}),L.add(z.type)}},page:{afterCreate:z=>{const Y=Eo.createId(z.id),V=Zs.createId(z.id);this.store.has(Y)||this.store.put([Eo.create({id:Y})]),this.store.has(V)||this.store.put([Zs.create({id:V,pageId:z.id})])},afterDelete:(z,Y)=>{var _,k;if(((_=this.getInstanceState())==null?void 0:_.currentPageId)===z.id){const O=(k=this.getPages().find(W=>W.id!==z.id))==null?void 0:k.id;O?this.store.put([{...this.getInstanceState(),currentPageId:O}]):Y==="user"&&this.store.ensureStoreIsUsable()}const V=Eo.createId(z.id),N=Zs.createId(z.id);this.store.remove([V,N])}},instance:{afterChange:(z,Y,V)=>{var N;if(!this.store.has(Y.currentPageId)){const _=this.store.has(z.currentPageId)?z.currentPageId:(N=this.getPages()[0])==null?void 0:N.id;_?this.store.update(Y.id,k=>({...k,currentPageId:_})):V==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(z,Y)=>{if((z==null?void 0:z.selectedShapeIds)!==(Y==null?void 0:Y.selectedShapeIds)){const V=Y.selectedShapeIds.filter(_=>{var O,W;let k=(O=this.getShape(_))==null?void 0:O.parentId;for(;is(k);){if(Y.selectedShapeIds.includes(k))return!1;k=(W=this.getShape(k))==null?void 0:W.parentId}return!0});let N=null;if(V.length>0){const _=this.findCommonAncestor(St(V.map(k=>this.getShape(k))),k=>this.isShapeOfType(k,"group"));_&&(N=_)}else Y!=null&&Y.focusedGroupId&&(N=Y.focusedGroupId);(V.length!==Y.selectedShapeIds.length||N!==Y.focusedGroupId)&&this.store.put([{...Y,selectedShapeIds:V,focusedGroupId:N??null}])}}}})),this._currentPageShapeIds=$Q(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=UQ(this.store),this.disposables.add(this.store.listen(z=>{this.emit("change",z)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new ZQ(this),this.focusManager=new QQ(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new j4,(U=this.store.props.collaboration)!=null&&U.mode){const z=this.store.props.collaboration.mode;this.disposables.add(To("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:z.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,r=>this.isShapeHidden(r))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,r=Ei(this.shapeUtils,t);return bt(r,`No shape util found for type "${t}"`),r}getBindingUtil(e){const t=typeof e=="string"?e:e.type,r=Ei(this.bindingUtils,t);return bt(r,`No binding util found for type "${t}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??Jt()),this}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${Jt()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(t==null?void 0:t.ignoreShapeLock)??r;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:r,tags:i,extras:s}){const o=this.createErrorAnnotations(t,r);return fC(e,{tags:{...o.tags,...i},extras:{...o.extras,...s}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const i=t.pop();if(!i)return!0;const s=r.getCurrent();if((s==null?void 0:s.id)===i){if(t.length===0)return!0;r=s;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var i;const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const s=t.pop();if(!s)return r;const o=(i=r.children)==null?void 0:i[s];if(!o)return;r=o}return r}getDocumentSettings(){return this.store.get(kI)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(xi)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Zs.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return St(e.map(t=>this.store.get(t)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(s=>typeof s=="string"?s:s.id),{selectedShapeIds:r}=this.getCurrentPageState(),i=new Set(r);if(t.length===i.size&&t.every(s=>i.has(s)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(t);if(!r)return!1;const i=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,s=>i.includes(s.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=this.getSelectedShapeIds();return r.length>0&&t.length>0&&this.setSelectedShapes(r.filter(i=>!t.includes(i))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=St(e.map(r=>this.getShapePageBounds(r)));return t.length===0?null:De.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,r=0;for(let i=0,s=e.length;i<s;i++){const o=this.getShapePageTransform(e[i]);if(o)if(t){if(o.rotation()!==r)return 0}else t=!0,r=o.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const i=this.getShapeGeometry(e[0]).bounds.clone(),s=this.getShapePageTransform(e[0]);return i.point=s.applyToPoint(i.point),i}const r=De.FromPoints(e.flatMap(i=>{const s=this.getShapePageTransform(i);return s?s.applyToPoints(this.getShapeGeometry(i).bounds.corners):[]}).map(i=>i.rot(-t)));return r.point=r.point.rot(t),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:r}=this.pageToScreen(e.point),i=this.getZoomLevel();return new De(t,r,e.width*i,e.height*i)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==null){const r=this.getShape(t);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((t==null?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const r=this.getShape(t);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return St(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:dC(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return St(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);t.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(t.length===r.length){for(let i=0;i<t.length;i++)if(t[i]!==r[i]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(t),i=this.getShapeUtil(r);r&&i.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Eo.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find(f=>f.userId===e);if(!t)return null;const{w:r,h:i}=t.screenBounds,{x:s,y:o,z:a}=t.camera,c=new De(-s,-o,r/a,i/a),u=this.getViewportScreenBounds().clone(),d=u.width/u.height;return u.width=c.width,u.height=u.width/d,u.height<c.height&&(u.height=c.height,u.width=u.height*d),u.center=c.center,u}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:r}=dj(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw Pr(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:r}=dj(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw Pr(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const t=Un({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=t.zoomSteps)==null?void 0:r.length)<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const r=this.getCamera();let{x:i,y:s,z:o=r.z}=e;if(!(t!=null&&t.force)){const a=this.getCameraOptions(),c=a.zoomSteps[0],u=Gr(a.zoomSteps),d=this.getViewportScreenBounds();if(a.constraints){const{constraints:f}=a,g=Math.min(f.padding.y,d.w/2),m=Math.min(f.padding.x,d.h/2),v=De.From(a.constraints.bounds),w=(d.w-m*2)/v.w,S=(d.h-g*2)/v.h,b=this.getBaseZoom(),x=u*b,E=c*b;if(t!=null&&t.reset&&(o=this.getInitialZoom()),o<E||o>x){const{x:V,y:N,z:_}=r,k=-V+d.w/_/2,O=-N+d.h/_/2;o=Wr(o,E,x);const W=-V+d.w/o/2,q=-N+d.h/o/2;i=V+W-k,s=N+q-O}const M=m/o-v.x,j=g/o-v.y,D=(d.w-m*2)/o-v.w,H=(d.h-g*2)/o-v.h,L=M+D*f.origin.x,U=j+H*f.origin.y,z=typeof f.behavior=="string"?f.behavior:f.behavior.x,Y=typeof f.behavior=="string"?f.behavior:f.behavior.y;if(t!=null&&t.reset)i=L,s=U;else{switch(z){case"fixed":{i=L;break}case"contain":{o<w?i=L:i=Wr(i,M+D,M);break}case"inside":{o<w?i=Wr(i,M,(d.w-m)/o-v.w):i=Wr(i,M+D,M);break}case"outside":{i=Wr(i,m/o-v.w,(d.w-m)/o);break}case"free":break;default:throw Pr(z)}switch(Y){case"fixed":{s=U;break}case"contain":{o<S?s=U:s=Wr(s,j+H,j);break}case"inside":{o<S?s=Wr(s,j,(d.h-g)/o-v.h):s=Wr(s,j+H,j);break}case"outside":{s=Wr(s,g/o-v.h,(d.h-g)/o);break}case"free":break;default:throw Pr(Y)}}}else if(o>u||o<c){const{x:f,y:g,z:m}=r;o=Wr(o,c,u),i=f+(-f+d.w/o/2)-(-f+d.w/m/2),s=g+(-g+d.h/o/2)-(-g+d.h/m/2)}}return{x:i,y:s,z:o}}_setCamera(e,t){const r=this.getCamera(),{x:i,y:s,z:o}=this.getConstrainedCamera(e,t);return r.x===i&&r.y===s&&r.z===o?this:(Js(()=>{const a={...r,x:i,y:s,z:o};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:u}=this.inputs,{screenBounds:d}=this.store.unsafeGetWithoutCapture(xi);if(c.x/o-i!==u.x||c.y/o-s!==u.y){const f={type:"pointer",target:"canvas",name:"pointer_move",point:T.AddXY(c,d.x,d.y),pointerId:M3.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:Ii(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};t!=null&&t.immediate?this._flushEventForTick(f):this.dispatch(f)}this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(t!=null&&t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const i=T.Cast(e);Number.isFinite(i.x)||(i.x=0),Number.isFinite(i.y)||(i.y=0),(i.z===void 0||!Number.isFinite(i.z))&&(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(i,t);if(t!=null&&t.animation){const{width:o,height:a}=this.getViewportScreenBounds();this._animateToViewport(new De(-s.x,-s.y,o/s.z,a/s.z),t)}else this._setCamera(s,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{width:i,height:s}=this.getViewportPageBounds();return this.setCamera(new T(-(e.x-i/2),-(e.y-s/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const r=De.Common(St(t.map(i=>this.getShapePageBounds(i))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:r,constraints:i}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const s=this.getCamera(),{x:o,y:a,z:c}=s,{x:u,y:d}=e;let f=1;if(i){const g=this.getInitialZoom();c!==g&&(f=g)}return this.setCamera(new T(o+(u/f-u)-(u/c-u),a+(d/f-d)-(d/c-d),f),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{x:i,y:s,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let u=Gr(a)*c;for(let d=1;d<a.length;d++){const f=a[d-1]*c,g=a[d]*c;if(!(g-o<=(g-f)/2)){u=g;break}}this.setCamera(new T(i+(e.x/u-e.x)-(e.x/o-e.x),s+(e.y/u-e.y)-(e.y/o-e.y),u),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{zoomSteps:i}=this.getCameraOptions();if(i!==null&&i.length>1){const s=this.getBaseZoom(),{x:o,y:a,z:c}=this.getCamera();let u=i[0]*s;for(let d=i.length-1;d>0;d--){const f=i[d-1]*s,g=i[d]*s;if(!(g-c>=(g-f)/2)){u=f;break}}this.setCamera(new T(o+(e.x/u-e.x)-(e.x/c-e.x),a+(e.y/u-e.y)-(e.y/c-e.y),u),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(t!=null&&t.force))return this;const i=this.getViewportScreenBounds(),s=(t==null?void 0:t.inset)??Math.min(iY,i.width*.28),o=this.getBaseZoom(),a=r.zoomSteps[0],c=Gr(r.zoomSteps);let u=Wr(Math.min((i.width-s)/e.w,(i.height-s)/e.h),a*o,c*o);return(t==null?void 0:t.targetZoom)!==void 0&&(u=Math.min(t.targetZoom,u)),this.setCamera(new T(-e.x+(i.width-e.w*u)/2/u,-e.y+(i.height-e.h*u)/2/u,u),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:r,duration:i,start:s,end:o}=this._viewportAnimation;if(t>i){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new T(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}const a=i-t,c=r(1-a/i),u=s.minX+(o.minX-s.minX)*c,d=s.minY+(o.minY-s.minY)*c,f=s.maxX+(o.maxX-s.maxX)*c;this._setCamera(new T(-u,-d,this.getViewportScreenBounds().width/(f-u)),{force:!0})}_animateToViewport(e,t={animation:Jx}){const{animation:r,...i}=t;if(!r)return;const{duration:s=0,easing:o=Or.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),s===0||a===0?this._setCamera(new T(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...i}):(this._viewportAnimation={elapsed:0,duration:s/a,easing:o,start:c.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:i,friction:s=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let c=Math.min(i,1);const u=()=>{this.off("tick",d),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const d=f=>{const{x:g,y:m,z:v}=this.getCamera(),w=T.Mul(o,c*f/v);c*=1-s,c<a?u():this._setCamera(new T(g+w.x,m+w.y,v))};return this.on("tick",d),this}zoomToUser(e,t={animation:{duration:500}}){const r=this.getCollaborators().find(i=>i.userId===e);return r?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const i=r.currentPageId===this.getCurrentPageId();i||this.setCurrentPage(r.currentPageId),t&&t.animation&&!i&&(t.animation=void 0),this.centerOnPoint(r.cursor,t);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,e]}),this.timers.setTimeout(()=>{const o=[...this.getInstanceState().highlightedUserIds],a=o.indexOf(e);a<0||(o.splice(a,1),this.updateInstanceState({highlightedUserIds:o}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof HTMLElement){const a=e.getBoundingClientRect();e=new De(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!dl(document.body.scrollWidth,e.maxX,1),!dl(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:i}=this;this._willSetInitialBounds=!1;const{screenBounds:s,insets:o}=this.getInstanceState();if(e.equals(s)&&r.every((a,c)=>a===o[c]))return this;if(i)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(T.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:r,h:i}=this.getInstanceState().screenBounds;return new De(e,t,r,i)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new T(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:r,y:i,z:s}=this.getCamera();return new De(-r,-i,e/s,t/s)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(xi),{x:r,y:i,z:s=1}=this.getCamera();return new T((e.x-t.x)/s-r,(e.y-t.y)/s-i,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(xi),{x:r,y:i,z:s=1}=this.getCamera();return new T((e.x+r)*s+t.x,(e.y+i)*s+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:r,z:i=1}=this.getCamera();return new T((e.x+t)*i,(e.y+r)*i,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(s=>s.userId===r).sort((s,o)=>o.lastActivityTimestamp-s.lastActivityTimestamp)[0]):ic}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter(s=>s.userId===e);if(!t.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),t.some(s=>s.followingUserId===r))return this;const i=Ie("latestLeaderPresence",()=>this.getCollaborators().find(s=>s.userId===e));return Js(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const s=To("update current page",()=>{const c=i.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),o=()=>{s(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",o)},a=()=>{if(!i.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const d=this.getViewportPageBoundsForFollowing();if(!d){this.stopFollowingUser();return}const f=this.getViewportPageBounds(),g=Math.abs(d.minX-f.minX)+Math.abs(d.maxX-f.maxX),m=Math.abs(d.minY-f.minY)+Math.abs(d.maxY-f.maxY);if(g<this.options.followChaseViewportSnap&&m<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const v=Wr(u*.5,.1,.8),w=new De(zt(f.minX,d.minX,v),zt(f.minY,d.minY,v),zt(f.width,d.width,v),zt(f.height,d.height,v)),S=new T(-w.x,-w.y,this.getViewportScreenBounds().width/w.width);this.stopCameraAnimation(),this._setCamera(S)};this.once("stop-following",o),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let r=this.options.maxShapesPerPage*2,i=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),o=(c,u,d)=>{const f=this.getShape(c);if(!f||this.isShapeHidden(f))return;u*=f.opacity;let g=!1;const m=this.getShapeUtil(f);e&&(g=!d&&s.includes(c),g&&(u*=.32)),t.push({id:c,shape:f,util:m,index:r,backgroundIndex:i,opacity:u}),r+=1,i+=1;const v=this.getSortedChildIdsForParent(c);if(!v.length)return;let w=null;m.providesBackgroundForChildren(f)&&(w=i,i=r,r+=this.options.maxShapesPerPage);for(const S of v)o(S,u,d||g);w!==null&&(i=w)},a=e?[this.getCurrentPage()]:this.getPages();for(const c of a)for(const u of this.getSortedChildIdsForParent(c.id))o(u,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(WK)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(_i)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(r.map(i=>i.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),r=jQ(e.name??"Page 1",t.map(o=>o.name));let i=e.index;(!i||t.some(o=>o.index===i))&&(i=aa(t[t.length-1].index));const s=Ds.create({meta:{},...e,name:r,index:i});this.store.put([s])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const i=this.getPage(t);if(i){if(t===this.getCurrentPageId()){const s=r.findIndex(a=>a.id===t),o=r[s-1]??r[s+1];this.setCurrentPage(o.id)}this.store.remove([i.id])}}),this}duplicatePage(e,t=Ds.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,i=this.getPage(r);if(!i)return this;const s={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(i.id));return this.run(()=>{var u;const a=this.getPages(),c=fp(i.index,(u=a[a.indexOf(i)+1])==null?void 0:u.index);if(this.createPage({name:i.name+" Copy",id:t,index:c}),this.setCurrentPage(t),this.setCamera(s),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(r=>r.id);return t.length<=0?this:(this.run(()=>this.store.remove(t),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:i=1,shouldResolveToOriginal:s=!1}=t,a=Math.max(.125,(d=>Math.pow(2,Math.ceil(Math.log2(d))))(i)),c="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(r,{screenScale:i||1,steppedScreenScale:a,dpr:u,networkEffectiveType:c,shouldResolveToOriginal:s})}async uploadAsset(e,t){return await this.store.props.assets.upload(e,t)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var t,r;return(r=(t=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(t,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);if(!r)throw Error("Editor.getTransform: shape not found");return Re.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(es(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??Re.Identity();return Re.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);return!r||es(r.parentId)?Re.Identity():this._getShapePageTransformCache().get(r.parentId)??Re.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??Re.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this._getShapePageTransformCache().get(e.id);return t?De.FromPoints(Re.applyToPoints(t,this.getShapeGeometry(e).vertices)):new De})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${Re.applyToPoints(Re.Inverse(r),t).map(s=>`${s.x}px ${s.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(es(e.parentId))return;const t=this.getShapeAncestors(e.id).filter(i=>this.isShapeOfType(i,"frame"));return t.length===0?void 0:t.map(i=>this._getShapePageTransformCache().get(i.id).applyToPoints(this.getShapeGeometry(i).vertices)).reduce((i,s)=>{if(!(s&&i))return;const o=Y3(i,s);return o?o.map(T.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:i}=t;if(i.every((o,a)=>o&&T.Equals(o,r[a])))return t.clone();const s=Y3(r,i);return s?De.FromPoints(s):void 0}return t})}getShapeAncestors(e,t=[]){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return t;const s=i.parentId;if(es(s))return t.reverse(),t;const o=this.store.get(s);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return;const s=i.parentId;if(es(s))return;const o=this.getShape(s);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){const r=typeof e=="string"?e:e==null?void 0:e.id,i=r&&this.getShape(r);return i?i.parentId===t?!0:this.hasAncestor(this.getShapeParent(i),t):!1}findCommonAncestor(e,t){var c;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(u=>u.id),i=St(r.map(u=>this.getShape(u)));if(i.length===1){const u=i[0].parentId;return es(u)?void 0:t?(c=this.findShapeAncestor(i[0],t))==null?void 0:c.id:u}const[s,...o]=i;let a=this.getShapeParent(s);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(o.every(u=>this.hasAncestor(u,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const t=typeof e=="string"?this.getShape(e):e;return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}_notVisibleShapes(){return zQ(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),r=this.getEditingShapeId(),i=new Set(e);return r&&i.delete(r),t.forEach(s=>{i.delete(s)}),i}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const r=this.getShapeMaskedPageBounds(t);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&t.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const r=this.getZoomLevel(),i=this.getViewportPageBounds(),{filter:s,margin:o=0,hitLocked:a=!1,hitLabels:c=!1,hitInside:u=!1,hitFrameInside:d=!1}=t;let f=1/0,g=null,m=1/0,v=null;const w=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(S=>{if(S.isLocked&&!a||this.isShapeHidden(S)||this.isShapeOfType(S,"group"))return!1;const b=this.getShapeMask(S);return b&&!As(e,b)?!1:s?s(S):!0});for(let S=w.length-1;S>=0;S--){const b=w[S],x=this.getShapeGeometry(b),E=x instanceof to,M=this.getPointInShapeSpace(b,e);if(this.isShapeOfType(b,"frame")||(this.isShapeOfType(b,"arrow")||this.isShapeOfType(b,"geo")&&b.props.fill==="none")&&b.props.text.trim()){for(const D of x.children)if(D.isLabel&&D.isPointInBounds(M))return b}if(this.isShapeOfType(b,"frame")){const D=x.distanceToPoint(M,u);if(Math.abs(D)<=o)return v||b;if(x.hitTestPoint(M,0,!0))return v||g||(d?b:void 0);continue}let j;if(E){let D=1/0;for(const H of x.children){if(H.isLabel&&!c)continue;const L=H.distanceToPoint(M,u);L<D&&(D=L)}j=D}else o===0&&(x.bounds.w<1||x.bounds.h<1)||x.bounds.containsPoint(M,o)?j=x.distanceToPoint(M,u):j=1/0;if(x.isClosed){if(j<=o){if(x.isFilled||E&&x.children[0].isFilled)return v||b;if(this.getShapePageBounds(b).contains(i))continue;if(Math.abs(j)<o)Math.abs(j)<m&&(m=Math.abs(j),v=b);else if(!v){const{area:D}=x;D<f&&(f=D,g=b)}}}else if(j<this.options.hitTestMargin/r)return b}return v||g||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,t))}isPointInShape(e,t,r={}){const{hitInside:i=!1,margin:s=0}=r,o=typeof e=="string"?e:e.id,a=this.getShapeMask(o);return a&&!As(t,a)?!1:this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),s,i)}getPointInShapeSpace(e,t){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return new T(0,0);if(es(i.parentId))return T.From(t);const s=this.getShapePageTransform(i.parentId);return s?s.clone().invert().applyToPoint(t):T.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,i=t.length;r<i;r++)dB(this,t[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(is(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e==null?void 0:e.id;if(!t)return;const r=this.getShape(t);if(!(r===void 0||!is(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,i=>i.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,i=this.getShape(r);if(!i)return!1;let s=!1;if(i.parentId===t)s=!0;else{let o=this.getShape(i.parentId);e:for(;o;){if(o.parentId===t){s=!0;break e}o=this.getShape(o.parentId)}}return s}getAncestorPageId(e){const t=typeof e=="string"?e:e==null?void 0:e.id,r=t&&this.getShape(t);if(r)return es(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,t,r){const i=typeof e[0]=="string"?e:e.map(g=>g.id);if(i.length===0)return this;const s=[],o=es(t)?Re.Identity():this.getShapePageTransform(t),a=o.rotation();let c=[];const u=St(this.getSortedChildIdsForParent(t).map(g=>this.getShape(g)));if(r){const g=u.find(m=>m.index===r);if(g){const m=u[u.indexOf(g)+1];m?c=lh(r,m.index,i.length):c=QS(r,i.length)}else{const m=u.sort(_i).find(v=>v.index>r);m?c=lh(r,m.index,i.length):c=QS(r,i.length)}}else{const g=u.length&&u[u.length-1];c=g?QS(g.index,i.length):pp(i.length)}const d=o.clone().invert(),f=St(i.map(g=>this.getShape(g)));return this.run(()=>{for(let g=0;g<f.length;g++){const m=f[g],v=this.getShapePageTransform(m);if(!v)continue;const w=v.point();if(!w)continue;const S=d.applyToPoint(w),b=v.rotation()-a;s.push({id:m.id,type:m.type,parentId:t,x:S.x,y:S.y,rotation:b,index:c[g]})}this.updateShapes(s)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];if(!r||r.length===0)return"a1";const i=this.getShape(r[r.length-1]);return aa(i.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];return r||ic}visitDescendants(e,t){const r=typeof e=="string"?e:e.id,i=this.getSortedChildIdsForParent(r);for(const s of i)t(s)!==!1&&this.visitDescendants(s,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const r of e.map(i=>this.getShape(i)).sort(_i))t.add(r.id),this.visitDescendants(r,i=>{t.add(i)});return t}getDroppingOverShape(e,t=[]){const r=this.getCurrentPageShapesSorted();for(let i=r.length-1;i>=0;i--){const s=r[i];if(this.isShapeHidden(s)||this.getSelectedShapeIds().includes(s.id)||!this.getShapeUtil(s).canDropShapes(s,t)||t.find(a=>a.id===s.id||this.hasAncestor(s,a.id)))continue;const o=this.getShapeMaskedPageBounds(s.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,e),0,!0))return s}}getOutermostSelectableShape(e,t){const r=typeof e=="string"?e:e.id,i=this.getShape(r);let s=i,o=i;const a=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&(a==null?void 0:a.id)!==o.id&&!this.hasAncestor(a,o.id)&&((t==null?void 0:t(o))??!0))s=o;else if((a==null?void 0:a.id)===o.id)break;o=this.getShapeParent(o)}return s}_getBindingsIndexCache(){const e=BQ(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.fromId===r&&i.type===t)}getBindingsToShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(i=>i.toId===r&&i.type===t)}getBindingsInvolvingShape(e,t){const r=typeof e=="string"?e:e.id,i=this._getBindingsIndexCache().get(r)??ic;return t?i.filter(s=>s.type===t):i}createBindings(e){const t=[];for(const r of e){const i=this.getShape(r.fromId),s=this.getShape(r.toId);if(!i||!s||!this.canBindShapes({fromShape:i,toShape:s,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),c=this.store.schema.types.binding.create({...r,id:r.id??wu(),props:{...a,...r.props}});t.push(c)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const r of e){if(!r)continue;const i=this.getBinding(r.id);if(!i)continue;const s=ea(i,r);if(s===i)continue;const o=this.getShape(s.fromId),a=this.getShape(s.toId);!o||!a||this.canBindShapes({fromShape:o,toShape:a,binding:s})&&t.push(s)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const r=e.map(i=>typeof i=="string"?i:i.id);return t?this.store.atomic(()=>{var i,s;for(const o of r){const a=this.getBinding(o);if(!a)continue;const c=this.getBindingUtil(a);(i=c.onBeforeIsolateFromShape)==null||i.call(c,{binding:a,removedShape:this.getShape(a.toId)}),(s=c.onBeforeIsolateToShape)==null||s.call(c,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([o])}}):this.store.remove(r),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:r}){const i=typeof e=="string"?e:e.type,s=typeof t=="string"?t:t.type,o=typeof r=="string"?r:r.type,a={fromShapeType:i,toShapeType:s,bindingType:o};return i===s?this.getShapeUtil(i).canBind(a):this.getShapeUtil(i).canBind(a)&&this.getShapeUtil(s).canBind(a)}rotateShapesBy(e,t,r){const i=typeof e[0]=="string"?e:e.map(o=>o.id);if(i.length<=0)return this;const s=B5({editor:this,ids:i});return s?(hy({delta:t,snapshot:s,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,t){var s,o,a;let r=e;const i=this.getShapeUtil(e);return r=ea(r,((s=i.onTranslateStart)==null?void 0:s.call(i,r))??void 0),r=ea(r,{id:e.id,type:e.type,x:t.x,y:t.y}),r=ea(r,((o=i.onTranslate)==null?void 0:o.call(i,e,r))??void 0),r=ea(r,((a=i.onTranslateEnd)==null?void 0:a.call(i,e,r))??void 0),r}nudgeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(r.length<=0)return this;const i=[];for(const s of r){const o=this.getShape(s),a=T.From(t),c=this.getShapeParentTransform(o);c&&a.rot(-c.rotation()),i.push(this.getChangesToTranslateShape(o,a.add(o)))}return this.updateShapes(i),this}duplicateShapes(e,t){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(g=>g.id);if(r.length<=0)return this;const i=new Set(r),s=this.getShapeAndDescendantIds(r),o=[...s].reverse(),a=new Map;for(const g of s)a.set(g,wn());const{shapesToCreateWithOriginals:c,bindingsToCreate:u}=uj(this,s,g=>{const m=[];for(const w of g){const S=this.getBinding(w);if(!S)continue;const b=wu();m.push({...S,id:b,fromId:ss(a.get(S.fromId)),toId:ss(a.get(S.toId))})}const v=[];for(const w of o){const S=ss(a.get(w)),b=this.getShape(w);if(!b)continue;let x=0,E=0;if(t&&i.has(w)){const M=this.getShapeParentTransform(b),j=new T(t.x,t.y).rot(-M.rotation());x=j.x,E=j.y}v.push({shape:{...b,id:S,x:b.x+x,y:b.y+E,index:"a1",parentId:a.get(b.parentId)??b.parentId},originalShape:b})}return{shapesToCreateWithOriginals:v,bindingsToCreate:m}});c.forEach(({shape:g,originalShape:m})=>{const v=m.parentId,w=this.getSortedChildIdsForParent(v),S=w.indexOf(m.id),b=w[S+1],x=b?this.getShape(b):void 0,E=fp(m.index,x==null?void 0:x.index);g.index=E});const d=c.map(({shape:g})=>g);if(d.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Pm(this);return}if(this.createShapes(d),this.createBindings(u),this.setSelectedShapes(St(r.map(g=>a.get(g)))),t!==void 0){const g=this.getSelectionPageBounds(),m=this.getViewportPageBounds();g&&!m.contains(g)&&this.centerOnPoint(g.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const i=this.getCurrentPageId();if(t===i)return this;if(!this.store.has(t))return this;const s=this.getContentFromCurrentPage(r);if(!s)return this;if(this.getPageShapeIds(t).size+s.shapes.length>this.options.maxShapesPerPage)return Pm(this,t),this;const o=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:o}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly()||t.length===0)return this;let r=!0,i=!0;const s=[];for(const o of t){const a=this.getShape(o);a&&(s.push(a),a.isLocked?i=!1:r=!1)}return this.run(()=>{i?(this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!1}))):this.updateShapes(s.map(o=>({id:o.id,type:o.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=Em(this,"toBack",t,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Em(this,"backward",r,t);return i&&this.updateShapes(i),this}bringForward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),i=Em(this,"forward",r,t);return i&&this.updateShapes(i),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=Em(this,"toFront",t);return r&&this.updateShapes(r),this}flipShapes(e,t){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly())return this;let i=St(r.map(o=>this.getShape(o)));if(!i.length)return this;i=St(i.map(o=>this.isShapeOfType(o,"group")?this.getSortedChildIdsForParent(o.id).map(a=>this.getShape(a)):o).flat());const s=De.Common(St(i.map(o=>this.getShapePageBounds(o)))).center;return this.run(()=>{for(const o of i){const a=this.getShapeGeometry(o).bounds,c=this.getShapePageTransform(o.id);c&&this.resizeShape(o.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:a,initialPageTransform:c,initialShape:o,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(o).isAspectRatioLocked(o),scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(e,t,r){const i=typeof e[0]=="string"?e:e.map(w=>w.id);if(this.getIsReadonly())return this;const s=i.map(w=>this.getShape(w)).filter(w=>w?this.getShapeUtil(w).canBeLaidOut(w):!1),o=s.length;if(r===0&&o<3||o<2)return this;const a=Object.fromEntries(s.map(w=>[w.id,this.getShapePageBounds(w)]));let c,u,d,f;t==="horizontal"?(c="x",u="minX",d="maxX",f="width"):(c="y",u="minY",d="maxY",f="height");let g;if(r===0){const w=[];s.sort((b,x)=>a[b.id][u]-a[x.id][u]);for(let b=0;b<o-1;b++){const x=s[b],E=s[b+1],M=a[x.id],D=a[E.id][u]-M[d],H=w.find(L=>L.gap===D);H?H.count++:w.push({gap:D,count:1})}let S=0;w.forEach(b=>{b.count>S&&(S=b.count,g=b.gap)}),S===1&&(g=Math.max(0,w.reduce((b,x)=>b+x.gap*x.count,0)/(o-1)))}else g=r;const m=[];let v=a[s[0].id][d];return s.forEach((w,S)=>{var j,D;if(S===0)return;const b={x:0,y:0};b[c]=v+g-a[w.id][c];const x=this.getShapeParent(w),E=x?T.Rot(b,-this.getShapePageTransform(x).decompose().rotation):b,M=(D=(j=this.getShapeUtil(w)).onTranslateStart)==null?void 0:D.call(j,w);m.push(M?{...M,[c]:w[c]+E[c]}:{id:w.id,type:w.type,[c]:w[c]+E[c]}),v+=a[w.id][f]+g}),this.updateShapes(m),this}packShapes(e,t){var D,H;const r=typeof e[0]=="string"?e:e.map(L=>L.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=r.map(L=>this.getShape(L)).filter(L=>L?this.getShapeUtil(L).canBeLaidOut(L):!1),s={},o={};let a,c,u=0;for(let L=0;L<i.length;L++)a=i[L],c=this.getShapePageBounds(a),s[a.id]=c,o[a.id]=c.clone(),u+=c.width*c.height;const d=De.Common(St(Object.values(s))),f=d.width;i.sort((L,U)=>s[U.id].height-s[L.id].height);const g=Math.max(Math.ceil(Math.sqrt(u/.95)),f),m=[new De(d.x,d.y,g,1/0)];let v=0,w=0,S,b;for(let L=0;L<i.length;L++){a=i[L],c=o[a.id];for(let U=m.length-1;U>=0;U--)if(S=m[U],!(c.width>S.width||c.height>S.height)){c.x=S.x,c.y=S.y,w=Math.max(w,c.maxY),v=Math.max(v,c.maxX),c.width===S.width&&c.height===S.height?(b=m.pop(),U<m.length&&(m[U]=b)):c.height===S.height?(S.x+=c.width+t,S.width-=c.width+t):c.width===S.width?(S.y+=c.height+t,S.height-=c.height+t):(m.push(new De(S.x+(c.width+t),S.y,S.width-(c.width+t),c.height)),S.y+=c.height+t,S.height-=c.height+t);break}}const x=De.Common(Object.values(o)),E=T.Sub(d.center,x.center);let M;const j=[];for(let L=0;L<i.length;L++){a=i[L],c=s[a.id],M=o[a.id];const U=T.Sub(M.point,c.point).add(E),z=this.getShapeParentTransform(a);z&&U.rot(-z.rotation());const Y={id:a.id,type:a.type,x:a.x+U.x,y:a.y+U.y},V=(H=(D=this.getShapeUtil(a)).onTranslateStart)==null?void 0:H.call(D,{...a,...Y});V?j.push({...Y,...V}):j.push(Y)}return j.length&&this.updateShapes(j),this}alignShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=St(r.map(c=>this.getShape(c))),s=Object.fromEntries(i.map(c=>[c.id,this.getShapePageBounds(c)])),o=De.Common(St(Object.values(s))),a=[];return i.forEach(c=>{const u=s[c.id];if(!u)return;const d={x:0,y:0};switch(t){case"top":{d.y=o.minY-u.minY;break}case"center-vertical":{d.y=o.midY-u.minY-u.height/2;break}case"bottom":{d.y=o.maxY-u.minY-u.height;break}case"left":{d.x=o.minX-u.minX;break}case"center-horizontal":{d.x=o.midX-u.minX-u.width/2;break}case"right":{d.x=o.maxX-u.minX-u.width;break}}const f=this.getShapeParent(c),g=f?T.Rot(d,-this.getShapePageTransform(f).decompose().rotation):d;a.push(this.getChangesToTranslateShape(c,T.Add(c,g)))}),this.updateShapes(a),this}distributeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(x=>x.id);if(this.getIsReadonly())return this;if(r.length<3)return this;const i=r.length,s=St(r.map(x=>this.getShape(x))),o=Object.fromEntries(s.map(x=>[x.id,this.getShapePageBounds(x)]));let a,c,u,d,f;t==="horizontal"?(a="x",c="minX",u="maxX",d="midX",f="width"):(a="y",c="minY",u="maxY",d="midY",f="height");const g=[],m=s.sort((x,E)=>o[x.id][c]-o[E.id][c])[0],v=s.sort((x,E)=>o[E.id][u]-o[x.id][u])[0],w=o[m.id][d],S=(o[v.id][d]-w)/(i-1),b=w+S;return s.filter(x=>x!==m&&x!==v).sort((x,E)=>o[x.id][d]-o[E.id][d]).forEach((x,E)=>{const M={x:0,y:0};M[a]=b+S*E-o[x.id][f]/2-o[x.id][a];const j=this.getShapeParent(x),D=j?T.Rot(M,-this.getShapePageTransform(j).rotation()):M;g.push(this.getChangesToTranslateShape(x,T.Add(x,D)))}),this.updateShapes(g),this}stretchShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const i=St(r.map(c=>this.getShape(c))),s=Object.fromEntries(r.map(c=>[c,this.getShapeGeometry(c).bounds])),o=Object.fromEntries(r.map(c=>[c,this.getShapePageBounds(c)])),a=De.Common(St(Object.values(o)));switch(t){case"vertical":{this.run(()=>{for(const c of i){if(this.getShapePageTransform(c).rotation()%un)continue;const d=s[c.id],f=o[c.id],g=new T(0,a.minY-f.minY),m=this.getShapeParentTransform(c);m&&g.rot(-m.rotation());const{x:v,y:w}=T.Add(g,c);this.updateShapes([{id:c.id,type:c.type,x:v,y:w}]);const S=new T(1,a.height/f.height);this.resizeShape(c.id,S,{initialBounds:d,scaleOrigin:new T(f.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of i){const u=s[c.id],d=o[c.id];if(this.getShapePageTransform(c).rotation()%un)continue;const g=new T(a.minX-d.minX,0),m=this.getShapeParentTransform(c);m&&g.rot(-m.rotation());const{x:v,y:w}=T.Add(g,c);this.updateShapes([{id:c.id,type:c.type,x:v,y:w}]);const S=new T(a.width/d.width,1);this.resizeShape(c.id,S,{initialBounds:u,scaleOrigin:new T(a.minX,d.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(e,t,r={}){var m,v,w;const i=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new T(1,t.y)),Number.isFinite(t.y)||(t=new T(t.x,1));const s=r.initialShape??this.getShape(i);if(!s)return this;const o=r.scaleOrigin??((m=this.getShapePageBounds(i))==null?void 0:m.center);if(!o)return this;const a=r.initialPageTransform?Re.Cast(r.initialPageTransform):this.getShapePageTransform(i);if(!a)return this;const c=a.rotation();if(c==null)return this;const u=r.scaleAxisRotation??c,d=r.initialBounds??this.getShapeGeometry(i).bounds;if(!d)return this;const f=r.isAspectRatioLocked??this.getShapeUtil(s).isAspectRatioLocked(s);if(!kN(c,u))return this._resizeUnalignedShape(i,t,{...r,initialBounds:d,scaleOrigin:o,scaleAxisRotation:u,initialPageTransform:a,isAspectRatioLocked:f,initialShape:s});const g=this.getShapeUtil(s);if(f&&(Math.abs(t.x)>Math.abs(t.y)?t=new T(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new T(Math.sign(t.x)*Math.abs(t.y),t.y)),g.onResize&&g.canResize(s)){const S=this._scalePagePoint(Re.applyToPoint(a,new T(0,0)),o,t,u),b=this.getPointInParentSpace(s.id,S),x=new T(t.x,t.y),E=dl((c-u)%Math.PI,0);x.x=E?t.x:t.y,x.y=E?t.y:t.x;const M=Re.applyToPoint(a,new T),{x:j,y:D}=this.getPointInParentSpace(s.id,M);let H=s;r.skipStartAndEndCallbacks||(H=ea(s,((v=g.onResizeStart)==null?void 0:v.call(g,s))??void 0)),H=ea(H,{id:i,type:s.type,x:b.x,y:b.y,...g.onResize({...s,x:j,y:D},{newPoint:b,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:x.x,scaleY:x.y,initialBounds:d,initialShape:s})}),r.skipStartAndEndCallbacks||(H=ea(H,((w=g.onResizeEnd)==null?void 0:w.call(g,s,H))??void 0)),this.updateShapes([H])}else{const S=Re.applyToPoint(a,d.center),b=this._scalePagePoint(S,o,t,u),x=this.getPointInParentSpace(s.id,S),E=this.getPointInParentSpace(s.id,b),M=T.Sub(E,x);this.updateShapes([{id:i,type:s.type,x:s.x+M.x,y:s.y+M.y}])}return this}_scalePagePoint(e,t,r,i){const s=T.RotWith(e,t,-i).sub(t),o=T.MulV(s,r);return T.Add(o,t).rotWith(t,i)}_resizeUnalignedShape(e,t,r){const{type:i}=r.initialShape,s=new T(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?s.x=Math.sign(t.x)*Math.abs(t.y):s.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,s,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:S}=Re.Decompose(r.initialPageTransform);S-=2*S,this.updateShapes([{id:e,type:i,rotation:S}])}const o=Re.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(o,r.scaleOrigin,t,r.scaleAxisRotation),c=this.getShapePageBounds(e),u=this.getShapePageTransform(e),d=c.center,f=u.point();if(!d||!f)return this;const g=T.Sub(a,d),m=T.Add(f,g),{x:v,y:w}=this.getPointInParentSpace(e,m);return this.updateShapes([{id:e,type:i,x:v,y:w}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return Pm(this),this;const i=this.getFocusedGroupId();return this.run(()=>{var d,f;const s=this.getCurrentPageShapesSorted(),o=e.map(g=>{if(g.id||(g={id:wn(),...g}),!g.parentId||!(this.store.has(g.parentId)||e.some(m=>m.id===g.parentId))){let m=this.getFocusedGroupId();for(let w=s.length-1;w>=0;w--){const S=s[w];if(!this.isShapeHidden(S)&&this.getShapeUtil(S).canReceiveNewChildrenOfType(S,g.type)&&this.isPointInShape(S,{x:g.x??0,y:g.y??0},{margin:0,hitInside:!0})){m=S.id;break}}const v=g.parentId;if(m===g.id&&(m=i),m!==v&&(g={...g},g.parentId=m,is(m))){const w=this.getPointInShapeSpace(this.getShape(m),{x:g.x??0,y:g.y??0});g.x=w.x,g.y=w.y,g.rotation=-this.getShapePageTransform(m).rotation()+(g.rotation??0)}}return g}),a=new Map,c=[],{opacityForNextShape:u}=this.getInstanceState();for(const g of o){const m=this.getShapeUtil(g);let v=g.index;if(!v){const x=g.parentId??i;a.has(x)||a.set(x,this.getHighestIndexForParent(x)),v=a.get(x),a.set(x,aa(v))}const w=m.getDefaultProps();for(const[x,E]of this.styleProps[g.type])w[E]=this.getStyleForNextShape(x);let S=this.store.schema.types.shape.create({...g,index:v,opacity:g.opacity??u,parentId:g.parentId??i,props:"props"in g?{...w,...g.props}:w});if(S.index===void 0)throw Error("no index!");const b=(f=(d=this.getShapeUtil(S)).onBeforeCreate)==null?void 0:f.call(d,S);b&&(S=b),c.push(S)}c.forEach(g=>{g.meta={...this.getInitialMetaForShape(g),...g.meta}}),this.store.put(c)}),this}animateShape(e,t={animation:Jx}){return this.animateShapes([e],t)}animateShapes(e,t={animation:Jx}){if(!t.animation)return this;const{duration:r=500,easing:i=Or.linear}=t.animation,s=Jt();let o=r,a;const c=[];let u,d;for(let g=0,m=e.length;g<m;g++){if(u=e[g],!u)continue;const v=this.getShape(u.id);v&&(d={start:Un(v),end:ea(Un(v),u)},c.push(d),this.animatingShapes.set(v.id,s))}const f=g=>{var S,b;if(o-=g,o<0){const{animatingShapes:x}=this,E=e.filter(M=>M&&x.get(M.id)===s);E.length&&this.updateShapes(E),this.off("tick",f);return}a=i(1-o/r);const{animatingShapes:m}=this,v=[];let w;for(let x=0,E=c.length;x<E;x++){const{start:M,end:j}=c[x];w=m.get(M.id),w===s&&v.push({...j,x:M.x+(j.x-M.x)*a,y:M.y+(j.y-M.y)*a,opacity:M.opacity+(j.opacity-M.opacity)*a,rotation:M.rotation+(j.rotation-M.rotation)*a,props:((b=(S=this.getShapeUtil(j)).getInterpolatedProps)==null?void 0:b.call(S,M,j,a))??j.props})}this._updateShapes(v)};return this.on("tick",f),this}groupShapes(e,t={}){var v;const{groupId:r=wn(),select:i=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s=typeof e[0]=="string"?e:e.map(w=>w.id);if(s.length<=1)return this;const o=St((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(w=>this.getShape(w))),a=o.sort(_i).map(w=>w.id),c=De.Common(St(o.map(w=>this.getShapePageBounds(w)))),{x:u,y:d}=c.point,f=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const g=o.filter(w=>w.parentId===f).sort(_i),m=(v=g[g.length-1])==null?void 0:v.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:f,index:m,x:u,y:d,opacity:1,props:{}}]),this.reparentShapes(a,r),i&&this.select(r)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:r=!0}=t,i=typeof e[0]=="string"?e:e.map(c=>c.id),s=St((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(c=>this.getShape(c)));if(s.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return s.forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):o.add(c.id)}),a.length===0?this:(this.run(()=>{let c;for(let u=0,d=a.length;u<d;u++){c=a[u];const f=this.getSortedChildIdsForParent(c.id);for(let g=0,m=f.length;g<m;g++)o.add(f[g]);this.reparentShapes(f,c.parentId,c.index)}this.deleteShapes(a.map(u=>u.id)),r&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let r=0,i=e.length;r<i;r++){const s=e[r];if(!s)continue;const o=this.getShape(s.id);if(o){if(!this._shouldIgnoreShapeLock){if(o.isLocked){if(!(Object.hasOwn(s,"isLocked")&&!s.isLocked))continue}else if(this.isShapeOrAncestorLocked(o))continue}this.animatingShapes.delete(s.id),t.push(s)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var s,o;const t=[];let r,i;for(let a=0,c=e.length;a<c;a++){const u=e[a];u&&(r=this.getShape(u.id),r&&(i=ea(r,u),i!==r&&(i=((o=(s=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:o.call(s,r,i))??i,t.push(i))))}this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>{var r;return!((r=this.getShape(t))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(r.length===0)return this;const i=new Set(r);for(const s of r)this.visitDescendants(s,o=>{i.add(o)});return this.run(()=>this.store.remove([...i]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let i=0,s=r.length;i<s;i++)this._extractSharedStyles(this.getShape(r[i]),t)}else for(const[r,i]of this.styleProps[e.type])t.applyValue(r,Ei(e.props,i))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new $I;for(const r of e)this._extractSharedStyles(r,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const r=this.styleProps[e.type].get(t);if(r!==void 0)return Ei(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new $I;if(!e)return t;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())t.applyValue(r,this.getStyleForNextShape(r));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=i=>{const s=this.getShape(i);if(s)if(this.isShapeOfType(s,"group"))for(const o of this.getSortedChildIdsForParent(s.id))t(o);else e.push(s)};for(const i of this.getSelectedShapeIds())t(i);let r=null;for(const i of e)if(r===null)r=i.opacity;else if(r!==i.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const r=[],i=s=>{if(this.isShapeOfType(s,"group")){const o=this.getSortedChildIdsForParent(s);for(const a of o)i(this.getShape(a))}else r.push(s)};for(const s of t)i(s);this.updateShapes(r.map(s=>({id:s.id,type:s.type,opacity:e})))}return this}setStyleForNextShapes(e,t,r){const i=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...i,[e.id]:t}},r),this}setStyleForSelectedShapes(e,t){const r=this.getSelectedShapes();if(r.length>0){const i=[],s=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o.id);for(const c of a)s(this.getShape(c))}else{const a=this.getShapeUtil(o),c=this.styleProps[o.type].get(e);if(c){const u={id:o.id,type:o.type,props:{[c]:t}};i.push({util:a,originalShape:o,updatePartial:u})}}};for(const o of r)s(o);this.updateShapes(i.map(({updatePartial:o})=>o))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,r;return await((r=(t=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,r;return(r=(t=this.externalContentHandlers)[e.type])==null?void 0:r.call(t,e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);if(!t||t.length===0)return;const r=this.getShapeAndDescendantIds(t);return uj(this,r,i=>{const s=[];for(const d of i){const f=this.getBinding(d);f&&s.push(f)}const o=[],a=[];for(const d of r){const f=this.getShape(d);if(!f)continue;if(!r.has(f.parentId)){const m=this.getShapePageTransform(f.id),v=m.point();a.push({...f,x:v.x,y:v.y,rotation:m.rotation(),parentId:this.getCurrentPageId()}),o.push(f.id)}else a.push(f)}const c=[],u=new Set;for(const d of a){if(!("assetId"in d.props))continue;const f=d.props.assetId;if(!f||u.has(f))continue;u.add(f);const g=this.getAsset(f);g&&c.push(g)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:o,bindings:s,assets:c}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async r=>{var i,s;if((r.type==="image"||r.type==="video")&&!((i=r.props.src)!=null&&i.startsWith("data:image"))&&!((s=r.props.src)!=null&&s.startsWith("http"))){const o=Un(r),a=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});o.props.src=await Io.blobToDataUrl(await fa(a).then(c=>c.blob())),t.push(o)}else t.push(r)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var z,Y;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:i=!1,preservePosition:s=!1}=t;let{point:o=void 0}=t;const a=this.getCurrentPageId(),{rootShapeIds:c}=e,u=[],d=[],f=[],g={store:{...Object.fromEntries(e.assets.map(V=>[V.id,V])),...Object.fromEntries(e.shapes.map(V=>[V.id,V])),...Object.fromEntries(((z=e.bindings)==null?void 0:z.map(V=>[V.id,V]))??[])},schema:e.schema},m=this.store.schema.migrateStoreSnapshot(g);if(m.type==="error")throw Error("Could not put content: could not migrate content");for(const V of Object.values(m.value))switch(V.typeName){case"asset":{u.push(V);break}case"shape":{d.push(V);break}case"binding":{f.push(V);break}}const v=new Map(i?d.map(V=>[V.id,V.id]):d.map(V=>[V.id,wn()])),w=new Map(i?f.map(V=>[V.id,V.id]):f.map(V=>[V.id,wu()]));let S=this.getCurrentPageId(),b=1/0,x=[];for(const V of this.getSelectedShapes()){if(b===0)break;const N=this.isShapeOfType(V,"frame"),_=this.getShapeAncestors(V);N&&_.push(V);const k=N?_.length+1:_.length;if(k<b)b=k,x=_,S=N?V.id:V.parentId;else if(k===b){if(x.length!==_.length)throw Error(`Ancestors: ${x.length} !== ${_.length}`);if(x.length===0){S=a;break}else{S=a;for(let O=0;O<x.length&&_[O]===x[O];O++)S=_[O].id}}}let E=!1;if(!es(S)){const V=this.getShape(S);if(V){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(V)))S=a;else if(c.length===1){const N=d.find(_=>_.id===c[0]);this.isShapeOfType(V,"frame")&&this.isShapeOfType(N,"frame")&&N.props.w===(V==null?void 0:V.props.w)&&N.props.h===(V==null?void 0:V.props.h)&&(E=!0)}}else S=a}E||(E=v.has(S)),E&&(S=this.getShape(S).parentId);let M=this.getHighestIndexForParent(S);const j=[],D=d.map(V=>{const N=v.get(V.id),_={...V,id:N};return c.includes(V.id)&&(_.parentId=a,j.push(_)),v.has(_.parentId)?_.parentId=v.get(V.parentId):(c.push(_.id),_.index=M,M=aa(M)),_});if(D.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Pm(this),this;const H=f.map(V=>({...V,id:ss(w.get(V.id)),fromId:ss(v.get(V.fromId)),toId:ss(v.get(V.toId))})),L=[],U=[];for(const V of u)this.store.has(V.id)||((V.type==="image"||V.type==="video")&&((Y=V.props.src)!=null&&Y.startsWith("data:image"))&&(U.push(Un(V)),V.props.src=null),L.push(V));return Promise.allSettled(U.map(async V=>{const N=await TQ(V.props.src,V.props.name,V.props.mimeType??"image/png"),_=await this.getAssetForExternalContent({type:"file",file:N,assetId:V.id});if(!_){this.deleteAssets([V.id]);return}this.updateAssets([{..._,id:V.id}])})),this.run(()=>{L.length>0&&this.createAssets(L),this.createShapes(D),this.createBindings(H),r&&this.select(...j.map(O=>O.id)),S!==a&&this.reparentShapes(j.map(O=>O.id),S);const V=D.map(O=>this.getShape(O.id)),N=De.Common(V.map(O=>this.getShapePageBounds(O)));if(o===void 0)if(es(S)){const O=this.getViewportPageBounds();s||O.includes(De.From(N))?o=N.center:o=O.center}else{const O=this.getShape(S);o=Re.applyToPoint(this.getShapePageTransform(O),this.getShapeGeometry(O).bounds.center)}if(j.length===1){const O=j[0];if(this.isShapeOfType(O,"frame"))for(;this.getShapesAtPoint(o).some(W=>this.isShapeOfType(W,"frame")&&W.props.w===O.props.w&&W.props.h===O.props.h);)o.x+=N.w+16}const _=De.Common(St(j.map(({id:O})=>this.getShapePageBounds(O)))).center,k=T.Sub(o,_);this.updateShapes(j.map(({id:O})=>{const W=this.getShape(O),q=this.getShapeParentTransform(O).decompose().rotation,X=T.Rot(k,-q);return{id:W.id,type:W.type,x:W.x+X.x,y:W.y+X.y}}))}),this}async getSvgElement(e,t={}){const r=typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length!==0)return EQ(this,r,t)}async getSvgString(e,t={}){const r=await this.getSvgElement(e,t);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,t={}){const r=await this.getSvgElement(e,t);if(r)return r.svg}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:r,previousPagePoint:i,currentScreenPoint:s,currentPagePoint:o}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(xi),{x:c,y:u,z:d}=pm(()=>this.getCamera()),f=e.point.x-a.x,g=e.point.y-a.y,m=e.point.z??.5;r.setTo(s),i.setTo(o),s.set(f,g);const v=f/d-c,w=g/d-u;isFinite(v)&&isFinite(w)&&o.set(v,w,m),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(s),this.inputs.originPagePoint.setTo(o)),this.run(()=>{var S;this.store.put([{id:yp,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===M3.CAMERA_MOVE?((S=this.store.unsafeGetWithoutCapture(yp))==null?void 0:S.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return TZ(this.store)}loadSnapshot(e,t){return h5(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=St(e.shapeIds.map(o=>this.getShape(o))),r={};for(const o of t){const a=this.getAncestorPageId(o);a&&(r[a]??(r[a]=[]),r[a].push(o))}const[i,s]=Object.entries(r).sort(([o,a],[c,u])=>u.length-a.length)[0]??["",[]];if(!i||!s.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(i);const o=De.Common(s.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(o,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:Pr(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(RQ(r))}catch(i){console.warn(i),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL((e==null?void 0:e.url)??window.location.href);return t.searchParams.set((e==null?void 0:e.param)??"d",AQ((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=Ie("url with state",()=>{var c,u;const o=((c=e==null?void 0:e.getUrl)==null?void 0:c.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:o,to:(u=e==null?void 0:e.getTarget)==null?void 0:u.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var a;const o=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,o.toString())}),i=H0(o=>o(),(e==null?void 0:e.debounceMs)??500),s=To("update url on state change",()=>r(new URL(t.get()),this),{scheduleEffect:i});return()=>{s(),i.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Ii(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Ii(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Ii(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Ii(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of t)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:t}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:i,currentPagePoint:s}=t;t.isPointing||(t.isDragging=!1);const o=this.store.unsafeGetWithoutCapture(xi),a=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:u=1},delta:{x:d,y:f}}=e,{x:g,y:m}=T.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:v,y:w,z:S}=pm(()=>this.getCamera()),{panSpeed:b,zoomSpeed:x}=c;this._setCamera(new T(v+d*b/S-g/S+g/(u*x),w+f*b/S-m/S+m/(u*x),u*x),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(c.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:u,zoomSpeed:d,wheelBehavior:f}=c;if(f!=="none"){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:g,y:m,z:v}=pm(()=>this.getCamera()),{x:w,y:S,z:b=0}=e.delta;let x=f;switch(t.ctrlKey&&(x=f==="pan"?"zoom":"pan"),x){case"zoom":{const{x:E,y:M}=this.inputs.currentScreenPoint;let j=b;f==="zoom"&&(Math.abs(S)>10?j=10*Math.sign(S)/100:j=S/100);const D=v+(j??0)*d*v;this._setCamera(new T(g+(E/D-E)-(E/v-E),m+(M/D-M)-(M/v-M),D),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new T(g+w*u/v,m+S*u/v,v),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:u}=e,{isPenMode:d}=o;switch(e.name){case"pointer_down":{if(d&&!u)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const f=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(f.x,f.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===T3&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!d&&u&&this.updateInstanceState({isPenMode:!0}),e.button===k3?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===xm&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&d)return;const{x:f,y:g,z:m}=pm(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:v,previousScreenPoint:w}=this.inputs,{panSpeed:S}=c,b=T.Sub(v,w);this.setCamera(new T(f+b.x*S/m,g+b.y*S/m,m),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&T.Dist2(i,s)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/m&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),o.isPenMode&&!u)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const f=this.inputs.pointerVelocity,g=Math.min(2,f.len());switch(e.button){case T3:{this.setCursor({type:"grab",rotation:0});break}case xm:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}g>0&&this.slideCamera({speed:g,direction:f})}else e.button===k3&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let u;switch(e.code){case"ArrowUp":{u=new T(0,-1);break}case"ArrowRight":{u=new T(1,0);break}case"ArrowDown":{u=new T(0,1);break}case"ArrowLeft":{u=new T(-1,0);break}}if(u){const d=this.getViewportPageBounds(),f=d.clone().translate(u.mulV({x:d.w,y:d.h}));this._animateToViewport(f,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(xm)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===xm?e.name="middle_click":e.button===QC&&(e.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(xi);if(e.isPen===u){const d=this._clickManager.handlePointerEvent(e);if(e.name!==d.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(d),this.emit("event",d);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){mr.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}Ue=eee(WI);He(Ue,1,"getIsShapeHiddenCache",uB,Fe);He(Ue,1,"getCanUndo",lB,Fe);He(Ue,1,"getCanRedo",cB,Fe);He(Ue,1,"getPath",aB,Fe);He(Ue,1,"getCurrentTool",oB,Fe);He(Ue,1,"getCurrentToolId",sB,Fe);He(Ue,1,"getDocumentSettings",iB,Fe);He(Ue,1,"getInstanceState",rB,Fe);He(Ue,1,"getOpenMenus",nB,Fe);He(Ue,1,"getIsMenuOpen",tB,Fe);He(Ue,1,"getPageStates",eB,Fe);He(Ue,1,"_getPageStatesQuery",J8,Fe);He(Ue,1,"getCurrentPageState",Q8,Fe);He(Ue,1,"_getCurrentPageStateId",Z8,Fe);He(Ue,1,"getSelectedShapeIds",X8,Fe);He(Ue,1,"getSelectedShapes",Y8,Fe);He(Ue,1,"getOnlySelectedShapeId",V8,Fe);He(Ue,1,"getOnlySelectedShape",G8,Fe);He(Ue,1,"getSelectionPageBounds",q8,Fe);He(Ue,1,"getSelectionRotation",K8,Fe);He(Ue,1,"getSelectionRotatedPageBounds",W8,Fe);He(Ue,1,"getSelectionRotatedScreenBounds",H8,Fe);He(Ue,1,"getFocusedGroupId",$8,Fe);He(Ue,1,"getFocusedGroup",U8,Fe);He(Ue,1,"getEditingShapeId",z8,Fe);He(Ue,1,"getEditingShape",F8,Fe);He(Ue,1,"getHoveredShapeId",B8,Fe);He(Ue,1,"getHoveredShape",N8,Fe);He(Ue,1,"getHintingShapeIds",L8,Fe);He(Ue,1,"getHintingShape",O8,Fe);He(Ue,1,"getErasingShapeIds",D8,Fe);He(Ue,1,"getErasingShapes",j8,Fe);He(Ue,1,"_unsafe_getCameraId",R8,Fe);He(Ue,1,"getCamera",A8,Fe);He(Ue,1,"getViewportPageBoundsForFollowing",k8,Fe);He(Ue,1,"getCameraForFollowing",T8,Fe);He(Ue,1,"getZoomLevel",M8,Fe);He(Ue,1,"getViewportScreenBounds",P8,Fe);He(Ue,1,"getViewportScreenCenter",C8,Fe);He(Ue,1,"getViewportPageBounds",E8,Fe);He(Ue,1,"_getCollaboratorsQuery",I8,Fe);He(Ue,1,"getCollaborators",_8,Fe);He(Ue,1,"getCollaboratorsOnCurrentPage",b8,Fe);He(Ue,1,"getRenderingShapes",x8,Fe);He(Ue,1,"_getAllPagesQuery",S8,Fe);He(Ue,1,"getPages",v8,Fe);He(Ue,1,"getCurrentPageId",w8,Fe);He(Ue,1,"getCurrentPageShapeIdsSorted",y8,Fe);He(Ue,1,"_getAllAssetsQuery",m8,Fe);He(Ue,1,"_getShapeGeometryCache",g8,Fe);He(Ue,1,"_getShapeHandlesCache",p8,Fe);He(Ue,1,"_getShapePageTransformCache",f8,Fe);He(Ue,1,"_getShapePageBoundsCache",h8,Fe);He(Ue,1,"_getShapeClipPathCache",d8,Fe);He(Ue,1,"_getShapeMaskCache",u8,Fe);He(Ue,1,"_getShapeMaskedPageBoundsCache",l8,Fe);He(Ue,1,"_notVisibleShapes",c8,Fe);He(Ue,1,"getCulledShapes",a8,Fe);He(Ue,1,"getCurrentPageBounds",o8,Fe);He(Ue,1,"getCurrentPageShapes",s8,Fe);He(Ue,1,"getCurrentPageShapesSorted",i8,Fe);He(Ue,1,"getCurrentPageRenderingShapesSorted",r8,Fe);He(Ue,1,"_getBindingsIndexCache",n8,Fe);He(Ue,1,"_getSelectionSharedStyles",t8,Fe);He(Ue,1,"getSharedStyles",e8,Fe);He(Ue,1,"getSharedOpacity",J6,Fe);He(Ue,1,"getIsFocused",Q6,Fe);He(Ue,1,"getIsReadonly",Z6,Fe);He(Ue,1,"_setShiftKeyTimeout",X6,Fe);He(Ue,1,"_setAltKeyTimeout",Y6,Fe);He(Ue,1,"_setCtrlKeyTimeout",V6,Fe);He(Ue,1,"_setMetaKeyTimeout",G6,Fe);nee(Ue,Fe);function Pm(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function ea(n,e){if(!e)return n;let t=null;const r=Object.entries(e);for(let i=0,s=r.length;i<s;i++){const[o,a]=r[i];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==n[o]){if(t||(t={...n}),o==="props"||o==="meta"){t[o]={...n[o]};for(const[c,u]of Object.entries(a))u!==void 0&&(t[o][c]=u);continue}t[o]=a}}return t||n}function dB(n,e,t){const r=n.getShape(e);if(!r)return;t.push(r);const i=n.getSortedChildIdsForParent(e);for(let s=0,o=i.length;s<o;s++)dB(n,i[s],t)}function uj(n,e,t){let r;if(n.run(()=>{const i=n.store.extractingChanges(()=>{const s=new Set,o=new Set;for(const a of e)if(n.getShape(a))for(const u of n.getBindingsInvolvingShape(a)){const d=e.has(u.fromId),f=e.has(u.toId);if(d&&f){s.add(u.id);continue}(!d||!f)&&o.add(u.id)}n.deleteBindings([...o],{isolateShapes:!0});try{r=ll.ok(t(s))}catch(a){r=ll.err(a)}});n.store.applyDiff(gp(i))},{history:"ignore"}),r.ok)return r.value;throw r.error}function dj(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:r}}=e.constraints,i=n.getViewportScreenBounds(),s=De.From(e.constraints.bounds),o=(i.w-t*2)/s.w,a=(i.h-r*2)/s.h;return{zx:o,zy:a}}function eg(){const n=me(),e=Xp();return xe("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const hj="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",fj="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Mm='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Hc(n,e,t,r,i,s=16,o=16){const a=(-t-e)*(en/180),c=Math.sin(a),u=Math.cos(a),d=1*u-1*c,f=1*c+1*u;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${d}' dy='${f}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${s} ${o}, pointer`}const iee=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],see={none:()=>"none","ew-resize":(n,e,t)=>Hc(fj,n,0,e,t),"ns-resize":(n,e,t)=>Hc(fj,n,90,e,t),"nesw-resize":(n,e,t)=>Hc(hj,n,0,e,t),"nwse-resize":(n,e,t)=>Hc(hj,n,90,e,t),"nwse-rotate":(n,e,t)=>Hc(Mm,n,0,e,t),"nesw-rotate":(n,e,t)=>Hc(Mm,n,90,e,t),"senw-rotate":(n,e,t)=>Hc(Mm,n,180,e,t),"swne-rotate":(n,e,t)=>Hc(Mm,n,270,e,t)};function Ss(n,e=0,t="black"){return see[n](eY(e),!1,t)}function oee(){const n=me(),e=Mr(),t=eg();ul("useCursor",()=>{const{type:r,rotation:i}=n.getInstanceState().cursor;if(iee.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",Ss(r,i,t?"white":"black"))},[n,e,t])}function aee(){const n=me(),e=Mr(),t=eg(),r=xe(mr.forceSrgb);Ce.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function cee(){const[n,e]=P.useState(0);P.useEffect(()=>e(t=>t+1),[])}const lee=n=>n.props.src,uee={upload:(n,e)=>Io.blobToDataUrl(e)};function KI(n){return"schema"in n&&n.schema?n.schema:$V({shapes:"shapeUtils"in n&&n.shapeUtils?pj(m5(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?pj(p5(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function xp({initialData:n,defaultName:e="",id:t,assets:r=uee,onMount:i,collaboration:s,...o}={}){const a=KI(o),c=new NC({id:t,schema:a,initialData:n,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??lee},onMount:u=>{bt(u instanceof Fe),i==null||i(u)},collaboration:s}});if(o.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");h5(c,o.snapshot)}return c}function pj(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const dee=(n,e)=>e.some(t=>n instanceof t);let gj,mj;function hee(){return gj||(gj=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function fee(){return mj||(mj=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const hB=new WeakMap,qI=new WeakMap,fB=new WeakMap,ub=new WeakMap,w2=new WeakMap;function pee(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(oc(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&hB.set(t,n)}).catch(()=>{}),w2.set(e,n),e}function gee(n){if(qI.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});qI.set(n,e)}let GI={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return qI.get(n);if(e==="objectStoreNames")return n.objectStoreNames||fB.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return oc(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function mee(n){GI=n(GI)}function yee(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(db(this),e,...t);return fB.set(r,e.sort?e.sort():[e]),oc(r)}:fee().includes(n)?function(...e){return n.apply(db(this),e),oc(hB.get(this))}:function(...e){return oc(n.apply(db(this),e))}}function wee(n){return typeof n=="function"?yee(n):(n instanceof IDBTransaction&&gee(n),dee(n,hee())?new Proxy(n,GI):n)}function oc(n){if(n instanceof IDBRequest)return pee(n);if(ub.has(n))return ub.get(n);const e=wee(n);return e!==n&&(ub.set(n,e),w2.set(e,n)),e}const db=n=>w2.get(n);function pB(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=oc(o);return r&&o.addEventListener("upgradeneeded",c=>{r(oc(o.result),c.oldVersion,c.newVersion,oc(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function gB(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),oc(t).then(()=>{})}const vee=["get","getKey","getAll","getAllKeys","count"],See=["put","add","delete","clear"],hb=new Map;function yj(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(hb.get(e))return hb.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=See.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||vee.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),i&&c.done]))[0]};return hb.set(e,s),s}mee(n=>({...n,get:(e,t,r)=>yj(e,t)||n.get(e,t,r),has:(e,t)=>!!yj(e,t)||n.has(e,t)}));const xee="TLDRAW_DOCUMENT_v2",bee="TLDRAW_ASSET_STORE_v1",mB="TLDRAW_DB_NAME_INDEX_v2",Bt={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function yB(n){const e=xee+n;return Iee(e),await pB(e,4,{upgrade(t){t.objectStoreNames.contains(Bt.Records)||t.createObjectStore(Bt.Records),t.objectStoreNames.contains(Bt.Schema)||t.createObjectStore(Bt.Schema),t.objectStoreNames.contains(Bt.SessionState)||t.createObjectStore(Bt.SessionState),t.objectStoreNames.contains(Bt.Assets)||t.createObjectStore(Bt.Assets)}})}async function _ee(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(g=>g.name):v2(),t=bee+n;if(!e.find(g=>g===t))return;const i=await pB(t,1,{upgrade(g){g.objectStoreNames.contains("assets")||g.createObjectStore("assets")}});if(!i.objectStoreNames.contains("assets"))return;const s=i.transaction(["assets"],"readonly"),o=s.objectStore("assets"),a=await o.getAllKeys(),c=await Promise.all(a.map(async g=>[g,await o.get(g)]));await s.done;const u=await yB(n),d=u.transaction([Bt.Assets],"readwrite"),f=d.objectStore(Bt.Assets);for(const[g,m]of c)f.put(m,g);await d.done,i.close(),u.close(),await gB(t)}const up=class up{constructor(e){G(this,"getDbPromise");G(this,"isClosed",!1);G(this,"pendingTransactionSet",new Set);up.connectedInstances.add(this),this.getDbPromise=(async()=>(await _ee(e),await yB(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(dp)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),up.connectedInstances.delete(this))}tx(e,t,r){const i=(async()=>{bt(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e),a=o.done.catch(c=>{if(!this.isClosed)throw c});try{return await r(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(i),i.finally(()=>this.pendingTransactionSet.delete(i)),i}async load({sessionId:e}={}){return await this.tx("readonly",[Bt.Records,Bt.Schema,Bt.SessionState],async t=>{var c,u;const r=t.objectStore(Bt.Records),i=t.objectStore(Bt.Schema),s=t.objectStore(Bt.SessionState);let o=e?(c=await s.get(e))==null?void 0:c.snapshot:null;return o||(o=(u=(await s.getAll()).sort((f,g)=>f.updatedAt-g.updatedAt).pop())==null?void 0:u.snapshot),{records:await r.getAll(),schema:await i.get(Bt.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Bt.Records,Bt.Schema,Bt.SessionState],async s=>{const o=s.objectStore(Bt.Records),a=s.objectStore(Bt.Schema),c=s.objectStore(Bt.SessionState);for(const[u,d]of Object.entries(t.added))await o.put(d,u);for(const[u,d]of Object.values(t.updated))await o.put(d,d.id);for(const u of Object.keys(t.removed))await o.delete(u);a.put(e.serialize(),Bt.Schema),i&&r?c.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:i}){await this.tx("readwrite",[Bt.Records,Bt.Schema,Bt.SessionState],async s=>{const o=s.objectStore(Bt.Records),a=s.objectStore(Bt.Schema),c=s.objectStore(Bt.SessionState);await o.clear();for(const[u,d]of Object.entries(t))await o.put(d,u);a.put(e.serialize(),Bt.Schema),i&&r?c.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Bt.SessionState],async e=>{const t=e.objectStore(Bt.SessionState),r=(await t.getAll()).sort((s,o)=>s.updatedAt-o.updatedAt);if(r.length<10){await e.done;return}const i=r.slice(0,r.length-10);for(const{id:s}of i)await t.delete(s)})}async getAsset(e){return await this.tx("readonly",[Bt.Assets],async t=>await t.objectStore(Bt.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[Bt.Assets],async r=>{await r.objectStore(Bt.Assets).put(t,e)})}};G(up,"connectedInstances",new Set);let g0=up;function v2(){const n=JSON.parse(SC(mB)||"[]")??[];return Array.isArray(n)?n:[]}function Iee(n){const e=new Set(v2());e.add(n),xC(mB,JSON.stringify([...e]))}function Eee(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function Cee(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const Pee=350,Mee=1e4,wj=Symbol("UPDATE_INSTANCE_STATE"),Tee=n=>n;class kee{constructor(e){G(this,"onmessage")}postMessage(e){}close(){}}const Aee=typeof BroadcastChannel>"u"?kee:BroadcastChannel;class Ree{constructor(e,{persistenceKey:t,sessionId:r=Sp,onLoad:i,onLoadError:s},o=new Aee(`tldraw-tab-sync-${t}`)){G(this,"disposables",new Set);G(this,"diffQueue",[]);G(this,"didDispose",!1);G(this,"shouldDoFullDBWrite",!0);G(this,"isReloading",!1);G(this,"persistenceKey");G(this,"sessionId");G(this,"serializedSchema");G(this,"isDebugging",!1);G(this,"documentTypes");G(this,"$sessionStateSnapshot");G(this,"db");G(this,"initTime",Date.now());G(this,"isPersisting",!1);G(this,"didLastWriteError",!1);G(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.db=new g0(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=s2(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(Tee({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(wj),this.schedulePersist()},{scope:"session"})),this.connect(i,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(i){t(i),Cee();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const i=Object.fromEntries(r.records.map(c=>[c.id,c])),s=r.sessionStateSnapshot??MZ(i),o=this.store.schema.migrateStoreSnapshot({store:i,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),t(new Error(`Failed to migrate store: ${o.reason}`));return}const a=Object.values(o.value).filter(c=>this.documentTypes.has(c.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),s&&NI(this.store,s)}this.channel.onmessage=({data:i})=>{var a,c;this.debug("got message",i);const s=i,o=this.store.schema.getMigrationsSince(s.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}s.type==="diff"&&(this.debug("applying diff"),Js(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(i){if(this.debug("error loading data from store",i),this.didDispose)return;t(i);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?Mee:Pee))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(bt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=Q0(e.filter(r=>r!==wj));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),Eee(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function S2(n){const e=P.useRef(n),[t,r]=P.useState(n);t!==e.current&&r(e.current);const i=P.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,r(e.current)},[]);return[t,i]}function jee(n){const[e,t]=S2({status:"loading"});return n=zu(n),P.useEffect(()=>{const{persistenceKey:r,sessionId:i,...s}=n;if(!r){t({status:"not-synced",store:xp(s)});return}t({status:"loading"});const o=new ha,a={upload:async(f,g)=>(await d.db.storeAsset(f.id,g),f.id),resolve:async f=>f.props.src?f.props.src.startsWith("asset:")?await o.get(f,async()=>{const g=await d.db.getAsset(f.id);return g?URL.createObjectURL(g):null}):f.props.src:null,...s.assets},c=xp({...s,assets:a});let u=!1;const d=new Ree(c,{sessionId:i,persistenceKey:r,onLoad(){u||t({store:c,status:"synced-local"})},onLoadError(f){u||t({status:"error",error:f})}});return()=>{u=!0,d.close()}},[n,t]),e}function Dee(){const n=me(),e=Mr();P.useEffect(()=>{const t=s=>e.style.setProperty("--tl-zoom",s.toString()),r=H0(t,100),i=new Ph("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return i.attach(),i.execute(),()=>{i.detach(),r.cancel()}},[n,e])}function VI(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0,i=n.length;r<i;r++)t[r]=n.charCodeAt(r);return e}function Oee(n){const e=atob(n),t=VI(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const Lee=5,Hf={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},Nee=Math.max(...Object.values(Hf)),Wf={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},Bee=Object.keys(Wf).length,fb="sales@tldraw.com",Fee=`${ol()}/watermarks/watermark-track.svg`;class yw{constructor(e,t,r){G(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");G(this,"isDevelopment");G(this,"isTest");G(this,"isCryptoAvailable");G(this,"state",cr("license state","pending"));G(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(i=>{const s=zee(i);!this.isDevelopment&&s&&fa(Fee),s?this.state.set("unlicensed"):i.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,r]=e.split("."),[i,s]=t.split("/");if(!i.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${i}'`);const o=await Oee(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(VI(atob(r))),new Uint8Array(VI(atob(s))))}catch(u){throw console.error(u),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return c.length>Bee&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[Wf.ID],hosts:c[Wf.HOSTS],flags:c[Wf.FLAGS],expiryDate:c[Wf.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(t),i=new Date(r.expiryDate),s=this.isFlagEnabled(r.flags,Hf.ANNUAL_LICENSE),o=this.isFlagEnabled(r.flags,Hf.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:i,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(i),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(i),isInternalLicense:this.isFlagEnabled(r.flags,Hf.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,Hf.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const i=r.toLowerCase().trim();if(i===t||`www.${i}`===t||i===`www.${t}`||r==="*")return!0;if(r.includes("*")){const s=new RegExp(r.replace(/\*/g,".*?"));return s.test(t)||s.test(`www.${t}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+Lee+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r=new Date>=t;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${fb} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r={major:new Date(I3.major),minor:new Date(I3.minor)};return r.major>=t||r.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${fb} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${fb} if you would like to use tldraw on other domains.`]),e.license.flags>=Nee*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}G(yw,"className","tl-watermark_SEE-LICENSE");function zee(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const wB=P.createContext({}),Uee=()=>P.useContext(wB);function $ee({licenseKey:n,children:e}){const[t]=P.useState(()=>new yw(n));return p.jsx(wB.Provider,{value:t,children:e})}function Ml(n){if(!n)throw Error("usePassThroughWheelEvents must be passed a ref");const e=Mr();P.useEffect(()=>{function t(i){if(i.isSpecialRedispatchedEvent)return;kt(i);const s=e.querySelector(".tl-canvas");if(!s)return;const o=new WheelEvent("wheel",i);o.isSpecialRedispatchedEvent=!0,s.dispatchEvent(o)}const r=n.current;if(r)return r.addEventListener("wheel",t,{passive:!1}),()=>{r.removeEventListener("wheel",t)}},[e,n])}const Hee='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',Wee='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function Kee(n){return xe("watermarkState",()=>n.state.get(),[n])}const qee=`data:image/svg+xml;utf8,${encodeURIComponent(Hee)}`,Gee=`data:image/svg+xml;utf8,${encodeURIComponent(Wee)}`,Vee=P.memo(function(){const e=Uee(),t=me(),r=xe("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),i=Kee(e);return["licensed-with-watermark","unlicensed"].includes(i)?p.jsxs(p.Fragment,{children:[p.jsx(Xee,{}),p.jsx(Yee,{src:r?Gee:qee})]}):null}),Yee=P.memo(function({src:e}){const t=me(),r=xe("debug mode",()=>t.getInstanceState().isDebugMode,[t]),i=xe("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),s=JC(),o=P.useRef(null);Ml(o);const a=`url('${e}') center 100% / 100% no-repeat`,c="https://tldraw.dev";return p.jsx("div",{ref:o,className:yw.className,"data-debug":r,"data-mobile":i,draggable:!1,...s,children:_n.isWebview?p.jsx("a",{draggable:!1,role:"button",onPointerDown:u=>{Sr(u),kt(u)},onClick:()=>sw.openWindow(c,"_blank"),style:{mask:a,WebkitMask:a}}):p.jsx("a",{href:c,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:u=>{Sr(u)},style:{mask:a,WebkitMask:a}})})}),Xee=P.memo(function(){const e=yw.className,t=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}

	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return p.jsx("style",{children:t})}),Zee=[],Qee=[],Jee=[],ete="tl-container",tte=P.memo(function({store:e,components:t,className:r,user:i,options:s,...o}){const[a,c]=P.useState(null),u=P.useMemo(()=>i??c5(),[i]),d=(t==null?void 0:t.ErrorFallback)===void 0?e5:t==null?void 0:t.ErrorFallback,f={...o,shapeUtils:o.shapeUtils??Zee,bindingUtils:o.bindingUtils??Qee,tools:o.tools??Jee,components:t,options:zu(s)};return p.jsx("div",{ref:c,"data-tldraw":CN,draggable:!1,className:rt(`${ete} tl-theme__light`,r),onPointerDown:Sr,tabIndex:-1,children:p.jsx(vp,{fallback:d,onError:g=>fC(g,{tags:{origin:"react.tldraw-before-app"}}),children:a&&p.jsx($ee,{licenseKey:o.licenseKey,children:p.jsx(jN,{container:a,children:p.jsx(fZ,{overrides:t,children:e?e instanceof NC?p.jsx(SB,{...f,store:e,user:u}):p.jsx(vB,{...f,store:e,user:u}):p.jsx(nte,{...f,store:e,user:u})})})})})})});function nte(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:i,bindingUtils:s,persistenceKey:o,sessionId:a,user:c,assets:u}=n,d=jee({shapeUtils:i,bindingUtils:s,initialData:r,persistenceKey:o,sessionId:a,defaultName:e,snapshot:t,assets:u});return p.jsx(vB,{...n,store:d,user:c})}const vB=P.memo(function({store:e,user:t,...r}){const i=Mr();P.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(i.classList.remove("tl-theme__light"),i.classList.add("tl-theme__dark"))},[i,t]);const{LoadingScreen:s}=$n();switch(e.status){case"error":throw e.error;case"loading":return s?p.jsx(s,{}):null}return p.jsx(SB,{...r,store:e.store,user:t})}),pb=()=>document.location.search.includes("tldraw_preserve_focus");function SB({onMount:n,children:e,store:t,tools:r,shapeUtils:i,bindingUtils:s,user:o,initialState:a,autoFocus:c=!0,inferDarkMode:u,cameraOptions:d,options:f,licenseKey:g,deepLinks:m,isShapeHidden:v}){const{ErrorFallback:w}=$n(),S=Mr(),[b,x]=S2(null),E=P.useRef(null),M=zu(m===!0?{}:m),j=P.useRef({autoFocus:c&&!pb(),inferDarkMode:u,initialState:a,cameraOptions:d,deepLinks:M});P.useLayoutEffect(()=>{j.current={autoFocus:c&&!pb(),inferDarkMode:u,initialState:a,cameraOptions:d,deepLinks:M}},[c,u,a,d,M]),P.useLayoutEffect(()=>{const{autoFocus:L,inferDarkMode:U,initialState:z,cameraOptions:Y,deepLinks:V}=j.current,N=new Fe({store:t,shapeUtils:i,bindingUtils:s,tools:r,getContainer:()=>S,user:o,initialState:z,autoFocus:L,inferDarkMode:U,cameraOptions:Y,options:f,licenseKey:g,isShapeHidden:v});return N.updateViewportScreenBounds(E.current??S),V&&(V!=null&&V.getUrl?N.navigateToDeepLink({...V,url:V.getUrl(N)}):N.navigateToDeepLink(V)),x(N),()=>{N.dispose()}},[s,S,f,i,t,r,o,x,g,v]),P.useLayoutEffect(()=>{if(b&&M)return b.registerDeepLinkListener(M)},[b,M]),P.useLayoutEffect(()=>{b&&d&&b.setCameraOptions(d)},[b,d]);const D=P.useSyncExternalStore(P.useCallback(L=>b?(b.on("crash",L),()=>b.off("crash",L)):()=>{},[b]),()=>(b==null?void 0:b.getCrashingError())??null);P.useEffect(function(){if(!b)return;function U(){b&&b.focus()}function z(){b&&b.blur()}if(c&&pb())return b.getContainer().addEventListener("pointerdown",U),document.body.addEventListener("pointerdown",z),()=>{var Y;(Y=b.getContainer())==null||Y.removeEventListener("pointerdown",U),document.body.removeEventListener("pointerdown",z)}},[b,c]);const{Canvas:H}=$n();return b?p.jsx(vp,{fallback:w,onError:L=>b.annotateError(L,{origin:"react.tldraw",willCrashApp:!0}),children:D?p.jsx(ite,{crashingError:D}):p.jsx(XC,{editor:b,children:p.jsxs(rte,{onMount:n,children:[e??(H?p.jsx(H,{}):null),p.jsx(Vee,{})]})})}):p.jsx("div",{className:"tl-canvas",ref:E})}function rte({children:n,onMount:e}){return Dee(),oee(),aee(),cee(),bB(t=>{const r=t.store.props.onMount(t),i=e==null?void 0:e(t);return()=>{r==null||r(),i==null||i()}}),n}function ite({crashingError:n}){throw n}function x2({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function xB({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function bB(n){const e=me(),t=dw(r=>{let i;return r.run(()=>{i=n==null?void 0:n(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,i});Ce.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function hl({children:n,className:e="",...t}){return p.jsx("div",{...t,className:rt("tl-html-container",e),children:n})}class fy{constructor(e){this.editor=e}}G(fy,"props"),G(fy,"migrations"),G(fy,"type");function ww(n,e,t={}){const{newPoint:r,handle:i,scaleX:s,scaleY:o}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:u=1,maxHeight:d=1/0}=t;let f=n.props.w*s,g=n.props.h*o;const m=new T(0,0);if(f>0){if(f<a){switch(i){case"top_left":case"left":case"bottom_left":{m.x=f-a;break}case"top":case"bottom":{m.x=(f-a)/2;break}default:m.x=0}f=a}}else if(m.x=f,f=-f,f<a){switch(i){case"top_left":case"left":case"bottom_left":{m.x=-f;break}default:m.x=-a}f=a}if(g>0){if(g<u){switch(i){case"top_left":case"top":case"top_right":{m.y=g-u;break}case"right":case"left":{m.y=(g-u)/2;break}default:m.y=0}g=u}}else if(m.y=g,g=-g,g<u){switch(i){case"top_left":case"top":case"top_right":{m.y=-g;break}default:m.y=-u}g=u}const{x:v,y:w}=m.rot(n.rotation).add(r);return{...n,x:v,y:w,props:{w:Math.min(c,f),h:Math.min(d,g)}}}class jh extends Ao{getGeometry(e){return new ga({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return ww(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,r){return{...t.props,w:zt(e.props.w,t.props.w,r),h:zt(e.props.h,t.props.h,r)}}}var tI;let ste=(tI=class extends Ye{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},G(tI,"id","idle"),tI);var nI;let ote=(nI=class extends Ye{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,i=wn(),s=this.editor.markHistoryStoppingPoint(`creating_box:${i}`),o=jo(t,this.editor);this.editor.createShapes([{id:i,type:r,x:o.x,y:o.y,props:{w:1,h:1}}]).select(i);const a=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:a.onCreate?c=>{var u;return(u=a.onCreate)==null?void 0:u.call(a,c)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,r=wn();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const i=this.editor.getShape(r);if(!i){this.cancel();return}let{w:s,h:o}=i.props;const a=new T(s/2,o/2),c=this.editor.getShapeParentTransform(i);c&&a.rot(-c.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),s*=u,o*=u,a.mul(u));const d=Un(i),f=jo(new T(i.x-a.x,i.y-a.y),this.editor);d.x=f.x,d.y=f.y,d.props.w=s,d.props.h=o,"scale"in i.props&&(d.props.scale=u),this.editor.updateShape(d),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},G(nI,"id","pointing"),nI);function jo(n,e){const t=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return t?n.clone().snapToGrid(r):n.clone()}class YI extends Ye{static children(){return[ste,ote]}}G(YI,"id","box"),G(YI,"initial","idle");function ate(n,e,t){const r=P.useRef(!1),i=P.useCallback(o=>{r.current=o,o?xo.addOpenMenu(n):xo.deleteOpenMenu(n),e==null||e(o)},[n,e]),s=xe("is menu open",()=>xo.getOpenMenus().includes(n),[n]);return P.useEffect(()=>(r.current&&(t==null||t("open-menu"),xo.addOpenMenu(n)),()=>{r.current&&(xo.deleteOpenMenu(n),xo.getOpenMenus().forEach(o=>{o.startsWith(n)&&(t==null||t("close-menu"),xo.deleteOpenMenu(o))}),r.current=!1)}),[n,t]),[s,i]}function vw(n){const e=me();return xe("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function ia(n){const e=me();return P.useMemo(function(){const i=u=>{if(u.isKilled)return;if(u.button===QC){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Ms(u)});return}if(u.button!==0)return;const d=f0(u.currentTarget);function f(){d.removeEventListener("pointerup",f),qp(d,u)}Kp(d,u),d.addEventListener("pointerup",f),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Ms(u)}),Sr(u)};let s,o;function a(u){u.isKilled||u.button===0&&(u.clientX===s&&u.clientY===o||(s=u.clientX,o=u.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Ms(u)})))}return{onPointerDown:i,onPointerMove:a,onPointerUp:u=>{u.isKilled||u.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Ms(u)})}}},[e,n])}function cte(n){const[e,t]=P.useState(()=>({store:xp(n),opts:n}));if(!mC(e.opts,n)){const r={store:xp(n),opts:n};return t(r),r.store}return e.store}function lte(n){const[e,t]=P.useState(()=>({opts:n,schema:KI(n)}));if(!mC(e.opts,n)){const r=KI(n);return t({opts:n,schema:r}),r}return e.schema}const ute=20,dte=8;function b2(n,e=ute){return Math.max(dte,Math.ceil(n/e))}class Hd extends Pl{constructor(t){super({...t,isFilled:!1,isClosed:!1});G(this,"_center");G(this,"radius");G(this,"start");G(this,"end");G(this,"largeArcFlag");G(this,"sweepFlag");G(this,"measure");G(this,"angleStart");G(this,"angleEnd");const{center:r,sweepFlag:i,largeArcFlag:s,start:o,end:a}=t;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=T.Angle(r,o),this.angleEnd=T.Angle(r,a),this.radius=T.Dist(r,o),this.measure=tY(this.angleStart,this.angleEnd,i,s),this.start=o,this.end=a,this.sweepFlag=i,this.largeArcFlag=s,this._center=r}nearestPoint(t){const{_center:r,measure:i,radius:s,angleEnd:o,angleStart:a,start:c,end:u}=this,d=jI(i,a,o,r.angle(t));if(d<=0)return c;if(d>=1)return u;const f=r.clone().add(t.clone().sub(r).uni().mul(s));let g,m=1/0,v;for(const w of[c,u,f])v=T.Dist2(t,w),v<m&&(g=w,m=v);if(!g)throw Error("nearest point not found");return g}hitTestLineSegment(t,r){const{_center:i,radius:s,measure:o,angleStart:a,angleEnd:c}=this,u=Yp(t,r,i,s);return u===null?!1:u.some(d=>{const f=jI(o,a,c,i.angle(d));return f>=0&&f<=1})}getVertices(){const{_center:t,measure:r,length:i,radius:s,angleStart:o}=this,a=[];for(let c=0,u=b2(Math.abs(i));c<u+1;c++){const d=c/u*r,f=o+d;a.push(Cu(t,s,f))}return a}getSvgPathData(t=!0){const{start:r,end:i,radius:s,largeArcFlag:o,sweepFlag:a}=this;return`${t?`M${r.toFixed()}`:""} A${s} ${s} 0 ${o} ${a} ${i.toFixed()}`}getLength(){return this.measure*this.radius}}class _2 extends Pl{constructor(t){super({isClosed:!0,...t});G(this,"_center");G(this,"radius");G(this,"x");G(this,"y");this.config=t;const{x:r=0,y:i=0,radius:s}=t;this.x=r,this.y=i,this._center=new T(s+r,s+i),this.radius=s}getBounds(){return new De(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,i=un*r,s=[];for(let o=0,a=b2(i);o<a;o++){const c=o/a*un;s.push(Cu(t,r,c))}return s}nearestPoint(t){const{_center:r,radius:i}=this;return r.equals(t)?T.AddXY(r,i,0):r.clone().add(t.clone().sub(r).uni().mul(i))}hitTestLineSegment(t,r,i=0){const{_center:s,radius:o}=this;return Yp(t,r,s,o+i)!==null}getSvgPathData(){const{_center:t,radius:r}=this;return`M${t.x+r},${t.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class Si extends kh{constructor(t){const{start:r,cp1:i,cp2:s,end:o}=t;super({...t,points:[r,o]});G(this,"a");G(this,"b");G(this,"c");G(this,"d");this.a=r,this.b=i,this.c=s,this.d=o}getVertices(){const t=[],{a:r,b:i,c:s,d:o}=this;for(let a=0,c=10;a<=c;a++){const u=a/c;t.push(new T((1-u)*(1-u)*(1-u)*r.x+3*((1-u)*(1-u))*u*i.x+3*(1-u)*(u*u)*s.x+u*u*u*o.x,(1-u)*(1-u)*(1-u)*r.y+3*((1-u)*(1-u))*u*i.y+3*(1-u)*(u*u)*s.y+u*u*u*o.y))}return t}midPoint(){return Si.GetAtT(this,.5)}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(t),s=T.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(t=!0){const{a:r,b:i,c:s,d:o}=this;return`${t?`M ${r.toFixed()} `:""} C${i.toFixed()} ${s.toFixed()} ${o.toFixed()}`}static GetAtT(t,r){const{a:i,b:s,c:o,d:a}=t;return new T((1-r)*(1-r)*(1-r)*i.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*o.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*i.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*o.y+r*r*r*a.y)}getLength(t=32){let r,i=this.a,s=0;for(let o=1;o<=t;o++)r=Si.GetAtT(this,o/t),s+=T.Dist(i,r),i=r;return s}}class hte extends Pl{constructor(t){super({...t,isClosed:!1,isFilled:!1});G(this,"points");G(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,i=r-2,s=1.25;for(let o=0;o<r-1;o++){const a=o===0?t[0]:t[o-1],c=t[o],u=t[o+1],d=o===i?u:t[o+2],f=c,g=o===0?a:new T(c.x+(u.x-a.x)/6*s,c.y+(u.y-a.y)/6*s),m=o===i?u:new T(u.x-(d.x-c.x)/6*s,u.y-(d.y-c.y)/6*s),v=u;this._segments.push(new Si({start:f,cp1:g,cp2:m,end:v}))}}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){const t=this.segments.reduce((r,i)=>r.concat(i.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.segments)o=a.nearestPoint(t),s=T.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.segments.some(i=>i.hitTestLineSegment(t,r))}getSvgPathData(){let t=this.segments.reduce((r,i,s)=>r+i.getSvgPathData(s===0),"");return this.isClosed&&(t+="Z"),t}}class fte extends Pl{constructor(t){super({...t,isClosed:!0});G(this,"w");G(this,"h");G(this,"_edges");this.config=t;const{width:r,height:i}=t;this.w=r,this.h=i}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,i=t.length;r<i;r++){const s=t[r],o=t[(r+1)%i];this._edges.push(new ec({start:s,end:o}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),i=t/2,s=r/2,o=Math.pow(i-s,2)/Math.pow(i+s,2),a=en*(i+s)*(1+3*o/(10+Math.sqrt(4-3*o))),c=b2(a),u=un/c,d=Math.cos(u),f=Math.sin(u);let g=0,m=1,v=0,w=1;const S=Array(c);for(let b=0;b<c;b++)S[b]=new T(i+i*m,s+s*g),v=f*m+d*g,w=d*m-f*g,g=v,m=w;return S}nearestPoint(t){let r,i=1/0,s,o;for(const a of this.edges)o=a.nearestPoint(t),s=T.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.edges.some(i=>i.hitTestLineSegment(t,r))}getBounds(){return new De(0,0,this.w,this.h)}getLength(){const{w:t,h:r}=this,i=t/2,s=r/2,o=Math.max(0,i),a=Math.max(0,s);return MN(o,a)}getSvgPathData(t=!1){const{w:r,h:i}=this,s=r/2,o=i/2,a=Math.max(0,s),c=Math.max(0,o);return`${t?`M${s-a},${o}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class pte extends Pl{constructor(t){super({...t,isClosed:!0});G(this,"w");G(this,"h");G(this,"a");G(this,"b");G(this,"c");G(this,"d");this.config=t;const{width:r,height:i}=t;if(this.w=r,this.h=i,i>r){const s=r/2;this.a=new Hd({start:new T(0,s),end:new T(r,s),center:new T(r/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new ec({start:new T(r,s),end:new T(r,i-s)}),this.c=new Hd({start:new T(r,i-s),end:new T(0,i-s),center:new T(r/2,i-s),sweepFlag:1,largeArcFlag:1}),this.d=new ec({start:new T(0,i-s),end:new T(0,s)})}else{const s=i/2;this.a=new Hd({start:new T(s,i),end:new T(s,0),center:new T(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new ec({start:new T(s,0),end:new T(r-s,0)}),this.c=new Hd({start:new T(r-s,0),end:new T(r-s,i),center:new T(r-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new ec({start:new T(r-s,i),end:new T(s,i)})}}nearestPoint(t){let r,i=1/0,s,o;const{a,b:c,c:u,d}=this;for(const f of[a,c,u,d])o=f.nearestPoint(t),s=T.Dist2(o,t),s<i&&(r=o,i=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){const{a:i,b:s,c:o,d:a}=this;return[i,s,o,a].some(c=>c.hitTestLineSegment(t,r))}getVertices(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].reduce((o,a)=>(o.push(...a.vertices),o),[])}getBounds(){return new De(0,0,this.w,this.h)}getLength(){const{h:t,w:r}=this;return t>r?(en*(r/2)+(t-r))*2:(en*(t/2)+(r-t))*2}getSvgPathData(){const{a:t,b:r,c:i,d:s}=this;return[t,r,i,s].map((o,a)=>o.getSvgPathData(a===0)).join(" ")+" Z"}}async function gte({shouldReload:n=!0}={}){qK();for(const e of g0.connectedInstances)await e.close();await Promise.all(v2().map(e=>gB(e))),KK(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=gte);function mte(n,e="_blank"){sw.openWindow(n,e)}xa("@tldraw/editor","3.5.1","esm");const _B=()=>{},IB=P.createContext(null);function yte({onEvent:n,children:e}){return p.jsx(IB.Provider,{value:n??_B,children:e})}function ri(){return P.useContext(IB)??_B}function Ge(n,e,{checkForDefaultPrevented:t=!0}={}){return function(i){if(n==null||n(i),t===!1||!i.defaultPrevented)return e==null?void 0:e(i)}}function wte(n,e){const t=P.createContext(e),r=s=>{const{children:o,...a}=s,c=P.useMemo(()=>a,Object.values(a));return p.jsx(t.Provider,{value:c,children:o})};r.displayName=n+"Provider";function i(s){const o=P.useContext(t);if(o)return o;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return[r,i]}function $u(n,e=[]){let t=[];function r(s,o){const a=P.createContext(o),c=t.length;t=[...t,o];const u=f=>{var b;const{scope:g,children:m,...v}=f,w=((b=g==null?void 0:g[n])==null?void 0:b[c])||a,S=P.useMemo(()=>v,Object.values(v));return p.jsx(w.Provider,{value:S,children:m})};u.displayName=s+"Provider";function d(f,g){var w;const m=((w=g==null?void 0:g[n])==null?void 0:w[c])||a,v=P.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return[u,d]}const i=()=>{const s=t.map(o=>P.createContext(o));return function(a){const c=(a==null?void 0:a[n])||s;return P.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return i.scopeName=n,[r,vte(i,...e)]}function vte(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:u})=>{const f=c(s)[`__scope${u}`];return{...a,...f}},{});return P.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Ste(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function Sw(...n){return e=>n.forEach(t=>Ste(t,e))}function Dn(...n){return P.useCallback(Sw(...n),n)}var Pu=P.forwardRef((n,e)=>{const{children:t,...r}=n,i=P.Children.toArray(t),s=i.find(bte);if(s){const o=s.props.children,a=i.map(c=>c===s?P.Children.count(o)>1?P.Children.only(null):P.isValidElement(o)?o.props.children:null:c);return p.jsx(XI,{...r,ref:e,children:P.isValidElement(o)?P.cloneElement(o,void 0,a):null})}return p.jsx(XI,{...r,ref:e,children:t})});Pu.displayName="Slot";var XI=P.forwardRef((n,e)=>{const{children:t,...r}=n;if(P.isValidElement(t)){const i=Ite(t);return P.cloneElement(t,{..._te(r,t.props),ref:e?Sw(e,i):i})}return P.Children.count(t)>1?P.Children.only(null):null});XI.displayName="SlotClone";var xte=({children:n})=>p.jsx(p.Fragment,{children:n});function bte(n){return P.isValidElement(n)&&n.type===xte}function _te(n,e){const t={...e};for(const r in e){const i=n[r],s=e[r];/^on[A-Z]/.test(r)?i&&s?t[r]=(...a)=>{s(...a),i(...a)}:i&&(t[r]=i):r==="style"?t[r]={...i,...s}:r==="className"&&(t[r]=[i,s].filter(Boolean).join(" "))}return{...n,...t}}function Ite(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var Ete=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Vt=Ete.reduce((n,e)=>{const t=P.forwardRef((r,i)=>{const{asChild:s,...o}=r,a=s?Pu:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),p.jsx(a,{...o,ref:i})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function I2(n,e){n&&wl.flushSync(()=>n.dispatchEvent(e))}function Cte(n,e=[]){let t=[];function r(s,o){const a=P.createContext(o),c=t.length;t=[...t,o];function u(f){const{scope:g,children:m,...v}=f,w=(g==null?void 0:g[n][c])||a,S=P.useMemo(()=>v,Object.values(v));return p.jsx(w.Provider,{value:S,children:m})}function d(f,g){const m=(g==null?void 0:g[n][c])||a,v=P.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,d]}const i=()=>{const s=t.map(o=>P.createContext(o));return function(a){const c=(a==null?void 0:a[n])||s;return P.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return i.scopeName=n,[r,Pte(i,...e)]}function Pte(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:u})=>{const f=c(s)[`__scope${u}`];return{...a,...f}},{});return P.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function xw(n){const e=n+"CollectionProvider",[t,r]=Cte(e),[i,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),o=m=>{const{scope:v,children:w}=m,S=Ce.useRef(null),b=Ce.useRef(new Map).current;return p.jsx(i,{scope:v,itemMap:b,collectionRef:S,children:w})};o.displayName=e;const a=n+"CollectionSlot",c=Ce.forwardRef((m,v)=>{const{scope:w,children:S}=m,b=s(a,w),x=Dn(v,b.collectionRef);return p.jsx(Pu,{ref:x,children:S})});c.displayName=a;const u=n+"CollectionItemSlot",d="data-radix-collection-item",f=Ce.forwardRef((m,v)=>{const{scope:w,children:S,...b}=m,x=Ce.useRef(null),E=Dn(v,x),M=s(u,w);return Ce.useEffect(()=>(M.itemMap.set(x,{ref:x,...b}),()=>void M.itemMap.delete(x))),p.jsx(Pu,{[d]:"",ref:E,children:S})});f.displayName=u;function g(m){const v=s(n+"CollectionConsumer",m);return Ce.useCallback(()=>{const S=v.collectionRef.current;if(!S)return[];const b=Array.from(S.querySelectorAll(`[${d}]`));return Array.from(v.itemMap.values()).sort((M,j)=>b.indexOf(M.ref.current)-b.indexOf(j.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:o,Slot:c,ItemSlot:f},g,r]}var Mte=P.createContext(void 0);function E2(n){const e=P.useContext(Mte);return n||e||"ltr"}function ei(n){const e=P.useRef(n);return P.useEffect(()=>{e.current=n}),P.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function Tte(n,e=globalThis==null?void 0:globalThis.document){const t=ei(n);P.useEffect(()=>{const r=i=>{i.key==="Escape"&&t(i)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var kte="DismissableLayer",ZI="dismissableLayer.update",Ate="dismissableLayer.pointerDownOutside",Rte="dismissableLayer.focusOutside",vj,EB=P.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),tg=P.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:i,onFocusOutside:s,onInteractOutside:o,onDismiss:a,...c}=n,u=P.useContext(EB),[d,f]=P.useState(null),g=(d==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,m]=P.useState({}),v=Dn(e,H=>f(H)),w=Array.from(u.layers),[S]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=w.indexOf(S),x=d?w.indexOf(d):-1,E=u.layersWithOutsidePointerEventsDisabled.size>0,M=x>=b,j=Dte(H=>{const L=H.target,U=[...u.branches].some(z=>z.contains(L));!M||U||(i==null||i(H),o==null||o(H),H.defaultPrevented||a==null||a())},g),D=Ote(H=>{const L=H.target;[...u.branches].some(z=>z.contains(L))||(s==null||s(H),o==null||o(H),H.defaultPrevented||a==null||a())},g);return Tte(H=>{x===u.layers.size-1&&(r==null||r(H),!H.defaultPrevented&&a&&(H.preventDefault(),a()))},g),P.useEffect(()=>{if(d)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(vj=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),Sj(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=vj)}},[d,g,t,u]),P.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),Sj())},[d,u]),P.useEffect(()=>{const H=()=>m({});return document.addEventListener(ZI,H),()=>document.removeEventListener(ZI,H)},[]),p.jsx(Vt.div,{...c,ref:v,style:{pointerEvents:E?M?"auto":"none":void 0,...n.style},onFocusCapture:Ge(n.onFocusCapture,D.onFocusCapture),onBlurCapture:Ge(n.onBlurCapture,D.onBlurCapture),onPointerDownCapture:Ge(n.onPointerDownCapture,j.onPointerDownCapture)})});tg.displayName=kte;var jte="DismissableLayerBranch",CB=P.forwardRef((n,e)=>{const t=P.useContext(EB),r=P.useRef(null),i=Dn(e,r);return P.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),p.jsx(Vt.div,{...n,ref:i})});CB.displayName=jte;function Dte(n,e=globalThis==null?void 0:globalThis.document){const t=ei(n),r=P.useRef(!1),i=P.useRef(()=>{});return P.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){PB(Ate,t,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",i.current),i.current=c,e.addEventListener("click",i.current,{once:!0})):c()}else e.removeEventListener("click",i.current);r.current=!1},o=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(o),e.removeEventListener("pointerdown",s),e.removeEventListener("click",i.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Ote(n,e=globalThis==null?void 0:globalThis.document){const t=ei(n),r=P.useRef(!1);return P.useEffect(()=>{const i=s=>{s.target&&!r.current&&PB(Rte,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",i),()=>e.removeEventListener("focusin",i)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function Sj(){const n=new CustomEvent(ZI);document.dispatchEvent(n)}function PB(n,e,t,{discrete:r}){const i=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?I2(i,s):i.dispatchEvent(s)}var Lte=tg,Nte=CB,gb=0;function C2(){P.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??xj()),document.body.insertAdjacentElement("beforeend",n[1]??xj()),gb++,()=>{gb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),gb--}},[])}function xj(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.outline="none",n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",n}var mb="focusScope.autoFocusOnMount",yb="focusScope.autoFocusOnUnmount",bj={bubbles:!1,cancelable:!0},Bte="FocusScope",bw=P.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:i,onUnmountAutoFocus:s,...o}=n,[a,c]=P.useState(null),u=ei(i),d=ei(s),f=P.useRef(null),g=Dn(e,w=>c(w)),m=P.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;P.useEffect(()=>{if(r){let w=function(E){if(m.paused||!a)return;const M=E.target;a.contains(M)?f.current=M:Qc(f.current,{select:!0})},S=function(E){if(m.paused||!a)return;const M=E.relatedTarget;M!==null&&(a.contains(M)||Qc(f.current,{select:!0}))},b=function(E){if(document.activeElement===document.body)for(const j of E)j.removedNodes.length>0&&Qc(a)};document.addEventListener("focusin",w),document.addEventListener("focusout",S);const x=new MutationObserver(b);return a&&x.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",w),document.removeEventListener("focusout",S),x.disconnect()}}},[r,a,m.paused]),P.useEffect(()=>{if(a){Ij.add(m);const w=document.activeElement;if(!a.contains(w)){const b=new CustomEvent(mb,bj);a.addEventListener(mb,u),a.dispatchEvent(b),b.defaultPrevented||(Fte(Wte(MB(a)),{select:!0}),document.activeElement===w&&Qc(a))}return()=>{a.removeEventListener(mb,u),setTimeout(()=>{const b=new CustomEvent(yb,bj);a.addEventListener(yb,d),a.dispatchEvent(b),b.defaultPrevented||Qc(w??document.body,{select:!0}),a.removeEventListener(yb,d),Ij.remove(m)},0)}}},[a,u,d,m]);const v=P.useCallback(w=>{if(!t&&!r||m.paused)return;const S=w.key==="Tab"&&!w.altKey&&!w.ctrlKey&&!w.metaKey,b=document.activeElement;if(S&&b){const x=w.currentTarget,[E,M]=zte(x);E&&M?!w.shiftKey&&b===M?(w.preventDefault(),t&&Qc(E,{select:!0})):w.shiftKey&&b===E&&(w.preventDefault(),t&&Qc(M,{select:!0})):b===x&&w.preventDefault()}},[t,r,m.paused]);return p.jsx(Vt.div,{tabIndex:-1,...o,ref:g,onKeyDown:v})});bw.displayName=Bte;function Fte(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(Qc(r,{select:e}),document.activeElement!==t)return}function zte(n){const e=MB(n),t=_j(e,n),r=_j(e.reverse(),n);return[t,r]}function MB(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function _j(n,e){for(const t of n)if(!Ute(t,{upTo:e}))return t}function Ute(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function $te(n){return n instanceof HTMLInputElement&&"select"in n}function Qc(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&$te(n)&&e&&n.select()}}var Ij=Hte();function Hte(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=Ej(n,e),n.unshift(e)},remove(e){var t;n=Ej(n,e),(t=n[0])==null||t.resume()}}}function Ej(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function Wte(n){return n.filter(e=>e.tagName!=="A")}var vl=globalThis!=null&&globalThis.document?P.useLayoutEffect:()=>{},Kte=wG.useId||(()=>{}),qte=0;function ac(n){const[e,t]=P.useState(Kte());return vl(()=>{n||t(r=>r??String(qte++))},[n]),n||(e?`radix-${e}`:"")}const Gte=["top","right","bottom","left"],Sl=Math.min,Cs=Math.max,m0=Math.round,Tm=Math.floor,da=n=>({x:n,y:n}),Vte={left:"right",right:"left",bottom:"top",top:"bottom"},Yte={start:"end",end:"start"};function QI(n,e,t){return Cs(n,Sl(e,t))}function uc(n,e){return typeof n=="function"?n(e):n}function dc(n){return n.split("-")[0]}function Dh(n){return n.split("-")[1]}function P2(n){return n==="x"?"y":"x"}function M2(n){return n==="y"?"height":"width"}function xl(n){return["top","bottom"].includes(dc(n))?"y":"x"}function T2(n){return P2(xl(n))}function Xte(n,e,t){t===void 0&&(t=!1);const r=Dh(n),i=T2(n),s=M2(i);let o=i==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(o=y0(o)),[o,y0(o)]}function Zte(n){const e=y0(n);return[JI(n),e,JI(e)]}function JI(n){return n.replace(/start|end/g,e=>Yte[e])}function Qte(n,e,t){const r=["left","right"],i=["right","left"],s=["top","bottom"],o=["bottom","top"];switch(n){case"top":case"bottom":return t?e?i:r:e?r:i;case"left":case"right":return e?s:o;default:return[]}}function Jte(n,e,t,r){const i=Dh(n);let s=Qte(dc(n),t==="start",r);return i&&(s=s.map(o=>o+"-"+i),e&&(s=s.concat(s.map(JI)))),s}function y0(n){return n.replace(/left|right|bottom|top/g,e=>Vte[e])}function ene(n){return{top:0,right:0,bottom:0,left:0,...n}}function TB(n){return typeof n!="number"?ene(n):{top:n,right:n,bottom:n,left:n}}function w0(n){const{x:e,y:t,width:r,height:i}=n;return{width:r,height:i,top:t,left:e,right:e+r,bottom:t+i,x:e,y:t}}function Cj(n,e,t){let{reference:r,floating:i}=n;const s=xl(e),o=T2(e),a=M2(o),c=dc(e),u=s==="y",d=r.x+r.width/2-i.width/2,f=r.y+r.height/2-i.height/2,g=r[a]/2-i[a]/2;let m;switch(c){case"top":m={x:d,y:r.y-i.height};break;case"bottom":m={x:d,y:r.y+r.height};break;case"right":m={x:r.x+r.width,y:f};break;case"left":m={x:r.x-i.width,y:f};break;default:m={x:r.x,y:r.y}}switch(Dh(e)){case"start":m[o]-=g*(t&&u?-1:1);break;case"end":m[o]+=g*(t&&u?-1:1);break}return m}const tne=async(n,e,t)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=t,a=s.filter(Boolean),c=await(o.isRTL==null?void 0:o.isRTL(e));let u=await o.getElementRects({reference:n,floating:e,strategy:i}),{x:d,y:f}=Cj(u,r,c),g=r,m={},v=0;for(let w=0;w<a.length;w++){const{name:S,fn:b}=a[w],{x,y:E,data:M,reset:j}=await b({x:d,y:f,initialPlacement:r,placement:g,strategy:i,middlewareData:m,rects:u,platform:o,elements:{reference:n,floating:e}});d=x??d,f=E??f,m={...m,[S]:{...m[S],...M}},j&&v<=50&&(v++,typeof j=="object"&&(j.placement&&(g=j.placement),j.rects&&(u=j.rects===!0?await o.getElementRects({reference:n,floating:e,strategy:i}):j.rects),{x:d,y:f}=Cj(u,g,c)),w=-1)}return{x:d,y:f,placement:g,strategy:i,middlewareData:m}};async function bp(n,e){var t;e===void 0&&(e={});const{x:r,y:i,platform:s,rects:o,elements:a,strategy:c}=n,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:f="floating",altBoundary:g=!1,padding:m=0}=uc(e,n),v=TB(m),S=a[g?f==="floating"?"reference":"floating":f],b=w0(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(S)))==null||t?S:S.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:u,rootBoundary:d,strategy:c})),x=f==="floating"?{x:r,y:i,width:o.floating.width,height:o.floating.height}:o.reference,E=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),M=await(s.isElement==null?void 0:s.isElement(E))?await(s.getScale==null?void 0:s.getScale(E))||{x:1,y:1}:{x:1,y:1},j=w0(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:x,offsetParent:E,strategy:c}):x);return{top:(b.top-j.top+v.top)/M.y,bottom:(j.bottom-b.bottom+v.bottom)/M.y,left:(b.left-j.left+v.left)/M.x,right:(j.right-b.right+v.right)/M.x}}const nne=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:c}=e,{element:u,padding:d=0}=uc(n,e)||{};if(u==null)return{};const f=TB(d),g={x:t,y:r},m=T2(i),v=M2(m),w=await o.getDimensions(u),S=m==="y",b=S?"top":"left",x=S?"bottom":"right",E=S?"clientHeight":"clientWidth",M=s.reference[v]+s.reference[m]-g[m]-s.floating[v],j=g[m]-s.reference[m],D=await(o.getOffsetParent==null?void 0:o.getOffsetParent(u));let H=D?D[E]:0;(!H||!await(o.isElement==null?void 0:o.isElement(D)))&&(H=a.floating[E]||s.floating[v]);const L=M/2-j/2,U=H/2-w[v]/2-1,z=Sl(f[b],U),Y=Sl(f[x],U),V=z,N=H-w[v]-Y,_=H/2-w[v]/2+L,k=QI(V,_,N),O=!c.arrow&&Dh(i)!=null&&_!==k&&s.reference[v]/2-(_<V?z:Y)-w[v]/2<0,W=O?_<V?_-V:_-N:0;return{[m]:g[m]+W,data:{[m]:k,centerOffset:_-k-W,...O&&{alignmentOffset:W}},reset:O}}}),rne=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:i,middlewareData:s,rects:o,initialPlacement:a,platform:c,elements:u}=e,{mainAxis:d=!0,crossAxis:f=!0,fallbackPlacements:g,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:w=!0,...S}=uc(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=dc(i),x=xl(a),E=dc(a)===a,M=await(c.isRTL==null?void 0:c.isRTL(u.floating)),j=g||(E||!w?[y0(a)]:Zte(a)),D=v!=="none";!g&&D&&j.push(...Jte(a,w,v,M));const H=[a,...j],L=await bp(e,S),U=[];let z=((r=s.flip)==null?void 0:r.overflows)||[];if(d&&U.push(L[b]),f){const _=Xte(i,o,M);U.push(L[_[0]],L[_[1]])}if(z=[...z,{placement:i,overflows:U}],!U.every(_=>_<=0)){var Y,V;const _=(((Y=s.flip)==null?void 0:Y.index)||0)+1,k=H[_];if(k)return{data:{index:_,overflows:z},reset:{placement:k}};let O=(V=z.filter(W=>W.overflows[0]<=0).sort((W,q)=>W.overflows[1]-q.overflows[1])[0])==null?void 0:V.placement;if(!O)switch(m){case"bestFit":{var N;const W=(N=z.filter(q=>{if(D){const X=xl(q.placement);return X===x||X==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(X=>X>0).reduce((X,ne)=>X+ne,0)]).sort((q,X)=>q[1]-X[1])[0])==null?void 0:N[0];W&&(O=W);break}case"initialPlacement":O=a;break}if(i!==O)return{reset:{placement:O}}}return{}}}};function Pj(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function Mj(n){return Gte.some(e=>n[e]>=0)}const ine=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...i}=uc(n,e);switch(r){case"referenceHidden":{const s=await bp(e,{...i,elementContext:"reference"}),o=Pj(s,t.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:Mj(o)}}}case"escaped":{const s=await bp(e,{...i,altBoundary:!0}),o=Pj(s,t.floating);return{data:{escapedOffsets:o,escaped:Mj(o)}}}default:return{}}}}};async function sne(n,e){const{placement:t,platform:r,elements:i}=n,s=await(r.isRTL==null?void 0:r.isRTL(i.floating)),o=dc(t),a=Dh(t),c=xl(t)==="y",u=["left","top"].includes(o)?-1:1,d=s&&c?-1:1,f=uc(e,n);let{mainAxis:g,crossAxis:m,alignmentAxis:v}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:f.mainAxis||0,crossAxis:f.crossAxis||0,alignmentAxis:f.alignmentAxis};return a&&typeof v=="number"&&(m=a==="end"?v*-1:v),c?{x:m*d,y:g*u}:{x:g*u,y:m*d}}const one=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:i,y:s,placement:o,middlewareData:a}=e,c=await sne(e,n);return o===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:i+c.x,y:s+c.y,data:{...c,placement:o}}}}},ane=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:i}=e,{mainAxis:s=!0,crossAxis:o=!1,limiter:a={fn:S=>{let{x:b,y:x}=S;return{x:b,y:x}}},...c}=uc(n,e),u={x:t,y:r},d=await bp(e,c),f=xl(dc(i)),g=P2(f);let m=u[g],v=u[f];if(s){const S=g==="y"?"top":"left",b=g==="y"?"bottom":"right",x=m+d[S],E=m-d[b];m=QI(x,m,E)}if(o){const S=f==="y"?"top":"left",b=f==="y"?"bottom":"right",x=v+d[S],E=v-d[b];v=QI(x,v,E)}const w=a.fn({...e,[g]:m,[f]:v});return{...w,data:{x:w.x-t,y:w.y-r,enabled:{[g]:s,[f]:o}}}}}},cne=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:i,rects:s,middlewareData:o}=e,{offset:a=0,mainAxis:c=!0,crossAxis:u=!0}=uc(n,e),d={x:t,y:r},f=xl(i),g=P2(f);let m=d[g],v=d[f];const w=uc(a,e),S=typeof w=="number"?{mainAxis:w,crossAxis:0}:{mainAxis:0,crossAxis:0,...w};if(c){const E=g==="y"?"height":"width",M=s.reference[g]-s.floating[E]+S.mainAxis,j=s.reference[g]+s.reference[E]-S.mainAxis;m<M?m=M:m>j&&(m=j)}if(u){var b,x;const E=g==="y"?"width":"height",M=["top","left"].includes(dc(i)),j=s.reference[f]-s.floating[E]+(M&&((b=o.offset)==null?void 0:b[f])||0)+(M?0:S.crossAxis),D=s.reference[f]+s.reference[E]+(M?0:((x=o.offset)==null?void 0:x[f])||0)-(M?S.crossAxis:0);v<j?v=j:v>D&&(v=D)}return{[g]:m,[f]:v}}}},lne=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){var t,r;const{placement:i,rects:s,platform:o,elements:a}=e,{apply:c=()=>{},...u}=uc(n,e),d=await bp(e,u),f=dc(i),g=Dh(i),m=xl(i)==="y",{width:v,height:w}=s.floating;let S,b;f==="top"||f==="bottom"?(S=f,b=g===(await(o.isRTL==null?void 0:o.isRTL(a.floating))?"start":"end")?"left":"right"):(b=f,S=g==="end"?"top":"bottom");const x=w-d.top-d.bottom,E=v-d.left-d.right,M=Sl(w-d[S],x),j=Sl(v-d[b],E),D=!e.middlewareData.shift;let H=M,L=j;if((t=e.middlewareData.shift)!=null&&t.enabled.x&&(L=E),(r=e.middlewareData.shift)!=null&&r.enabled.y&&(H=x),D&&!g){const z=Cs(d.left,0),Y=Cs(d.right,0),V=Cs(d.top,0),N=Cs(d.bottom,0);m?L=v-2*(z!==0||Y!==0?z+Y:Cs(d.left,d.right)):H=w-2*(V!==0||N!==0?V+N:Cs(d.top,d.bottom))}await c({...e,availableWidth:L,availableHeight:H});const U=await o.getDimensions(a.floating);return v!==U.width||w!==U.height?{reset:{rects:!0}}:{}}}};function _w(){return typeof window<"u"}function Oh(n){return kB(n)?(n.nodeName||"").toLowerCase():"#document"}function Rs(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function Ia(n){var e;return(e=(kB(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function kB(n){return _w()?n instanceof Node||n instanceof Rs(n).Node:!1}function Do(n){return _w()?n instanceof Element||n instanceof Rs(n).Element:!1}function ma(n){return _w()?n instanceof HTMLElement||n instanceof Rs(n).HTMLElement:!1}function Tj(n){return!_w()||typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Rs(n).ShadowRoot}function ng(n){const{overflow:e,overflowX:t,overflowY:r,display:i}=Oo(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(i)}function une(n){return["table","td","th"].includes(Oh(n))}function Iw(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function k2(n){const e=A2(),t=Do(n)?Oo(n):n;return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function dne(n){let e=bl(n);for(;ma(e)&&!uh(e);){if(k2(e))return e;if(Iw(e))return null;e=bl(e)}return null}function A2(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function uh(n){return["html","body","#document"].includes(Oh(n))}function Oo(n){return Rs(n).getComputedStyle(n)}function Ew(n){return Do(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function bl(n){if(Oh(n)==="html")return n;const e=n.assignedSlot||n.parentNode||Tj(n)&&n.host||Ia(n);return Tj(e)?e.host:e}function AB(n){const e=bl(n);return uh(e)?n.ownerDocument?n.ownerDocument.body:n.body:ma(e)&&ng(e)?e:AB(e)}function _p(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const i=AB(n),s=i===((r=n.ownerDocument)==null?void 0:r.body),o=Rs(i);if(s){const a=eE(o);return e.concat(o,o.visualViewport||[],ng(i)?i:[],a&&t?_p(a):[])}return e.concat(i,_p(i,[],t))}function eE(n){return n.parent&&Object.getPrototypeOf(n.parent)?n.frameElement:null}function RB(n){const e=Oo(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=ma(n),s=i?n.offsetWidth:t,o=i?n.offsetHeight:r,a=m0(t)!==s||m0(r)!==o;return a&&(t=s,r=o),{width:t,height:r,$:a}}function R2(n){return Do(n)?n:n.contextElement}function nh(n){const e=R2(n);if(!ma(e))return da(1);const t=e.getBoundingClientRect(),{width:r,height:i,$:s}=RB(e);let o=(s?m0(t.width):t.width)/r,a=(s?m0(t.height):t.height)/i;return(!o||!Number.isFinite(o))&&(o=1),(!a||!Number.isFinite(a))&&(a=1),{x:o,y:a}}const hne=da(0);function jB(n){const e=Rs(n);return!A2()||!e.visualViewport?hne:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function fne(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Rs(n)?!1:e}function Mu(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const i=n.getBoundingClientRect(),s=R2(n);let o=da(1);e&&(r?Do(r)&&(o=nh(r)):o=nh(n));const a=fne(s,t,r)?jB(s):da(0);let c=(i.left+a.x)/o.x,u=(i.top+a.y)/o.y,d=i.width/o.x,f=i.height/o.y;if(s){const g=Rs(s),m=r&&Do(r)?Rs(r):r;let v=g,w=eE(v);for(;w&&r&&m!==v;){const S=nh(w),b=w.getBoundingClientRect(),x=Oo(w),E=b.left+(w.clientLeft+parseFloat(x.paddingLeft))*S.x,M=b.top+(w.clientTop+parseFloat(x.paddingTop))*S.y;c*=S.x,u*=S.y,d*=S.x,f*=S.y,c+=E,u+=M,v=Rs(w),w=eE(v)}}return w0({width:d,height:f,x:c,y:u})}function j2(n,e){const t=Ew(n).scrollLeft;return e?e.left+t:Mu(Ia(n)).left+t}function DB(n,e,t){t===void 0&&(t=!1);const r=n.getBoundingClientRect(),i=r.left+e.scrollLeft-(t?0:j2(n,r)),s=r.top+e.scrollTop;return{x:i,y:s}}function pne(n){let{elements:e,rect:t,offsetParent:r,strategy:i}=n;const s=i==="fixed",o=Ia(r),a=e?Iw(e.floating):!1;if(r===o||a&&s)return t;let c={scrollLeft:0,scrollTop:0},u=da(1);const d=da(0),f=ma(r);if((f||!f&&!s)&&((Oh(r)!=="body"||ng(o))&&(c=Ew(r)),ma(r))){const m=Mu(r);u=nh(r),d.x=m.x+r.clientLeft,d.y=m.y+r.clientTop}const g=o&&!f&&!s?DB(o,c,!0):da(0);return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-c.scrollLeft*u.x+d.x+g.x,y:t.y*u.y-c.scrollTop*u.y+d.y+g.y}}function gne(n){return Array.from(n.getClientRects())}function mne(n){const e=Ia(n),t=Ew(n),r=n.ownerDocument.body,i=Cs(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Cs(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-t.scrollLeft+j2(n);const a=-t.scrollTop;return Oo(r).direction==="rtl"&&(o+=Cs(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}function yne(n,e){const t=Rs(n),r=Ia(n),i=t.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,c=0;if(i){s=i.width,o=i.height;const u=A2();(!u||u&&e==="fixed")&&(a=i.offsetLeft,c=i.offsetTop)}return{width:s,height:o,x:a,y:c}}function wne(n,e){const t=Mu(n,!0,e==="fixed"),r=t.top+n.clientTop,i=t.left+n.clientLeft,s=ma(n)?nh(n):da(1),o=n.clientWidth*s.x,a=n.clientHeight*s.y,c=i*s.x,u=r*s.y;return{width:o,height:a,x:c,y:u}}function kj(n,e,t){let r;if(e==="viewport")r=yne(n,t);else if(e==="document")r=mne(Ia(n));else if(Do(e))r=wne(e,t);else{const i=jB(n);r={x:e.x-i.x,y:e.y-i.y,width:e.width,height:e.height}}return w0(r)}function OB(n,e){const t=bl(n);return t===e||!Do(t)||uh(t)?!1:Oo(t).position==="fixed"||OB(t,e)}function vne(n,e){const t=e.get(n);if(t)return t;let r=_p(n,[],!1).filter(a=>Do(a)&&Oh(a)!=="body"),i=null;const s=Oo(n).position==="fixed";let o=s?bl(n):n;for(;Do(o)&&!uh(o);){const a=Oo(o),c=k2(o);!c&&a.position==="fixed"&&(i=null),(s?!c&&!i:!c&&a.position==="static"&&!!i&&["absolute","fixed"].includes(i.position)||ng(o)&&!c&&OB(n,o))?r=r.filter(d=>d!==o):i=a,o=bl(o)}return e.set(n,r),r}function Sne(n){let{element:e,boundary:t,rootBoundary:r,strategy:i}=n;const o=[...t==="clippingAncestors"?Iw(e)?[]:vne(e,this._c):[].concat(t),r],a=o[0],c=o.reduce((u,d)=>{const f=kj(e,d,i);return u.top=Cs(f.top,u.top),u.right=Sl(f.right,u.right),u.bottom=Sl(f.bottom,u.bottom),u.left=Cs(f.left,u.left),u},kj(e,a,i));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function xne(n){const{width:e,height:t}=RB(n);return{width:e,height:t}}function bne(n,e,t){const r=ma(e),i=Ia(e),s=t==="fixed",o=Mu(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=da(0);if(r||!r&&!s)if((Oh(e)!=="body"||ng(i))&&(a=Ew(e)),r){const g=Mu(e,!0,s,e);c.x=g.x+e.clientLeft,c.y=g.y+e.clientTop}else i&&(c.x=j2(i));const u=i&&!r&&!s?DB(i,a):da(0),d=o.left+a.scrollLeft-c.x-u.x,f=o.top+a.scrollTop-c.y-u.y;return{x:d,y:f,width:o.width,height:o.height}}function wb(n){return Oo(n).position==="static"}function Aj(n,e){if(!ma(n)||Oo(n).position==="fixed")return null;if(e)return e(n);let t=n.offsetParent;return Ia(n)===t&&(t=t.ownerDocument.body),t}function LB(n,e){const t=Rs(n);if(Iw(n))return t;if(!ma(n)){let i=bl(n);for(;i&&!uh(i);){if(Do(i)&&!wb(i))return i;i=bl(i)}return t}let r=Aj(n,e);for(;r&&une(r)&&wb(r);)r=Aj(r,e);return r&&uh(r)&&wb(r)&&!k2(r)?t:r||dne(n)||t}const _ne=async function(n){const e=this.getOffsetParent||LB,t=this.getDimensions,r=await t(n.floating);return{reference:bne(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Ine(n){return Oo(n).direction==="rtl"}const Ene={convertOffsetParentRelativeRectToViewportRelativeRect:pne,getDocumentElement:Ia,getClippingRect:Sne,getOffsetParent:LB,getElementRects:_ne,getClientRects:gne,getDimensions:xne,getScale:nh,isElement:Do,isRTL:Ine};function Cne(n,e){let t=null,r;const i=Ia(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function o(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const{left:u,top:d,width:f,height:g}=n.getBoundingClientRect();if(a||e(),!f||!g)return;const m=Tm(d),v=Tm(i.clientWidth-(u+f)),w=Tm(i.clientHeight-(d+g)),S=Tm(u),x={rootMargin:-m+"px "+-v+"px "+-w+"px "+-S+"px",threshold:Cs(0,Sl(1,c))||1};let E=!0;function M(j){const D=j[0].intersectionRatio;if(D!==c){if(!E)return o();D?o(!1,D):r=setTimeout(()=>{o(!1,1e-7)},1e3)}E=!1}try{t=new IntersectionObserver(M,{...x,root:i.ownerDocument})}catch{t=new IntersectionObserver(M,x)}t.observe(n)}return o(!0),s}function Pne(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:i=!0,ancestorResize:s=!0,elementResize:o=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,u=R2(n),d=i||s?[...u?_p(u):[],..._p(e)]:[];d.forEach(b=>{i&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const f=u&&a?Cne(u,t):null;let g=-1,m=null;o&&(m=new ResizeObserver(b=>{let[x]=b;x&&x.target===u&&m&&(m.unobserve(e),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var E;(E=m)==null||E.observe(e)})),t()}),u&&!c&&m.observe(u),m.observe(e));let v,w=c?Mu(n):null;c&&S();function S(){const b=Mu(n);w&&(b.x!==w.x||b.y!==w.y||b.width!==w.width||b.height!==w.height)&&t(),w=b,v=requestAnimationFrame(S)}return t(),()=>{var b;d.forEach(x=>{i&&x.removeEventListener("scroll",t),s&&x.removeEventListener("resize",t)}),f==null||f(),(b=m)==null||b.disconnect(),m=null,c&&cancelAnimationFrame(v)}}const Mne=one,Tne=ane,kne=rne,Ane=lne,Rne=ine,Rj=nne,jne=cne,Dne=(n,e,t)=>{const r=new Map,i={platform:Ene,...t},s={...i.platform,_c:r};return tne(n,e,{...i,platform:s})};var py=typeof document<"u"?P.useLayoutEffect:P.useEffect;function v0(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,i;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!v0(n[r],e[r]))return!1;return!0}if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,i[r]))return!1;for(r=t;r--!==0;){const s=i[r];if(!(s==="_owner"&&n.$$typeof)&&!v0(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function NB(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function jj(n,e){const t=NB(n);return Math.round(e*t)/t}function vb(n){const e=P.useRef(n);return py(()=>{e.current=n}),e}function One(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:i,elements:{reference:s,floating:o}={},transform:a=!0,whileElementsMounted:c,open:u}=n,[d,f]=P.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[g,m]=P.useState(r);v0(g,r)||m(r);const[v,w]=P.useState(null),[S,b]=P.useState(null),x=P.useCallback(q=>{q!==D.current&&(D.current=q,w(q))},[]),E=P.useCallback(q=>{q!==H.current&&(H.current=q,b(q))},[]),M=s||v,j=o||S,D=P.useRef(null),H=P.useRef(null),L=P.useRef(d),U=c!=null,z=vb(c),Y=vb(i),V=vb(u),N=P.useCallback(()=>{if(!D.current||!H.current)return;const q={placement:e,strategy:t,middleware:g};Y.current&&(q.platform=Y.current),Dne(D.current,H.current,q).then(X=>{const ne={...X,isPositioned:V.current!==!1};_.current&&!v0(L.current,ne)&&(L.current=ne,wl.flushSync(()=>{f(ne)}))})},[g,e,t,Y,V]);py(()=>{u===!1&&L.current.isPositioned&&(L.current.isPositioned=!1,f(q=>({...q,isPositioned:!1})))},[u]);const _=P.useRef(!1);py(()=>(_.current=!0,()=>{_.current=!1}),[]),py(()=>{if(M&&(D.current=M),j&&(H.current=j),M&&j){if(z.current)return z.current(M,j,N);N()}},[M,j,N,z,U]);const k=P.useMemo(()=>({reference:D,floating:H,setReference:x,setFloating:E}),[x,E]),O=P.useMemo(()=>({reference:M,floating:j}),[M,j]),W=P.useMemo(()=>{const q={position:t,left:0,top:0};if(!O.floating)return q;const X=jj(O.floating,d.x),ne=jj(O.floating,d.y);return a?{...q,transform:"translate("+X+"px, "+ne+"px)",...NB(O.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:X,top:ne}},[t,a,O.floating,d.x,d.y]);return P.useMemo(()=>({...d,update:N,refs:k,elements:O,floatingStyles:W}),[d,N,k,O,W])}const Lne=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:i}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?Rj({element:r.current,padding:i}).fn(t):{}:r?Rj({element:r,padding:i}).fn(t):{}}}},Nne=(n,e)=>({...Mne(n),options:[n,e]}),Bne=(n,e)=>({...Tne(n),options:[n,e]}),Fne=(n,e)=>({...jne(n),options:[n,e]}),zne=(n,e)=>({...kne(n),options:[n,e]}),Une=(n,e)=>({...Ane(n),options:[n,e]}),$ne=(n,e)=>({...Rne(n),options:[n,e]}),Hne=(n,e)=>({...Lne(n),options:[n,e]});var Wne="Arrow",BB=P.forwardRef((n,e)=>{const{children:t,width:r=10,height:i=5,...s}=n;return p.jsx(Vt.svg,{...s,ref:e,width:r,height:i,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:p.jsx("polygon",{points:"0,0 30,0 15,10"})})});BB.displayName=Wne;var Kne=BB;function qne(n,e=[]){let t=[];function r(s,o){const a=P.createContext(o),c=t.length;t=[...t,o];function u(f){const{scope:g,children:m,...v}=f,w=(g==null?void 0:g[n][c])||a,S=P.useMemo(()=>v,Object.values(v));return p.jsx(w.Provider,{value:S,children:m})}function d(f,g){const m=(g==null?void 0:g[n][c])||a,v=P.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,d]}const i=()=>{const s=t.map(o=>P.createContext(o));return function(a){const c=(a==null?void 0:a[n])||s;return P.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return i.scopeName=n,[r,Gne(i,...e)]}function Gne(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:u})=>{const f=c(s)[`__scope${u}`];return{...a,...f}},{});return P.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function FB(n){const[e,t]=P.useState(void 0);return vl(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(i=>{if(!Array.isArray(i)||!i.length)return;const s=i[0];let o,a;if("borderBoxSize"in s){const c=s.borderBoxSize,u=Array.isArray(c)?c[0]:c;o=u.inlineSize,a=u.blockSize}else o=n.offsetWidth,a=n.offsetHeight;t({width:o,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var D2="Popper",[zB,Cw]=qne(D2),[Vne,UB]=zB(D2),$B=n=>{const{__scopePopper:e,children:t}=n,[r,i]=P.useState(null);return p.jsx(Vne,{scope:e,anchor:r,onAnchorChange:i,children:t})};$B.displayName=D2;var HB="PopperAnchor",WB=P.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...i}=n,s=UB(HB,t),o=P.useRef(null),a=Dn(e,o);return P.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||o.current)}),r?null:p.jsx(Vt.div,{...i,ref:a})});WB.displayName=HB;var O2="PopperContent",[Yne,Xne]=zB(O2),KB=P.forwardRef((n,e)=>{var ue,fe,_e,Le,Ne,Ze;const{__scopePopper:t,side:r="bottom",sideOffset:i=0,align:s="center",alignOffset:o=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:d=0,sticky:f="partial",hideWhenDetached:g=!1,updatePositionStrategy:m="optimized",onPlaced:v,...w}=n,S=UB(O2,t),[b,x]=P.useState(null),E=Dn(e,dt=>x(dt)),[M,j]=P.useState(null),D=FB(M),H=(D==null?void 0:D.width)??0,L=(D==null?void 0:D.height)??0,U=r+(s!=="center"?"-"+s:""),z=typeof d=="number"?d:{top:0,right:0,bottom:0,left:0,...d},Y=Array.isArray(u)?u:[u],V=Y.length>0,N={padding:z,boundary:Y.filter(Qne),altBoundary:V},{refs:_,floatingStyles:k,placement:O,isPositioned:W,middlewareData:q}=One({strategy:"fixed",placement:U,whileElementsMounted:(...dt)=>Pne(...dt,{animationFrame:m==="always"}),elements:{reference:S.anchor},middleware:[Nne({mainAxis:i+L,alignmentAxis:o}),c&&Bne({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?Fne():void 0,...N}),c&&zne({...N}),Une({...N,apply:({elements:dt,rects:et,availableWidth:Xe,availableHeight:Kt})=>{const{width:_t,height:Ut}=et.reference,ur=dt.floating.style;ur.setProperty("--radix-popper-available-width",`${Xe}px`),ur.setProperty("--radix-popper-available-height",`${Kt}px`),ur.setProperty("--radix-popper-anchor-width",`${_t}px`),ur.setProperty("--radix-popper-anchor-height",`${Ut}px`)}}),M&&Hne({element:M,padding:a}),Jne({arrowWidth:H,arrowHeight:L}),g&&$ne({strategy:"referenceHidden",...N})]}),[X,ne]=VB(O),$=ei(v);vl(()=>{W&&($==null||$())},[W,$]);const C=(ue=q.arrow)==null?void 0:ue.x,R=(fe=q.arrow)==null?void 0:fe.y,Z=((_e=q.arrow)==null?void 0:_e.centerOffset)!==0,[J,oe]=P.useState();return vl(()=>{b&&oe(window.getComputedStyle(b).zIndex)},[b]),p.jsx("div",{ref:_.setFloating,"data-radix-popper-content-wrapper":"",style:{...k,transform:W?k.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:J,"--radix-popper-transform-origin":[(Le=q.transformOrigin)==null?void 0:Le.x,(Ne=q.transformOrigin)==null?void 0:Ne.y].join(" "),...((Ze=q.hide)==null?void 0:Ze.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:p.jsx(Yne,{scope:t,placedSide:X,onArrowChange:j,arrowX:C,arrowY:R,shouldHideArrow:Z,children:p.jsx(Vt.div,{"data-side":X,"data-align":ne,...w,ref:E,style:{...w.style,animation:W?void 0:"none"}})})})});KB.displayName=O2;var qB="PopperArrow",Zne={top:"bottom",right:"left",bottom:"top",left:"right"},GB=P.forwardRef(function(e,t){const{__scopePopper:r,...i}=e,s=Xne(qB,r),o=Zne[s.placedSide];return p.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[o]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:p.jsx(Kne,{...i,ref:t,style:{...i.style,display:"block"}})})});GB.displayName=qB;function Qne(n){return n!==null}var Jne=n=>({name:"transformOrigin",options:n,fn(e){var S,b,x;const{placement:t,rects:r,middlewareData:i}=e,o=((S=i.arrow)==null?void 0:S.centerOffset)!==0,a=o?0:n.arrowWidth,c=o?0:n.arrowHeight,[u,d]=VB(t),f={start:"0%",center:"50%",end:"100%"}[d],g=(((b=i.arrow)==null?void 0:b.x)??0)+a/2,m=(((x=i.arrow)==null?void 0:x.y)??0)+c/2;let v="",w="";return u==="bottom"?(v=o?f:`${g}px`,w=`${-c}px`):u==="top"?(v=o?f:`${g}px`,w=`${r.floating.height+c}px`):u==="right"?(v=`${-c}px`,w=o?f:`${m}px`):u==="left"&&(v=`${r.floating.width+c}px`,w=o?f:`${m}px`),{data:{x:v,y:w}}}});function VB(n){const[e,t="center"]=n.split("-");return[e,t]}var L2=$B,N2=WB,YB=KB,XB=GB,ere="Portal",rg=P.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[i,s]=P.useState(!1);vl(()=>s(!0),[]);const o=t||i&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return o?OZ.createPortal(p.jsx(Vt.div,{...r,ref:e}),o):null});rg.displayName=ere;function tre(n,e){return P.useReducer((t,r)=>e[t][r]??t,n)}var Fo=n=>{const{present:e,children:t}=n,r=nre(e),i=typeof t=="function"?t({present:r.isPresent}):P.Children.only(t),s=Dn(r.ref,rre(i));return typeof t=="function"||r.isPresent?P.cloneElement(i,{ref:s}):null};Fo.displayName="Presence";function nre(n){const[e,t]=P.useState(),r=P.useRef({}),i=P.useRef(n),s=P.useRef("none"),o=n?"mounted":"unmounted",[a,c]=tre(o,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return P.useEffect(()=>{const u=km(r.current);s.current=a==="mounted"?u:"none"},[a]),vl(()=>{const u=r.current,d=i.current;if(d!==n){const g=s.current,m=km(u);n?c("MOUNT"):m==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(d&&g!==m?"ANIMATION_OUT":"UNMOUNT"),i.current=n}},[n,c]),vl(()=>{if(e){let u;const d=e.ownerDocument.defaultView??window,f=m=>{const w=km(r.current).includes(m.animationName);if(m.target===e&&w&&(c("ANIMATION_END"),!i.current)){const S=e.style.animationFillMode;e.style.animationFillMode="forwards",u=d.setTimeout(()=>{e.style.animationFillMode==="forwards"&&(e.style.animationFillMode=S)})}},g=m=>{m.target===e&&(s.current=km(r.current))};return e.addEventListener("animationstart",g),e.addEventListener("animationcancel",f),e.addEventListener("animationend",f),()=>{d.clearTimeout(u),e.removeEventListener("animationstart",g),e.removeEventListener("animationcancel",f),e.removeEventListener("animationend",f)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:P.useCallback(u=>{u&&(r.current=getComputedStyle(u)),t(u)},[])}}function km(n){return(n==null?void 0:n.animationName)||"none"}function rre(n){var r,i;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(i=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:i.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function ire(n,e=[]){let t=[];function r(s,o){const a=P.createContext(o),c=t.length;t=[...t,o];function u(f){const{scope:g,children:m,...v}=f,w=(g==null?void 0:g[n][c])||a,S=P.useMemo(()=>v,Object.values(v));return p.jsx(w.Provider,{value:S,children:m})}function d(f,g){const m=(g==null?void 0:g[n][c])||a,v=P.useContext(m);if(v)return v;if(o!==void 0)return o;throw new Error(`\`${f}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,d]}const i=()=>{const s=t.map(o=>P.createContext(o));return function(a){const c=(a==null?void 0:a[n])||s;return P.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return i.scopeName=n,[r,sre(i,...e)]}function sre(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(s){const o=r.reduce((a,{useScope:c,scopeName:u})=>{const f=c(s)[`__scope${u}`];return{...a,...f}},{});return P.useMemo(()=>({[`__scope${e.scopeName}`]:o}),[o])}};return t.scopeName=e.scopeName,t}function Tl({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,i]=ore({defaultProp:e,onChange:t}),s=n!==void 0,o=s?n:r,a=ei(t),c=P.useCallback(u=>{if(s){const f=typeof u=="function"?u(n):u;f!==n&&a(f)}else i(u)},[s,n,i,a]);return[o,c]}function ore({defaultProp:n,onChange:e}){const t=P.useState(n),[r]=t,i=P.useRef(r),s=ei(e);return P.useEffect(()=>{i.current!==r&&(s(r),i.current=r)},[r,i,s]),t}var Sb="rovingFocusGroup.onEntryFocus",are={bubbles:!1,cancelable:!0},Pw="RovingFocusGroup",[tE,ZB,cre]=xw(Pw),[lre,QB]=ire(Pw,[cre]),[ure,dre]=lre(Pw),JB=P.forwardRef((n,e)=>p.jsx(tE.Provider,{scope:n.__scopeRovingFocusGroup,children:p.jsx(tE.Slot,{scope:n.__scopeRovingFocusGroup,children:p.jsx(hre,{...n,ref:e})})}));JB.displayName=Pw;var hre=P.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:i=!1,dir:s,currentTabStopId:o,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:d=!1,...f}=n,g=P.useRef(null),m=Dn(e,g),v=E2(s),[w=null,S]=Tl({prop:o,defaultProp:a,onChange:c}),[b,x]=P.useState(!1),E=ei(u),M=ZB(t),j=P.useRef(!1),[D,H]=P.useState(0);return P.useEffect(()=>{const L=g.current;if(L)return L.addEventListener(Sb,E),()=>L.removeEventListener(Sb,E)},[E]),p.jsx(ure,{scope:t,orientation:r,dir:v,loop:i,currentTabStopId:w,onItemFocus:P.useCallback(L=>S(L),[S]),onItemShiftTab:P.useCallback(()=>x(!0),[]),onFocusableItemAdd:P.useCallback(()=>H(L=>L+1),[]),onFocusableItemRemove:P.useCallback(()=>H(L=>L-1),[]),children:p.jsx(Vt.div,{tabIndex:b||D===0?-1:0,"data-orientation":r,...f,ref:m,style:{outline:"none",...n.style},onMouseDown:Ge(n.onMouseDown,()=>{j.current=!0}),onFocus:Ge(n.onFocus,L=>{const U=!j.current;if(L.target===L.currentTarget&&U&&!b){const z=new CustomEvent(Sb,are);if(L.currentTarget.dispatchEvent(z),!z.defaultPrevented){const Y=M().filter(O=>O.focusable),V=Y.find(O=>O.active),N=Y.find(O=>O.id===w),k=[V,N,...Y].filter(Boolean).map(O=>O.ref.current);nF(k,d)}}j.current=!1}),onBlur:Ge(n.onBlur,()=>x(!1))})})}),eF="RovingFocusGroupItem",tF=P.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:i=!1,tabStopId:s,...o}=n,a=ac(),c=s||a,u=dre(eF,t),d=u.currentTabStopId===c,f=ZB(t),{onFocusableItemAdd:g,onFocusableItemRemove:m}=u;return P.useEffect(()=>{if(r)return g(),()=>m()},[r,g,m]),p.jsx(tE.ItemSlot,{scope:t,id:c,focusable:r,active:i,children:p.jsx(Vt.span,{tabIndex:d?0:-1,"data-orientation":u.orientation,...o,ref:e,onMouseDown:Ge(n.onMouseDown,v=>{r?u.onItemFocus(c):v.preventDefault()}),onFocus:Ge(n.onFocus,()=>u.onItemFocus(c)),onKeyDown:Ge(n.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const w=gre(v,u.orientation,u.dir);if(w!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=f().filter(x=>x.focusable).map(x=>x.ref.current);if(w==="last")b.reverse();else if(w==="prev"||w==="next"){w==="prev"&&b.reverse();const x=b.indexOf(v.currentTarget);b=u.loop?mre(b,x+1):b.slice(x+1)}setTimeout(()=>nF(b))}})})})});tF.displayName=eF;var fre={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function pre(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function gre(n,e,t){const r=pre(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return fre[r]}function nF(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function mre(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var yre=JB,wre=tF,vre=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},Md=new WeakMap,Am=new WeakMap,Rm={},xb=0,rF=function(n){return n&&(n.host||rF(n.parentNode))},Sre=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=rF(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},xre=function(n,e,t,r){var i=Sre(e,Array.isArray(n)?n:[n]);Rm[t]||(Rm[t]=new WeakMap);var s=Rm[t],o=[],a=new Set,c=new Set(i),u=function(f){!f||a.has(f)||(a.add(f),u(f.parentNode))};i.forEach(u);var d=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(g){if(a.has(g))d(g);else try{var m=g.getAttribute(r),v=m!==null&&m!=="false",w=(Md.get(g)||0)+1,S=(s.get(g)||0)+1;Md.set(g,w),s.set(g,S),o.push(g),w===1&&v&&Am.set(g,!0),S===1&&g.setAttribute(t,"true"),v||g.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",g,b)}})};return d(e),a.clear(),xb++,function(){o.forEach(function(f){var g=Md.get(f)-1,m=s.get(f)-1;Md.set(f,g),s.set(f,m),g||(Am.has(f)||f.removeAttribute(r),Am.delete(f)),m||f.removeAttribute(t)}),xb--,xb||(Md=new WeakMap,Md=new WeakMap,Am=new WeakMap,Rm={})}},B2=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),i=vre(n);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),xre(r,i,t,"aria-hidden")):function(){return null}},oa=function(){return oa=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},oa.apply(this,arguments)};function iF(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function bre(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))}var gy="right-scroll-bar-position",my="width-before-scroll-bar",_re="with-scroll-bars-hidden",Ire="--removed-body-scroll-bar-size";function bb(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function Ere(n,e){var t=P.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var i=t.value;i!==r&&(t.value=r,t.callback(r,i))}}}})[0];return t.callback=e,t.facade}var Cre=typeof window<"u"?P.useLayoutEffect:P.useEffect,Dj=new WeakMap;function Pre(n,e){var t=Ere(null,function(r){return n.forEach(function(i){return bb(i,r)})});return Cre(function(){var r=Dj.get(t);if(r){var i=new Set(r),s=new Set(n),o=t.current;i.forEach(function(a){s.has(a)||bb(a,null)}),s.forEach(function(a){i.has(a)||bb(a,o)})}Dj.set(t,n)},[n]),t}function Mre(n){return n}function Tre(n,e){e===void 0&&(e=Mre);var t=[],r=!1,i={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var o=e(s,r);return t.push(o),function(){t=t.filter(function(a){return a!==o})}},assignSyncMedium:function(s){for(r=!0;t.length;){var o=t;t=[],o.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var o=[];if(t.length){var a=t;t=[],a.forEach(s),o=t}var c=function(){var d=o;o=[],d.forEach(s)},u=function(){return Promise.resolve().then(c)};u(),t={push:function(d){o.push(d),u()},filter:function(d){return o=o.filter(d),t}}}};return i}function kre(n){n===void 0&&(n={});var e=Tre(null);return e.options=oa({async:!0,ssr:!1},n),e}var sF=function(n){var e=n.sideCar,t=iF(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return P.createElement(r,oa({},t))};sF.isSideCarExport=!0;function Are(n,e){return n.useMedium(e),sF}var oF=kre(),_b=function(){},Mw=P.forwardRef(function(n,e){var t=P.useRef(null),r=P.useState({onScrollCapture:_b,onWheelCapture:_b,onTouchMoveCapture:_b}),i=r[0],s=r[1],o=n.forwardProps,a=n.children,c=n.className,u=n.removeScrollBar,d=n.enabled,f=n.shards,g=n.sideCar,m=n.noIsolation,v=n.inert,w=n.allowPinchZoom,S=n.as,b=S===void 0?"div":S,x=n.gapMode,E=iF(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),M=g,j=Pre([t,e]),D=oa(oa({},E),i);return P.createElement(P.Fragment,null,d&&P.createElement(M,{sideCar:oF,removeScrollBar:u,shards:f,noIsolation:m,inert:v,setCallbacks:s,allowPinchZoom:!!w,lockRef:t,gapMode:x}),o?P.cloneElement(P.Children.only(a),oa(oa({},D),{ref:j})):P.createElement(b,oa({},D,{className:c,ref:j}),a))});Mw.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Mw.classNames={fullWidth:my,zeroRight:gy};var Rre=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function jre(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=Rre();return e&&n.setAttribute("nonce",e),n}function Dre(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function Ore(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var Lre=function(){var n=0,e=null;return{add:function(t){n==0&&(e=jre())&&(Dre(e,t),Ore(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},Nre=function(){var n=Lre();return function(e,t){P.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},aF=function(){var n=Nre(),e=function(t){var r=t.styles,i=t.dynamic;return n(r,i),null};return e},Bre={left:0,top:0,right:0,gap:0},Ib=function(n){return parseInt(n||"",10)||0},Fre=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],i=e[n==="padding"?"paddingRight":"marginRight"];return[Ib(t),Ib(r),Ib(i)]},zre=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return Bre;var e=Fre(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},Ure=aF(),rh="data-scroll-locked",$re=function(n,e,t,r){var i=n.left,s=n.top,o=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(_re,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(rh,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(o,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(gy,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(my,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(gy," .").concat(gy,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(my," .").concat(my,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(rh,`] {
    `).concat(Ire,": ").concat(a,`px;
  }
`)},Oj=function(){var n=parseInt(document.body.getAttribute(rh)||"0",10);return isFinite(n)?n:0},Hre=function(){P.useEffect(function(){return document.body.setAttribute(rh,(Oj()+1).toString()),function(){var n=Oj()-1;n<=0?document.body.removeAttribute(rh):document.body.setAttribute(rh,n.toString())}},[])},Wre=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,i=r===void 0?"margin":r;Hre();var s=P.useMemo(function(){return zre(i)},[i]);return P.createElement(Ure,{styles:$re(s,!e,i,t?"":"!important")})},nE=!1;if(typeof window<"u")try{var jm=Object.defineProperty({},"passive",{get:function(){return nE=!0,!0}});window.addEventListener("test",jm,jm),window.removeEventListener("test",jm,jm)}catch{nE=!1}var Td=nE?{passive:!1}:!1,Kre=function(n){return n.tagName==="TEXTAREA"},cF=function(n,e){if(!(n instanceof Element))return!1;var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!Kre(n)&&t[e]==="visible")},qre=function(n){return cF(n,"overflowY")},Gre=function(n){return cF(n,"overflowX")},Lj=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var i=lF(n,r);if(i){var s=uF(n,r),o=s[1],a=s[2];if(o>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},Vre=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},Yre=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},lF=function(n,e){return n==="v"?qre(e):Gre(e)},uF=function(n,e){return n==="v"?Vre(e):Yre(e)},Xre=function(n,e){return n==="h"&&e==="rtl"?-1:1},Zre=function(n,e,t,r,i){var s=Xre(n,window.getComputedStyle(e).direction),o=s*r,a=t.target,c=e.contains(a),u=!1,d=o>0,f=0,g=0;do{var m=uF(n,a),v=m[0],w=m[1],S=m[2],b=w-S-s*v;(v||b)&&lF(n,a)&&(f+=b,g+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(d&&(Math.abs(f)<1||!i)||!d&&(Math.abs(g)<1||!i))&&(u=!0),u},Dm=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},Nj=function(n){return[n.deltaX,n.deltaY]},Bj=function(n){return n&&"current"in n?n.current:n},Qre=function(n,e){return n[0]===e[0]&&n[1]===e[1]},Jre=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},eie=0,kd=[];function tie(n){var e=P.useRef([]),t=P.useRef([0,0]),r=P.useRef(),i=P.useState(eie++)[0],s=P.useState(aF)[0],o=P.useRef(n);P.useEffect(function(){o.current=n},[n]),P.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(i));var w=bre([n.lockRef.current],(n.shards||[]).map(Bj),!0).filter(Boolean);return w.forEach(function(S){return S.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),w.forEach(function(S){return S.classList.remove("allow-interactivity-".concat(i))})}}},[n.inert,n.lockRef.current,n.shards]);var a=P.useCallback(function(w,S){if("touches"in w&&w.touches.length===2||w.type==="wheel"&&w.ctrlKey)return!o.current.allowPinchZoom;var b=Dm(w),x=t.current,E="deltaX"in w?w.deltaX:x[0]-b[0],M="deltaY"in w?w.deltaY:x[1]-b[1],j,D=w.target,H=Math.abs(E)>Math.abs(M)?"h":"v";if("touches"in w&&H==="h"&&D.type==="range")return!1;var L=Lj(H,D);if(!L)return!0;if(L?j=H:(j=H==="v"?"h":"v",L=Lj(H,D)),!L)return!1;if(!r.current&&"changedTouches"in w&&(E||M)&&(r.current=j),!j)return!0;var U=r.current||j;return Zre(U,S,w,U==="h"?E:M,!0)},[]),c=P.useCallback(function(w){var S=w;if(!(!kd.length||kd[kd.length-1]!==s)){var b="deltaY"in S?Nj(S):Dm(S),x=e.current.filter(function(j){return j.name===S.type&&(j.target===S.target||S.target===j.shadowParent)&&Qre(j.delta,b)})[0];if(x&&x.should){S.cancelable&&S.preventDefault();return}if(!x){var E=(o.current.shards||[]).map(Bj).filter(Boolean).filter(function(j){return j.contains(S.target)}),M=E.length>0?a(S,E[0]):!o.current.noIsolation;M&&S.cancelable&&S.preventDefault()}}},[]),u=P.useCallback(function(w,S,b,x){var E={name:w,delta:S,target:b,should:x,shadowParent:nie(b)};e.current.push(E),setTimeout(function(){e.current=e.current.filter(function(M){return M!==E})},1)},[]),d=P.useCallback(function(w){t.current=Dm(w),r.current=void 0},[]),f=P.useCallback(function(w){u(w.type,Nj(w),w.target,a(w,n.lockRef.current))},[]),g=P.useCallback(function(w){u(w.type,Dm(w),w.target,a(w,n.lockRef.current))},[]);P.useEffect(function(){return kd.push(s),n.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:g}),document.addEventListener("wheel",c,Td),document.addEventListener("touchmove",c,Td),document.addEventListener("touchstart",d,Td),function(){kd=kd.filter(function(w){return w!==s}),document.removeEventListener("wheel",c,Td),document.removeEventListener("touchmove",c,Td),document.removeEventListener("touchstart",d,Td)}},[]);var m=n.removeScrollBar,v=n.inert;return P.createElement(P.Fragment,null,v?P.createElement(s,{styles:Jre(i)}):null,m?P.createElement(Wre,{gapMode:n.gapMode}):null)}function nie(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const rie=Are(oF,tie);var Tw=P.forwardRef(function(n,e){return P.createElement(Mw,oa({},n,{ref:e,sideCar:rie}))});Tw.classNames=Mw.classNames;var rE=["Enter"," "],iie=["ArrowDown","PageUp","Home"],dF=["ArrowUp","PageDown","End"],sie=[...iie,...dF],oie={ltr:[...rE,"ArrowRight"],rtl:[...rE,"ArrowLeft"]},aie={ltr:["ArrowLeft"],rtl:["ArrowRight"]},ig="Menu",[Ip,cie,lie]=xw(ig),[Hu,kw]=$u(ig,[lie,Cw,QB]),sg=Cw(),hF=QB(),[fF,kl]=Hu(ig),[uie,og]=Hu(ig),pF=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:i,onOpenChange:s,modal:o=!0}=n,a=sg(e),[c,u]=P.useState(null),d=P.useRef(!1),f=ei(s),g=E2(i);return P.useEffect(()=>{const m=()=>{d.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>d.current=!1;return document.addEventListener("keydown",m,{capture:!0}),()=>{document.removeEventListener("keydown",m,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),p.jsx(L2,{...a,children:p.jsx(fF,{scope:e,open:t,onOpenChange:f,content:c,onContentChange:u,children:p.jsx(uie,{scope:e,onClose:P.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:d,dir:g,modal:o,children:r})})})};pF.displayName=ig;var die="MenuAnchor",F2=P.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=sg(t);return p.jsx(N2,{...i,...r,ref:e})});F2.displayName=die;var z2="MenuPortal",[hie,gF]=Hu(z2,{forceMount:void 0}),mF=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:i}=n,s=kl(z2,e);return p.jsx(hie,{scope:e,forceMount:t,children:p.jsx(Fo,{present:t||s.open,children:p.jsx(rg,{asChild:!0,container:i,children:r})})})};mF.displayName=z2;var eo="MenuContent",[fie,U2]=Hu(eo),yF=P.forwardRef((n,e)=>{const t=gF(eo,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=kl(eo,n.__scopeMenu),o=og(eo,n.__scopeMenu);return p.jsx(Ip.Provider,{scope:n.__scopeMenu,children:p.jsx(Fo,{present:r||s.open,children:p.jsx(Ip.Slot,{scope:n.__scopeMenu,children:o.modal?p.jsx(pie,{...i,ref:e}):p.jsx(gie,{...i,ref:e})})})})}),pie=P.forwardRef((n,e)=>{const t=kl(eo,n.__scopeMenu),r=P.useRef(null),i=Dn(e,r);return P.useEffect(()=>{const s=r.current;if(s)return B2(s)},[]),p.jsx($2,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:Ge(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),gie=P.forwardRef((n,e)=>{const t=kl(eo,n.__scopeMenu);return p.jsx($2,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),$2=P.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:i,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:f,onInteractOutside:g,onDismiss:m,disableOutsideScroll:v,...w}=n,S=kl(eo,t),b=og(eo,t),x=sg(t),E=hF(t),M=cie(t),[j,D]=P.useState(null),H=P.useRef(null),L=Dn(e,H,S.onContentChange),U=P.useRef(0),z=P.useRef(""),Y=P.useRef(0),V=P.useRef(null),N=P.useRef("right"),_=P.useRef(0),k=v?Tw:P.Fragment,O=v?{as:Pu,allowPinchZoom:!0}:void 0,W=X=>{var ue,fe;const ne=z.current+X,$=M().filter(_e=>!_e.disabled),C=document.activeElement,R=(ue=$.find(_e=>_e.ref.current===C))==null?void 0:ue.textValue,Z=$.map(_e=>_e.textValue),J=Pie(Z,ne,R),oe=(fe=$.find(_e=>_e.textValue===J))==null?void 0:fe.ref.current;(function _e(Le){z.current=Le,window.clearTimeout(U.current),Le!==""&&(U.current=window.setTimeout(()=>_e(""),1e3))})(ne),oe&&setTimeout(()=>oe.focus())};P.useEffect(()=>()=>window.clearTimeout(U.current),[]),C2();const q=P.useCallback(X=>{var $,C;return N.current===(($=V.current)==null?void 0:$.side)&&Tie(X,(C=V.current)==null?void 0:C.area)},[]);return p.jsx(fie,{scope:t,searchRef:z,onItemEnter:P.useCallback(X=>{q(X)&&X.preventDefault()},[q]),onItemLeave:P.useCallback(X=>{var ne;q(X)||((ne=H.current)==null||ne.focus(),D(null))},[q]),onTriggerLeave:P.useCallback(X=>{q(X)&&X.preventDefault()},[q]),pointerGraceTimerRef:Y,onPointerGraceIntentChange:P.useCallback(X=>{V.current=X},[]),children:p.jsx(k,{...O,children:p.jsx(bw,{asChild:!0,trapped:i,onMountAutoFocus:Ge(s,X=>{var ne;X.preventDefault(),(ne=H.current)==null||ne.focus({preventScroll:!0})}),onUnmountAutoFocus:o,children:p.jsx(tg,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:f,onInteractOutside:g,onDismiss:m,children:p.jsx(yre,{asChild:!0,...E,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:j,onCurrentTabStopIdChange:D,onEntryFocus:Ge(c,X=>{b.isUsingKeyboardRef.current||X.preventDefault()}),preventScrollOnEntryFocus:!0,children:p.jsx(YB,{role:"menu","aria-orientation":"vertical","data-state":DF(S.open),"data-radix-menu-content":"",dir:b.dir,...x,...w,ref:L,style:{outline:"none",...w.style},onKeyDown:Ge(w.onKeyDown,X=>{const $=X.target.closest("[data-radix-menu-content]")===X.currentTarget,C=X.ctrlKey||X.altKey||X.metaKey,R=X.key.length===1;$&&(X.key==="Tab"&&X.preventDefault(),!C&&R&&W(X.key));const Z=H.current;if(X.target!==Z||!sie.includes(X.key))return;X.preventDefault();const oe=M().filter(ue=>!ue.disabled).map(ue=>ue.ref.current);dF.includes(X.key)&&oe.reverse(),Eie(oe)}),onBlur:Ge(n.onBlur,X=>{X.currentTarget.contains(X.target)||(window.clearTimeout(U.current),z.current="")}),onPointerMove:Ge(n.onPointerMove,Ep(X=>{const ne=X.target,$=_.current!==X.clientX;if(X.currentTarget.contains(ne)&&$){const C=X.clientX>_.current?"right":"left";N.current=C,_.current=X.clientX}}))})})})})})})});yF.displayName=eo;var mie="MenuGroup",H2=P.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(Vt.div,{role:"group",...r,ref:e})});H2.displayName=mie;var yie="MenuLabel",wF=P.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(Vt.div,{...r,ref:e})});wF.displayName=yie;var S0="MenuItem",Fj="menu.itemSelect",Aw=P.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...i}=n,s=P.useRef(null),o=og(S0,n.__scopeMenu),a=U2(S0,n.__scopeMenu),c=Dn(e,s),u=P.useRef(!1),d=()=>{const f=s.current;if(!t&&f){const g=new CustomEvent(Fj,{bubbles:!0,cancelable:!0});f.addEventListener(Fj,m=>r==null?void 0:r(m),{once:!0}),I2(f,g),g.defaultPrevented?u.current=!1:o.onClose()}};return p.jsx(vF,{...i,ref:c,disabled:t,onClick:Ge(n.onClick,d),onPointerDown:f=>{var g;(g=n.onPointerDown)==null||g.call(n,f),u.current=!0},onPointerUp:Ge(n.onPointerUp,f=>{var g;u.current||(g=f.currentTarget)==null||g.click()}),onKeyDown:Ge(n.onKeyDown,f=>{const g=a.searchRef.current!=="";t||g&&f.key===" "||rE.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});Aw.displayName=S0;var vF=P.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:i,...s}=n,o=U2(S0,t),a=hF(t),c=P.useRef(null),u=Dn(e,c),[d,f]=P.useState(!1),[g,m]=P.useState("");return P.useEffect(()=>{const v=c.current;v&&m((v.textContent??"").trim())},[s.children]),p.jsx(Ip.ItemSlot,{scope:t,disabled:r,textValue:i??g,children:p.jsx(wre,{asChild:!0,...a,focusable:!r,children:p.jsx(Vt.div,{role:"menuitem","data-highlighted":d?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:u,onPointerMove:Ge(n.onPointerMove,Ep(v=>{r?o.onItemLeave(v):(o.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ge(n.onPointerLeave,Ep(v=>o.onItemLeave(v))),onFocus:Ge(n.onFocus,()=>f(!0)),onBlur:Ge(n.onBlur,()=>f(!1))})})})}),wie="MenuCheckboxItem",SF=P.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...i}=n;return p.jsx(EF,{scope:n.__scopeMenu,checked:t,children:p.jsx(Aw,{role:"menuitemcheckbox","aria-checked":x0(t)?"mixed":t,...i,ref:e,"data-state":q2(t),onSelect:Ge(i.onSelect,()=>r==null?void 0:r(x0(t)?!0:!t),{checkForDefaultPrevented:!1})})})});SF.displayName=wie;var xF="MenuRadioGroup",[vie,Sie]=Hu(xF,{value:void 0,onValueChange:()=>{}}),bF=P.forwardRef((n,e)=>{const{value:t,onValueChange:r,...i}=n,s=ei(r);return p.jsx(vie,{scope:n.__scopeMenu,value:t,onValueChange:s,children:p.jsx(H2,{...i,ref:e})})});bF.displayName=xF;var _F="MenuRadioItem",IF=P.forwardRef((n,e)=>{const{value:t,...r}=n,i=Sie(_F,n.__scopeMenu),s=t===i.value;return p.jsx(EF,{scope:n.__scopeMenu,checked:s,children:p.jsx(Aw,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":q2(s),onSelect:Ge(r.onSelect,()=>{var o;return(o=i.onValueChange)==null?void 0:o.call(i,t)},{checkForDefaultPrevented:!1})})})});IF.displayName=_F;var W2="MenuItemIndicator",[EF,xie]=Hu(W2,{checked:!1}),CF=P.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...i}=n,s=xie(W2,t);return p.jsx(Fo,{present:r||x0(s.checked)||s.checked===!0,children:p.jsx(Vt.span,{...i,ref:e,"data-state":q2(s.checked)})})});CF.displayName=W2;var bie="MenuSeparator",PF=P.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(Vt.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});PF.displayName=bie;var _ie="MenuArrow",MF=P.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,i=sg(t);return p.jsx(XB,{...i,...r,ref:e})});MF.displayName=_ie;var K2="MenuSub",[Iie,TF]=Hu(K2),kF=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:i}=n,s=kl(K2,e),o=sg(e),[a,c]=P.useState(null),[u,d]=P.useState(null),f=ei(i);return P.useEffect(()=>(s.open===!1&&f(!1),()=>f(!1)),[s.open,f]),p.jsx(L2,{...o,children:p.jsx(fF,{scope:e,open:r,onOpenChange:f,content:u,onContentChange:d,children:p.jsx(Iie,{scope:e,contentId:ac(),triggerId:ac(),trigger:a,onTriggerChange:c,children:t})})})};kF.displayName=K2;var Kf="MenuSubTrigger",AF=P.forwardRef((n,e)=>{const t=kl(Kf,n.__scopeMenu),r=og(Kf,n.__scopeMenu),i=TF(Kf,n.__scopeMenu),s=U2(Kf,n.__scopeMenu),o=P.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,u={__scopeMenu:n.__scopeMenu},d=P.useCallback(()=>{o.current&&window.clearTimeout(o.current),o.current=null},[]);return P.useEffect(()=>d,[d]),P.useEffect(()=>{const f=a.current;return()=>{window.clearTimeout(f),c(null)}},[a,c]),p.jsx(F2,{asChild:!0,...u,children:p.jsx(vF,{id:i.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":i.contentId,"data-state":DF(t.open),...n,ref:Sw(e,i.onTriggerChange),onClick:f=>{var g;(g=n.onClick)==null||g.call(n,f),!(n.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:Ge(n.onPointerMove,Ep(f=>{s.onItemEnter(f),!f.defaultPrevented&&!n.disabled&&!t.open&&!o.current&&(s.onPointerGraceIntentChange(null),o.current=window.setTimeout(()=>{t.onOpenChange(!0),d()},100))})),onPointerLeave:Ge(n.onPointerLeave,Ep(f=>{var m,v;d();const g=(m=t.content)==null?void 0:m.getBoundingClientRect();if(g){const w=(v=t.content)==null?void 0:v.dataset.side,S=w==="right",b=S?-5:5,x=g[S?"left":"right"],E=g[S?"right":"left"];s.onPointerGraceIntentChange({area:[{x:f.clientX+b,y:f.clientY},{x,y:g.top},{x:E,y:g.top},{x:E,y:g.bottom},{x,y:g.bottom}],side:w}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(f),f.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Ge(n.onKeyDown,f=>{var m;const g=s.searchRef.current!=="";n.disabled||g&&f.key===" "||oie[r.dir].includes(f.key)&&(t.onOpenChange(!0),(m=t.content)==null||m.focus(),f.preventDefault())})})})});AF.displayName=Kf;var RF="MenuSubContent",jF=P.forwardRef((n,e)=>{const t=gF(eo,n.__scopeMenu),{forceMount:r=t.forceMount,...i}=n,s=kl(eo,n.__scopeMenu),o=og(eo,n.__scopeMenu),a=TF(RF,n.__scopeMenu),c=P.useRef(null),u=Dn(e,c);return p.jsx(Ip.Provider,{scope:n.__scopeMenu,children:p.jsx(Fo,{present:r||s.open,children:p.jsx(Ip.Slot,{scope:n.__scopeMenu,children:p.jsx($2,{id:a.contentId,"aria-labelledby":a.triggerId,...i,ref:u,align:"start",side:o.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:d=>{var f;o.isUsingKeyboardRef.current&&((f=c.current)==null||f.focus()),d.preventDefault()},onCloseAutoFocus:d=>d.preventDefault(),onFocusOutside:Ge(n.onFocusOutside,d=>{d.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Ge(n.onEscapeKeyDown,d=>{o.onClose(),d.preventDefault()}),onKeyDown:Ge(n.onKeyDown,d=>{var m;const f=d.currentTarget.contains(d.target),g=aie[o.dir].includes(d.key);f&&g&&(s.onOpenChange(!1),(m=a.trigger)==null||m.focus(),d.preventDefault())})})})})})});jF.displayName=RF;function DF(n){return n?"open":"closed"}function x0(n){return n==="indeterminate"}function q2(n){return x0(n)?"indeterminate":n?"checked":"unchecked"}function Eie(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function Cie(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function Pie(n,e,t){const i=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let o=Cie(n,Math.max(s,0));i.length===1&&(o=o.filter(u=>u!==t));const c=o.find(u=>u.toLowerCase().startsWith(i.toLowerCase()));return c!==t?c:void 0}function Mie(n,e){const{x:t,y:r}=n;let i=!1;for(let s=0,o=e.length-1;s<e.length;o=s++){const a=e[s].x,c=e[s].y,u=e[o].x,d=e[o].y;c>r!=d>r&&t<(u-a)*(r-c)/(d-c)+a&&(i=!i)}return i}function Tie(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return Mie(t,e)}function Ep(n){return e=>e.pointerType==="mouse"?n(e):void 0}var OF=pF,LF=F2,NF=mF,BF=yF,FF=H2,zF=wF,UF=Aw,$F=SF,HF=bF,WF=IF,KF=CF,qF=PF,GF=MF,VF=kF,YF=AF,XF=jF,G2="ContextMenu",[kie,k1e]=$u(G2,[kw]),Ti=kw(),[Aie,ZF]=kie(G2),QF=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:i,modal:s=!0}=n,[o,a]=P.useState(!1),c=Ti(e),u=ei(r),d=P.useCallback(f=>{a(f),u(f)},[u]);return p.jsx(Aie,{scope:e,open:o,onOpenChange:d,modal:s,children:p.jsx(OF,{...c,dir:i,open:o,onOpenChange:d,modal:s,children:t})})};QF.displayName=G2;var JF="ContextMenuTrigger",ez=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...i}=n,s=ZF(JF,t),o=Ti(t),a=P.useRef({x:0,y:0}),c=P.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),u=P.useRef(0),d=P.useCallback(()=>window.clearTimeout(u.current),[]),f=g=>{a.current={x:g.clientX,y:g.clientY},s.onOpenChange(!0)};return P.useEffect(()=>d,[d]),P.useEffect(()=>void(r&&d()),[r,d]),p.jsxs(p.Fragment,{children:[p.jsx(LF,{...o,virtualRef:c}),p.jsx(Vt.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...i,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:Ge(n.onContextMenu,g=>{d(),f(g),g.preventDefault()}),onPointerDown:r?n.onPointerDown:Ge(n.onPointerDown,Om(g=>{d(),u.current=window.setTimeout(()=>f(g),700)})),onPointerMove:r?n.onPointerMove:Ge(n.onPointerMove,Om(d)),onPointerCancel:r?n.onPointerCancel:Ge(n.onPointerCancel,Om(d)),onPointerUp:r?n.onPointerUp:Ge(n.onPointerUp,Om(d))})]})});ez.displayName=JF;var Rie="ContextMenuPortal",V2=n=>{const{__scopeContextMenu:e,...t}=n,r=Ti(e);return p.jsx(NF,{...r,...t})};V2.displayName=Rie;var tz="ContextMenuContent",nz=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=ZF(tz,t),s=Ti(t),o=P.useRef(!1);return p.jsx(BF,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=n.onCloseAutoFocus)==null||c.call(n,a),!a.defaultPrevented&&o.current&&a.preventDefault(),o.current=!1},onInteractOutside:a=>{var c;(c=n.onInteractOutside)==null||c.call(n,a),!a.defaultPrevented&&!i.modal&&(o.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nz.displayName=tz;var jie="ContextMenuGroup",rz=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(FF,{...i,...r,ref:e})});rz.displayName=jie;var Die="ContextMenuLabel",Oie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(zF,{...i,...r,ref:e})});Oie.displayName=Die;var Lie="ContextMenuItem",iz=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(UF,{...i,...r,ref:e})});iz.displayName=Lie;var Nie="ContextMenuCheckboxItem",sz=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx($F,{...i,...r,ref:e})});sz.displayName=Nie;var Bie="ContextMenuRadioGroup",Fie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(HF,{...i,...r,ref:e})});Fie.displayName=Bie;var zie="ContextMenuRadioItem",Uie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(WF,{...i,...r,ref:e})});Uie.displayName=zie;var $ie="ContextMenuItemIndicator",Hie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(KF,{...i,...r,ref:e})});Hie.displayName=$ie;var Wie="ContextMenuSeparator",Kie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(qF,{...i,...r,ref:e})});Kie.displayName=Wie;var qie="ContextMenuArrow",Gie=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(GF,{...i,...r,ref:e})});Gie.displayName=qie;var Vie="ContextMenuSub",oz=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:i,defaultOpen:s}=n,o=Ti(e),[a,c]=Tl({prop:i,defaultProp:s,onChange:r});return p.jsx(VF,{...o,open:a,onOpenChange:c,children:t})};oz.displayName=Vie;var Yie="ContextMenuSubTrigger",az=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(YF,{...i,...r,ref:e})});az.displayName=Yie;var Xie="ContextMenuSubContent",cz=P.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,i=Ti(t);return p.jsx(XF,{...i,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});cz.displayName=Xie;function Om(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var Zie=QF,Qie=ez,Jie=V2,ese=nz,tse=sz,Y2="DropdownMenu",[nse,A1e]=$u(Y2,[kw]),ki=kw(),[rse,lz]=nse(Y2),uz=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:i,defaultOpen:s,onOpenChange:o,modal:a=!0}=n,c=ki(e),u=P.useRef(null),[d=!1,f]=Tl({prop:i,defaultProp:s,onChange:o});return p.jsx(rse,{scope:e,triggerId:ac(),triggerRef:u,contentId:ac(),open:d,onOpenChange:f,onOpenToggle:P.useCallback(()=>f(g=>!g),[f]),modal:a,children:p.jsx(OF,{...c,open:d,onOpenChange:f,dir:r,modal:a,children:t})})};uz.displayName=Y2;var dz="DropdownMenuTrigger",hz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...i}=n,s=lz(dz,t),o=ki(t);return p.jsx(LF,{asChild:!0,...o,children:p.jsx(Vt.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...i,ref:Sw(e,s.triggerRef),onPointerDown:Ge(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Ge(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});hz.displayName=dz;var ise="DropdownMenuPortal",fz=n=>{const{__scopeDropdownMenu:e,...t}=n,r=ki(e);return p.jsx(NF,{...r,...t})};fz.displayName=ise;var pz="DropdownMenuContent",gz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=lz(pz,t),s=ki(t),o=P.useRef(!1);return p.jsx(BF,{id:i.contentId,"aria-labelledby":i.triggerId,...s,...r,ref:e,onCloseAutoFocus:Ge(n.onCloseAutoFocus,a=>{var c;o.current||(c=i.triggerRef.current)==null||c.focus(),o.current=!1,a.preventDefault()}),onInteractOutside:Ge(n.onInteractOutside,a=>{const c=a.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,d=c.button===2||u;(!i.modal||d)&&(o.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});gz.displayName=pz;var sse="DropdownMenuGroup",mz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(FF,{...i,...r,ref:e})});mz.displayName=sse;var ose="DropdownMenuLabel",ase=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(zF,{...i,...r,ref:e})});ase.displayName=ose;var cse="DropdownMenuItem",yz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(UF,{...i,...r,ref:e})});yz.displayName=cse;var lse="DropdownMenuCheckboxItem",wz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx($F,{...i,...r,ref:e})});wz.displayName=lse;var use="DropdownMenuRadioGroup",dse=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(HF,{...i,...r,ref:e})});dse.displayName=use;var hse="DropdownMenuRadioItem",fse=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(WF,{...i,...r,ref:e})});fse.displayName=hse;var pse="DropdownMenuItemIndicator",gse=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(KF,{...i,...r,ref:e})});gse.displayName=pse;var mse="DropdownMenuSeparator",yse=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(qF,{...i,...r,ref:e})});yse.displayName=mse;var wse="DropdownMenuArrow",vse=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(GF,{...i,...r,ref:e})});vse.displayName=wse;var Sse=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:i,defaultOpen:s}=n,o=ki(e),[a=!1,c]=Tl({prop:r,defaultProp:s,onChange:i});return p.jsx(VF,{...o,open:a,onOpenChange:c,children:t})},xse="DropdownMenuSubTrigger",vz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(YF,{...i,...r,ref:e})});vz.displayName=xse;var bse="DropdownMenuSubContent",Sz=P.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,i=ki(t);return p.jsx(XF,{...i,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});Sz.displayName=bse;var X2=uz,Z2=hz,Rw=fz,Q2=gz,_se=mz,Ise=yz,Ese=wz,Cse=Sse,Pse=vz,Mse=Sz;function An(n,e){var i;const t=new Set;for(const s of e){const o=n.getShape(s);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&t.add(o);const a=n.getShape(o.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&t.add(a)}const r=new Map;for(const s of t){const o=xz(n,s);o.length&&r.set(s,o)}for(const[s,o]of r){const a=n.getShapeUtil(s),c=St(o.map(u=>n.getShape(u)));(i=a.onDragShapesOut)==null||i.call(a,s,c)}}function xz(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const r=n.getShapePageBounds(e);if(!r)return[];let i,s,o;const a=[];for(const c of t){const u=n.getShapePageBounds(c);if(!u)continue;if(!r.includes(u)){a.push(c);continue}i??(i=n.getShapeGeometry(e)),s??(s=n.getShapePageTransform(e)),o??(o=s.applyToPoints(i.vertices));const d=n.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:f,isClosed:g}=n.getShapeGeometry(c);if(!f.some(m=>As(m,d))){if(g){if(l2(d,f))continue}else if(jZ(d,f))continue;a.push(c)}}return a}function b0(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id})}function Tse(n,e){const t=St(e.map(i=>n.getShape(i)).filter(i=>i&&n.isShapeOfType(i,"frame")));if(!t.length)return;const r=[];n.run(()=>{t.map(i=>{const s=n.getSortedChildIdsForParent(i.id);s.length&&(n.reparentShapes(s,i.parentId,i.index),r.push(...s))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const kse=50;function Ase(n,e,t={}){const r=n.getShape(e);if(!r)return;const i=n.getSortedChildIdsForParent(r.id),s=St(i.map(m=>n.getShape(m)));if(!s.length)return;const o=De.FromPoints(s.flatMap(m=>{const v=n.getShapeGeometry(m.id);return n.getShapeLocalTransform(m).applyToPoints(v.vertices)})),{padding:a=kse}=t,c=o.w+2*a,u=o.h+2*a,d=a-o.minX,f=a-o.minY;if(d===0&&f===0&&r.props.w===c&&r.props.h===u)return;const g=new T(d,f).rot(r.rotation);n.run(()=>{const m=i.map(v=>{const w=n.getShape(v);return{id:w.id,type:w.type,x:w.x+d,y:w.y+f}});m.push({id:r.id,type:r.type,x:r.x-g.x,y:r.y-g.y,props:{w:c,h:u}}),n.updateShapes(m)})}const bz=P.createContext(null);function Rse({assetUrls:n,children:e}){return P.useEffect(()=>{for(const t of Object.values(n.icons)){const r=hp();r.src=t,r.decode()}for(const t of Object.values(n.embedIcons)){const r=hp();r.src=t,r.decode()}},[n]),p.jsx(bz.Provider,{value:n,children:e})}function J2(){const n=P.useContext(bz);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const iE={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},jse=new Set(["ar","fa","he","ur","ku"]),Ad={locale:"en",label:"English",messages:iE,dir:"ltr"};async function Dse(n,e){if(!(await fa(e.translations.en)).ok)return console.warn("No main translations found."),Ad;if(n==="en")return Ad;const r=wp.find(a=>a.locale===n);if(!r)return console.warn(`No translation found for locale ${n}`),Ad;const s=await(await fa(e.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${n}`),Ad;const o=[];for(const a in Ad.messages)s[a]||o.push(a);return o.length>0,{locale:n,label:r.label,dir:jse.has(r.locale)?"rtl":"ltr",messages:{...Ad.messages,...s}}}const _z=P.createContext(null);function Iz(){const n=P.useContext(_z);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}function Ose({overrides:n,locale:e,children:t}){const r=J2(),[i,s]=P.useState(()=>n&&n.en?{locale:"en",label:"English",dir:"ltr",messages:{...iE,...n.en}}:{locale:"en",label:"English",dir:"ltr",messages:iE});return P.useEffect(()=>{let o=!1;async function a(){const c=await Dse(e,r);c&&!o&&(n&&n[e]?s({...c,messages:{...c.messages,...n[e]}}):s(c))}return a(),()=>{o=!0}},[r,e,n]),p.jsx(_z.Provider,{value:i,children:t})}function Nt(){const n=Iz();return P.useCallback(function(t){return n.messages[t]??t},[n])}const ot=P.forwardRef(function({children:e,type:t,...r},i){return p.jsx("button",{ref:i,type:"button",draggable:!1,...r,className:rt("tlui-button",`tlui-button__${t}`,r.className),children:e})});function yr({children:n}){return p.jsx("span",{className:"tlui-button__label",children:n})}var eP="Dialog",[Ez,R1e]=$u(eP),[Lse,zo]=Ez(eP),Cz=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!0}=n,a=P.useRef(null),c=P.useRef(null),[u=!1,d]=Tl({prop:r,defaultProp:i,onChange:s});return p.jsx(Lse,{scope:e,triggerRef:a,contentRef:c,contentId:ac(),titleId:ac(),descriptionId:ac(),open:u,onOpenChange:d,onOpenToggle:P.useCallback(()=>d(f=>!f),[d]),modal:o,children:t})};Cz.displayName=eP;var Pz="DialogTrigger",Nse=P.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(Pz,t),s=Dn(e,i.triggerRef);return p.jsx(Vt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":rP(i.open),...r,ref:s,onClick:Ge(n.onClick,i.onOpenToggle)})});Nse.displayName=Pz;var tP="DialogPortal",[Bse,Mz]=Ez(tP,{forceMount:void 0}),Tz=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:i}=n,s=zo(tP,e);return p.jsx(Bse,{scope:e,forceMount:t,children:P.Children.map(r,o=>p.jsx(Fo,{present:t||s.open,children:p.jsx(rg,{asChild:!0,container:i,children:o})}))})};Tz.displayName=tP;var _0="DialogOverlay",kz=P.forwardRef((n,e)=>{const t=Mz(_0,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=zo(_0,n.__scopeDialog);return s.modal?p.jsx(Fo,{present:r||s.open,children:p.jsx(Fse,{...i,ref:e})}):null});kz.displayName=_0;var Fse=P.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(_0,t);return p.jsx(Tw,{as:Pu,allowPinchZoom:!0,shards:[i.contentRef],children:p.jsx(Vt.div,{"data-state":rP(i.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),Tu="DialogContent",Az=P.forwardRef((n,e)=>{const t=Mz(Tu,n.__scopeDialog),{forceMount:r=t.forceMount,...i}=n,s=zo(Tu,n.__scopeDialog);return p.jsx(Fo,{present:r||s.open,children:s.modal?p.jsx(zse,{...i,ref:e}):p.jsx(Use,{...i,ref:e})})});Az.displayName=Tu;var zse=P.forwardRef((n,e)=>{const t=zo(Tu,n.__scopeDialog),r=P.useRef(null),i=Dn(e,t.contentRef,r);return P.useEffect(()=>{const s=r.current;if(s)return B2(s)},[]),p.jsx(Rz,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ge(n.onCloseAutoFocus,s=>{var o;s.preventDefault(),(o=t.triggerRef.current)==null||o.focus()}),onPointerDownOutside:Ge(n.onPointerDownOutside,s=>{const o=s.detail.originalEvent,a=o.button===0&&o.ctrlKey===!0;(o.button===2||a)&&s.preventDefault()}),onFocusOutside:Ge(n.onFocusOutside,s=>s.preventDefault())})}),Use=P.forwardRef((n,e)=>{const t=zo(Tu,n.__scopeDialog),r=P.useRef(!1),i=P.useRef(!1);return p.jsx(Rz,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var c,u;(c=n.onInteractOutside)==null||c.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((u=t.triggerRef.current)==null?void 0:u.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),Rz=P.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,...o}=n,a=zo(Tu,t),c=P.useRef(null),u=Dn(e,c);return C2(),p.jsxs(p.Fragment,{children:[p.jsx(bw,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:p.jsx(tg,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":rP(a.open),...o,ref:u,onDismiss:()=>a.onOpenChange(!1)})}),p.jsxs(p.Fragment,{children:[p.jsx(Hse,{titleId:a.titleId}),p.jsx(Kse,{contentRef:c,descriptionId:a.descriptionId})]})]})}),nP="DialogTitle",jz=P.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(nP,t);return p.jsx(Vt.h2,{id:i.titleId,...r,ref:e})});jz.displayName=nP;var Dz="DialogDescription",$se=P.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(Dz,t);return p.jsx(Vt.p,{id:i.descriptionId,...r,ref:e})});$se.displayName=Dz;var Oz="DialogClose",Lz=P.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,i=zo(Oz,t);return p.jsx(Vt.button,{type:"button",...r,ref:e,onClick:Ge(n.onClick,()=>i.onOpenChange(!1))})});Lz.displayName=Oz;function rP(n){return n?"open":"closed"}var Nz="DialogTitleWarning",[j1e,Bz]=wte(Nz,{contentName:Tu,titleName:nP,docsSlug:"dialog"}),Hse=({titleId:n})=>{const e=Bz(Nz),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return P.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},Wse="DialogDescriptionWarning",Kse=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${Bz(Wse).contentName}}.`;return P.useEffect(()=>{var s;const i=(s=n.current)==null?void 0:s.getAttribute("aria-describedby");e&&i&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},qse=Cz,Gse=Tz,Vse=kz,Yse=Az;const ya=P.memo(function({small:e,invertIcon:t,icon:r,color:i,className:s,...o}){const a=J2(),c=a.icons[r]??a.icons["question-mark-circle"],u=P.useRef(null);return P.useLayoutEffect(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),u!=null&&u.current&&(u.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[u,c,r]),r==="none"?p.jsx("div",{className:rt("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s)}):p.jsx("div",{...o,ref:u,className:rt("tlui-icon",{"tlui-icon__small":e},s),style:{color:i,mask:`url(${c}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function Ot({icon:n,small:e,invertIcon:t}){return p.jsx(ya,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}function jw({className:n,children:e}){return p.jsx("div",{className:rt("tlui-dialog__header",n),children:e})}function Dw({className:n,children:e}){return p.jsx(jz,{dir:"ltr",className:rt("tlui-dialog__header__title",n),children:e})}function Ow(){return p.jsx("div",{className:"tlui-dialog__header__close",children:p.jsx(Lz,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:p.jsx(ot,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:p.jsx(Ot,{small:!0,icon:"cross-2"})})})})}function Cp({className:n,children:e,style:t}){return p.jsx("div",{className:rt("tlui-dialog__body",n),style:t,children:e})}function iP({className:n,children:e}){return p.jsx("div",{className:rt("tlui-dialog__footer",n),children:e})}const Lw=P.forwardRef(function({className:e,label:t,icon:r,iconLeft:i,autoSelect:s=!1,autoFocus:o=!1,defaultValue:a,placeholder:c,onComplete:u,onValueChange:d,onCancel:f,onFocus:g,onBlur:m,shouldManuallyMaintainScrollPositionWhenFocused:v=!1,children:w,value:S},b){const x=Cl(),E=P.useRef(null);P.useImperativeHandle(b,()=>E.current);const M=Nt(),j=P.useRef(a??""),D=P.useRef(a??""),[H,L]=P.useState(!1),U=P.useCallback(N=>{L(!0);const _=N.currentTarget;D.current=_.value,x?x.timers.requestAnimationFrame(()=>{s&&_.select()}):UI.requestAnimationFrame("anon",()=>{s&&_.select()}),g==null||g()},[s,x,g]),z=P.useCallback(N=>{const _=N.currentTarget.value;D.current=_,d==null||d(_)},[d]),Y=P.useCallback(N=>{switch(N.key){case"Enter":{N.currentTarget.blur(),Sr(N),u==null||u(N.currentTarget.value);break}case"Escape":{N.currentTarget.value=j.current,f==null||f(N.currentTarget.value),N.currentTarget.blur(),Sr(N);break}}},[u,f]),V=P.useCallback(N=>{L(!1);const _=N.currentTarget.value;m==null||m(_)},[m]);return P.useEffect(()=>{if(!_n.isIos)return;const N=window.visualViewport;if(H&&v&&N){const _=()=>{var k;(k=E.current)==null||k.scrollIntoView({block:"center"})};return N.addEventListener("resize",_),N.addEventListener("scroll",_),x?x.timers.requestAnimationFrame(()=>{var k;(k=E.current)==null||k.scrollIntoView({block:"center"})}):UI.requestAnimationFrame("anon",()=>{var k;(k=E.current)==null||k.scrollIntoView({block:"center"})}),()=>{N.removeEventListener("resize",_),N.removeEventListener("scroll",_)}}},[H,x,v]),p.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[w,t&&p.jsx("label",{children:M(t)}),i&&p.jsx(ya,{icon:i,className:"tlui-icon-left",small:!0}),p.jsx("input",{ref:E,className:rt("tlui-input",e),type:"text",defaultValue:a,onKeyDownCapture:Y,onChange:z,onFocus:U,onBlur:V,autoFocus:o,placeholder:c,value:S}),r&&p.jsx(ya,{icon:r,small:!!t})]})});function zj(n){return js.isValid(n)?{isValid:!0,hasProtocol:!0}:js.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const Xse=ti(function({onClose:e}){const r=me().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?p.jsx(Zse,{onClose:e,selectedShape:r}):null}),Zse=ti(function({onClose:e,selectedShape:t}){const r=me(),i=Nt(),s=P.useRef(null);P.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var v;return(v=s.current)==null?void 0:v.focus()})},[r]);const o=P.useRef(t.props.url),[a,c]=P.useState(()=>{const v=zj(t.props.url),w=v.isValid===!0?v.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:w,safe:w,valid:!0}}),u=P.useCallback(v=>{const w=v.replace(/https?:\/\/(https?:\/\/)/,(x,E)=>E),S=zj(w),b=S.isValid===!0?S.hasProtocol?w:"https://"+w:"https://";c({actual:w,safe:b,valid:S.isValid})},[]),d=P.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(r.updateShapes([{id:v.id,type:v.type,props:{url:""}}]),e())},[r,e]),f=P.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(v&&"url"in v.props&&v.props.url!==a.safe&&r.updateShapes([{id:v.id,type:v.type,props:{url:a.safe}}]),e())},[r,e,a]),g=P.useCallback(()=>{e()},[e]);if(!t)return e(),null;const m=o.current&&!a.valid;return p.jsxs(p.Fragment,{children:[p.jsxs(jw,{children:[p.jsx(Dw,{children:i("edit-link-dialog.title")}),p.jsx(Ow,{})]}),p.jsx(Cp,{children:p.jsxs("div",{className:"tlui-edit-link-dialog",children:[p.jsx(Lw,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:u,onComplete:f,onCancel:g}),p.jsx("div",{children:a.valid?i("edit-link-dialog.detail"):i("edit-link-dialog.invalid-url")})]})}),p.jsxs(iP,{className:"tlui-dialog__footer__actions",children:[p.jsx(ot,{type:"normal",onClick:g,onTouchEnd:g,children:p.jsx(yr,{children:i("edit-link-dialog.cancel")})}),m?p.jsx(ot,{type:"danger",onTouchEnd:d,onClick:d,children:p.jsx(yr,{children:i("edit-link-dialog.clear")})}):p.jsx(ot,{type:"primary",disabled:!a.valid,onTouchEnd:f,onClick:f,children:p.jsx(yr,{children:i("edit-link-dialog.save")})})]})]})});var Qse={};const Uj=/(^\/r\/[^/]+\/?$)/,sP=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(Uj))return n},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(Uj))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,i,s]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${Qse.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${s}`}else t="";return t}},fromEmbedUrl:n=>{const e=yt(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[i,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${i},${s},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=yt(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i,s]=t;return`https://codepen.io/${i}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,i]=t;return`https://scratch.mit.edu/projects/${i}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=yt(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=yt(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=yt(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=yt(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const i of r)e.searchParams.delete(i);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=yt(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=yt(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=yt(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],Jse={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},eoe=sP.map(n=>n.type);function toe(n){return eoe.includes(n)}function noe(n){return"icon"in n}function Fz(){return me().getShapeUtil("embed")}function oP(){const n=Fz();return e=>n?n.getEmbedDefinition(e):void 0}function roe(){const n=Fz();return n?n.getEmbedDefinitions():[]}const zz=ti(function({onClose:e}){const t=me(),r=Nt(),i=J2(),[s,o]=P.useState(null),[a,c]=P.useState(""),[u,d]=P.useState(null),[f,g]=P.useState(!1),m=P.useRef(-1),v=roe(),w=oP();return p.jsxs(p.Fragment,{children:[p.jsxs(jw,{children:[p.jsx(Dw,{children:s?`${r("embed-dialog.title")}  ${s.title}`:r("embed-dialog.title")}),p.jsx(Ow,{})]}),s?p.jsxs(p.Fragment,{children:[p.jsxs(Cp,{className:"tlui-embed-dialog__enter",children:[p.jsx(Lw,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:S=>{c(S);const b=w(S);d(b&&b.definition.type===s.type?b:null),g(!1),clearTimeout(m.current),m.current=t.timers.setTimeout(()=>g(!b),320)}}),a===""?p.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[p.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&p.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",p.jsx(ya,{icon:"external-link",small:!0})]})]}):p.jsx("div",{className:"tlui-embed-dialog__warning",children:f?r("embed-dialog.invalid-url"):""})]}),p.jsxs(iP,{className:"tlui-dialog__footer__actions",children:[p.jsx(ot,{type:"normal",onClick:()=>{o(null),d(null),c("")},children:p.jsx(yr,{children:r("embed-dialog.back")})}),p.jsx("div",{className:"tlui-embed__spacer"}),p.jsx(ot,{type:"normal",onClick:e,children:p.jsx(yr,{children:r("embed-dialog.cancel")})}),p.jsx(ot,{type:"primary",disabled:!u,onClick:()=>{u&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:u.definition}),e())},children:p.jsx(yr,{children:r("embed-dialog.create")})})]})]}):p.jsx(p.Fragment,{children:p.jsx(Cp,{className:"tlui-embed-dialog__list",children:v.map(S=>{const b=toe(S.type)?i.embedIcons[S.type]:noe(S)?S.icon:void 0;return p.jsxs(ot,{type:"menu",onClick:()=>o(S),children:[p.jsx(yr,{children:S.title}),b&&p.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${b})`}})]},S.type)})})})]})});var yy={exports:{}};yy.exports;var $j;function ioe(){return $j||($j=1,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function o(c,u){if(!s[c]){s[c]={};for(var d=0;d<c.length;d++)s[c][c.charAt(d)]=d}return s[c][u]}var a={compressToBase64:function(c){if(c==null)return"";var u=a._compress(c,6,function(d){return r.charAt(d)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(u){return o(r,c.charAt(u))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(u){return t(u+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(u){return c.charCodeAt(u)-32})},compressToUint8Array:function(c){for(var u=a.compress(c),d=new Uint8Array(u.length*2),f=0,g=u.length;f<g;f++){var m=u.charCodeAt(f);d[f*2]=m>>>8,d[f*2+1]=m%256}return d},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var u=new Array(c.length/2),d=0,f=u.length;d<f;d++)u[d]=c[d*2]*256+c[d*2+1];var g=[];return u.forEach(function(m){g.push(t(m))}),a.decompress(g.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(u){return i.charAt(u)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(u){return o(i,c.charAt(u))}))},compress:function(c){return a._compress(c,16,function(u){return t(u)})},_compress:function(c,u,d){if(c==null)return"";var f,g,m={},v={},w="",S="",b="",x=2,E=3,M=2,j=[],D=0,H=0,L;for(L=0;L<c.length;L+=1)if(w=c.charAt(L),Object.prototype.hasOwnProperty.call(m,w)||(m[w]=E++,v[w]=!0),S=b+w,Object.prototype.hasOwnProperty.call(m,S))b=S;else{if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(f=0;f<M;f++)D=D<<1,H==u-1?(H=0,j.push(d(D)),D=0):H++;for(g=b.charCodeAt(0),f=0;f<8;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1}else{for(g=1,f=0;f<M;f++)D=D<<1|g,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=0;for(g=b.charCodeAt(0),f=0;f<16;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1}x--,x==0&&(x=Math.pow(2,M),M++),delete v[b]}else for(g=m[b],f=0;f<M;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1;x--,x==0&&(x=Math.pow(2,M),M++),m[S]=E++,b=String(w)}if(b!==""){if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(f=0;f<M;f++)D=D<<1,H==u-1?(H=0,j.push(d(D)),D=0):H++;for(g=b.charCodeAt(0),f=0;f<8;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1}else{for(g=1,f=0;f<M;f++)D=D<<1|g,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=0;for(g=b.charCodeAt(0),f=0;f<16;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1}x--,x==0&&(x=Math.pow(2,M),M++),delete v[b]}else for(g=m[b],f=0;f<M;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1;x--,x==0&&(x=Math.pow(2,M),M++)}for(g=2,f=0;f<M;f++)D=D<<1|g&1,H==u-1?(H=0,j.push(d(D)),D=0):H++,g=g>>1;for(;;)if(D=D<<1,H==u-1){j.push(d(D));break}else H++;return j.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(u){return c.charCodeAt(u)})},_decompress:function(c,u,d){var f=[],g=4,m=4,v=3,w="",S=[],b,x,E,M,j,D,H,L={val:d(0),position:u,index:1};for(b=0;b<3;b+=1)f[b]=b;for(E=0,j=Math.pow(2,2),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;switch(E){case 0:for(E=0,j=Math.pow(2,8),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;H=t(E);break;case 1:for(E=0,j=Math.pow(2,16),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;H=t(E);break;case 2:return""}for(f[3]=H,x=H,S.push(H);;){if(L.index>c)return"";for(E=0,j=Math.pow(2,v),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;switch(H=E){case 0:for(E=0,j=Math.pow(2,8),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;f[m++]=t(E),H=m-1,g--;break;case 1:for(E=0,j=Math.pow(2,16),D=1;D!=j;)M=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=d(L.index++)),E|=(M>0?1:0)*D,D<<=1;f[m++]=t(E),H=m-1,g--;break;case 2:return S.join("")}if(g==0&&(g=Math.pow(2,v),v++),f[H])w=f[H];else if(H===m)w=x+x.charAt(0);else return null;S.push(w),f[m++]=x+w.charAt(0),g--,x=w,g==0&&(g=Math.pow(2,v),v++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(yy)),yy.exports}var soe=ioe();const Uz=fs(soe),aP="web image/vnd.tldraw+png",ooe={"image/png":aP},aoe={[aP]:"image/png"};function coe(n){return Ei(ooe,n)??null}function loe(n){return Ei(aoe,n)??n}function uoe(n){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(n)}function doe(n){const e=Object.entries(n);for(const[t,r]of e)r.catch(i=>console.error(i));return navigator.clipboard.write([new ClipboardItem(n)]).catch(t=>(console.error(t),Promise.all(e.map(async([r,i])=>[r,await i])).then(r=>{const i=gC(r);return navigator.clipboard.write([new ClipboardItem(i)])})))}async function hoe(n,e,t){var b,x,E;const{elements:r,files:i}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},o=new Map,a=new Map,c=n.getCurrentPageId(),u=new Map,d=[],f=new Set;r.forEach(M=>{if(u.set(M.id,wn()),M.boundElements!==null)for(const j of M.boundElements)j.type==="text"&&f.add(j.id)});let g=Y4;for(const M of r){if(f.has(M.id))continue;const j=u.get(M.id),D={id:j,typeName:"shape",parentId:c,index:g,x:M.x,y:M.y,rotation:0,isLocked:M.locked,opacity:foe(M.opacity),meta:{}};switch(M.angle!==0&&a.set(j,M.angle),M.groupIds&&M.groupIds.length>0?o.has(M.groupIds[0])?(b=o.get(M.groupIds[0]))==null||b.push(j):o.set(M.groupIds[0],[j]):d.push(j),M.type){case"rectangle":case"ellipse":case"diamond":{let H="",L="middle";if(M.boundElements!==null){for(const z of M.boundElements)if(z.type==="text"){const Y=r.find(V=>V.id===z.id);Y&&(H=Y.text,L=Soe[Y.textAlign])}}const U=M.backgroundColor==="transparent"?M.strokeColor:M.backgroundColor;s.shapes.push({...D,type:"geo",props:{geo:M.type,url:M.link??"",w:M.width,h:M.height,size:Lm[M.strokeWidth]??"draw",color:Pf[U]??"black",text:H,align:L,dash:Nm(M),fill:_oe(M)}});break}case"freedraw":{s.shapes.push({...D,type:"draw",props:{dash:Nm(M),size:Lm[M.strokeWidth],color:Pf[M.strokeColor]??"black",segments:[{type:"free",points:M.points.map(([H,L,U=.5])=>({x:H,y:L,z:U}))}]}});break}case"line":{if(M.points.slice().length<2)break;const L=pp(M.points.length);s.shapes.push({...D,type:"line",props:{dash:Nm(M),size:Lm[M.strokeWidth],color:Pf[M.strokeColor]??"black",spline:M.roundness?"cubic":"line",points:{...Object.fromEntries(M.points.map(([U,z],Y)=>{const V=L[Y];return[V,{id:V,index:V,x:U,y:z}]}))}}});break}case"arrow":{let H="";if(M.boundElements!==null){for(const V of M.boundElements)if(V.type==="text"){const N=r.find(_=>_.id===V.id);N&&(H=N.text)}}const L=M.points[0],U=M.points[M.points.length-1],z=u.get((x=M.startBinding)==null?void 0:x.elementId),Y=u.get((E=M.endBinding)==null?void 0:E.elementId);s.shapes.push({...D,type:"arrow",props:{text:H,bend:boe(M,L,U),dash:Nm(M),size:Lm[M.strokeWidth]??"m",color:Pf[M.strokeColor]??"black",start:{x:L[0],y:L[1]},end:{x:U[0],y:U[1]},arrowheadEnd:Hj[M.endArrowhead]??"none",arrowheadStart:Hj[M.startArrowhead]??"none"}}),z&&s.bindings.push({id:wu(),typeName:"binding",type:"arrow",fromId:j,toId:z,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),Y&&s.bindings.push({id:wu(),typeName:"binding",type:"arrow",fromId:j,toId:Y,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:H,scale:L}=goe(M.fontSize);s.shapes.push({...D,type:"text",props:{size:H,scale:L,font:moe[M.fontFamily]??"draw",color:Pf[M.strokeColor]??"black",text:M.text,textAlign:xoe[M.textAlign]}});break}case"image":{const H=i[M.fileId];if(!H)break;const L=tl.createId();s.assets.push({id:L,typeName:"asset",type:"image",props:{w:M.width,h:M.height,fileSize:H.size,name:M.id??"Untitled",isAnimated:!1,mimeType:H.mimeType,src:H.dataURL},meta:{}}),s.shapes.push({...D,type:"image",props:{w:M.width,h:M.height,assetId:L}})}}g=aa(g)}const m=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(s,{point:m,select:!1,preserveIds:!0});for(const M of o.values())if(M.length>1){n.groupShapes(M);const j=n.getShape(M[0]);j!=null&&j.parentId&&is(j.parentId)&&d.push(j.parentId)}for(const[M,j]of a)n.select(M),n.rotateShapesBy([M],j);const v=St(d.map(M=>n.getShape(M))),w=De.Common(v.map(M=>n.getShapePageBounds(M))),S=n.getViewportPageBounds().center;n.updateShapes(v.map(M=>{const j={x:(M.x??0)-(w.x+w.w/2),y:(M.y??0)-(w.y+w.h/2)};return{id:M.id,type:M.type,x:S.x+j.x,y:S.y+j.y}})),n.setSelectedShapes(d)}const foe=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Lm={1:"s",2:"m",3:"l",4:"xl"},poe={16:"s",20:"m",28:"l",36:"xl"};function goe(n){const e=poe[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const moe={1:"draw",2:"sans",3:"mono"},yoe={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function ta(n,e,t){const r=[0,1,2,3,4].map(i=>yoe[n][i]);return Object.fromEntries(r.map((i,s)=>[i,s<3?e:t]))}const Pf={...ta("gray","grey","black"),...ta("red","light-red","red"),...ta("pink","light-red","red"),...ta("grape","light-violet","violet"),...ta("blue","light-blue","blue"),...ta("cyan","light-blue","blue"),...ta("teal","light-green","green"),...ta("green","light-green","green"),...ta("yellow","yellow","orange"),...ta("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},woe={solid:"draw",dashed:"dashed",dotted:"dotted"},voe={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},Soe={left:"start",center:"middle",right:"end"},xoe={left:"start",center:"middle",right:"end"},Hj={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function boe(n,e,t){let r=0;if(n.points.length>2){const i=new T(e[0],e[1]),s=new T(t[0],t[1]),o=new T(n.points[1][0],n.points[1][1]),a=T.Sub(s,i),c=T.Per(a),u=T.Med(s,i),d=T.Sub(u,c),f=T.Add(u,c),g=T.NearestPointOnLineSegment(d,f,o,!1);r=T.Dist(g,u),T.Clockwise(g,s,u)&&(r*=-1)}return r}const Nm=n=>{let e=woe[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},_oe=n=>n.backgroundColor==="transparent"?"none":voe[n.fillStyle]??"solid";async function Ioe(n,e,t,r){const i=e.map(s=>s instanceof File?s:new File([s],"tldrawFile",{type:s.type}));n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"files",files:i,point:t,ignoreParent:!1,sources:r})}function Eoe(n,e,t){const r=n.getSelectionPageBounds();n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(e,{point:t,select:!0});const i=n.getSelectionPageBounds();r&&i&&(r!=null&&r.collides(i))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function sE(n,e,t,r){return n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const Coe=[aP,"image/png","image/jpeg","image/webp","image/svg+xml"];function Poe(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const Moe=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Toe=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return WN(e)},koe=n=>/^<svg/.test(n),Aoe=["input","select","textarea"];function Eb(n){const{activeElement:e}=document;return n.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||Aoe.indexOf(e.tagName.toLowerCase())>-1)}const Cb=(n,e,t,r)=>{const i=Toe(e);if(i)for(const s of i)sE(n,s,t);else Moe(e)?sE(n,e,t):koe(e)?(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},Roe=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const i of Object.values(e.items))switch(i.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(i.getAsFile()))});break}case"string":{i.type==="text/html"?r.push({type:"html",source:new Promise(s=>i.getAsString(s))}):i.type==="text/plain"?r.push({type:"text",source:new Promise(s=>i.getAsString(s))}):r.push({type:i.type,source:new Promise(s=>i.getAsString(s))});break}}Hz(n,r,t)},$z=async(n,e,t)=>{const r=[];for(const i of e){for(const s of Coe)if(i.types.includes(s)){const o=i.getType(s).then(a=>Io.rewriteMimeType(a,loe(s)));r.push({type:"blob",source:o});break}i.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const s=await i.getType("text/html");return await Io.blobToText(s)})()}),i.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const s=await i.getType("text/uri-list");return await Io.blobToText(s)})()}),i.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const s=await i.getType("text/plain");return await Io.blobToText(s)})()})}return await Hz(n,r,t)};async function Hz(n,e,t){const r=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){if(r.length>n.options.maxFilesAtOnce)throw Error("Too many files");const s=St(await Promise.all(r.map(o=>o.source)));return await Ioe(n,s,t)}const i=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(o=>{const a=s;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var d;const u=(d=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:d[1];if(u)try{const f=Uz.decompressFromBase64(u);if(f===null){o({type:"error",data:f,reason:"found tldraw data comment but could not parse base64"});return}else{const g=JSON.parse(f);if(g.type!=="application/tldraw"&&o({type:"error",data:g,reason:`found tldraw data comment but JSON was of a different type: ${g.type}`}),typeof g.data=="string"){o({type:"error",data:g,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:g.data});return}}catch{o({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const f=JSON.parse(c);if(f.type==="excalidraw/clipboard"){o({type:"excalidraw",data:f});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const s of i)if(s.type==="tldraw"){Eoe(n,s.data,t);return}for(const s of i)if(s.type==="excalidraw"){hoe(n,s.data,t);return}for(const s of i)if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(u=>u.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const u=a.firstElementChild.getAttribute("href");Cb(n,u,t,i);return}if(!i.some(u=>u.type==="text"&&u.subtype!=="html")&&s.data.trim()){Cb(n,Poe(s.data),t,i);return}}for(const s of i)if(s.type==="text"&&s.subtype==="url"){sE(n,s.data,t,i);return}for(const s of i)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){Cb(n,s.data,t,i);return}}const I0=async n=>{var r;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=Uz.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const i=e.shapes.map(s=>n.getShapeUtil(s).getText(s)).filter(XK);if((r=navigator.clipboard)!=null&&r.write){const s=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let o=i.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function joe(){const n=me(),e=ri(),t=P.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await I0(n),e("copy",{source:o}))},[n,e]),r=P.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await I0(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),i=P.useCallback(async function(o,a,c){n.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?($z(n,o,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(u=>{i(u,a,c)}))},[n,e]);return{copy:t,cut:r,paste:i}}function Doe(){const n=me(),e=ri(),t=xe("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);P.useEffect(()=>{if(!t)return;const r=async c=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Eb(n)||(kt(c),await I0(n),e("copy",{source:"kbd"}))};async function i(c){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Eb(n)||(kt(c),await I0(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let s=!1;const o=c=>{c.button===1&&(s=!0,n.timers.requestAnimationFrame(()=>{s=!1}))},a=c=>{var g;if(s){Sr(c);return}if(n.getEditingShapeId()!==null||Eb(n))return;let u,d=!1;n.inputs.shiftKey&&(d=!0),n.user.getIsPasteAtCursorMode()&&(d=!d),d&&(u=n.inputs.currentPagePoint);const f=()=>{c.clipboardData&&Roe(n,c.clipboardData,u)};(g=navigator.clipboard)!=null&&g.read?navigator.clipboard.read().then(m=>{Array.isArray(m)&&m[0]instanceof ClipboardItem&&$z(n,m,u)},()=>{f()}):f(),kt(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",i),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",i),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[n,e,t])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Ooe(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,i,s,o,a=[],c=!0,u=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(d){u=!0,i=d}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}function Wj(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function xs(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wj(Object(t),!0).forEach(function(r){Loe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Wj(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Loe(n,e,t){return e=Koe(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function Noe(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function Boe(n,e){if(n==null)return{};var t=Noe(n,e),r,i;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(i=0;i<s.length;i++)r=s[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function Kj(n,e){return zoe(n)||Ooe(n,e)||Wz(n,e)||Hoe()}function Bm(n){return Foe(n)||Uoe(n)||Wz(n)||$oe()}function Foe(n){if(Array.isArray(n))return oE(n)}function zoe(n){if(Array.isArray(n))return n}function Uoe(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function Wz(n,e){if(n){if(typeof n=="string")return oE(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return oE(n,e)}}function oE(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function $oe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Hoe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Woe(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function Koe(n){var e=Woe(n,"string");return typeof e=="symbol"?e:String(e)}function ip(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),i=[t-1,r-1,1,1],s=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;o?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=t,c.height=r);var u=a.getContext("2d"),d=c.getContext("2d");d&&(d.fillRect.apply(d,i),u.drawImage(c,t-1,r-1,1,1,0,0,1,1));var f=u&&u.getImageData(0,0,1,1).data[3]!==0,g=Date.now()-s;return[a,c].forEach(function(m){m.height=0,m.width=0}),o?(postMessage({width:t,height:r,benchmark:g,isTestPass:f}),!f&&n.sizes.length&&ip(n)):f?n.onSuccess(t,r,g):(n.onError(t,r,g),n.sizes.length&&ip(n)),f}var Pb={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},qoe=["onError","onSuccess"],Wd={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Mf={};function Mb(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,i=[];if(!n.width||!n.height)n.sizes.forEach(function(d){var f=e||t?d:1,g=e||r?d:1;i.push([f,g])});else for(var s=n.min||Wd.min,o=n.step||Wd.step,a=Math.max(n.width,n.height);a>=s;){var c=e||t?a:1,u=e||r?a:1;i.push([c,u]),a-=o}return i}function Fm(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),i=n.onError,s=n.onSuccess,o=Boe(n,qoe),a=null;if(!e)return!1;if(n.useWorker&&t){var c=`
            var canvasTest = `.concat(ip.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),u=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(u);a=new Worker(d),URL.revokeObjectURL(d),a.onmessage=function(f){var g=f.data,m=g.width,v=g.height,w=g.benchmark,S=g.isTestPass;S?(Mf[r].onSuccess(m,v,w),delete Mf[r]):Mf[r].onError(m,v,w)}}if(n.usePromise)return new Promise(function(f,g){var m=xs(xs({},n),{},{onError:function(b,x,E){var M;if(n.sizes.length===0)M=!0;else{var j=n.sizes.slice(-1),D=Kj(j,1),H=Kj(D[0],2),L=H[0],U=H[1];M=b===L&&x===U}i(b,x,E),M&&g({width:b,height:x,benchmark:E})},onSuccess:function(b,x,E){s(b,x,E),f({width:b,height:x,benchmark:E})}});if(a){var v=m.onError,w=m.onSuccess;Mf[r]={onError:v,onSuccess:w},a.postMessage(o)}else ip(m)});if(a)Mf[r]={onError:i,onSuccess:s},a.postMessage(o);else return ip(n)}var Tb={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Mb({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Bm(Pb.area)}),r=xs(xs(xs({},Wd),e),{},{sizes:t});return Fm(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Mb({width:1,height:e.max,min:e.min,step:e.step,sizes:Bm(Pb.height)}),r=xs(xs(xs({},Wd),e),{},{sizes:t});return Fm(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Mb({width:e.max,height:1,min:e.min,step:e.step,sizes:Bm(Pb.width)}),r=xs(xs(xs({},Wd),e),{},{sizes:t});return Fm(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=xs(xs({},Wd),e);return t.sizes=Bm(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Fm(t)}};let kb=null;function Goe(){return kb||(kb=Voe()),kb}async function Voe(){const n=await Tb.maxWidth({usePromise:!0}),e=await Tb.maxHeight({usePromise:!0}),t=await Tb.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const qj=8192,Yoe=4096*4096;async function Xoe(n,e){if(n<=qj&&e<=qj&&n*e<=Yoe)return[n,e];const{maxWidth:t,maxHeight:r,maxArea:i}=await Goe(),s=n/e;if(n>t&&(n=t,e=n/s),e>r&&(e=r,n=e*s),n*e>i){const o=Math.sqrt(i/(n*e));n*=o,e*=o}return[n,e]}async function Kz(n,e,t){const{type:r,width:i,height:s,quality:o=1,pixelRatio:a=2}=t;let[c,u]=await Xoe(i*a,s*a);c=Math.floor(c),u=Math.floor(u);const d=c/i,f=await Io.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),g=await new Promise(v=>{const w=hp();w.crossOrigin="anonymous",w.onload=async()=>{_n.isSafari&&await xI(250);const S=document.createElement("canvas"),b=S.getContext("2d");S.width=c,S.height=u,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(w,0,0,c,u),URL.revokeObjectURL(f),v(S)},w.onerror=()=>{v(null)},w.src=f});if(!g)return null;const m=await new Promise(v=>g.toBlob(w=>{(!w||mr.throwToBlob.get())&&v(null),v(w)},"image/"+r,o));if(!m)return null;if(r==="png"){const v=new DataView(await m.arrayBuffer());return sa.setPhysChunk(v,d,{type:"image/"+r})}else return m}async function qz(n,e,t){const r=await n.getSvgString(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:t.scale??1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function aE(n,e,t,r={}){var i;switch(t){case"svg":return(i=await qz(n,e,r))==null?void 0:i.svg;case"json":{const s=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(s)}default:Pr(t)}}async function Gz({editor:n,ids:e,format:t,opts:r={}}){switch(t){case"svg":return new Blob([await aE(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await aE(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const i=await qz(n,e,r);if(!i)throw new Error("Could not construct image.");const s=await Kz(n,i.svg,{type:t,quality:r.quality,pixelRatio:r.pixelRatio,width:i.width,height:i.height});if(!s)throw new Error("Could not construct image.");return s}default:Pr(t)}}const Zoe={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function Qoe(n,e,t,r={}){return{blobPromise:Gz({editor:n,ids:e,format:t,opts:r}),mimeType:Zoe[t]}}function Joe(n,e,t="svg",r={}){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:i,mimeType:s}=Qoe(n,e,t,r),o={[s]:i},a=coe(s);return a&&uoe(a)&&(o[a]=i.then(c=>Io.rewriteMimeType(c,a))),doe(o)}switch(t){case"json":case"svg":return eae(async()=>aE(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:Pr(t)}}async function eae(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}var tae="VisuallyHidden",cP=P.forwardRef((n,e)=>p.jsx(Vt.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));cP.displayName=tae;var lP="ToastProvider",[uP,nae,rae]=xw("Toast"),[Vz,D1e]=$u("Toast",[rae]),[iae,Nw]=Vz(lP),Yz=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:s=50,children:o}=n,[a,c]=P.useState(null),[u,d]=P.useState(0),f=P.useRef(!1),g=P.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${lP}\`. Expected non-empty \`string\`.`),p.jsx(uP.Provider,{scope:e,children:p.jsx(iae,{scope:e,label:t,duration:r,swipeDirection:i,swipeThreshold:s,toastCount:u,viewport:a,onViewportChange:c,onToastAdd:P.useCallback(()=>d(m=>m+1),[]),onToastRemove:P.useCallback(()=>d(m=>m-1),[]),isFocusedToastEscapeKeyDownRef:f,isClosePausedRef:g,children:o})})};Yz.displayName=lP;var Xz="ToastViewport",sae=["F8"],cE="toast.viewportPause",lE="toast.viewportResume",Zz=P.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=sae,label:i="Notifications ({hotkey})",...s}=n,o=Nw(Xz,t),a=nae(t),c=P.useRef(null),u=P.useRef(null),d=P.useRef(null),f=P.useRef(null),g=Dn(e,f,o.onViewportChange),m=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=o.toastCount>0;P.useEffect(()=>{const S=b=>{var E;r.length!==0&&r.every(M=>b[M]||b.code===M)&&((E=f.current)==null||E.focus())};return document.addEventListener("keydown",S),()=>document.removeEventListener("keydown",S)},[r]),P.useEffect(()=>{const S=c.current,b=f.current;if(v&&S&&b){const x=()=>{if(!o.isClosePausedRef.current){const D=new CustomEvent(cE);b.dispatchEvent(D),o.isClosePausedRef.current=!0}},E=()=>{if(o.isClosePausedRef.current){const D=new CustomEvent(lE);b.dispatchEvent(D),o.isClosePausedRef.current=!1}},M=D=>{!S.contains(D.relatedTarget)&&E()},j=()=>{S.contains(document.activeElement)||E()};return S.addEventListener("focusin",x),S.addEventListener("focusout",M),S.addEventListener("pointermove",x),S.addEventListener("pointerleave",j),window.addEventListener("blur",x),window.addEventListener("focus",E),()=>{S.removeEventListener("focusin",x),S.removeEventListener("focusout",M),S.removeEventListener("pointermove",x),S.removeEventListener("pointerleave",j),window.removeEventListener("blur",x),window.removeEventListener("focus",E)}}},[v,o.isClosePausedRef]);const w=P.useCallback(({tabbingDirection:S})=>{const x=a().map(E=>{const M=E.ref.current,j=[M,...wae(M)];return S==="forwards"?j:j.reverse()});return(S==="forwards"?x.reverse():x).flat()},[a]);return P.useEffect(()=>{const S=f.current;if(S){const b=x=>{var j,D,H;const E=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!E){const L=document.activeElement,U=x.shiftKey;if(x.target===S&&U){(j=u.current)==null||j.focus();return}const V=w({tabbingDirection:U?"backwards":"forwards"}),N=V.findIndex(_=>_===L);Ab(V.slice(N+1))?x.preventDefault():U?(D=u.current)==null||D.focus():(H=d.current)==null||H.focus()}};return S.addEventListener("keydown",b),()=>S.removeEventListener("keydown",b)}},[a,w]),p.jsxs(Nte,{ref:c,role:"region","aria-label":i.replace("{hotkey}",m),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&p.jsx(uE,{ref:u,onFocusFromOutsideViewport:()=>{const S=w({tabbingDirection:"forwards"});Ab(S)}}),p.jsx(uP.Slot,{scope:t,children:p.jsx(Vt.ol,{tabIndex:-1,...s,ref:g})}),v&&p.jsx(uE,{ref:d,onFocusFromOutsideViewport:()=>{const S=w({tabbingDirection:"backwards"});Ab(S)}})]})});Zz.displayName=Xz;var Qz="ToastFocusProxy",uE=P.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...i}=n,s=Nw(Qz,t);return p.jsx(cP,{"aria-hidden":!0,tabIndex:0,...i,ref:e,style:{position:"fixed"},onFocus:o=>{var u;const a=o.relatedTarget;!((u=s.viewport)!=null&&u.contains(a))&&r()}})});uE.displayName=Qz;var Bw="Toast",oae="toast.swipeStart",aae="toast.swipeMove",cae="toast.swipeCancel",lae="toast.swipeEnd",Jz=P.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:i,onOpenChange:s,...o}=n,[a=!0,c]=Tl({prop:r,defaultProp:i,onChange:s});return p.jsx(Fo,{present:t||a,children:p.jsx(hae,{open:a,...o,ref:e,onClose:()=>c(!1),onPause:ei(n.onPause),onResume:ei(n.onResume),onSwipeStart:Ge(n.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ge(n.onSwipeMove,u=>{const{x:d,y:f}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${f}px`)}),onSwipeCancel:Ge(n.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ge(n.onSwipeEnd,u=>{const{x:d,y:f}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${d}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${f}px`),c(!1)})})})});Jz.displayName=Bw;var[uae,dae]=Vz(Bw,{onClose(){}}),hae=P.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:i,open:s,onClose:o,onEscapeKeyDown:a,onPause:c,onResume:u,onSwipeStart:d,onSwipeMove:f,onSwipeCancel:g,onSwipeEnd:m,...v}=n,w=Nw(Bw,t),[S,b]=P.useState(null),x=Dn(e,_=>b(_)),E=P.useRef(null),M=P.useRef(null),j=i||w.duration,D=P.useRef(0),H=P.useRef(j),L=P.useRef(0),{onToastAdd:U,onToastRemove:z}=w,Y=ei(()=>{var k;(S==null?void 0:S.contains(document.activeElement))&&((k=w.viewport)==null||k.focus()),o()}),V=P.useCallback(_=>{!_||_===1/0||(window.clearTimeout(L.current),D.current=new Date().getTime(),L.current=window.setTimeout(Y,_))},[Y]);P.useEffect(()=>{const _=w.viewport;if(_){const k=()=>{V(H.current),u==null||u()},O=()=>{const W=new Date().getTime()-D.current;H.current=H.current-W,window.clearTimeout(L.current),c==null||c()};return _.addEventListener(cE,O),_.addEventListener(lE,k),()=>{_.removeEventListener(cE,O),_.removeEventListener(lE,k)}}},[w.viewport,j,c,u,V]),P.useEffect(()=>{s&&!w.isClosePausedRef.current&&V(j)},[s,j,w.isClosePausedRef,V]),P.useEffect(()=>(U(),()=>z()),[U,z]);const N=P.useMemo(()=>S?oU(S):null,[S]);return w.viewport?p.jsxs(p.Fragment,{children:[N&&p.jsx(fae,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:N}),p.jsx(uae,{scope:t,onClose:Y,children:wl.createPortal(p.jsx(uP.ItemSlot,{scope:t,children:p.jsx(Lte,{asChild:!0,onEscapeKeyDown:Ge(a,()=>{w.isFocusedToastEscapeKeyDownRef.current||Y(),w.isFocusedToastEscapeKeyDownRef.current=!1}),children:p.jsx(Vt.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":w.swipeDirection,...v,ref:x,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:Ge(n.onKeyDown,_=>{_.key==="Escape"&&(a==null||a(_.nativeEvent),_.nativeEvent.defaultPrevented||(w.isFocusedToastEscapeKeyDownRef.current=!0,Y()))}),onPointerDown:Ge(n.onPointerDown,_=>{_.button===0&&(E.current={x:_.clientX,y:_.clientY})}),onPointerMove:Ge(n.onPointerMove,_=>{if(!E.current)return;const k=_.clientX-E.current.x,O=_.clientY-E.current.y,W=!!M.current,q=["left","right"].includes(w.swipeDirection),X=["left","up"].includes(w.swipeDirection)?Math.min:Math.max,ne=q?X(0,k):0,$=q?0:X(0,O),C=_.pointerType==="touch"?10:2,R={x:ne,y:$},Z={originalEvent:_,delta:R};W?(M.current=R,zm(aae,f,Z,{discrete:!1})):Gj(R,w.swipeDirection,C)?(M.current=R,zm(oae,d,Z,{discrete:!1}),_.target.setPointerCapture(_.pointerId)):(Math.abs(k)>C||Math.abs(O)>C)&&(E.current=null)}),onPointerUp:Ge(n.onPointerUp,_=>{const k=M.current,O=_.target;if(O.hasPointerCapture(_.pointerId)&&O.releasePointerCapture(_.pointerId),M.current=null,E.current=null,k){const W=_.currentTarget,q={originalEvent:_,delta:k};Gj(k,w.swipeDirection,w.swipeThreshold)?zm(lae,m,q,{discrete:!0}):zm(cae,g,q,{discrete:!0}),W.addEventListener("click",X=>X.preventDefault(),{once:!0})}})})})}),w.viewport)})]}):null}),fae=n=>{const{__scopeToast:e,children:t,...r}=n,i=Nw(Bw,e),[s,o]=P.useState(!1),[a,c]=P.useState(!1);return mae(()=>o(!0)),P.useEffect(()=>{const u=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(u)},[]),a?null:p.jsx(rg,{asChild:!0,children:p.jsx(cP,{...r,children:s&&p.jsxs(p.Fragment,{children:[i.label," ",t]})})})},pae="ToastTitle",eU=P.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(Vt.div,{...r,ref:e})});eU.displayName=pae;var gae="ToastDescription",tU=P.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(Vt.div,{...r,ref:e})});tU.displayName=gae;var nU="ToastAction",rU=P.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?p.jsx(sU,{altText:t,asChild:!0,children:p.jsx(dP,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${nU}\`. Expected non-empty \`string\`.`),null)});rU.displayName=nU;var iU="ToastClose",dP=P.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,i=dae(iU,t);return p.jsx(sU,{asChild:!0,children:p.jsx(Vt.button,{type:"button",...r,ref:e,onClick:Ge(n.onClick,i.onClose)})})});dP.displayName=iU;var sU=P.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...i}=n;return p.jsx(Vt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...i,ref:e})});function oU(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),yae(r)){const i=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!i)if(s){const o=r.dataset.radixToastAnnounceAlt;o&&e.push(o)}else e.push(...oU(r))}}),e}function zm(n,e,t,{discrete:r}){const i=t.originalEvent.currentTarget,s=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&i.addEventListener(n,e,{once:!0}),r?I2(i,s):i.dispatchEvent(s)}var Gj=(n,e,t=0)=>{const r=Math.abs(n.x),i=Math.abs(n.y),s=r>i;return e==="left"||e==="right"?s&&r>t:!s&&i>t};function mae(n=()=>{}){const e=ei(n);vl(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function yae(n){return n.nodeType===n.ELEMENT_NODE}function wae(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const i=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||i?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function Ab(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var vae=Jz,Sae=eU,xae=tU,bae=rU,Vj=dP;const aU=P.createContext(null);function _ae({children:n}){const e=LC("toasts",[]),t=P.useMemo(()=>({toasts:e,addToast(r){const i=r.id??Jt();return e.update(s=>[...s.filter(o=>o.id!==r.id),{...r,id:i}]),i},removeToast(r){return e.update(i=>i.filter(s=>s.id!==r)),r},clearToasts(){e.set([])}}),[e]);return p.jsx(Yz,{children:p.jsx(aU.Provider,{value:t,children:n})})}function Ea(){const n=P.useContext(aU);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}function Iae(){const n=me(),{addToast:e}=Ea(),t=Nt();return P.useCallback((r,i="svg")=>{Joe(n,r,i).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function Eae(n,e,t="png",r,i={}){if(!r&&(r=`shapes at ${Yj()}`,e.length===1)){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?r=a.props.name??"frame":r=`${rw(a.id)} at ${Yj()}`}r+=`.${t}`;const s=await Gz({editor:n,ids:e,format:t,opts:i}),o=new File([s],r,{type:s.type});Cae(o)}function Yj(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),i=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${i}.${s}.${o}`}function Cae(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function Pae(){const n=me(),{addToast:e}=Ea(),t=Nt();return P.useCallback((r,i="png",s)=>{Eae(n,r,i,s,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}async function Mae(n,e,t){const r=St(e.map(a=>{const c=n.getShape(a);if(!(!c||n.getShapeUtil(c.type).toSvg===void 0))return c}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||n.isShapeOfType(a,"image"))return}const i=[];if(t!==void 0){const a=r.map(c=>({shape:c,bounds:n.getShapeMaskedPageBounds(c).clone().expandBy(t)}));for(let c=0;c<a.length;c++){const u=a[c];if(c===0){i[0]={shapes:[u.shape],bounds:u.bounds};continue}let d=!1;for(const f of i)if(f.bounds.includes(u.bounds)){f.shapes.push(u.shape),f.bounds.expand(u.bounds),d=!0;break}d||i.push({shapes:[u.shape],bounds:u.bounds})}}else{const a=De.Common(r.map(c=>n.getShapeMaskedPageBounds(c)));i.push({shapes:r,bounds:a})}const s=n.options.flattenImageBoundsPadding;for(const a of i){t!==void 0&&a.bounds.expandBy(-t);const c=await n.getSvgString(a.shapes,{padding:s});if(!(c!=null&&c.svg))continue;const u=new Blob([c.svg],{type:"image/svg+xml"}),d=await n.getAssetForExternalContent({type:"file",file:new File([u],"asset.svg",{type:"image/svg+xml"})});d&&(a.asset=d)}const o=[];return Js(()=>{for(const a of i){const{asset:c,bounds:u,shapes:d}=a;if(!c)continue;const f=n.findCommonAncestor(d)??n.getCurrentPageId();if(!f)continue;let g="a1";for(const b of d)if(b.parentId===f){b.index>g&&(g=b.index);break}let m,v,w;if(is(f)){const b=n.getShape(f);if(!b)continue;const x=n.getPointInShapeSpace(b,{x:u.x,y:u.y});w=n.getShapePageTransform(f).rotation(),x.sub(new T(s,s).rot(-w)),m=x.x,v=x.y}else m=u.x-s,v=u.y-s,w=0;n.deleteShapes(d),n.createAssets([{...c,id:c.id}]);const S=wn();n.createShape({id:S,type:"image",index:g,parentId:f,x:m,y:v,rotation:-w,props:{assetId:c.id,w:u.w+s*2,h:u.h+s*2}}),o.push(S)}}),o}const cU=Ce.createContext([]);function lU(){const n=me(),e=P.useRef(),t=rl(Ce.useContext(cU));return P.useEffect(()=>{const r=window.document.createElement("input");r.type="file",r.accept=(t==null?void 0:t.join(","))??CK,r.multiple=!0,e.current=r;async function i(s){const o=s.target.files;!o||o.length===0||(n.markHistoryStoppingPoint("insert media"),await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",i),()=>{e.current=void 0,r.removeEventListener("change",i)}},[n,t]),P.useCallback(()=>{var r;(r=e.current)==null||r.click()},[e])}function Fw(){const n=Cl();return(n==null?void 0:n.store.props.collaboration)!==void 0}function Tae(){const n=Cl();return xe("sync status",()=>{var e;return(e=n==null?void 0:n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}function kae(){const n=me(),e=P.useRef(null),t=P.useRef(null);return P.useCallback(async function(){const i=document.createElement("div"),s=document.createElement("style"),o=(b,x)=>{b&&(b.innerHTML=""),x&&document.head.contains(x)&&document.head.removeChild(x),b&&document.body.contains(b)&&document.body.removeChild(b)};o(e.current,t.current),e.current=i,t.current=s;const a=`tl-print-surface-${Jt()}`;i.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(s),document.body.appendChild(i)},u=()=>{n.once("tick",()=>{o(i,s)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",u);function d(b,x,E){try{i.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${E}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${x?"":"hide"}">
          ${x??""}
        </div>
      </div>`}catch(M){console.error(M)}}function f(){_n.isChromeForIos?(c(),window.print()):_n.isSafari?(c(),document.execCommand("print",!1)):window.print()}const g=n.getSelectedShapeIds(),m=n.getCurrentPageId(),v=n.getPages(),S={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const b=await n.getSvgString(g,S);if(b){const x=v.find(E=>E.id===m);d(`tldraw  ${x==null?void 0:x.name}`,null,b.svg),f()}}else{const b=n.getCurrentPage(),x=await n.getSvgString(n.getSortedChildIdsForParent(b.id),S);x&&(d(`tldraw  ${b.name}`,null,x.svg),f())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",u)},[n])}const uU=P.createContext(null);function Aae({context:n,children:e}){const t=ri(),r=LC("dialogs",[]),i=P.useMemo(()=>({dialogs:r,addDialog(s){const o=s.id??Jt();return r.update(a=>[...a.filter(c=>c.id!==s.id),{...s,id:o}]),t("open-menu",{source:"dialog",id:o}),xo.addOpenMenu(o,n),o},removeDialog(s){var a;const o=r.get().find(c=>c.id===s);return o&&((a=o.onClose)==null||a.call(o),t("close-menu",{source:"dialog",id:s}),xo.deleteOpenMenu(s,n),r.update(c=>c.filter(u=>u!==o))),s},clearDialogs(){const s=r.get();s.length!==0&&(s.forEach(o=>{var a;(a=o.onClose)==null||a.call(o),t("close-menu",{source:"dialog",id:o.id}),xo.deleteOpenMenu(o.id,n)}),r.set([]))}}),[t,r,n]);return p.jsx(uU.Provider,{value:i,children:e})}function Wu(){const n=P.useContext(uU);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const dU=P.createContext(null);function Rae(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function Rd(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function jae({overrides:n,children:e}){const t=me(),r=Fw(),{addDialog:i,clearDialogs:s}=Wu(),{clearToasts:o,addToast:a}=Ea(),c=Nt(),u=lU(),d=kae(),{cut:f,copy:g,paste:m}=joe(),v=Iae(),w=Pae(),S=c("document.default-name"),b=oP(),x=ri(),E=P.useMemo(()=>{function M(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function j(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const D=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(L){j()&&(M()||(x("edit-link",{source:L}),t.markHistoryStoppingPoint("edit-link"),i({component:Xse})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(L){x("insert-embed",{source:L}),i({component:zz})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(L){x("insert-media",{source:L}),u()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(L){x("undo",{source:L}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(L){x("redo",{source:L}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("export-as",{format:"svg",source:L}),w(U,"svg",Rd(t,S)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("export-as",{format:"png",source:L}),w(U,"png",Rd(t,S)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("export-as",{format:"json",source:L}),w(U,"json",Rd(t,S)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("export-all-as",{format:"svg",source:L}),w(Array.from(t.getCurrentPageShapeIds()),"svg",Rd(t,S)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(L){const U=Array.from(t.getCurrentPageShapeIds().values());U.length!==0&&(x("export-all-as",{format:"png",source:L}),w(U,"png",Rd(t,S)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(L){const U=Array.from(t.getCurrentPageShapeIds().values());U.length!==0&&(x("export-all-as",{format:"json",source:L}),w(U,"json",Rd(t,S)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("copy-as",{format:"svg",source:L}),v(U,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("copy-as",{format:"png",source:L}),v(U,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(L){let U=t.getSelectedShapeIds();U.length===0&&(U=Array.from(t.getCurrentPageShapeIds().values())),U.length!==0&&(x("copy-as",{format:"json",source:L}),v(U,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(L){if(!j()||M())return;x("toggle-auto-size",{source:L}),t.markHistoryStoppingPoint("toggling auto size");const U=t.getSelectedShapes().filter(z=>t.isShapeOfType(z,"text")&&z.props.autoSize===!1);t.updateShapes(U.map(z=>({id:z.id,type:z.type,props:{...z.props,w:8,autoSize:!0}}))),An(t,U.map(z=>z.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(L){x("open-embed-link",{source:L});const U=t.getSelectedShapeIds(),z="No embed shapes selected";if(U.length!==1){console.error(z);return}const Y=t.getShape(U[0]);if(!Y||!t.isShapeOfType(Y,"embed")){console.error(z);return}mte(Y.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(L){var U,z;if(((U=t.root.getCurrent())==null?void 0:U.id)!=="zoom"&&(x("zoom-tool",{source:L}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const Y=t.root.getCurrent();Y&&((z=Y.getCurrent())==null?void 0:z.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:Y.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(L){j()&&(M()||t.run(()=>{x("convert-to-bookmark",{source:L});const U=t.getSelectedShapes(),z=[],Y=[];for(const V of U){if(!V||!t.isShapeOfType(V,"embed")||!V.props.url)continue;const N=new T(V.x,V.y);N.rot(-V.rotation),N.add(new T(V.props.w/2-300/2,V.props.h/2-320/2)),N.rot(V.rotation);const _={id:wn(),type:"bookmark",rotation:V.rotation,x:N.x,y:N.y,opacity:1,props:{url:V.props.url}};z.push(_),Y.push(V.id)}t.markHistoryStoppingPoint("convert shapes to bookmark"),t.deleteShapes(Y),t.createShapes(z)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(L){j()&&(M()||(x("convert-to-embed",{source:L}),t.run(()=>{const U=t.getSelectedShapeIds(),z=St(U.map(N=>t.getShape(N))),Y=[],V=[];for(const N of z){if(!t.isShapeOfType(N,"bookmark"))continue;const{url:_}=N.props,k=b(_);if(!k||!k.definition)continue;const{width:O,height:W}=k.definition,q=new T(N.x,N.y);q.rot(-N.rotation),q.add(new T(N.props.w/2-O/2,N.props.h/2-W/2)),q.rot(N.rotation);const X={id:wn(),type:"embed",x:q.x,y:q.y,rotation:N.rotation,props:{url:_,w:O,h:W}};Y.push(X),V.push(N.id)}t.markHistoryStoppingPoint("convert shapes to embed"),t.deleteShapes(V),t.createShapes(Y)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(L){if(!j()||M())return;x("duplicate-shapes",{source:L});const U=t.getInstanceState();let z,Y;if(U.duplicateProps)z=U.duplicateProps.shapeIds,Y=U.duplicateProps.offset;else{z=t.getSelectedShapeIds();const V=De.Common(St(z.map(N=>t.getShapePageBounds(N))));Y=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:V.width+t.options.adjacentShapeMargin,y:0}}t.markHistoryStoppingPoint("duplicate shapes"),t.duplicateShapes(z,Y),U.duplicateProps&&t.updateInstanceState({duplicateProps:{...U.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(L){j()&&(M()||(x("ungroup-shapes",{source:L}),t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(L){if(!j()||M())return;x("group-shapes",{source:L});const U=t.getOnlySelectedShape();U&&t.isShapeOfType(U,"group")?(t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.markHistoryStoppingPoint("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(L){if(!j())return;x("remove-frame",{source:L});const U=t.getSelectedShapes();U.length>0&&U.every(z=>t.isShapeOfType(z,"frame"))&&(t.markHistoryStoppingPoint("remove-frame"),Tse(t,U.map(z=>z.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(L){if(!j())return;x("fit-frame-to-content",{source:L});const U=t.getOnlySelectedShape();U&&t.isShapeOfType(U,"frame")&&(t.markHistoryStoppingPoint("fit-frame-to-content"),Ase(t,U.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"left",source:L}),t.markHistoryStoppingPoint("align left");const U=t.getSelectedShapeIds();t.alignShapes(U,"left"),An(t,U)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"center-horizontal",source:L}),t.markHistoryStoppingPoint("align center horizontal");const U=t.getSelectedShapeIds();t.alignShapes(U,"center-horizontal"),An(t,U)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"right",source:L}),t.markHistoryStoppingPoint("align right");const U=t.getSelectedShapeIds();t.alignShapes(U,"right"),An(t,U)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"center-vertical",source:L}),t.markHistoryStoppingPoint("align center vertical");const U=t.getSelectedShapeIds();t.alignShapes(U,"center-vertical"),An(t,U)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"top",source:L}),t.markHistoryStoppingPoint("align top");const U=t.getSelectedShapeIds();t.alignShapes(U,"top"),An(t,U)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(L){if(!j()||M())return;x("align-shapes",{operation:"bottom",source:L}),t.markHistoryStoppingPoint("align bottom");const U=t.getSelectedShapeIds();t.alignShapes(U,"bottom"),An(t,U)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(L){if(!j()||M())return;x("distribute-shapes",{operation:"horizontal",source:L}),t.markHistoryStoppingPoint("distribute horizontal");const U=t.getSelectedShapeIds();t.distributeShapes(U,"horizontal"),An(t,U)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(L){if(!j()||M())return;x("distribute-shapes",{operation:"vertical",source:L}),t.markHistoryStoppingPoint("distribute vertical");const U=t.getSelectedShapeIds();t.distributeShapes(U,"vertical"),An(t,U)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(L){if(!j()||M())return;x("stretch-shapes",{operation:"horizontal",source:L}),t.markHistoryStoppingPoint("stretch horizontal");const U=t.getSelectedShapeIds();t.stretchShapes(U,"horizontal"),An(t,U)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(L){if(!j()||M())return;x("stretch-shapes",{operation:"vertical",source:L}),t.markHistoryStoppingPoint("stretch vertical");const U=t.getSelectedShapeIds();t.stretchShapes(U,"vertical"),An(t,U)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(L){if(!j()||M())return;x("flip-shapes",{operation:"horizontal",source:L}),t.markHistoryStoppingPoint("flip horizontal");const U=t.getSelectedShapeIds();t.flipShapes(U,"horizontal"),An(t,U)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(L){if(!j()||M())return;x("flip-shapes",{operation:"vertical",source:L}),t.markHistoryStoppingPoint("flip vertical");const U=t.getSelectedShapeIds();t.flipShapes(U,"vertical"),An(t,U)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(L){if(!j()||M())return;x("pack-shapes",{source:L}),t.markHistoryStoppingPoint("pack");const U=t.getSelectedShapeIds();t.packShapes(U,t.options.adjacentShapeMargin),An(t,U)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(L){if(!j()||M())return;x("stack-shapes",{operation:"vertical",source:L}),t.markHistoryStoppingPoint("stack-vertical");const U=t.getSelectedShapeIds();t.stackShapes(U,"vertical",16),An(t,U)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(L){if(!j()||M())return;x("stack-shapes",{operation:"horizontal",source:L}),t.markHistoryStoppingPoint("stack-horizontal");const U=t.getSelectedShapeIds();t.stackShapes(U,"horizontal",16),An(t,U)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(L){j()&&(M()||(x("reorder-shapes",{operation:"toFront",source:L}),t.markHistoryStoppingPoint("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(L){j()&&(M()||(x("reorder-shapes",{operation:"forward",source:L}),t.markHistoryStoppingPoint("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(L){j()&&(M()||(x("reorder-shapes",{operation:"backward",source:L}),t.markHistoryStoppingPoint("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(L){j()&&(M()||(x("reorder-shapes",{operation:"toBack",source:L}),t.markHistoryStoppingPoint("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(L){j()&&(M()||(t.markHistoryStoppingPoint("cut"),f(L)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(L){j()&&(M()||g(L))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(L){var U;(U=navigator.clipboard)==null||U.read().then(z=>{m(z,L,L==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(L){t.run(()=>{M()||(x("select-all-shapes",{source:L}),t.markHistoryStoppingPoint("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(L){j()&&(M()||(x("select-none-shapes",{source:L}),t.markHistoryStoppingPoint("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(L){j()&&(M()||(x("delete-shapes",{source:L}),t.markHistoryStoppingPoint("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(L){if(!j()||M())return;x("rotate-cw",{source:L}),t.markHistoryStoppingPoint("rotate-cw");const U=t.getSelectionRotation()%(jn/2),z=dl(U,0)||dl(U,jn/2),Y=t.getSelectedShapeIds();t.rotateShapesBy(Y,jn/2-(z?0:U)),An(t,Y)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(L){if(!j()||M())return;x("rotate-ccw",{source:L}),t.markHistoryStoppingPoint("rotate-ccw");const U=t.getSelectionRotation()%(jn/2),z=dl(U,0),Y=t.getSelectedShapeIds();t.rotateShapesBy(Y,z?-(jn/2):-U),An(t,Y)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(L){x("zoom-in",{source:L}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(L){x("zoom-out",{source:L}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(L){x("reset-zoom",{source:L}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(L){x("zoom-to-fit",{source:L}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(L){j()&&(M()||(x("zoom-to-selection",{source:L}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(L){x("toggle-snap-mode",{source:L}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(L){const U=t.user.getIsDarkMode()?"light":"dark";x("color-scheme",{source:L,value:U}),t.user.updateUserPreferences({colorScheme:U})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(L){x("toggle-wrap-mode",{source:L}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(L){x("toggle-dynamic-size-mode",{source:L}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(L){x("toggle-paste-at-cursor",{source:L}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(L){x("toggle-reduce-motion",{source:L}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(L){x("toggle-edge-scrolling",{source:L}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(L){x("toggle-transparent",{source:L}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(L){x("toggle-tool-lock",{source:L}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(L){x("unlock-all",{source:L});const U=[];for(const z of t.getCurrentPageShapes())z.isLocked&&U.push({id:z.id,type:z.type,isLocked:!1});U.length>0&&t.updateShapes(U)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(L){t.timers.requestAnimationFrame(()=>{t.run(()=>{x("toggle-focus-mode",{source:L}),s(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(L){x("toggle-grid-mode",{source:L}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(L){x("toggle-debug-mode",{source:L}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(L){x("print",{source:L}),d()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(L){x("exit-pen-mode",{source:L}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(L){x("stop-following",{source:L}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(L){x("zoom-to-content",{source:L});const U=t.getSelectionPageBounds()??t.getCurrentPageBounds();U&&t.zoomToBounds(U,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(L){t.markHistoryStoppingPoint("locking"),x("toggle-lock",{source:L}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(L){const U=Ds.createId(),z=t.getSelectedShapeIds();t.run(()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.createPage({name:c("page-menu.new-page-initial-name"),id:U}),t.moveShapesToPage(z,U)}),x("move-to-new-page",{source:L})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(L){const U=hs;t.run(()=>{t.markHistoryStoppingPoint("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(U,"white"),t.setStyleForNextShapes(U,"white")}),x("set-style",{source:L,id:U.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(L){const U=Eu;t.run(()=>{t.markHistoryStoppingPoint("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(U,"fill"),t.setStyleForNextShapes(U,"fill")}),x("set-style",{source:L,id:U.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async L=>{const U=t.getSelectedShapeIds();if(U.length===0)return;t.markHistoryStoppingPoint("flattening to image"),x("flatten-to-image",{source:L});const z=await Mae(t,U,t.options.flattenImageBoundsExpand);z!=null&&z.length&&t.setSelectedShapes(z)}}];r&&D.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(L){x("open-cursor-chat",{source:L}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const H=Rae(D);return n?n(t,H,void 0):H},[t,x,n,i,a,u,w,v,f,g,m,s,o,d,c,S,r,b]);return p.jsx(dU.Provider,{value:E,children:e})}function Ku(){const n=P.useContext(dU);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Pp(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}function Ls(){const n=Cl();return xe("isReadonlyMode",()=>!!(n!=null&&n.getIsReadonly()),[n])}const Rb=[0,389,436,476,580,640,840,1023];var lr=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(lr||{});const hU=Ce.createContext(null);function Dae({forceMobile:n=!1,children:e}){const t=Cl(),r=xe("breakpoint",()=>{const{width:i}=(t==null?void 0:t.getViewportScreenBounds())??{width:window.innerWidth},s=n?lr.MOBILE_SM:Rb.length-1;for(let o=0;o<s;o++)if(i>Rb[o]&&i<=Rb[o+1])return o;return s},[t]);return p.jsx(hU.Provider,{value:r,children:e})}function $i(){const n=P.useContext(hU);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}const Oae=_n.isDarwin?"":"Ctrl",Lae=_n.isDarwin?"":"Alt";function fU(n){return n===","?[","]:n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,Oae).replace(/\?/g,Lae).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function dE(n){return" "+fU(n).join("")}function sp({children:n,visibleOnMobileLayout:e=!1}){const t=$i();return!e&&t<lr.MOBILE?null:p.jsx("kbd",{className:"tlui-kbd",children:fU(n).map((r,i)=>p.jsx("span",{children:r},i))})}const pU=P.createContext(null);function zw(){const n=P.useContext(pU);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function no({type:n,sourceId:e,children:t}){return p.jsx(pU.Provider,{value:{type:n,sourceId:e},children:t})}function Uw({id:n,kbd:e,label:t,readonlyOk:r,onSelect:i,toggle:s=!1,disabled:o=!1,checked:a=!1}){const{type:c,sourceId:u}=zw(),d=Ls(),f=Nt();if(d&&!r)return null;const g=Pp(t,c),m=g?f(g):void 0;switch(c){case"menu":return p.jsxs(Ese,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:m,onSelect:v=>{i==null||i(u),kt(v)},disabled:o,checked:a,children:[p.jsx(ya,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),m&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:m}),e&&p.jsx(sp,{children:e})]});case"context-menu":return p.jsxs(tse,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:m,onSelect:v=>{i(u),kt(v)},disabled:o,checked:a,children:[p.jsx(ya,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),m&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:m}),e&&p.jsx(sp,{children:e})]},n);default:return null}}function vc(n,e){const t=Cl(),r=P.useCallback(o=>{o&&(t==null||t.complete()),e==null||e(o)},[t,e]),i=ri(),s=P.useCallback(o=>{i(o,{source:"unknown",id:n})},[n,i]);return ate(t?`${n}-${t.contextId}`:n,r,s)}function ku({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[i,s]=vc(n);return p.jsx(X2,{open:r||i,dir:"ltr",modal:t,onOpenChange:s,children:e})}function Au({children:n,...e}){return p.jsx(Z2,{dir:"ltr",asChild:!0,onTouchEnd:t=>kt(t),...e,children:n})}function Ru({className:n,side:e="bottom",align:t="start",sideOffset:r=8,alignOffset:i=8,children:s}){const o=Mr();return p.jsx(Rw,{container:o,children:p.jsx(Q2,{className:rt("tlui-menu",n),side:e,sideOffset:r,align:t,alignOffset:i,collisionPadding:4,children:s})})}function Nae({id:n,children:e}){const[t,r]=vc(n);return p.jsx(Cse,{open:t,onOpenChange:r,children:e})}function Bae({id:n,label:e,title:t,disabled:r}){return p.jsx(Pse,{dir:"ltr",asChild:!0,disabled:r,children:p.jsxs(ot,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:t,children:[p.jsx(yr,{children:e}),p.jsx(Ot,{icon:"chevron-right",small:!0})]})})}function Fae({id:n,alignOffset:e=-1,sideOffset:t=-6,size:r="small",children:i}){const s=Mr();return p.jsx(Rw,{container:s,children:p.jsx(Mse,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":r,children:i})})}function zae({children:n}){return p.jsx(_se,{dir:"ltr",className:"tlui-menu__group",children:n})}function Mp({noClose:n,children:e}){return p.jsx(Ise,{dir:"ltr",asChild:!0,onClick:n?kt:void 0,children:e})}function Pt({id:n,label:e,children:t}){const{type:r,sourceId:i}=zw(),s=Nt(),o=Pp(e,r),a=o?s(o):void 0;switch(r){case"panel":return p.jsx("div",{className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"menu":return p.jsx(zae,{"data-testid":`${i}-group.${n}`,children:t});case"context-menu":return p.jsx(rz,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${n}`,children:t});case"keyboard-shortcuts":return p.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${n}`,children:[p.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),p.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function ms({id:n,disabled:e=!1,label:t,size:r="small",children:i}){const{type:s,sourceId:o}=zw(),a=Mr(),c=Nt(),u=t?typeof t=="string"?t:t[s]??t.default:void 0,d=u?c(u):void 0;switch(s){case"menu":return p.jsxs(Nae,{id:`${o}-sub.${n}`,children:[p.jsx(Bae,{id:`${o}-sub.${n}-button`,disabled:e,label:d,title:d}),p.jsx(Fae,{id:`${o}-sub.${n}-content`,size:r,children:i})]});case"context-menu":return e?null:p.jsxs(Uae,{id:`${o}-sub.${n}`,children:[p.jsx(az,{dir:"ltr",disabled:e,asChild:!0,children:p.jsxs(ot,{"data-testid":`${o}-sub.${n}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[p.jsx(yr,{children:d}),p.jsx(Ot,{icon:"chevron-right",small:!0})]})}),p.jsx(V2,{container:a,children:p.jsx(cz,{"data-testid":`${o}-sub.${n}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function Uae({id:n,children:e}){const[t,r]=vc(n);return p.jsx(oz,{open:t,onOpenChange:r,children:e})}const $ae=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function Hae(){const n=me(),e=ri(),t=xe("colorScheme",()=>n.user.getUserPreferences().colorScheme??(n.user.getIsDarkMode()?"dark":"light"),[n]);return p.jsx(ms,{id:"help menu color-scheme",label:"menu.theme",children:p.jsx(Pt,{id:"theme",children:$ae.map(({colorScheme:r,label:i})=>p.jsx(Uw,{id:`color-scheme-${r}`,label:i,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}const Wae=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=Wu(),i=Mr(),s=P.useCallback(o=>{if(!o){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return p.jsx(qse,{onOpenChange:s,defaultOpen:!0,children:p.jsx(Gse,{container:i,children:p.jsx(Vse,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&s(!1)},children:p.jsx(Yse,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,children:p.jsx(e,{onClose:()=>s(!1)})})})})})},Kae=P.memo(function(){const{dialogs:e}=Wu();return xe("dialogs",()=>e.get(),[e]).map(r=>p.jsx(Wae,{...r},r.id))}),qae=4e3,Gae={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function Vae({toast:n}){const{removeToast:e}=Ea(),t=Nt(),r=o=>{o||e(n.id)},i=n.actions&&n.actions.length>0,s=n.icon||n.severity&&Gae[n.severity];return p.jsxs(vae,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:qae,"data-severity":n.severity,children:[s&&p.jsx("div",{className:"tlui-toast__icon",children:p.jsx(ya,{icon:s})}),p.jsxs("div",{className:"tlui-toast__main","data-title":!!n.title,"data-description":!!n.description,"data-actions":!!n.actions,children:[p.jsxs("div",{className:"tlui-toast__content",children:[n.title&&p.jsx(Sae,{className:"tlui-toast__title",children:n.title}),n.description&&p.jsx(xae,{className:"tlui-toast__description",children:n.description})]}),n.actions&&p.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,a)=>p.jsx(bae,{altText:o.label,asChild:!0,onClick:o.onClick,children:p.jsx(ot,{type:o.type,children:p.jsx(yr,{children:o.label})})},a)),p.jsx(Vj,{asChild:!0,children:p.jsx(ot,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:p.jsx(yr,{children:n.closeLabel??t("toast.close")})})})]})]}),!i&&p.jsx(Vj,{asChild:!0,children:p.jsx(ot,{type:"normal",className:"tlui-toast__close",children:p.jsx(yr,{children:n.closeLabel??t("toast.close")})})})]})}const Yae=P.memo(function(){const{toasts:e}=Ea(),t=xe("toasts",()=>e.get(),[]);return p.jsxs(p.Fragment,{children:[t.map(r=>p.jsx(Vae,{toast:r},r.id)),p.jsx(Zz,{className:"tlui-toast__viewport"})]})});function Uo({actionId:n="",...e}){const r=Ku()[n];return r?p.jsx(Uw,{...r,...e}):null}function Xj(n){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function Vr({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:r,kbd:i,label:s,icon:o,onSelect:a,noClose:c,isSelected:u}){const{type:d,sourceId:f}=zw(),g=Nt(),[m,v]=P.useState(!1);if(Ls()&&!t)return null;const S=Pp(s,d),b=i?dE(i):void 0,x=S?g(S):void 0,E=x&&b?`${x} ${b}`:x;switch(d){case"menu":return p.jsx(Mp,{children:p.jsxs(ot,{type:"menu","data-testid":`${f}.${r}`,disabled:n,title:E,onClick:M=>{c&&kt(M),m?v(!1):a(f)},children:[p.jsx(yr,{children:x}),i&&p.jsx(sp,{children:i})]})});case"context-menu":return n?null:p.jsxs(iz,{dir:"ltr",title:E,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${f}.${r}`,onSelect:M=>{c&&kt(M),m?v(!1):a(f)},children:[p.jsx("span",{className:"tlui-button__label",draggable:!1,children:x}),i&&p.jsx(sp,{children:i}),e&&p.jsx(Xj,{})]});case"panel":return p.jsxs(ot,{"data-testid":`${f}.${r}`,type:"menu",title:E,disabled:n,onClick:()=>a(f),children:[p.jsx(yr,{children:x}),e?p.jsx(Xj,{}):o&&p.jsx(Ot,{icon:o})]});case"small-icons":case"icons":return p.jsx(ot,{"data-testid":`${f}.${r}`,type:"icon",title:E,disabled:n,onClick:()=>a(f),children:p.jsx(Ot,{icon:o,small:d==="small-icons"})});case"keyboard-shortcuts":return i?p.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${f}.${r}`,children:[p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:x}),p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:p.jsx(sp,{visibleOnMobileLayout:!0,children:i})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return p.jsxs(ot,{type:"low",onClick:()=>a(f),children:[p.jsx(Ot,{icon:o}),p.jsx(yr,{children:x})]});case"toolbar":return p.jsx(ot,{type:"tool","data-testid":`tools.${r}`,"aria-label":S,"data-value":r,onClick:()=>a("toolbar"),title:E,disabled:n,onTouchStart:M=>{kt(M),a("toolbar")},role:"radio","aria-checked":u?"true":"false",children:p.jsx(Ot,{icon:o})});case"toolbar-overflow":return p.jsx(Mp,{"aria-label":s,children:p.jsx(ot,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:E,disabled:n,role:"radio","aria-checked":u?"true":"false","data-value":r,children:p.jsx(Ot,{icon:o})})});default:throw Pr(d)}}function Ee({actionId:n="",...e}){const r=Ku()[n];return r?p.jsx(Vr,{...r,...e}):null}const gU=P.createContext(null);function Xae({overrides:n,children:e}){const t=me(),r=ri(),{addDialog:i}=Wu(),s=lU(),o=P.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(u){if(t.isIn("select")){const d=t.root.getCurrent();d.exit({},d.id),d.enter({},d.id)}t.setCurrentTool("select"),r("select-tool",{source:u,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(u){t.setCurrentTool("hand"),r("select-tool",{source:u,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(u){t.setCurrentTool("eraser"),r("select-tool",{source:u,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(u){t.setCurrentTool("draw"),r("select-tool",{source:u,id:"draw"})}},...[...Co.values].map(u=>({id:u,label:`tool.${u}`,meta:{geo:u},kbd:u==="rectangle"?"r":u==="ellipse"?"o":void 0,icon:"geo-"+u,onSelect(d){t.run(()=>{t.setStyleForNextShapes(Co,u),t.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${u}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(u){t.setCurrentTool("arrow"),r("select-tool",{source:u,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(u){t.setCurrentTool("line"),r("select-tool",{source:u,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(u){t.setCurrentTool("frame"),r("select-tool",{source:u,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(u){t.setCurrentTool("text"),r("select-tool",{source:u,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(u){s(),r("select-tool",{source:u,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(u){t.setCurrentTool("note"),r("select-tool",{source:u,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(u){t.setCurrentTool("laser"),r("select-tool",{source:u,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(u){i({component:zz}),r("select-tool",{source:u,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(u){t.setCurrentTool("highlight"),r("select-tool",{source:u,id:"highlight"})}}];a.push();const c=Object.fromEntries(a.map(u=>[u.id,u]));return n?n(t,c,{insertMedia:s}):c},[n,t,r,s,i]);return p.jsx(gU.Provider,{value:o,children:e})}function hP(){const n=P.useContext(gU);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function ts({toolId:n="",...e}){const r=hP()[n];return r?p.jsx(Vr,{...r,...e}):null}function Zae({children:n}){const e=me();return xe("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:Qae}=Math,ih=Qae+1e-4;function mU(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const i=n[0],s=n[n.length-1],o=s.runningLength,a=Math.pow(t*r,2),c=[],u=[];let d=n[0].vector,f=n[0].point,g=f,m=f,v=g,w=!1,S;for(let b=0;b<n.length;b++){S=n[b];const{point:x,vector:E}=n[b],M=S.vector.dpr(d),j=(b<n.length-1?n[b+1]:n[b]).vector,D=b<n.length-1?j.dpr(S.vector):1,H=M<0&&!w,L=D!==null&&D<.2;if(H||L){if(D>-.62&&o-S.runningLength>S.radius){const z=d.clone().mul(S.radius);d.clone().cpr(j)<0?(m=T.Add(x,z),v=T.Sub(x,z)):(m=T.Sub(x,z),v=T.Add(x,z)),c.push(m),u.push(v)}else{const z=d.clone().mul(S.radius).per(),Y=T.Sub(S.input,z);for(let V=1/13,N=0;N<1;N+=V)m=T.RotWith(Y,S.input,ih*N),c.push(m),v=T.RotWith(Y,S.input,ih+ih*-N),u.push(v)}f=m,g=v,L&&(w=!0);continue}if(w=!1,S===i||S===s){const z=T.Per(E).mul(S.radius);c.push(T.Sub(x,z)),u.push(T.Add(x,z));continue}const U=T.Lrp(j,E,D).per().mul(S.radius);m=T.Sub(x,U),(b<=1||T.Dist2(f,m)>a)&&(c.push(m),f=m),v=T.Add(x,U),(b<=1||T.Dist2(g,v)>a)&&(u.push(v),g=v),d=E}return{left:c,right:u}}function fP(n,e={}){const{size:t=16,start:r={},end:i={},last:s=!1}=e,{cap:o=!0}=r,{cap:a=!0}=i;if(n.length===0||t<=0)return[];const c=n[0],u=n[n.length-1],d=u.runningLength,f=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,g=i.taper===!1?0:i.taper===!0?Math.max(t,d):i.taper,{left:m,right:v}=mU(n,e),w=c.point,S=n.length>1?n[n.length-1].point:T.AddXY(c.point,1,1);if(n.length===1&&(!(f||g)||s)){const M=T.Add(w,T.Sub(w,S).uni().per().mul(-c.radius)),j=[];for(let D=1/13,H=D;H<=1;H+=D)j.push(T.RotWith(M,w,ih*2*H));return j}const b=[];if(!(f||g&&n.length===1))if(o)for(let M=1/8,j=M;j<=1;j+=M){const D=T.RotWith(v[0],w,ih*j);b.push(D)}else{const M=T.Sub(m[0],v[0]),j=T.Mul(M,.5),D=T.Mul(M,.51);b.push(T.Sub(w,j),T.Sub(w,D),T.Add(w,D),T.Add(w,j))}const x=[],E=u.vector.clone().per().neg();if(g||f&&n.length===1)x.push(S);else if(a){const M=T.Add(S,T.Mul(E,u.radius));for(let j=1/29,D=j;D<1;D+=j)x.push(T.RotWith(M,S,ih*3*D))}else x.push(T.Add(S,T.Mul(E,u.radius)),T.Add(S,T.Mul(E,u.radius*.99)),T.Sub(S,T.Mul(E,u.radius*.99)),T.Sub(S,T.Mul(E,u.radius)));return m.concat(x,v.reverse(),b)}const Jae=.025,ece=.01;function wa(n,e={}){var S;const{streamline:t=.5,size:r=16,simulatePressure:i=!1}=e;if(n.length===0)return[];const s=.15+(1-t)*.85;let o=n.map(T.From),a=0;if(!i){let b=o[0];for(;b&&!(b.z>=Jae);)o.shift(),b=o[0]}if(!i){let b=o[o.length-1];for(;b&&!(b.z>=ece);)o.pop(),b=o[o.length-1]}if(o.length===0)return[{point:T.From(n[0]),input:T.From(n[0]),pressure:i?.5:.15,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(T.Dist2(c,o[0])>(r/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const u=o.pop();for(c=o[o.length-1];c&&!(T.Dist2(c,u)>(r/3)**2);)o.pop(),c=o[o.length-1],a++;o.push(u);const d=e.last||!e.simulatePressure||o.length>1&&T.Dist2(o[o.length-1],o[o.length-2])<r**2||a>0;if(o.length===2&&e.simulatePressure){const b=o[1];o=o.slice(0,-1);for(let x=1;x<5;x++){const E=T.Lrp(o[0],b,x/4);E.z=(o[0].z+(b.z-o[0].z))*x/4,o.push(E)}}const f=[{point:o[0],input:o[0],pressure:i?.5:o[0].z,vector:new T(1,1),distance:0,runningLength:0,radius:1}];let g=0,m=f[0],v,w;d&&t>0&&o.push(o[o.length-1].clone());for(let b=1,x=o.length;b<x;b++)v=!s||e.last&&b===x-1?o[b].clone():o[b].clone().lrp(m.point,1-s),!m.point.equals(v)&&(w=T.Dist(v,m.point),g+=w,!(b<4&&g<r)&&(m={input:o[b],point:v,pressure:i?.5:o[b].z,vector:T.Sub(m.point,v).uni(),distance:w,runningLength:g,radius:1},f.push(m)));if((S=f[1])!=null&&S.vector&&(f[0].vector=f[1].vector.clone()),g<1){const b=Math.max(.5,...f.map(x=>x.pressure));f.forEach(x=>x.pressure=b)}return f}const{min:Wc}=Math,jb=.275;function $w(n,e){const{size:t=16,thinning:r=.5,simulatePressure:i=!0,easing:s=S=>S,start:o={},end:a={}}=e,{easing:c=Or.easeOutQuad}=o,{easing:u=Or.easeOutCubic}=a,d=n[n.length-1].runningLength;let f,g=n[0].pressure,m;if(!i&&d<t){const S=n.reduce((b,x)=>Math.max(b,x.pressure),.5);return n.forEach(b=>{b.pressure=S,b.radius=t*s(.5-r*(.5-b.pressure))}),n}else{let S;for(let b=0,x=n.length;b<x&&(m=n[b],!(m.runningLength>t*5));b++){const E=Wc(1,m.distance/t);if(i){const M=Wc(1,1-E);S=Wc(1,g+(M-g)*(E*jb))}else S=Wc(1,g+(m.pressure-g)*.5);g=g+(S-g)*.5}for(let b=0;b<n.length;b++){if(m=n[b],r){let{pressure:x}=m;const E=Wc(1,m.distance/t);if(i){const M=Wc(1,1-E);x=Wc(1,g+(M-g)*(E*jb))}else x=Wc(1,g+(x-g)*(E*jb));m.radius=t*s(.5-r*(.5-x)),g=x}else m.radius=t/2;f===void 0&&(f=m.radius)}}const v=o.taper===!1?0:o.taper===!0?Math.max(t,d):o.taper,w=a.taper===!1?0:a.taper===!0?Math.max(t,d):a.taper;if(v||w)for(let S=0;S<n.length;S++){m=n[S];const{runningLength:b}=m,x=b<v?c(b/v):1,E=d-b<w?u((d-b)/w):1;m.radius=Math.max(.01,m.radius*Math.min(x,E))}return n}function tce(n,e={}){return fP($w(wa(n,e),e),e)}function Zj({scribble:n,zoom:e,color:t,opacity:r,className:i}){if(!n.points.length)return null;const s=tce(n.points,{size:n.size/e,start:{taper:n.taper,easing:Or.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(s.length<4){const a=n.size/e/2,{x:c,y:u}=n.points[n.points.length-1];o=`M ${c-a},${u} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=t2(s);return p.jsx("svg",{className:i&&rt("tl-overlays__item",i),children:p.jsx("path",{className:"tl-scribble",d:o,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})}const nce=({bounds:n,rotation:e})=>{const t=me();return xe("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?p.jsx(YN,{bounds:n,rotation:e}):null};function rce({size:n,width:e,height:t,hideAlternateHandles:r}){const i=ge(n/3),s=i/2;return p.jsxs("svg",{className:"tl-overlays__item",children:[p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ge(0-s)},${ge(n)} 
						${ge(0-s)},${ge(0-s)} 
						${ge(n)},${ge(0-s)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),p.jsx("line",{className:rt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ge(e/2-n),y1:ge(0-s),x2:ge(e/2+n),y2:ge(0-s),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),p.jsx("polyline",{className:rt("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ge(e-n)},${ge(0-s)} 
						${ge(e+s)},${ge(0-s)} 
						${ge(e+s)},${ge(n)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),p.jsx("line",{className:rt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ge(e+s),y1:ge(t/2-n),x2:ge(e+s),y2:ge(t/2+n),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ge(e+s)},${ge(t-n)} 
						${ge(e+s)},${ge(t+s)}
						${ge(e-n)},${ge(t+s)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),p.jsx("line",{className:rt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ge(e/2-n),y1:ge(t+s),x2:ge(e/2+n),y2:ge(t+s),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),p.jsx("polyline",{className:rt("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ge(0+n)},${ge(t+s)} 
						${ge(0-s)},${ge(t+s)}
						${ge(0-s)},${ge(t-n)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),p.jsx("line",{className:rt("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ge(0-s),y1:ge(t/2-n),x2:ge(0-s),y2:ge(t/2+n),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const ice=ti(function({bounds:e,rotation:t}){const r=me(),i=P.useRef(null),s=Ls(),o=ia("top"),a=ia("right"),c=ia("bottom"),u=ia("left"),d=ia("top_left"),f=ia("top_right"),g=ia("bottom_right"),m=ia("bottom_left"),v=r.getInstanceState().cursor.type==="default",w=r.getInstanceState().isCoarsePointer,S=r.getOnlySelectedShape(),b=S&&r.isShapeOrAncestorLocked(S),x=S?r.getShapeUtil(S).expandSelectionOutlinePx(S):0;if(Th(i,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:-x,y:-x}),S&&r.isShapeHidden(S)||!e)return null;e=e.clone().expandBy(x).zeroFix();const E=r.getZoomLevel(),M=r.getInstanceState().isChangingStyle,j=e.width,D=e.height,H=8/E,L=j<H*2,U=D<H*2,z=j<H*4,Y=D<H*4,V=j<H*5,N=D<H*5,_=w?1.75:1,k=6/E*_,O=(z?k/2:k)*(_*.75),W=(Y?k/2:k)*(_*.75),q=(S?!r.getShapeUtil(S).hideSelectionBoundsFg(S):!0)&&!M;let X=q&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||q&&r.isIn("select.resizing")&&S&&r.isShapeOfType(S,"text");S&&X&&_n.isFirefox&&r.isShapeOfType(S,"embed")&&(X=!1);const ne=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!M&&!s,$=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!M&&!s,C=!w&&!(L||U)&&($||ne)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!b,R=w&&(!z||!Y)&&($||ne)&&(S?!r.getShapeUtil(S).hideRotateHandle(S):!0)&&!b,Z=$&&(S?r.getShapeUtil(S).canResize(S)&&!r.getShapeUtil(S).hideResizeHandles(S):!0)&&!ne&&!b,J=L||U,oe=L&&U,ue=V||N,fe=Z||ne,_e=!C,Le=!$||!R,Ne=!$||!fe,Ze=!$||!fe||J,dt=!$||!fe||J,et=!$||!fe||oe&&!ne;let Xe=!0,Kt=!0;if(ne)Xe=ue,Kt=ue;else if(Z){Xe=J||oe||w;const ur=w&&S&&S.type==="text";Kt=Xe&&!ur}const _t=Math.min(24/E,D-W*3),Ut=$&&w&&S&&r.isShapeOfType(S,"text")&&_t*E>=4;return p.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsxs("g",{ref:i,children:[X&&p.jsx("rect",{className:"tl-selection__fg__outline",width:ge(j),height:ge(D)}),p.jsx(Um,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:k,corner:"top_left_rotate",cursor:v?Ss("nwse-rotate",t):void 0,isHidden:_e}),p.jsx(Um,{"data-testid":"selection.rotate.top-right",cx:j+k*3,cy:0,targetSize:k,corner:"top_right_rotate",cursor:v?Ss("nesw-rotate",t):void 0,isHidden:_e}),p.jsx(Um,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:D+k*3,targetSize:k,corner:"bottom_left_rotate",cursor:v?Ss("swne-rotate",t):void 0,isHidden:_e}),p.jsx(Um,{"data-testid":"selection.rotate.bottom-right",cx:j+k*3,cy:D+k*3,targetSize:k,corner:"bottom_right_rotate",cursor:v?Ss("senw-rotate",t):void 0,isHidden:_e}),p.jsx(oce,{"data-testid":"selection.rotate.mobile",cx:z?-k*1.5:j/2,cy:z?D/2:-k*1.5,size:H,isHidden:Le}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Xe}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:ge(0-(Y?W*2:W)),width:ge(j),height:ge(Math.max(1,W*2)),style:v?{cursor:Ss("ns-resize",t)}:void 0,...o}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Kt}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:ge(j-(z?0:O)),y:0,height:ge(D),width:ge(Math.max(1,O*2)),style:v?{cursor:Ss("ew-resize",t)}:void 0,...a}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Xe}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:ge(D-(Y?0:W)),width:ge(j),height:ge(Math.max(1,W*2)),style:v?{cursor:Ss("ns-resize",t)}:void 0,...c}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Kt}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:ge(0-(z?O*2:O)),y:0,height:ge(D),width:ge(Math.max(1,O*2)),style:v?{cursor:Ss("ew-resize",t)}:void 0,...u}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Ne}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:ge(0-(z?O*2:O*1.5)),y:ge(0-(Y?W*2:W*1.5)),width:ge(O*3),height:ge(W*3),style:v?{cursor:Ss("nwse-resize",t)}:void 0,...d}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":Ze}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:ge(j-(z?0:O*1.5)),y:ge(0-(Y?W*2:W*1.5)),width:ge(O*3),height:ge(W*3),style:v?{cursor:Ss("nesw-resize",t)}:void 0,...f}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:ge(j-(z?O:O*1.5)),y:ge(D-(Y?W:W*1.5)),width:ge(O*3),height:ge(W*3),style:v?{cursor:Ss("nwse-resize",t)}:void 0,...g}),p.jsx("rect",{className:rt("tl-transparent",{"tl-hidden":dt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:ge(0-(z?O*3:O*1.5)),y:ge(D-(Y?0:W*1.5)),width:ge(O*3),height:ge(W*3),style:v?{cursor:Ss("nesw-resize",t)}:void 0,...m}),Z&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.resize.top-left",className:rt("tl-corner-handle",{"tl-hidden":Ne}),"aria-label":"top_left handle",x:ge(0-H/2),y:ge(0-H/2),width:ge(H),height:ge(H)}),p.jsx("rect",{"data-testid":"selection.resize.top-right",className:rt("tl-corner-handle",{"tl-hidden":Ze}),"aria-label":"top_right handle",x:ge(j-H/2),y:ge(0-H/2),width:ge(H),height:ge(H)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:rt("tl-corner-handle",{"tl-hidden":et}),"aria-label":"bottom_right handle",x:ge(j-H/2),y:ge(D-H/2),width:ge(H),height:ge(H)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:rt("tl-corner-handle",{"tl-hidden":dt}),"aria-label":"bottom_left handle",x:ge(0-H/2),y:ge(D-H/2),width:ge(H),height:ge(H)})]}),Ut&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:ge(0-H/4),y:ge(D/2-_t/2),rx:H/4,width:ge(H/2),height:ge(_t)}),p.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:H/4,x:ge(j-H/4),y:ge(D/2-_t/2),width:ge(H/2),height:ge(_t)})]}),ne&&p.jsx(rce,{size:H,width:j,height:D,hideAlternateHandles:ue})]})})}),Um=function({cx:e,cy:t,targetSize:r,corner:i,cursor:s,isHidden:o,"data-testid":a}){const c=ia(i);return p.jsx("rect",{className:rt("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${i} target`,pointerEvents:"all",x:ge(e-r*3),y:ge(t-r*3),width:ge(Math.max(1,r*3)),height:ge(Math.max(1,r*3)),cursor:s,...c})},sce=Math.sqrt(Math.PI),oce=function({cx:e,cy:t,size:r,isHidden:i,"data-testid":s}){const o=ia("mobile_rotate"),a=me(),c=xe("zoom level",()=>a.getZoomLevel(),[a]),u=Math.max(14*(1/c),20/Math.max(1,c));return p.jsxs("g",{children:[p.jsx("circle",{"data-testid":s,pointerEvents:"all",className:rt("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":i}),cx:e,cy:t,r:u,...o}),p.jsx("circle",{className:rt("tl-mobile-rotate__fg",{"tl-hidden":i}),cx:e,cy:t,r:r/sce})]})};function ace(){const n=me();return xe("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?p.jsx(XN,{}):null}function hE(n,e,t){const{arrowheadStart:r,arrowheadEnd:i}=e.props,s=Kd(n,e,t),o=s.start.clone(),a=s.end.clone(),c=T.Med(o,a);if(T.Equals(o,a))return{bindings:t,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const u=T.Sub(a,o).uni(),d=E0(n,e,"start"),f=E0(n,e,"end"),g=n.getShapePageTransform(e);Qj(a,s.start,g,f),Qj(o,s.end,g,d);let m=0,v=0,w=0,S=0,b=qd*e.props.scale;const x=d&&f&&d.shape===f.shape,E=d&&f?pP(n,d.shape.id,f.shape.id):"safe";E==="safe"&&d&&f&&!x&&!d.isExact&&!f.isExact&&(f.didIntersect&&!d.didIntersect?d.isClosed&&o.setTo(a.clone().add(u.clone().mul(qd*e.props.scale))):f.didIntersect||f.isClosed&&a.setTo(o.clone().sub(u.clone().mul(qd*e.props.scale))));const M=T.Sub(a,o),j=T.Len(M)?M.uni():T.From(M),D=!T.Equals(j,u);x||(E!=="start-contains-end"&&d&&r!=="none"&&!d.isExact&&(w=ua[e.props.size]/2+("size"in d.shape.props?ua[d.shape.props.size]/2:0),m=(C0+w)*e.props.scale,b+=w*e.props.scale),E!=="end-contains-start"&&f&&i!=="none"&&!f.isExact&&(S=ua[e.props.size]/2+("size"in f.shape.props?ua[f.shape.props.size]/2:0),v=(C0+S)*e.props.scale,b+=S*e.props.scale));const H=o.clone().add(j.clone().mul(m*(D?-1:1))),L=a.clone().sub(j.clone().mul(v*(D?-1:1)));T.DistMin(H,L,b)&&(m!==0&&v!==0?(m*=-1.5,v*=-1.5):m!==0?m*=-1:v!==0&&(v*=-1)),o.add(j.clone().mul(m*(D?-1:1))),a.sub(j.clone().mul(v*(D?-1:1))),D?(d&&f&&a.setTo(T.Add(o,j.clone().mul(-qd*e.props.scale))),c.setTo(T.Med(s.start,s.end))):c.setTo(T.Med(o,a));const U=T.Dist(o,a);return{bindings:t,isStraight:!0,start:{handle:s.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:U>0,length:U}}function Qj(n,e,t,r){if(r===void 0||r.isExact)return;const i=Re.applyToPoint(t,e),s=Re.applyToPoint(t,n),o=Re.applyToPoint(Re.Inverse(r.transform),i),a=Re.applyToPoint(Re.Inverse(r.transform),s),c=r.isClosed,d=(c?a2:kZ)(o,a,r.outline);let f;if(d!==null&&(f=d.sort((v,w)=>T.Dist2(v,o)-T.Dist2(w,o))[0]??(c?void 0:a)),f===void 0)return;const g=Re.applyToPoint(r.transform,f),m=Re.applyToPoint(Re.Inverse(t),g);n.setTo(m),r.didIntersect=!0}function cce(n,e,t){const{arrowheadEnd:r,arrowheadStart:i}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(fce*e.props.scale)))return hE(n,e,t);const o=Kd(n,e,t),a=T.Med(o.start,o.end),c=T.Sub(o.end,o.start),u=T.Len(c)?c.uni():T.From(c),d=T.Add(a,u.per().mul(-s)),f=E0(n,e,"start"),g=E0(n,e,"end"),m=o.start.clone(),v=o.end.clone(),w=d.clone();if(T.Equals(m,v))return{bindings:t,isStraight:!0,start:{handle:m,point:m,arrowhead:e.props.arrowheadStart},end:{handle:v,point:v,arrowhead:e.props.arrowheadEnd},middle:w,isValid:!1,length:0};const S=e.props.bend<0,b=S?Wp:TN,x=Jj(m,v,w),E=T.Angle(x.center,m),M=T.Angle(x.center,v),j=b(E,M);if(x.length===0||x.size===0||!C3(x.length)||!C3(x.size))return hE(n,e,t);const D=m.clone(),H=v.clone(),L=w.clone(),U=n.getShapePageTransform(e);let z=0,Y=0,V=qd*e.props.scale;if(f&&!f.isExact){const ne=Re.applyToPoint(U,D),$=Re.applyToPoint(U,x.center),C=Re.applyToPoint(U,H),R=Re.Inverse(f.transform),Z=Re.applyToPoint(R,ne),J=Re.applyToPoint(R,$),oe=Re.applyToPoint(R,C),{isClosed:ue}=f,fe=ue?BI:V3;let _e,Le=fe(J,x.radius,f.outline);if(Le){const Ne=J.angle(Z),Ze=J.angle(oe),dt=b(Ne,Ze);Le=Le.filter(Xe=>b(Ne,J.angle(Xe))<=dt);const et=dt*.25;Le.sort(ue?(Xe,Kt)=>Math.abs(b(Ne,J.angle(Xe))-et)<Math.abs(b(Ne,J.angle(Kt))-et)?-1:1:(Xe,Kt)=>b(Ne,J.angle(Xe))<b(Ne,J.angle(Kt))?-1:1),_e=Le[0]??(ue?void 0:Z)}else _e=ue?void 0:Z;if(_e&&(D.setTo(n.getPointInShapeSpace(e,Re.applyToPoint(f.transform,_e))),f.didIntersect=!0,i!=="none")){const Ne=ua[e.props.size]/2+("size"in f.shape.props?ua[f.shape.props.size]/2:0);z=(C0+Ne)*e.props.scale,V+=Ne*e.props.scale}}if(g&&!g.isExact){const ne=Re.applyToPoint(U,D),$=Re.applyToPoint(U,H),C=Re.applyToPoint(U,x.center),R=Re.Inverse(g.transform),Z=Re.applyToPoint(R,ne),J=Re.applyToPoint(R,C),oe=Re.applyToPoint(R,$),ue=g.isClosed,fe=ue?BI:V3;let _e,Le=fe(J,x.radius,g.outline);if(Le){const Ne=J.angle(Z),Ze=J.angle(oe),dt=b(Ne,Ze),et=dt*.75;Le=Le.filter(Xe=>b(Ne,J.angle(Xe))<=dt),Le.sort(ue?(Xe,Kt)=>Math.abs(b(Ne,J.angle(Xe))-et)<Math.abs(b(Ne,J.angle(Kt))-et)?-1:1:(Xe,Kt)=>b(Ne,J.angle(Xe))<b(Ne,J.angle(Kt))?-1:1),Le[0]?_e=Le[0]:_e=ue?void 0:oe}else _e=ue?void 0:oe;if(_e&&(H.setTo(n.getPointInShapeSpace(e,Re.applyToPoint(g.transform,_e))),g.didIntersect=!0,r!=="none")){const Ne=ua[e.props.size]/2+("size"in g.shape.props?ua[g.shape.props.size]/2:0);Y=(C0+Ne)*e.props.scale,V+=Ne*e.props.scale}}let N=T.Angle(x.center,D),_=T.Angle(x.center,H),k=b(N,_),O=k*x.radius;const W=D.clone(),q=H.clone();if(z!==0&&W.setTo(x.center).add(T.FromAngle(N+k*(z/O*(S?1:-1))).mul(x.radius)),Y!==0&&q.setTo(x.center).add(T.FromAngle(_+k*(Y/O*(S?-1:1))).mul(x.radius)),T.DistMin(W,q,V)&&(z!==0&&Y!==0?(z*=-1.5,Y*=-1.5):z!==0?z*=-2:Y!==0&&(Y*=-2)),z!==0&&D.setTo(x.center).add(T.FromAngle(N+k*(z/O*(S?1:-1))).mul(x.radius)),Y!==0&&H.setTo(x.center).add(T.FromAngle(_+k*(Y/O*(S?-1:1))).mul(x.radius)),f&&g&&!f.isExact&&!g.isExact){N=T.Angle(x.center,D),_=T.Angle(x.center,H),k=b(N,_),O=k*x.radius;const ne=pP(n,f.shape.id,g.shape.id);ne==="double-bound"&&O<30?(D.setTo(m),H.setTo(v),L.setTo(w)):ne==="safe"&&(f&&!f.didIntersect&&D.setTo(m),(g&&!g.didIntersect||b(E,N)>b(E,_))&&H.setTo(x.center).add(T.FromAngle(N+k*(Math.min(.9,qd*e.props.scale/O)*(S?1:-1))).mul(x.radius)))}lce(x.center,x.radius,D,H,L,j,S),D.equals(H)&&(D.setTo(L.clone().addXY(1,1)),H.setTo(L.clone().subXY(1,1))),m.setTo(D),v.setTo(H),w.setTo(L);const X=Jj(m,v,w);return{bindings:t,isStraight:!1,start:{point:m,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:v,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:w,handleArc:x,bodyArc:X,isValid:X.length!==0&&isFinite(X.center.x)&&isFinite(X.center.y)}}function Jj(n,e,t){const r=ZC(n,e,t)??T.Med(n,e),i=T.Dist(r,n),s=+T.Clockwise(n,t,e),o=((n.y-e.y)**2+(n.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,c=((t.y-n.y)**2+(t.x-n.x)**2)**.5,u=Math.acos((a*a+c*c-o*o)/(2*a*c))*2,d=+(en>u),f=(un-u)*(s?1:-1),g=f*i;return{center:r,radius:i,size:f,length:g,largeArcFlag:d,sweepFlag:s}}function lce(n,e,t,r,i,s,o){const a=T.Angle(n,t),c=T.Angle(n,r);let u=Wp(a,c);if(o||(u=un-u),i.setTo(n).add(T.FromAngle(a+u*(.5*(o?1:-1))).mul(e)),u>s){i.rotWith(n,en);const d=r.clone();r.setTo(t),t.setTo(d)}}const uce=8;function dce(n){return Math.abs(n.props.bend)<uce*n.props.scale}function E0(n,e,t){const r=n.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===t);if(!r)return;const i=n.getShape(r.toId);if(!i)return;const s=n.getShapePageTransform(i),o=n.getShapeGeometry(i),a=o instanceof to?o.children[0].vertices:o.vertices;return{shape:i,transform:s,isClosed:o.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function eD(n,e,t,r){const i=n.getShape(t.toId);if(i){const{point:s,size:o}=n.getShapeGeometry(i).bounds,a=T.Add(s,T.MulV(t.props.isPrecise||r?t.props.normalizedAnchor:{x:.5,y:.5},o)),c=Re.applyToPoint(n.getShapePageTransform(i),a);return Re.applyToPoint(Re.Inverse(e),c)}else return new T(0,0)}function as(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(r=>r.props.terminal==="start"),end:t.find(r=>r.props.terminal==="end")}}const hce=kG("arrow info",(n,e)=>{const t=as(n,e);return dce(e)?hE(n,e,t):cce(n,e,t)});function la(n,e){const t=typeof e=="string"?e:e.id;return hce.get(n,t)}function Kd(n,e,t){var a,c;const r=n.getShapePageTransform(e),i=pP(n,(a=t.start)==null?void 0:a.toId,(c=t.end)==null?void 0:c.toId),s=t.start?eD(n,r,t.start,i==="double-bound"||i==="start-contains-end"):T.From(e.props.start),o=t.end?eD(n,r,t.end,i==="double-bound"||i==="end-contains-start"):T.From(e.props.end);return{start:s,end:o}}function Tf(n,e,t,r){const i=typeof e=="string"?e:e.id,s=typeof t=="string"?t:t.id,o=n.getBindingsFromShape(i,"arrow").filter(c=>c.props.terminal===r.terminal);o.length>1&&n.deleteBindings(o.slice(1));const a=o[0];a?n.updateBinding({...a,toId:s,props:r}):n.createBinding({type:"arrow",fromId:i,toId:s,props:r})}function wy(n,e,t){const r=n.getBindingsFromShape(e,"arrow").filter(i=>i.props.terminal===t);n.deleteBindings(r)}const qd=10,C0=10,fce=10,ua={s:2,m:3.5,l:5,xl:10};function pP(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),i=n.getShapePageBounds(t);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}class vy extends fy{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&Db(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&Db(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){Db(this.editor,e)}onAfterChangeToShape({binding:e}){yU(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&P0({editor:this.editor,arrow:t,terminal:e.props.terminal})}}G(vy,"type","arrow"),G(vy,"props",XL),G(vy,"migrations",ZL);function yU(n,e){var S;const t=n.getShape(e);if(!t)return;const r=as(n,t),{start:i,end:s}=r,o=i?n.getShape(i.toId):void 0,a=s?n.getShape(s.toId):void 0,c=n.getAncestorPageId(t);if(!c)return;let u;if(o&&a)u=n.findCommonAncestor([o,a])??c;else if(o||a){const b=(S=o||a)==null?void 0:S.parentId;b&&b===t.parentId?u=t.parentId:u=c}else return;u&&u!==t.parentId&&n.reparentShapes([e],u);const d=n.getShape(e);if(!d)throw Error("no reparented arrow");const f=n.getShapeNearestSibling(d,o),g=n.getShapeNearestSibling(d,a);let m;if(f&&g)m=f.index>g.index?f:g;else if(f&&!g)m=f;else if(g&&!f)m=g;else return;let v;const w=n.getSortedChildIdsForParent(m.parentId).map(b=>n.getShape(b)).filter(b=>b.index>m.index);if(w.length){const b=w.find(x=>x.type!=="arrow");if(d.index>m.index&&(!b||d.index<b.index))return;v=fp(m.index,w[0].index)}else v=aa(m.index);v!==d.index&&n.updateShapes([{id:e,type:"arrow",index:v}])}function Db(n,e){const t=as(n,e);for(const r of["start","end"]){const i=t[r];if(!i)continue;const s=n.getShape(i.toId),o=n.getAncestorPageId(e)===n.getAncestorPageId(s);(!s||!o)&&P0({editor:n,arrow:e,terminal:r,unbind:!0})}yU(n,e.id)}function P0({editor:n,arrow:e,terminal:t,unbind:r=!1,useHandle:i=!1}){const s=la(n,e);if(!s)throw new Error("expected arrow info");const o=i?s.start.handle:s.start.point,a=i?s.end.handle:s.end.point,c=t==="start"?o:a,u={id:e.id,type:"arrow",props:{[t]:{x:c.x,y:c.y},bend:e.props.bend}};if(!s.isStraight){const d=t==="start"?o:s.start.handle,f=t==="end"?a:s.end.handle,g=T.Med(d,f),m=T.Sub(d,f).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),v=Yp(s.handleArc.center,T.Add(g,m),s.handleArc.center,s.handleArc.radius);bt((v==null?void 0:v.length)===1);const w=T.Dist(g,v[0])*Math.sign(e.props.bend);dl(w,u.props.bend)||(u.props.bend=w)}n.updateShape(u),r&&wy(n,e,t)}const wU=[vy],Pi={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Ci={s:2,m:3.5,l:5,xl:10},dh={s:18,m:24,l:36,xl:44},cc={s:18,m:22,l:26,xl:32},pce={s:18,m:20,l:24,xl:28},hc={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},gce=20,M0=4.25,Vs=16;function mce(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Gd="  ",Oi=class Oi{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,i=r.activeElement;i!==e&&e.focus(),r.execCommand("insertText",!1,t)||Oi.insertTextFirefox(e,t),i===r.body?e.blur():i instanceof HTMLElement&&i!==e&&i.focus()}static set(e,t){e.select(),Oi.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:i,selectionEnd:s}=e,o=Oi.getSelection(e);Oi.insert(e,t+o+(r??t)),e.selectionStart=(i||0)+t.length,e.selectionEnd=(s||0)+t.length}static replace(e,t,r){let i=0;e.value.replace(t,(...s)=>{const o=i+s[s.length-2],a=s[0].length;e.selectionStart=o,e.selectionEnd=o+a;const c=typeof r=="string"?r:r(...s);return Oi.insert(e,c),e.selectionStart=o,i+=c.length-a,c})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.slice(t,r),o=(a=/\n/g.exec(s))==null?void 0:a.length;if(o&&o>0){const c=i.lastIndexOf(`
`,t-1)+1,u=e.value.slice(c,r-1),d=u.replace(/^|\n/g,`$&${Gd}`),f=d.length-u.length;e.setSelectionRange(c,r-1),Oi.insert(e,d),e.setSelectionRange(t+1,r+f)}else Oi.insert(e,Gd)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:i}=e,s=i.lastIndexOf(`
`,t-1)+1,o=Oi.findLineEnd(i,r),a=e.value.slice(s,o),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=a.length-c.length;e.setSelectionRange(s,o),Oi.insert(e,c);const d=/\t| {1,2}/.exec(i.slice(s,t)),f=d?d[0].length:0,g=t-f;e.setSelectionRange(t-f,Math.max(g,r-u))}static indentCE(e){var c;const t=window.getSelection(),r=e.innerText,i=$m(e)??0,s=$m(e)??0,o=r.slice(i,s),a=(c=/\n/g.exec(o))==null?void 0:c.length;if(a&&a>0){const u=r.lastIndexOf(`
`,i-1)+1,d=r.slice(u,s-1),g=d.replace(/^|\n/g,`$&${Gd}`).length-d.length;t&&t.setBaseAndExtent(e,i+1,e,s+g)}else{const u=window.getSelection();e.innerText=r.slice(0,i)+Gd+r.slice(i),u==null||u.setBaseAndExtent(e,i+1,e,i+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,i=$m(e)??0,s=$m(e)??0,o=r.lastIndexOf(`
`,i-1)+1,a=Oi.findLineEnd(r,s),c=r.slice(o,a),u=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),d=c.length-u.length;if(t){t.setBaseAndExtent(e,o,e,a);const f=/\t| {1,2}/.exec(r.slice(o,i)),g=f?f[0].length:0,m=i-g;t.setBaseAndExtent(e,i-g,e,Math.max(m,s-d))}}static normalizeText(e){return e.replace(Oi.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Oi.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};G(Oi,"fixNewLines",/\r?\n|\r/g);let hh=Oi;function $m(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(n),i.setEnd(r.endContainer,r.endOffset),t=i.toString().length}return t}const yce=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function vU(n){return yce.test(n)}function wce(n){return n.replace(/\t/g,Gd)}function vce(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const i=r.length-r.trimStart().length;t=Math.min(t,i)}return e.map(r=>r.slice(t)).join(`
`)}const SU={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"","&#8212;":"","&#8216;":"","&#8217;":"","&#8220;":"","&#8221;":"","&#8230;":""},Sce=new RegExp(Object.keys(SU).join("|"),"g");function xce(n){return n.replace(Sce,e=>SU[e])}function bce(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function _ce(n){return bce(vce(wce(n)))}function Ice(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i},{toasts:s,msg:o}){n.registerExternalAssetHandler("file",async({file:a,assetId:c})=>{const u=r.includes(a.type),d=i.includes(a.type);!u&&!d&&s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),bt(u||d,`File type not allowed: ${a.type}`),a.size>t&&s.addToast({title:o("assets.files.size-too-big"),severity:"error"}),bt(a.size<=t,`File size too big: ${(a.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);const f=Dk(await a.arrayBuffer());c=c??tl.createId(f);const g=await tD(a,c,u,d);if(isFinite(e)){const m={w:g.props.w,h:g.props.h},v=mce(m,{w:e,h:e});m!==v&&Ps.isStaticImageType(a.type)&&(g.props.w=v.w,g.props.h=v.h)}return g.props.src=await n.uploadAsset(g,a),tl.create(g)}),n.registerExternalAssetHandler("url",async({url:a})=>{var u,d,f,g,m;let c;try{const w=await(await fa(a,{method:"GET",mode:"no-cors"})).text(),S=new DOMParser().parseFromString(w,"text/html");c={image:((u=S.head.querySelector('meta[property="og:image"]'))==null?void 0:u.getAttribute("content"))??"",favicon:((d=S.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:d.getAttribute("href"))??((f=S.head.querySelector('link[rel="icon"]'))==null?void 0:f.getAttribute("href"))??"",title:((g=S.head.querySelector('meta[property="og:title"]'))==null?void 0:g.getAttribute("content"))??a,description:((m=S.head.querySelector('meta[property="og:description"]'))==null?void 0:m.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,a).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,a).href)}catch(v){console.error(v),s.addToast({title:o("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:tl.createId(bI(a)),typeName:"asset",type:"bookmark",props:{src:a,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:a,text:c})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!d)throw new Error("No <svg/> element present");let f=parseFloat(d.getAttribute("width")||"0"),g=parseFloat(d.getAttribute("height")||"0");if(!(f&&g)){document.body.appendChild(d);const v=d.getBoundingClientRect();document.body.removeChild(d),f=v.width,g=v.height}const m=await n.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!m)throw Error("Could not create an asset");nD(n,[m],u)}),n.registerExternalContentHandler("embed",({point:a,url:c,embed:u})=>{const d=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:f,height:g}=u,m=wn(),v={id:m,type:"embed",x:d.x-(f||450)/2,y:d.y-(g||450)/2,props:{w:f,h:g,url:c}};n.createShapes([v]).select(m)}),n.registerExternalContentHandler("files",async({point:a,files:c})=>{if(c.length>n.options.maxFilesAtOnce)throw Error("Too many files");const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=new T(u.x,u.y),f=[],g=[];for(const m of c){if(m.size>t){s.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(m.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);continue}if(!m.type){s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!r.concat(i).includes(m.type)){s.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${m.name} not loaded - Mime type not allowed ${m.type}.`);continue}const v=r.includes(m.type),w=i.includes(m.type),S=Dk(await m.arrayBuffer()),b=tl.createId(S),x=await tD(m,b,v,w);let E;v&&(E=n.createTemporaryAssetPreview(b,m)),f.push(x),g.push({asset:x,file:m,temporaryAssetPreview:E})}Promise.allSettled(g.map(async m=>{try{const v=await n.getAssetForExternalContent({type:"file",file:m.file});if(!v)throw Error("Could not create an asset");n.updateAssets([{...v,id:m.asset.id}])}catch(v){s.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(v);return}})),nD(n,f,d)}),n.registerExternalContentHandler("text",async({point:a,text:c})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),d=n.getShapeUtil("text").getDefaultProps(),f=_ce(c),g=n.getOnlySelectedShape();if(g&&"text"in g.props){n.updateShapes([{id:g.id,type:g.type,props:{text:f}}]);return}let m,v,w,S="middle";const b=f.split(`
`).length>1,x=vU(f);b&&(S=b?x?"end":"start":"middle");const E=n.textMeasure.measureText(f,{...Pi,fontFamily:hc[d.font],fontSize:dh[d.size],maxWidth:null}),M=Math.min(b?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(E.w>M){const j=n.textMeasure.measureText(f,{...Pi,fontFamily:hc[d.font],fontSize:dh[d.size],maxWidth:M});m=j.w,v=j.h,w=!1,S=x?"end":"start"}else m=E.w,v=E.h,w=!0;u.y-v/2<n.getViewportPageBounds().minY+40&&(u.y=n.getViewportPageBounds().minY+40+v/2),n.createShapes([{id:wn(),type:"text",x:u.x-m/2,y:u.y-v/2,props:{text:f,textAlign:S,autoSize:w,w:m}}])}),n.registerExternalContentHandler("url",async({point:a,url:c})=>{const u=n.getShapeUtil("embed"),d=u==null?void 0:u.getEmbedDefinition(c);if(d)return n.putExternalContent({type:"embed",url:d.url,point:a,embed:d.definition});const f=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),g=tl.createId(bI(c)),m=Ece(n,c,f);let v=n.getAsset(g),w=!1;if(!v){w=!0;try{const S=await n.getAssetForExternalContent({type:"url",url:c});if(!S)throw Error("Could not create an asset");v=S}catch{s.addToast({title:o("assets.url.failed"),severity:"error"});return}}n.run(()=>{w&&n.createAssets([v]),n.updateShapes([{id:m.id,type:m.type,props:{assetId:v.id}}])})})}async function tD(n,e,t,r){let i=n.type;n.type==="video/quicktime"&&(i="video/mp4");const s=t?await Ps.getImageSize(n):await Ps.getVideoSize(n),o=await Ps.isAnimated(n)||r;return{id:e,type:t?"image":"video",typeName:"asset",props:{name:n.name,src:"",w:s.w,h:s.h,fileSize:n.size,mimeType:i,isAnimated:o},meta:{}}}async function nD(n,e,t){if(!e.length)return[];const r=T.From(t),i=[];for(let s=0;s<e.length;s++){const o=e[s];switch(o.type){case"image":{i.push({id:wn(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":i.push({id:wn(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}}return n.run(()=>{const s=e.filter(o=>!n.getAsset(o.id));s.length&&n.createAssets(s),n.createShapes(i).select(...i.map(o=>o.id)),xU(n,t)}),i.map(s=>s.id)}function xU(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const i=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(s=>{const o=n.getShapeParentTransform(s).decompose().rotation,a=T.Rot(i,-o);return{id:s.id,type:s.type,x:s.x-a.x,y:s.y-a.y}}))}if(r=n.getSelectionPageBounds(),r&&n.getInstanceState().isGridMode){const i=n.getDocumentSettings().gridSize,s=new T(r.minX,r.minY),o=s.clone().snapToGrid(i),a=T.Sub(s,o);n.updateShapes(n.getSelectedShapes().map(c=>{const u={x:c.x-a.x,y:c.y-a.y};return{id:c.id,type:c.type,x:u.x,y:u.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})}function Ece(n,e,t){const r={id:wn(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([r]).select(r.id),xU(n,t)}),n.getShape(r.id)}var rI;let Cce=(rI=class extends Ye{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}},G(rI,"id","idle"),rI);var iI;let Pce=(iI=class extends Ye{constructor(){super(...arguments);G(this,"shape");G(this,"markId","");G(this,"preciseTimeout",-1);G(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var f;const{originPagePoint:t}=this.editor.inputs,r=wn();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`);const i=jo(t,this.editor);this.editor.createShape({id:r,type:"arrow",x:i.x,y:i.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(r);if(!s)throw Error("expected shape");const o=this.editor.getShapeHandles(s);if(!o)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),c=this.shape,u=o.find(g=>g.id==="start"),d=(f=a.onHandleDrag)==null?void 0:f.call(a,s,{handle:{...u,x:0,y:0},isPrecise:!0,initial:c});d&&this.editor.updateShapes([d]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var i,s;const t=this.shape;if(!t)throw Error("expected shape");const r=this.editor.getShapeHandles(t);if(!r)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=r.find(d=>d.id==="start"),u=(i=o.onHandleDrag)==null?void 0:i.call(o,t,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:a});u&&this.editor.updateShapes([u])}{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),u=r.find(f=>f.id==="end"),d=(s=o.onHandleDrag)==null?void 0:s.call(o,this.editor.getShape(t),{handle:{...u,x:c.x,y:c.y},isPrecise:!1,initial:a});d&&this.editor.updateShapes([d])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},G(iI,"id","pointing"),iI);class fE extends Ye{constructor(){super(...arguments);G(this,"shapeType","arrow")}static children(){return[Cce,Pce]}}G(fE,"id","arrow"),G(fE,"initial","idle");class gP extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"initialShape");G(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");G(this,"util",this.editor.getShapeUtil(this.shapeType));G(this,"isPen",!1);G(this,"isPenOrStylus",!1);G(this,"segmentMode","free");G(this,"didJustShiftClickToExtendPreviousShapeLine",!1);G(this,"pagePointWhereCurrentSegmentChanged",{});G(this,"pagePointWhereNextSegmentChanged",null);G(this,"lastRecordedPoint",{});G(this,"mergeNextPoint",!1);G(this,"currentLineLength",0);G(this,"markId",null)}onEnter(t){this.markId=null,this.info=t,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:t}=this.editor;if(this.isPen&&!t.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?T.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(t){if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(t){if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r,i){if(!this.canClose())return!1;const s=Ci[r],o=t[0].points[0],a=t[t.length-1],c=a.points[a.points.length-1];return o!==c&&this.currentLineLength>s*4*i&&T.DistMin(o,c,s*2*i)}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:i=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||i>0&&i<.5||i>.5&&i<1;const s=this.isPenOrStylus?i*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=Gr(a.props.segments);if(!c)throw Error("Expected a previous segment!");const u=Gr(c.points);if(!u)throw Error("Expected a previous point!");const{x:d,y:f}=this.editor.getPointInShapeSpace(a,t).toFixed(),g={type:this.segmentMode,points:[{x:u.x,y:u.y,z:+s.toFixed(2)},{x:d,y:f,z:+s.toFixed(2)}]},m=Re.applyToPoint(this.editor.getShapePageTransform(a.id),u);this.pagePointWhereCurrentSegmentChanged=m,this.pagePointWhereNextSegmentChanged=null;const v=[...a.props.segments,g];this.currentLineLength<Ci[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const w={id:a.id,type:this.shapeType,props:{segments:v}};this.canClose()&&(w.props.isClosed=this.getIsClosed(v,a.props.size,a.props.scale)),this.editor.updateShapes([w]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=wn();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:t}=this,{inputs:r}=this.editor;if(!t)return;const{id:i,props:{size:s,scale:o}}=t,a=this.editor.getShape(i);if(!a)return;const{segments:c}=a.props,{x:u,y:d,z:f}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),g=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,m={x:u,y:d,z:g};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(T.Dist2(v,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const S=Gr(c);if(!S)throw Error("Expected a previous segment!");const b=Gr(S.points);if(!b)throw Error("Expected a previous last point!");let x;const E=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(S.type==="straight"){this.currentLineLength+=T.Dist(b,E),x={type:"straight",points:[{...b},E]};const j=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=Re.applyToPoint(j,b)}else x={type:"straight",points:[E,m]};const M={id:i,type:this.shapeType,props:{segments:[...c,x]}};this.canClose()&&(M.props.isClosed=this.getIsClosed(c,s,o)),this.editor.updateShapes([M])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(T.Dist2(v,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const S=c.slice(),b=S[S.length-1],x=Gr(b.points);if(!x)throw Error("No previous point!");const E={type:"free",points:[...T.PointsBetween(x,m,6).map(D=>({x:Ya(D.x),y:Ya(D.y),z:Ya(D.z)}))]},M=[...S,E];this.currentLineLength<Ci[a.props.size]*4&&(this.currentLineLength=this.getLineLength(M));const j={id:i,type:this.shapeType,props:{segments:M}};this.canClose()&&(j.props.isClosed=this.getIsClosed(M,s,o)),this.editor.updateShapes([j])}break}case"straight":{const v=c.slice(),w=v[v.length-1],{pagePointWhereCurrentSegmentChanged:S}=this,{ctrlKey:b,currentPagePoint:x}=this.editor.inputs;if(!S)throw Error("We should have a point where the segment changed");let E,M=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(M=!b,this.didJustShiftClickToExtendPreviousShapeLine=!1):M=!b;let j=this.editor.getPointInShapeSpace(a,x).toFixed().toJson(),D=!1,H;if((this.editor.user.getIsSnapMode()?!b:b)&&v.length>2){let z,Y=8/this.editor.getZoomLevel();for(let V=0,N=c.length-2;V<N;V++){const _=c[V];if(!_)break;if(_.type==="free")continue;const k=_.points[0],O=Gr(_.points);if(!(k&&O))continue;const W=T.NearestPointOnLineSegment(k,O,j);if(T.DistMin(W,j,Y)){z=W.toFixed().toJson(),Y=T.Dist(W,j),H=_;break}}z&&(D=!0,j=z)}if(D&&H){const z=this.editor.getShapePageTransform(a),Y=H.points[0],V=Gr(H.points);if(!V)throw Error("Expected a last point!");const N=Re.applyToPoint(z,Y),_=Re.applyToPoint(z,V),k=Re.applyToPoint(z,j);this.editor.snaps.setIndicators([{id:Jt(),type:"points",points:[N,k,_]}])}else{if(this.editor.snaps.clearIndicators(),M){const z=T.Angle(S,x),V=h0(z,24)-z;E=T.RotWith(x,S,V)}else E=x;j=this.editor.getPointInShapeSpace(a,E).toFixed().toJson()}this.currentLineLength+=T.Dist(w.points[0],j),v[v.length-1]={...w,type:"straight",points:[w.points[0],j]};const U={id:i,type:this.shapeType,props:{segments:v}};this.canClose()&&(U.props.isClosed=this.getIsClosed(c,s,o)),this.editor.updateShapes([U]);break}case"free":{const v=c.slice(),w=v[v.length-1],S=[...w.points];if(S.length&&this.mergeNextPoint){const{z:x}=S[S.length-1];S[S.length-1]={x:m.x,y:m.y,z:x?Math.max(x,m.z):m.z}}else this.currentLineLength+=T.Dist(S[S.length-1],m),S.push(m);v[v.length-1]={...w,points:S},this.currentLineLength<Ci[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const b={id:i,type:this.shapeType,props:{segments:v}};if(this.canClose()&&(b.props.isClosed=this.getIsClosed(v,s,o)),this.editor.updateShapes([b]),S.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:i,type:this.shapeType,props:{isComplete:!0}}]);const x=wn(),E=this.editor.getShape(i).props;this.editor.createShapes([{id:x,type:this.shapeType,x:Ya(r.currentPagePoint.x),y:Ya(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:E.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(f*1.25).toFixed():.5}]}]}}]),this.initialShape=Un(this.editor.getShape(x)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const i of t)for(let s=0;s<i.points.length-1;s++){const o=i.points[s],a=i.points[s+1];r+=T.Dist2(a,o)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}G(gP,"id","drawing");var sI;let bU=(sI=class extends Ye{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},G(sI,"id","idle"),sI);class Sy extends Ye{constructor(){super(...arguments);G(this,"shapeType","draw")}static children(){return[bU,gP]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}G(Sy,"id","draw"),G(Sy,"initial","idle"),G(Sy,"isLockable",!1);class pE extends YI{constructor(){super(...arguments);G(this,"shapeType","frame")}onCreate(t){if(!t)return;const r=this.editor.getShapePageBounds(t),i=[],s=this.editor.getShapeAncestors(t).map(o=>o.id);this.editor.getSortedChildIdsForParent(t.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===t.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&r.contains(c)&&Mce(a,s,t)&&i.push(a.id)}),this.editor.reparentShapes(i,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}G(pE,"id","frame"),G(pE,"initial","idle");function Mce(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var oI;let Tce=(oI=class extends Ye{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},G(oI,"id","idle"),oI);var aI;let kce=(aI=class extends Ye{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=wn(),i=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),s=jo(t,this.editor);this.editor.createShapes([{id:r,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Co),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=wn();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,i=this.editor.getStyleForNextShape(Co),s=i==="star"?{w:200,h:190}:i==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Co),scale:r,...s}}]);const o=this.editor.getShape(t);if(!o)return;const{w:a,h:c}=o.props,u=new T(a/2,c/2).mul(r),d=this.editor.getShapeParentTransform(o);d&&u.rot(-d.rotation());const f=jo(new T(o.x-u.x,o.y-u.y),this.editor);this.editor.select(t),this.editor.updateShape({id:o.id,type:"geo",x:f.x,y:f.y,props:{geo:this.editor.getStyleForNextShape(Co),w:a*r,h:c*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},G(aI,"id","pointing"),aI);class gE extends Ye{constructor(){super(...arguments);G(this,"shapeType","geo")}static children(){return[Tce,kce]}}G(gE,"id","geo"),G(gE,"initial","idle");class xy extends Ye{constructor(){super(...arguments);G(this,"shapeType","highlight")}static children(){return[bU,gP]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}G(xy,"id","highlight"),G(xy,"initial","idle"),G(xy,"isLockable",!1);var cI;let Ace=(cI=class extends Ye{constructor(){super(...arguments);G(this,"shapeId","")}onEnter(t){this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},G(cI,"id","idle"),cI);const rD=2;var lI;let Rce=(lI=class extends Ye{constructor(){super(...arguments);G(this,"shape",{});G(this,"markId")}onEnter(t){const{inputs:r}=this.editor,{currentPagePoint:i}=r;this.markId=void 0;const s=t.shapeId&&this.editor.getShape(t.shapeId);if(s&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s.id}`),this.shape=s;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(v=>v.type==="vertex").sort(_i),c=a[a.length-1],u=a[a.length-2],d=Re.applyToPoint(this.editor.getShapeParentTransform(this.shape),new T(this.shape.x,this.shape.y)),f=T.Sub(i,d).addXY(.1,.1),g=jo(f,this.editor),m=Un(this.shape.props.points);if(T.DistMin(c,u,rD)||T.DistMin(g,c,rD))m[c.id]={id:c.id,index:c.index,x:g.x,y:g.y};else{const v=aa(c.index);m[v]={id:v,index:v,x:g.x,y:g.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:m}}])}else{const o=wn();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${o}`);const a=jo(i,this.editor);this.editor.createShapes([{id:o,type:"line",x:a.x,y:a.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Gr(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},G(lI,"id","pointing"),lI);class mE extends Ye{constructor(){super(...arguments);G(this,"shapeType","line")}static children(){return[Ace,Rce]}}G(mE,"id","line"),G(mE,"initial","idle");var uI;let jce=(uI=class extends Ye{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},G(uI,"id","idle"),uI);const Dce=0,yn=200,Hw=new T(yn/2,yn/2),_U=10,Oce=n=>[[["a1"],new T(yn*.5,yn*-.5-n.options.adjacentShapeMargin)],[["a2"],new T(yn*1.5+n.options.adjacentShapeMargin,yn*.5)],[["a3"],new T(yn*.5,yn*1.5+n.options.adjacentShapeMargin)],[["a4"],new T(yn*-.5-n.options.adjacentShapeMargin,yn*.5)]];function Lce(n,e){if(e===1)return Oce(n);const t=yn*e,r=n.options.adjacentShapeMargin*e;return[[["a1"],new T(t*.5,t*-.5-r)],[["a2"],new T(t*1.5+r,t*.5)],[["a3"],new T(t*.5,t*1.5+r)],[["a4"],new T(t*-.5-r,t*.5)]]}function IU(n,e,t,r,i,s){return Object.fromEntries(Lce(n,s).map(([o,a],c)=>{const u=a.clone();return c===0&&i?u.y-=i:c===2&&r&&(u.y+=r),[o,u.rot(t).add(e)]}))}function EU(n,e,t,r){const i=new Set(n.getSelectedShapeIds()),s=(yn+n.options.adjacentShapeMargin+r)**2,o=new Map,a=[];for(const d of n.getCurrentPageShapes()){if(!n.isShapeOfType(d,"note")||t!==d.props.scale||i.has(d.id))continue;const f=n.getShapePageTransform(d.id);e===f.rotation()&&(o.set(d,n.getShapePageBounds(d).center),a.push(...Object.values(IU(n,f.point(),e,d.props.growY,r,t))))}const c=a.length;let u;for(const[d,f]of o)for(let g=0;g<c;g++)u=a[g],u&&(T.Dist2(f,u)>s||n.isPointInShape(d,u)&&(a[g]=void 0));return St(a)}function CU(n,e,t,r,i=!1){let s;const o=n.getCurrentPageShapesSorted(),a=(yn+n.options.adjacentShapeMargin**2)**e.props.scale;for(let c=o.length-1;c>=0;c--){const u=o[c];if(u.type==="note"&&u.id!==e.id){const d=n.getShapePageBounds(u);if(d&&T.Dist2(d.center,t)<a&&n.isPointInShape(u,t)){s=u;break}}}if(n.complete(),!s||i){n.markHistoryStoppingPoint("creating note shape");const c=wn();n.createShape({id:c,type:"note",x:t.x,y:t.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const u=n.getShape(c);if(!u)return;const d=n.getPointInParentSpace(u,T.Sub(t,T.Rot(Hw.clone().mul(u.props.scale),r)));n.updateShape({id:c,type:"note",x:d.x,y:d.y}),s=n.getShape(c)}return Bce(n),s}const Nce=16;function Bce(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const r=e.clone().expandBy(Nce/n.getZoomLevel()).expand(t),i=t.clone().translate({x:(r.center.x-t.center.x)*2,y:(r.center.y-t.center.y)*2});n.zoomToBounds(i,{animation:{duration:n.options.animationMediumMs},inset:0})}}var dI;let Fce=(dI=class extends Ye{constructor(){super(...arguments);G(this,"dragged",!1);G(this,"info",{});G(this,"markId","");G(this,"shape",{})}onEnter(){const{editor:t}=this,r=wn();this.markId=t.markHistoryStoppingPoint(`creating_note:${r}`);const i=this.editor.inputs.originPagePoint.clone(),s=zce(this.editor,i,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&i.sub(s),this.shape=Uce(this.editor,r,i)}onPointerMove(t){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},G(dI,"id","pointing"),dI);function zce(n,e,t){let r=_U/n.getZoomLevel(),i;for(const s of EU(n,0,t,0)){const o=T.Sub(e,s),a=o.len();a<r&&(r=a,i=o)}return i}function Uce(n,e,t){const r=jo(t,n);n.createShape({id:e,type:"note",x:r.x,y:r.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const i=n.getShape(e),s=n.getShapeGeometry(i).bounds;return n.updateShapes([{id:e,type:"note",x:i.x-s.width/2,y:i.y-s.height/2}]),n.getShape(e)}class yE extends Ye{constructor(){super(...arguments);G(this,"shapeType","note")}static children(){return[jce,Fce]}}G(yE,"id","note"),G(yE,"initial","idle");function $ce(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}const tc=R4($ce,32);var hI;let Hce=(hI=class extends Ye{onPointerMove(e){switch(e.target){case"shape":case"canvas":tc(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){tc.cancel()}onKeyDown(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},G(hI,"id","idle"),hI);var fI;let Wce=(fI=class extends Ye{constructor(){super(...arguments);G(this,"shape");G(this,"markId","");G(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(t){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:i}=r.inputs;if(!i)return;const{originPagePoint:s,currentPagePoint:o}=r.inputs,a=Math.abs(s.x-o.x),u=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(a>u){const d=wn();this.markId=r.markHistoryStoppingPoint(`creating_text:${d}`);const f=this.createTextShape(d,s,!1,a);if(!f){this.cancel();return}this.shape=r.getShape(f),r.select(d),r.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(f.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const t=wn(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(t,r,!0,20)&&(this.editor.select(t),this.editor.setEditingShape(t))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,r,i,s){this.editor.createShape({id:t,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:i,w:s,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(t);if(!o){this.cancel();return}const a=this.editor.getShapePageBounds(o),c=new T;if(i)switch(o.props.textAlign){case"start":{c.x=0;break}case"middle":{c.x=-a.width/2;break}case"end":{c.x=-a.width;break}}else c.x=0;if(c.y=-a.height/2,is(o.parentId)){const f=this.editor.getShapeParentTransform(o);c.rot(-f.rotation())}const u=o.x+c.x,d=o.y+c.y;if(this.editor.getInstanceState().isGridMode){const f=new T(u,d),g=jo(f,this.editor),m=T.Sub(f,g);this.editor.updateShape({...o,x:u-m.x,y:d-m.y})}else this.editor.updateShape({...o,x:u,y:d});return o}},G(fI,"id","pointing"),fI);class wE extends Ye{constructor(){super(...arguments);G(this,"shapeType","text")}static children(){return[Hce,Wce]}}G(wE,"id","text"),G(wE,"initial","idle");const Kce=[wE,Sy,gE,yE,mE,pE,fE,xy];function io(){return wc({isDarkMode:eg()})}function Ww(n){return{key:`${pa.id}:${n}`,async getElement(){const e=qce(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const i=await(await fa(t)).blob(),s=await Io.blobToDataUrl(i),o=r.replace(t,s);return p.jsx("style",{children:o})}}}function qce(n){const e=qL[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function mP(n){return{key:`${pa.id}:${n}`,async getElement(){return n!=="pattern"?null:p.jsx(Gce,{})}}}function Gce(){const n=wP(),e=Mh(),t=io(),r=8/12;return p.jsxs(p.Fragment,{children:[p.jsxs("mask",{id:e,children:[p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),p.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[p.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),p.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),p.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),p.jsx("pattern",{id:n(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function yP(){return{key:`${pa.id}:pattern`,component:Zce}}const qf=8,iD=(n,e,t)=>new Promise((r,i)=>{const s=qf*e*n,o=document.createElement("canvas");o.width=s,o.height=s;const a=o.getContext("2d");if(!a)return;a.fillStyle=t?o0.darkMode.solid:o0.lightMode.solid,a.fillRect(0,0,s,s),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const c=8/12,u=d=>d*e*n;a.beginPath(),a.moveTo(u(c*1),u(c*3)),a.lineTo(u(c*3),u(c*1)),a.moveTo(u(c*5),u(c*7)),a.lineTo(u(c*7),u(c*5)),a.moveTo(u(c*9),u(c*11)),a.lineTo(u(c*11),u(c*9)),a.stroke(),o.toBlob(d=>{!d||mr.throwToBlob.get()?i():r(d)})}),sD=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""};let Ob=null;function Vce(){return Ob||(Ob={white:sD([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:sD([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),Ob}function PU(n){return Math.ceil(Math.log2(Math.max(1,n)))}function wP(){const n=ko("hash_pattern");return P.useCallback((e,t)=>{const r=PU(e);return VC(n,`${t}_${r}`)},[n])}function MU(n){const e=[],r=PU(n);for(let i=0;i<=r;i++)e.push(Math.pow(2,i));return e}function Yce(n){const e=Vce();return MU(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function Xce(){const n=me(),e=xe("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=xe("maxZoom",()=>Math.ceil(Gr(n.getCameraOptions().zoomSteps)),[n]),[r,i]=P.useState(!1),[s,o]=P.useState(()=>Yce(t)),a=wP();return P.useEffect(()=>{const u=Promise.all(MU(t).flatMap(f=>[iD(e,f,!1).then(g=>({zoom:f,theme:"light",url:URL.createObjectURL(g)})),iD(e,f,!0).then(g=>({zoom:f,theme:"dark",url:URL.createObjectURL(g)}))]));let d=!1;return u.then(f=>{d||(o(f),i(!0))}),()=>{d=!0,i(!1),u.then(f=>{for(const{url:g}of f)URL.revokeObjectURL(g)})}},[e,t]),{defs:p.jsx(p.Fragment,{children:s.map(u=>{const d=a(u.zoom,u.theme);return p.jsx("pattern",{id:d,width:qf,height:qf,patternUnits:"userSpaceOnUse",children:p.jsx("image",{href:u.url,width:qf,height:qf})},d)})}),isReady:r}}function Zce(){const n=me(),e=P.useRef(null),{defs:t,isReady:r}=Xce();return P.useEffect(()=>{if(r&&_n.isSafari){const i=TU(e.current);i&&n.timers.requestAnimationFrame(()=>{i.style.display="none",n.timers.requestAnimationFrame(()=>{i.style.display=""})})}},[n,r]),p.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:t})}function TU(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?TU(n.parentElement):null}const wi=Ce.memo(function({theme:e,d:t,color:r,fill:i,scale:s}){switch(i){case"none":return null;case"solid":return p.jsx("path",{fill:e[r].semi,d:t});case"semi":return p.jsx("path",{fill:e.solid,d:t});case"fill":return p.jsx("path",{fill:e[r].fill,d:t});case"pattern":return p.jsx(Qce,{theme:e,color:r,fill:i,d:t,scale:s})}});function Qce({d:n,color:e,theme:t}){const r=me(),i=Xp(),s=xe("zoomLevel",()=>r.getZoomLevel(),[r]),o=wP(),a=r.getZoomLevel()<=.18;return p.jsxs(p.Fragment,{children:[p.jsx("path",{fill:t[e].pattern,d:n}),p.jsx("path",{fill:i?`url(#${o(1,t.id)})`:a?t[e].semi:`url(#${o(s,t.id)})`,d:n})]})}function Jce(n){return n.replace(/\s/g,"")}function vE(n,e,t){const{padding:r=0}=t;if(e.length===0)return null;const i=De.From(e[0].box);for(const{box:u}of e)i.union(u);const s=r+(t.offsetX??0),o=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-i.height:(Math.ceil(t.height)-i.height)/2);let a=null;const c=[];for(const{text:u,box:d}of e)a!==null&&d.y>a&&c.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:d.y+o,children:`
`},c.length)),c.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:d.x+s,y:d.y+o,unicodeBidi:"plaintext",children:Jce(u)},c.length)),a=d.y;return p.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:c})}function ele(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const i=De.From(t[0].box);for(const{box:s}of t)i.union(s);if(n==="start-legacy")return(r-2*e-i.width)/2;if(n==="end-legacy")return-(r-2*e-i.width)/2}}function tle(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Kw({fontSize:n,font:e,align:t,verticalAlign:r,text:i,labelColor:s,bounds:o,padding:a=16,stroke:c=!0}){const u=me(),d=io(),f={fontSize:n,fontFamily:qL[e],textAlign:t,verticalTextAlign:r,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:Pi.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},g=u.textMeasure.measureTextSpans(i,f),m=ele(t,a,g,o.width);m&&(f.offsetX=m),f.offsetX+=o.x,f.offsetY+=o.y;const v=vE(u,g,f);let w=null;return c&&(f.fill=d.background,f.stroke=d.background,f.strokeWidth=2,w=vE(u,g,f)),p.jsxs(p.Fragment,{children:[w,v]})}const nle=P.forwardRef(function({isEditing:e,text:t,handleFocus:r,handleChange:i,handleKeyDown:s,handleBlur:o,handleInputPointerDown:a,handleDoubleClick:c},u){return p.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:r,onChange:i,onKeyDown:s,onBlur:o,onTouchEnd:Sr,onContextMenu:e?Sr:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:kt})});function rle(n,e,t){const r=me(),i=P.useRef(null),s=xe("isEditing",()=>r.getEditingShapeId()===n,[r]),o=xe("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);P.useEffect(()=>{function d(f){var g;f.shapeId===n&&((g=i.current)==null||g.select())}return r.on("select-all-text",d),()=>{r.off("select-all-text",d)}},[r,n,s]),P.useEffect(()=>{var d,f,g,m;s&&(document.activeElement!==i.current&&((d=i.current)==null||d.focus()),r.getInstanceState().isCoarsePointer&&((f=i.current)==null||f.select()),_n.isSafari&&((g=i.current)==null||g.blur(),(m=i.current)==null||m.focus()))},[r,s]);const a=P.useCallback(d=>{if(r.getEditingShapeId()===n)switch(d.key){case"Enter":{(d.ctrlKey||d.metaKey)&&r.complete();break}}},[r,n]),c=P.useCallback(d=>{if(r.getEditingShapeId()!==n)return;let f=hh.normalizeText(d.currentTarget.value);const g=f.replace(/\t/g,Gd);if(g!==f){const m=d.currentTarget.selectionStart;d.currentTarget.value=g,d.currentTarget.selectionStart=m+(g.length-f.length),d.currentTarget.selectionEnd=m+(g.length-f.length),f=g}r.updateShape({id:n,type:e,props:{text:f}})},[r,n,e]),u=P.useCallback(d=>{r.dispatch({...Ms(d),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),Sr(d)},[r,n]);return{rInput:i,handleFocus:dp,handleBlur:dp,handleKeyDown:a,handleChange:c,handleInputPointerDown:u,handleDoubleClick:Sr,isEmpty:t.trim().length===0,isEditing:s,isEditingAnything:o}}const qw=Ce.memo(function({shapeId:e,type:t,text:r,labelColor:i,font:s,fontSize:o,lineHeight:a,align:c,verticalAlign:u,wrap:d,isSelected:f,padding:g=0,onKeyDown:m,classNamePrefix:v,style:w,textWidth:S,textHeight:b}){const{rInput:x,isEmpty:E,isEditing:M,isEditingAnything:j,...D}=rle(e,t,r),[H,L]=P.useState(r);P.useEffect(()=>{M||L(r)},[M,r]);const U=hh.normalizeTextForDom(r),z=U.length>0,Y=tle(c);if(!M&&!z)return null;const V=v||"tl-text";return p.jsx("div",{className:`${V}-label tl-text-wrapper`,"data-font":s,"data-align":c,"data-hastext":!E,"data-isediting":M,"data-iseditinganything":j,"data-textwrap":!!d,"data-isselected":f,style:{justifyContent:c==="middle"||Y?"center":c,alignItems:u==="middle"?"center":u,padding:g,...w},children:p.jsxs("div",{className:`${V}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*a)+"px",minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(S||0),color:i,width:S?Math.ceil(S):void 0,height:b?Math.ceil(b):void 0},children:[p.jsx("div",{className:`${V} tl-text tl-text-content`,dir:"auto",children:U.split(`
`).map((N,_)=>p.jsx("div",{dir:"auto",children:N},_))}),(j||f)&&p.jsx(nle,{ref:x,text:r,isEditing:M,...D,handleKeyDown:m??D.handleKeyDown},H)]})})}),ile=new ha;function sle(n){return ile.get(n,()=>n.store.createComputedCache("arrowLabelSize",e=>{const t=la(n,e);let r=0,i=0;const s=t.isStraight?new ec({start:T.From(t.start.point),end:T.From(t.end.point)}):new Hd({center:T.Cast(t.handleArc.center),start:T.Cast(t.start.point),end:T.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});if(e.props.text.trim()){const o=s.bounds,a=SE(e),{w:c,h:u}=n.textMeasure.measureText(e.props.text,{...Pi,fontFamily:hc[e.props.font],fontSize:a,maxWidth:null});r=c,i=u;let d=!1;if(o.width>o.height?(r=Math.max(Math.min(c,64),Math.min(o.width-64,c)),d=!0):r>16*a&&(r=16*a,d=!0),d){const{w:f,h:g}=n.textMeasure.measureText(e.props.text,{...Pi,fontFamily:hc[e.props.font],fontSize:a,maxWidth:r});r=f,i=g}}return new T(r,i).addScalar(M0*2*e.props.scale)}))}function vP(n,e){return e.props.text.trim()===""?new T(0,0).addScalar(M0*2*e.props.scale):sle(n).get(e.id)??new T(0,0)}function kU(n){const e=Ci[n.props.size];return(gce+(e-Ci.s)*2+(e===Ci.xl?20:0))*n.props.scale}function ole(n,e,t){const r=vP(n,e),i=kU(e),s=T.Nudge(t.start.point,t.end.point,i),o=T.Nudge(t.end.point,t.start.point,i),a=a2(s,o,De.FromCenter(t.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,u]=a;T.Dist2(c,s)>T.Dist2(u,s)&&([u,c]=a);const d=s.add(T.Sub(t.middle,c)),f=o.add(T.Sub(t.middle,u)),g=T.Dist(t.start.point,d)/t.length,m=T.Dist(t.start.point,f)/t.length;return{start:g,end:m}}function ale(n,e,t){const r=vP(n,e),i=kU(e),s=Math.sign(e.props.bend),o=i/t.handleArc.radius*s,a=T.Angle(t.bodyArc.center,t.start.point)-o,c=T.Angle(t.bodyArc.center,t.end.point)+o,u=Cu(t.bodyArc.center,t.bodyArc.radius,a),d=Cu(t.bodyArc.center,t.bodyArc.radius,c),f=[],g=aD(t.bodyArc.center,t.bodyArc.radius,a,c,s,De.FromCenter(u,r).corners);f.push(new gr({points:De.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const m=aD(t.bodyArc.center,t.bodyArc.radius,a,c,s,De.FromCenter(d,r).corners);f.push(new gr({points:De.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const H of[...g??[],...m??[],u,d])f.push(new _2({x:H.x-3,y:H.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const v=(g&&cD(t.start.point,g))??t.middle,w=(m&&cD(t.end.point,m))??t.middle,S=T.Angle(t.bodyArc.center,t.start.point),b=T.Angle(t.bodyArc.center,t.end.point),x=T.Angle(t.bodyArc.center,v),E=T.Angle(t.bodyArc.center,w);if(nl(S,x,s)>nl(S,E,s))return{start:.5,end:.5,dbg:f};const M=nl(S,b,s),j=nl(S,x,s)/M,D=nl(S,E,s)/M;return{start:j,end:D,dbg:f}}function by(n,e){let t;const r=[],i=la(n,e),s={hasStartBinding:!!i.bindings.start,hasEndBinding:!!i.bindings.end,hasStartArrowhead:i.start.arrowhead!=="none",hasEndArrowhead:i.end.arrowhead!=="none"};if(i.isStraight){const a=ole(n,e,i),c=oD(n,e,a,s);t=T.Lrp(i.start.point,i.end.point,c)}else{const a=ale(n,e,i);a.dbg&&r.push(...a.dbg);const c=oD(n,e,a,s),u=cle(T.Angle(i.bodyArc.center,i.start.point),T.Angle(i.bodyArc.center,i.end.point),Math.sign(e.props.bend),c);t=Cu(i.bodyArc.center,i.bodyArc.radius,u)}const o=vP(n,e);return{box:De.FromCenter(t,o),debugGeom:r}}function oD(n,e,t,r){const{hasEndArrowhead:i,hasEndBinding:s,hasStartBinding:o,hasStartArrowhead:a}=r,c=DU(n,e);let u=Wr(e.props.labelPosition,a||o?t.start:0,i||s?t.end:1);const d=Math.min(.02,500/c*.02);return u=u>=.5-d&&u<=.5+d?.5:u,u}function aD(n,e,t,r,i,s){const o=BI(n,e,s),a=nl(t,r,i);return o==null?void 0:o.filter(c=>{const u=nl(t,T.Angle(n,c),i);return u>=0&&u<=a})}function cD(n,e){let t=null,r=-1/0;for(const i of e){const s=T.Dist2(n,i);s>r&&(t=i,r=s)}return t}function cle(n,e,t,r){const i=nl(n,e,t);return n+i*r*t*-1}function SE(n){return pce[n.props.size]*n.props.scale}function lle(n,e,t){const r=e==="end"?n.end.point:n.start.point,i=e==="end"?n.start.point:n.end.point,s=n.isStraight?T.Dist(i,r):Math.abs(n.bodyArc.length),o=Math.max(Math.min(s/5,t*3),t);let a;if(n.isStraight)a=T.Nudge(r,i,o);else{const c=AZ(r,o,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?c[0]:c[1]:n.handleArc.sweepFlag?c[1]:c[0]}return T.IsNaN(a)&&(a=n.start.point),{point:r,int:a}}function ule({point:n,int:e}){const t=T.RotWith(e,n,en/6),r=T.RotWith(e,n,-en/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function dle({point:n,int:e}){const t=T.RotWith(e,n,en/6),r=T.RotWith(e,n,-en/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function hle({point:n,int:e}){const t=T.Sub(e,n).div(2),r=T.Add(n,T.Rot(t,jn)),i=T.Sub(n,T.Rot(t,jn));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function fle({point:n,int:e}){const t=T.Lrp(n,e,.45),r=T.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function ple({point:n,int:e}){const t=T.Lrp(n,e,.75),r=T.RotWith(t,n,en/4),i=T.RotWith(t,n,-en/4),s=T.Lrp(r,i,.5);return s.add(T.Sub(s,n)),`M ${s.x} ${s.y} L ${i.x} ${i.y} ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function gle({int:n,point:e}){const t=T.Lrp(e,n,.85),r=T.Sub(t,e).div(2),i=T.Add(e,T.Rot(r,jn)),s=T.Sub(e,T.Rot(r,jn)),o=T.Add(t,T.Rot(r,jn)),a=T.Sub(t,T.Rot(r,jn));return`M ${i.x} ${i.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${s.x} ${s.y} Z`}function mle({int:n,point:e}){const t=T.Sub(n,e).div(2),r=T.Add(e,T.Rot(t,jn)),i=T.Sub(e,T.Rot(t,jn));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function T0(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const i=lle(n,e,t);if(i){switch(r){case"bar":return mle(i);case"square":return gle(i);case"diamond":return ple(i);case"dot":return fle(i);case"inverted":return hle(i);case"arrow":return ule(i);case"triangle":return dle(i)}return""}}function yle(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${i} ${s} ${t.handle.x},${t.handle.y}`}function AU(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:s}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${i} ${s} ${t.point.x},${t.point.y}`}function RU(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function wle(n){return RU(n.start.handle,n.end.handle)}function jU(n){return RU(n.start.point,n.end.point)}class _y extends Ao{constructor(){super(...arguments);G(this,"_resizeInitialBindings",new ha)}canEdit(){return!0}canBind({toShapeType:t}){return t!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(t){const r=as(this.editor,t);return!r.start&&!r.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const r=la(this.editor,t),i=[],s=r.isStraight?new ec({start:T.From(r.start.point),end:T.From(r.end.point)}):new Hd({center:T.Cast(r.handleArc.center),start:T.Cast(r.start.point),end:T.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const a=by(this.editor,t);i.push(...a.debugGeom),o=new ga({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new to({children:[...o?[s,o]:[s],...i]})}getHandles(t){const r=la(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}getText(t){return t.props.text}onHandleDrag(t,{handle:r,isPrecise:i}){const s=r.id,o=as(this.editor,t);if(s==="middle"){const{start:D,end:H}=Kd(this.editor,t,o),L=T.Sub(H,D),U=T.Per(L),z=T.Med(H,D),Y=T.Sub(z,U),V=T.Add(z,U),N=T.NearestPointOnLineSegment(Y,V,r,!1);let _=T.Dist(N,z);return T.Clockwise(N,H,z)&&(_*=-1),{id:t.id,type:t.type,props:{bend:_}}}const a={id:t.id,type:"arrow",props:{}},c=o[s],d=o[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return wy(this.editor,t,s),a.props[s]={x:r.x,y:r.y},a;const f=this.editor.getShapePageTransform(t.id).applyToPoint(r),g=this.editor.getShapeAtPoint(f,{hitInside:!0,hitFrameInside:!0,margin:0,filter:D=>!D.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:D,binding:"arrow"})});if(!g){wy(this.editor,t,s);const D=jo(new T(r.x,r.y),this.editor);return a.props[s]={x:D.x,y:D.y},a}const m=this.editor.getShapeGeometry(g),v=De.ZeroFix(m.bounds),S=this.editor.getShapePageTransform(a.id).applyToPoint(r),b=this.editor.getPointInShapeSpace(g,S);let x=i;x||(!c||c&&g.id!==c.toId)&&(x=this.editor.inputs.pointerVelocity.len()<.5),i||(m.isClosed||(x=!0),d&&g.id===d.toId&&d.props.isPrecise&&(x=!0));const E={x:(b.x-v.minX)/v.width,y:(b.y-v.minY)/v.height};x&&T.Dist(b,v.center)<Math.max(4,Math.min(Math.min(v.width,v.height)*.15,16))/this.editor.getZoomLevel()&&(E.x=.5,E.y=.5);const M={terminal:s,normalizedAnchor:E,isPrecise:x,isExact:this.editor.inputs.altKey};Tf(this.editor,t,g.id,M),this.editor.setHintingShapes([g.id]);const j=as(this.editor,t);return j.start&&j.end&&j.start.toId===j.end.toId&&T.Equals(j.start.props.normalizedAnchor,j.end.props.normalizedAnchor)&&Tf(this.editor,t,j.end.toId,{...j.end.props,normalizedAnchor:{x:j.end.props.normalizedAnchor.x+.05,y:j.end.props.normalizedAnchor.y}}),a}onTranslateStart(t){const r=as(this.editor,t),i=Kd(this.editor,t,r),s=this.editor.getShapePageTransform(t.id),o=this.editor.getSelectedShapeIds();if(!(r.start&&(o.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(o.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){uD.set(t,{pagePosition:s.applyToPoint(t),terminalBindings:Np(i,(a,c)=>{const u=r[a];return u?{binding:u,shapePosition:c,pagePosition:s.applyToPoint(c)}:null})}),r.start&&(P0({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),r.end&&P0({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=r[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}}onTranslate(t,r){const i=uD.get(t);if(!i)return;const s=this.editor.getShapePageTransform(r.id),o=T.Sub(s.applyToPoint(r),i.pagePosition);for(const a of Object.values(i.terminalBindings)){if(!a)continue;const c=T.Add(a.pagePosition,T.Mul(o,.5)),u=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:d=>!d.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:d,binding:"arrow"})});if((u==null?void 0:u.id)===a.binding.toId){const d=De.ZeroFix(this.editor.getShapeGeometry(u).bounds),f=this.editor.getPointInShapeSpace(u,c),g={x:(f.x-d.minX)/d.width,y:(f.y-d.minY)/d.height};Tf(this.editor,r,u.id,{...a.binding.props,normalizedAnchor:g,isPrecise:!0})}else wy(this.editor,r,a.binding.props.terminal)}}onResize(t,r){const{scaleX:i,scaleY:s}=r,o=this._resizeInitialBindings.get(t,()=>as(this.editor,t)),a=Kd(this.editor,t,o),{start:c,end:u}=Un(t.props);let{bend:d}=t.props;o.start||(c.x=a.start.x*i,c.y=a.start.y*s),o.end||(u.x=a.end.x*i,u.y=a.end.y*s);const f=Math.abs(i),g=Math.abs(s),m=o!=null&&o.start?T.From(o.start.props.normalizedAnchor):null,v=o!=null&&o.end?T.From(o.end.props.normalizedAnchor):null;return i<0&&s>=0?(d!==0&&(d*=-1,d*=Math.max(f,g)),m&&(m.x=1-m.x),v&&(v.x=1-v.x)):i>=0&&s<0?(d!==0&&(d*=-1,d*=Math.max(f,g)),m&&(m.y=1-m.y),v&&(v.y=1-v.y)):i>=0&&s>=0?d!==0&&(d*=Math.max(f,g)):i<0&&s<0&&(d!==0&&(d*=Math.max(f,g)),m&&(m.x=1-m.x,m.y=1-m.y),v&&(v.x=1-v.x,v.y=1-v.y)),o.start&&m&&Tf(this.editor,t,o.start.toId,{...o.start.props,normalizedAnchor:m.toJson()}),o.end&&v&&Tf(this.editor,t,o.end.toId,{...o.end.props,normalizedAnchor:v.toJson()}),{props:{start:c,end:u,bend:d}}}onDoubleClickHandle(t,r){switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(t){const r=io(),i=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),o=la(this.editor,t);if(!(o!=null&&o.isValid))return null;const a=by(this.editor,t),c=t.id===this.editor.getOnlySelectedShapeId(),d=this.editor.getEditingShapeId()===t.id||t.props.text;return p.jsxs(p.Fragment,{children:[p.jsx(yl,{style:{minWidth:50,minHeight:50},children:p.jsx(lD,{shape:t,shouldDisplayHandles:s&&(i==null?void 0:i.id)===t.id})}),d&&p.jsx(qw,{shapeId:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:SE(t),lineHeight:Pi.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:r[t.props.labelColor].solid,textWidth:a.box.w-M0*2*t.props.scale,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(t){const r=vw(t.id),i=ko(t.id+"_clip"),s=la(this.editor,t);if(!s)return null;const{start:o,end:a}=Kd(this.editor,t,s==null?void 0:s.bindings),c=this.editor.getShapeGeometry(t),u=c.bounds,d=t.props.text.trim()?c.children[1]:null;if(T.Equals(o,a))return null;const f=Ci[t.props.size]*t.props.scale,g=s.start.arrowhead&&T0(s,"start",f),m=s.end.arrowhead&&T0(s,"end",f),v=s.isStraight?jU(s):AU(s),w=g&&s.start.arrowhead!=="arrow"||m&&s.end.arrowhead!=="arrow"||!!d;if(r&&d)return p.jsx("rect",{x:ge(d.x),y:ge(d.y),width:d.w,height:d.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale});const S=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs("g",{children:[w&&p.jsx("defs",{children:p.jsx(OU,{hasText:t.props.text.trim().length>0,bounds:u,labelBounds:d?d.getBounds():new De(0,0,0,0),as:S&&g?g:"",ae:b&&m?m:""})}),p.jsxs("g",{style:{clipPath:w?`url(#${i})`:void 0,WebkitClipPath:w?`url(#${i})`:void 0},children:[w&&p.jsx("rect",{x:u.minX-100,y:u.minY-100,width:u.width+200,height:u.height+200,opacity:0}),p.jsx("path",{d:v})]}),g&&p.jsx("path",{d:g}),m&&p.jsx("path",{d:m}),d&&p.jsx("rect",{x:ge(d.x),y:ge(d.y),width:d.w,height:d.h,rx:3.5,ry:3.5})]})}onEditEnd(t){const{id:r,type:i,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:i,props:{text:s.trimEnd()}}])}toSvg(t,r){r.addExportDef(mP(t.props.fill)),t.props.text&&r.addExportDef(Ww(t.props.font));const i=wc(r),s=1/t.props.scale;return p.jsxs("g",{transform:`scale(${s})`,children:[p.jsx(lD,{shape:t,shouldDisplayHandles:!1}),p.jsx(Kw,{fontSize:SE(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:i[t.props.labelColor].solid,bounds:by(this.editor,t).box.clone().expandBy(-M0*t.props.scale),padding:0})]})}getCanvasSvgDefs(){return[yP(),{key:"arrow:dot",component:vle},{key:"arrow:cross",component:Sle}]}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,scale:zt(t.props.scale,r.props.scale,i),start:{x:zt(t.props.start.x,r.props.start.x,i),y:zt(t.props.start.y,r.props.start.y,i)},end:{x:zt(t.props.end.x,r.props.end.x,i),y:zt(t.props.end.y,r.props.end.y,i)},bend:zt(t.props.bend,r.props.bend,i),labelPosition:zt(t.props.labelPosition,r.props.labelPosition,i)}}}G(_y,"type","arrow"),G(_y,"props",VL),G(_y,"migrations",YL);function DU(n,e){const t=la(n,e);return t.isStraight?T.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const lD=ti(function({shape:e,shouldDisplayHandles:t}){const r=me(),i=io(),s=la(r,e),o=De.ZeroFix(r.getShapeGeometry(e).bounds),a=as(r,e),c=xe("force solid",()=>r.getZoomLevel()<.2,[r]),u=ko(e.id+"_clip"),d=ko("arrowhead-dot"),f=ko("arrowhead-cross");if(!(s!=null&&s.isValid))return null;const g=Ci[e.props.size]*e.props.scale,m=s.start.arrowhead&&T0(s,"start",g),v=s.end.arrowhead&&T0(s,"end",g),w=s.isStraight?jU(s):AU(s);let S=null;if(t){const D=2/r.getZoomLevel(),{strokeDasharray:H,strokeDashoffset:L}=bo(DU(r,e),D,{end:"skip",start:"skip",lengthRatio:2.5});S=a.start||a.end?p.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?wle(s):yle(s),strokeDasharray:H,strokeDashoffset:L,strokeWidth:D,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?`url(#${f})`:`url(#${d})`:"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?`url(#${f})`:`url(#${d})`:"",opacity:.16}):null}const{strokeDasharray:b,strokeDashoffset:x}=bo(s.isStraight?s.length:Math.abs(s.bodyArc.length),g,{style:e.props.dash,forceSolid:c}),E=by(r,e),M=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),j=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:u,children:p.jsx(OU,{hasText:e.props.text.trim().length>0,bounds:o,labelBounds:E.box,as:M&&m?m:"",ae:j&&v?v:""})})}),p.jsxs("g",{fill:"none",stroke:i[e.props.color].solid,strokeWidth:g,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[S,p.jsxs("g",{style:{clipPath:`url(#${u})`,WebkitClipPath:`url(#${u})`},children:[p.jsx("rect",{x:ge(o.minX-100),y:ge(o.minY-100),width:ge(o.width+200),height:ge(o.height+200),opacity:0}),p.jsx("path",{d:w,strokeDasharray:b,strokeDashoffset:x})]}),m&&M&&e.props.fill!=="none"&&p.jsx(wi,{theme:i,d:m,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),v&&j&&e.props.fill!=="none"&&p.jsx(wi,{theme:i,d:v,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),m&&p.jsx("path",{d:m}),v&&p.jsx("path",{d:v})]})]})});function OU({hasText:n,bounds:e,labelBounds:t,as:r,ae:i}){const s=`M${ge(e.minX-100)},${ge(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,o=`M${ge(t.minX)},${ge(t.minY)} v${t.height} h${t.width} v-${t.height} Z`;return p.jsx("path",{d:`${s}${n?o:""}${r}${i}`})}const uD=new WeakMap;function vle(){const n=ko("arrowhead-dot");return p.jsx("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:p.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function Sle(){const n=ko("arrowhead-cross");return p.jsxs("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[p.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),p.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const dD="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function fh({url:n}){const e=me(),t=xe("zoomLevel",()=>e.getZoomLevel()<.32,[e]);return p.jsx("a",{className:rt("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:Sr,onPointerUp:Sr,title:n,draggable:!1,children:p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${dD}") center 100% / 100% no-repeat`,WebkitMask:`url("${dD}") center 100% / 100% no-repeat`}})})}const hD="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",xle=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function k0(n){return xle.map(t=>{const{offsetX:r,offsetY:i,blur:s,spread:o,color:a}=t,c=new T(r,i),{x:u,y:d}=c.rot(-n);return`${u}px ${d}px ${s}px ${o}px ${a}`}).join(", ")}const ble=300,LU=320,_le=46,Ile=101;class Iy extends jh{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:ble,h:LU,assetId:null}}component(e){return p.jsx(Ele,{shape:e,util:this})}indicator(e){return p.jsx("rect",{width:ge(e.props.w),height:ge(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return fD(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(js.isValid(t.props.url))Ple(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return fD(this.editor,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:zt(e.props.w,t.props.w,r),h:zt(e.props.h,t.props.h,r)}}}G(Iy,"type","bookmark"),G(Iy,"props",tN),G(Iy,"migrations",nN);function Ele({shape:n,util:e}){const t=n.props.assetId?e.editor.getAsset(n.props.assetId):null,r=!!Xp()&&_n.isSafari,i=e.editor.getShapePageTransform(n).rotation(),s=Cle(n),[o,a]=P.useState(!0),c=()=>a(!1);return p.jsx(hl,{children:p.jsxs("div",{className:rt("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:k0(i),maxHeight:n.props.h},children:[(!t||t.props.image)&&p.jsxs("div",{className:"tl-bookmark__image_container",children:[t?p.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t==null?void 0:t.props.image,alt:(t==null?void 0:t.props.title)||""}):p.jsx("div",{className:"tl-bookmark__placeholder"}),(t==null?void 0:t.props.image)&&p.jsx(fh,{url:n.props.url})]}),p.jsxs("div",{className:"tl-bookmark__copy_container",children:[t!=null&&t.props.title?p.jsx("h2",{className:"tl-bookmark__heading",children:xce(t.props.title)}):null,t!=null&&t.props.description&&(t!=null&&t.props.image)?p.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,p.jsxs("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Sr,onPointerUp:Sr,onClick:Sr,children:[o&&(t!=null&&t.props.favicon)?p.jsx("img",{className:"tl-bookmark__favicon",src:t==null?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:c,alt:`favicon of ${s}`}):p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${hD}") center 100% / 100% no-repeat`,WebkitMask:`url("${hD}") center 100% / 100% no-repeat`}}),p.jsx("span",{children:s})]})]})]})})}function fD(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let r=LU;return t&&(t.props.image||(t.props.title?r=Ile:r=_le)),{...e,props:{...e.props,h:r}}}const Cle=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function Ple(n,e){const{url:t}=e.props,r=tl.createId(bI(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),Mle(n,e))}const Mle=H0(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.run(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function ju(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,i=n[1].point;if(t===2)return`M${Qt(r)}L${Qt(i)}`;let s="";for(let o=2,a=t-1;o<a;o++)r=n[o].point,i=n[o+1].point,s+=os(r,i);return e?`M${os(n[0].point,n[1].point)}Q${Qt(n[1].point)}${os(n[1].point,n[2].point)}T${s}${os(n[t-1].point,n[0].point)}${os(n[0].point,n[1].point)}Z`:`M${Qt(n[0].point)}Q${Qt(n[1].point)}${os(n[1].point,n[2].point)}${n.length>3?"T":""}${s}L${Qt(n[t-1].point)}`}function Tle(n,e={}){const{start:t={},end:r={}}=e,{cap:i=!0}=t,{cap:s=!0}=r;bt(!t.taper&&!r.taper,"cap taper not supported here"),bt(!t.easing&&!r.easing,"cap easing not supported here"),bt(i&&s,"cap must be true");const o=wa(n,e);$w(o,e);const a=kle(o);let c="";for(const u of a)c+=Rle(u,e);return c}function kle(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],r=T.Sub(n[1].point,n[0].point).uni(),i,s,o,a,c;for(let u=1,d=n.length;u<d-1;u++){if(o=n[u-1],a=n[u],c=n[u+1],i=T.Sub(c.point,a.point).uni(),s=T.Dpr(r,i),r=i,s<-.8){const f={...a,point:a.input};t.push(f),e.push(Lb(t)),t=[f];continue}if(t.push(a),!(s>.7)&&(T.Dist2(o.point,a.point)+T.Dist2(a.point,c.point))/((o.radius+a.radius+c.radius)/3)**2<1.5){t.push(a),e.push(Lb(t)),t=[a];continue}}return t.push(n[n.length-1]),e.push(Lb(t)),e}function Lb(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],T.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const r=n[n.length-1];let i;for(;n.length>2&&(i=n[n.length-2],T.Dist2(r.point,i.point)<((r.radius+i.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:T.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:T.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function Ale(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function Rle(n,e={}){if(n.length===0)return"";if(n.length===1)return Ale(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=mU(n,e);r.reverse();let i=`M${Qt(t[0])}T`;for(let s=1;s<t.length;s++)i+=os(t[s-1],t[s]);{const s=n[n.length-1],o=s.radius,a=s.vector.clone().per().neg(),c=T.Add(s.point,T.Mul(a,o)),u=T.Add(s.point,T.Mul(a,-o));i+=`${Qt(c)}A${ge(o)},${ge(o)} 0 0 1 ${Qt(u)}T`}for(let s=1;s<r.length;s++)i+=os(r[s-1],r[s]);{const s=n[0],o=s.radius,a=s.vector.clone().per(),c=T.Add(s.point,T.Mul(a,o)),u=T.Add(s.point,T.Mul(a,-o));i+=`${Qt(c)}A${ge(o)},${ge(o)} 0 0 1 ${Qt(u)}Z`}return i}const NU=(n,e,t)=>{const r=[],i=[];n.forEach(u=>r.push(...u.points)),e.forEach(u=>i.push(...u.points));const s=Math.max(r.length,i.length),o=[],a=[];for(let u=0;u<s;u++)o.push(r[u]||r[r.length-1]),a.push(i[u]||i[i.length-1]);return[{type:"free",points:o.map((u,d)=>{let f=.5;return a[d].z!==void 0&&u.z!==void 0&&(f=zt(u.z,a[d].z,t)),{x:zt(u.x,a[d].x,t),y:zt(u.y,a[d].y,t),z:f}})}]},jle=n=>n*.65+QV(n*en/2)*.35,Dle=n=>({size:n,thinning:.5,streamline:ch(n,[9,16],[.64,.74],!0),smoothing:.62,easing:Or.easeOutSine,simulatePressure:!0}),Ole=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:jle}),pD=n=>({size:n,thinning:0,streamline:ch(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:Or.linear}),Lle=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Or.linear});function SP({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:Or.easeOutSine,last:e}}function xE(n,e,t,r){const i=n.isComplete||t;return r?n.isPen?{...Lle(e),last:i}:{...pD(e),last:i}:n.dash==="draw"?n.isPen?{...Ole(e),last:i}:{...Dle(e),last:i}:{...pD(e),last:i}}function ph(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(T.Cast));else{const r=Math.max(4,Math.floor(T.Dist(t.points[0],t.points[1])/16));e.push(...T.PointsBetween(t.points[0],t.points[1],r))}return e}function Nle(n,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class Ey extends Ao{hideResizeHandles(e){return Nb(e)}hideRotateHandle(e){return Nb(e)}hideSelectionBoundsFg(e){return Nb(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=ph(e.props.segments),r=(Ci[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const s=De.FromPoints(t);if(s.width<r*2&&s.height<r*2)return new _2({x:-r,y:-r,radius:r,isFilled:!0})}const i=wa(t,xE(e.props,r,e.props.isPen,!0)).map(s=>s.point);return e.props.isClosed?new gr({points:i,isFilled:e.props.fill!=="none"}):new kh({points:i})}component(e){return p.jsx(yl,{children:p.jsx(gD,{shape:e})})}indicator(e){var d;const t=ph(e.props.segments);let r=(Ci[e.props.size]+1)*e.props.scale;const i=this.editor.getZoomLevel();!(i<.5&&i<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&t.length===1&&(r+=No(e.id)()*(r/6));const o=e.props.isComplete||((d=Gr(e.props.segments))==null?void 0:d.type)==="straight",a=xE(e.props,r,o,!0),c=wa(t,a),u=c.length>1?ju(c,e.props.isClosed):BU(t[0],r);return p.jsx("path",{d:u})}toSvg(e,t){t.addExportDef(mP(e.props.fill));const r=1/e.props.scale;return p.jsx("g",{transform:`scale(${r})`,children:p.jsx(gD,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[yP()]}onResize(e,t){const{scaleX:r,scaleY:i}=t,s=[];for(const o of e.props.segments)s.push({...o,points:o.points.map(({x:a,y:c,z:u})=>({x:Ya(r*a),y:Ya(i*c),z:u}))});return{props:{segments:s}}}expandSelectionOutlinePx(e){const t=e.props.dash==="draw"?1.6:1;return Ci[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,segments:NU(e.props.segments,t.props.segments,r),scale:zt(e.props.scale,t.props.scale,r)}}}G(Ey,"type","draw"),G(Ey,"props",iN),G(Ey,"migrations",sN);function BU(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Nb(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function gD({shape:n,zoomOverride:e}){var m;const t=io(),r=me(),i=ph(n.props.segments),s=n.props.isComplete||((m=Gr(n.props.segments))==null?void 0:m.type)==="straight";let o=(Ci[n.props.size]+1)*n.props.scale;const a=xe("force solid",()=>{const v=e??r.getZoomLevel();return v<.5&&v<1.5/o},[r,o,e]),c=xe("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!n.props.isPen&&n.props.dash==="draw"&&i.length===1&&(o+=No(n.id)()*(o/6));const u=xE(n.props,o,s,a);if(!a&&n.props.dash==="draw")return p.jsxs(p.Fragment,{children:[n.props.isClosed&&n.props.fill&&i.length>1?p.jsx(wi,{d:ju(wa(i,u),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,p.jsx("path",{d:Tle(i,u),strokeLinecap:"round",fill:t[n.props.color].solid})]});const d=wa(i,u),f=d.length<2,g=f?BU(i[0],0):ju(d,n.props.isClosed);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{d:g,theme:t,color:n.props.color,fill:f||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),p.jsx("path",{d:g,strokeLinecap:"round",fill:f?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:o,strokeDasharray:f?"none":Nle(n,o,c),strokeDashoffset:"0"})]})}function Ble(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Fle(n,e){const t=yt(e);if(!t)return;const r=t.host.replace("www.","");for(const i of n)if(FU(i.hostnames,r)){const s=i.fromEmbedUrl(e);if(s)return{definition:i,url:s,embedUrl:e}}}const zle=n=>n.split("*").map(e=>Ble(e)).join(".+"),FU=(n,e)=>!!n.find(t=>{const r=new RegExp(zle(t));return e.match(r)});function Ule(n,e){const t=yt(e);if(!t)return;const r=t.host.replace("www.","");for(const i of n)if(FU(i.hostnames,r)){const s=i.toEmbedUrl(e);if(s)return{definition:i,embedUrl:s,url:e}}}function $le(n,e){try{return Ule(n,e)??Fle(n,e)}catch{return}}const Hle=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class Cy extends jh{constructor(){super(...arguments);G(this,"embedDefinitions",sP)}setEmbedDefinitions(t){this.embedDefinitions=t}getEmbedDefinitions(){return this.embedDefinitions}getEmbedDefinition(t){return $le(this.embedDefinitions,t)}getText(t){return t.props.url}hideSelectionBoundsFg(t){return!this.canResize(t)}canEdit(){return!0}canResize(t){var r,i;return!!((i=(r=this.getEmbedDefinition(t.props.url))==null?void 0:r.definition)!=null&&i.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(t){const r=this.getEmbedDefinition(t.props.url);return(r==null?void 0:r.definition.isAspectRatioLocked)??!1}onResize(t,r){const i=this.isAspectRatioLocked(t),s=this.getEmbedDefinition(t.props.url);let o=(s==null?void 0:s.definition.minWidth)??200,a=(s==null?void 0:s.definition.minHeight)??200;if(i){const c=t.props.w/t.props.h;c>1?o*=c:a/=c}return ww(t,r,{minWidth:o,minHeight:a})}component(t){const r=Xp(),{w:i,h:s,url:o}=t.props,a=vw(t.id),c=this.getEmbedDefinition(o),u=xe("is hovering",()=>{const{editingShapeId:v,hoveredShapeId:w}=this.editor.getCurrentPageState();if(v&&w!==v){const S=this.editor.getShape(v);if(S&&this.editor.isShapeOfType(S,"embed"))return!0}return!1},[]),d=this.editor.getShapePageTransform(t).rotation();if(r)return p.jsx(hl,{className:"tl-embed-container",id:t.id,children:p.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:k0(d),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:(c==null?void 0:c.definition.backgroundColor)??"var(--color-background)",width:i,height:s}})});const f=a||u;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(c==null?void 0:c.definition.type)==="tldraw")return null;if((c==null?void 0:c.definition.type)==="github_gist"){const v=c.url.split("/").pop();if(!v)throw Error("No gist id!");return p.jsx(hl,{className:"tl-embed-container",id:t.id,children:p.jsx(Wle,{id:v,width:ge(i),height:ge(s),isInteractive:f,pageRotation:d})})}const m=Hle({...Jse,...(c==null?void 0:c.definition.overridePermissions)??{}});return p.jsx(hl,{className:"tl-embed-container",id:t.id,children:c!=null&&c.definition?p.jsx("iframe",{className:"tl-embed",sandbox:m,src:c.embedUrl,width:ge(i),height:ge(s),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:f?"auto":"none",zIndex:f?"":"-1",boxShadow:k0(d),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:c==null?void 0:c.definition.backgroundColor}}):null})}indicator(t){const r=this.getEmbedDefinition(t.props.url);return p.jsx("rect",{width:ge(t.props.w),height:ge(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}getInterpolatedProps(t,r,i){return{...i>.5?r.props:t.props,w:zt(t.props.w,r.props.w,i),h:zt(t.props.h,r.props.h,i)}}}G(Cy,"type","embed"),G(Cy,"props",oN),G(Cy,"migrations",aN);function Wle({id:n,file:e,isInteractive:t,width:r,height:i,style:s,pageRotation:o}){return p.jsx("iframe",{className:"tl-embed",draggable:!1,width:ge(r),height:ge(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...s,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:k0(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function bE(n,e){const i=((vu(n.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(i)}function mD(n,e,t){const r=n.textMeasure.measureTextSpans(UU(e.props.name,"Frame")+"",t),i=r[0],s=Gr(r),o=s.box.w+s.box.x-i.box.x;return{box:new De(0,-t.height,o,t.height),spans:r}}function yD(n,e){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:e,offsetY:-34,offsetX:2}}function zU(n,e,t){const r=t?"":"px",i=t?"":"deg";let s;switch(e){case 0:s="";break;case 3:s=`translate(${ge(n.props.w)}${r}, 0${r}) rotate(90${i})`;break;case 2:s=`translate(${ge(n.props.w)}${r}, ${ge(n.props.h)}${r}) rotate(180${i})`;break;case 1:s=`translate(0${r}, ${ge(n.props.h)}${r}) rotate(270${i})`;break;default:throw Error("labelSide out of bounds")}return s}const Kle=P.forwardRef(({id:n,name:e,isEditing:t},r)=>{const i=me(),s=P.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(Sr(c),c.currentTarget.blur(),i.setEditingShape(null))},[i]),o=P.useCallback(c=>{const u=i.getShape(n);if(!u)return;const d=u.props.name,f=c.currentTarget.value.trim();d!==f&&i.updateShapes([{id:n,type:"frame",props:{name:f}}])},[n,i]),a=P.useCallback(c=>{const u=i.getShape(n);if(!u)return;const d=u.props.name,f=c.currentTarget.value;d!==f&&i.updateShapes([{id:n,type:"frame",props:{name:f}}])},[n,i]);return p.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[p.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:o,onChange:a}),UU(e,"Frame")+""]})});function qle({id:n,name:e,width:t,height:r}){const i=me(),{side:s,translation:o}=xe("shape rotation",()=>{const u=i.getShape(n);if(!u)return{side:0,translation:"translate(0, 0)"};const d=bE(i,u);return{side:d,translation:zU(u,d,!1)}},[i,n]),a=P.useRef(null),c=vw(n);return P.useEffect(()=>{const u=a.current;u&&c&&(u.focus(),u.select())},[a,c]),p.jsx("div",{className:"tl-frame-heading",style:{overflow:c?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(s===0||s===2?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${o} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},children:p.jsx("div",{className:"tl-frame-heading-hit-area",children:p.jsx(Kle,{ref:a,id:n,name:e,isEditing:c})})})}function UU(n,e){return n.match(/^\s*$/)?e:n}class Py extends jh{canEdit(){return!0}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){const{editor:t}=this,r=t.getZoomLevel(),i=yD(e,"black"),s=mD(t,e,i),o=bE(t,e);let a,c,u,d;const{w:f,h:g}=s.box,m=Math.min(f,e.props.w*r),v=Math.min(g,e.props.h*r);switch(o){case 0:{a=-8/r,c=(-g-4)/r,u=(m+16)/r,d=g/r;break}case 1:{a=(-g-4)/r,d=(v+16)/r,c=e.props.h-d+8/r,u=g/r;break}case 2:{a=e.props.w-(m+8)/r,c=e.props.h+4/r,u=(v+16)/r,d=g/r;break}case 3:{a=e.props.w+4/r,d=(v+16)/r,c=-8/r,u=g/r;break}}return new to({children:[new ga({width:e.props.w,height:e.props.h,isFilled:!1}),new ga({x:a,y:c,width:u,height:d,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=this.editor.getShapeGeometry(e).bounds,r=io(),i=xe("is creating this shape",()=>{const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const o=s==null?void 0:s.info;return o?o.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return p.jsxs(p.Fragment,{children:[p.jsx(yl,{children:p.jsx("rect",{className:rt("tl-frame__body",{"tl-frame__creating":i}),width:t.width,height:t.height,fill:r.solid,stroke:r.text})}),i?null:p.jsx(qle,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const r=wc({isDarkMode:t.isDarkMode}),i=bE(this.editor,e),s=zU(e,i,!0),o=yD(e,r.text),{box:a,spans:c}=mD(this.editor,e,o),u=vE(this.editor,c,o);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),p.jsxs("g",{transform:s,children:[p.jsx("rect",{x:a.x-8,y:a.y-4,width:a.width+20,height:a.height,fill:r.background,rx:4,ry:4}),u]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return p.jsx("rect",{width:ge(t.width),height:ge(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every(r=>r.parentId===e.id)||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(t,r.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return ww(e,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:zt(e.props.w,t.props.w,r),h:zt(e.props.h,t.props.h,r)}}}G(Py,"type","frame"),G(Py,"props",cN),G(Py,"migrations",lN);function wD(n,e){return n>e?(en*(e/2)+(n-e))*2:(en*(n/2)+(e-n))*2}function $U(n,e){return xP(n,e).map((t,r)=>t.getSvgPathData(r===0)).join(" ")+" Z"}function Gle(n,e,t,r){const i=n/4,s=e/4,o=No(r),a=t*.75,c=x=>x.addXY(o()*a,o()*a),u=new T(n/2,e),d=new T(0,s*1.2),f=new T(n/2,s*.9),g=new T(n,s*1.2),m=c(new T(n/2,e)),v=c(new T(0,s*1.2)),w=c(new T(n/2,s*.9)),S=c(new T(n,s*1.2));return[new Si({start:u,cp1:new T(i*1.5,s*3),cp2:new T(0,s*2.5),end:d}),new Si({start:d,cp1:new T(0,-s*.32),cp2:new T(i*1.85,-s*.32),end:f}),new Si({start:f,cp1:new T(i*2.15,-s*.32),cp2:new T(n,-s*.32),end:g}),new Si({start:g,cp1:new T(n,s*2.5),cp2:new T(i*2.5,s*3),end:m}),new Si({start:m,cp1:new T(i*1.5,s*3),cp2:new T(0,s*2.5),end:v}),new Si({start:v,cp1:new T(0,-s*.32),cp2:new T(i*1.85,-s*.32),end:w}),new Si({start:w,cp1:new T(i*2.15,-s*.32),cp2:new T(n,-s*.32),end:S}),new Si({start:S,cp1:new T(n,s*2.5),cp2:new T(i*2.5,s*3),end:u})].map((x,E)=>x.getSvgPathData(E===0)).join(" ")+" Z"}function xP(n,e){const t=n/4,r=e/4;return[new Si({start:new T(n/2,e),cp1:new T(t*1.5,r*3),cp2:new T(0,r*2.5),end:new T(0,r*1.2)}),new Si({start:new T(0,r*1.2),cp1:new T(0,-r*.32),cp2:new T(t*1.85,-r*.32),end:new T(n/2,r*.9)}),new Si({start:new T(n/2,r*.9),cp1:new T(t*2.15,-r*.32),cp2:new T(n,-r*.32),end:new T(n,r*1.2)}),new Si({start:new T(n,r*1.2),cp1:new T(n,r*2.5),cp2:new T(t*2.5,r*3),end:new T(n/2,e)})]}function Vle(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function Yle(n,e,t,r){const i=No(n),s=e/2,o=t/2,a=MN(s,o),c=[],u=un*i(),d=un+jn/2+Math.abs(i())*jn,f=Math.max(16,a/10);for(let g=0;g<f;g++){const m=g/(f-1),v=u+m*d,w=Math.cos(v),S=Math.sin(v);c.push(new T(s*w+e*.5+.05*i(),o*S+t/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?Or.easeInOutSine(m):Or.easeInExpo(m)))/2)))}return wa(c,Vle(r))}function Xle(n,e,t,r){return ju(Yle(n,e,t,r))}function _E(n){let e="M";const t=n.length;let r,i,s;for(let o=0,a=t;o<a;o+=3)r=n[o],i=n[o+1],s=n[o+2],e+=`${Qt(r)}L${Qt(i)}Q${Qt(s)}`;return e+=`${Qt(n[0])}`,e}function IE(n,e,t,r,i){const s=[],o=No(n);let a=e[0],c;const u=e.length;for(let d=0,f=u*i;d<f;d++){c=T.AddXY(e[(d+1)%u],o()*t,o()*t);const g=T.Sub(c,a),m=T.Len(g),v=T.Div(g,m).mul(Math.min(m/4,r));s.push(T.Add(a,v),T.Add(c,v.neg()),c),a=c}return s}function Zle(n,e,t){const r=Math.min(n,e)/2,i=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*i)/t,a=n>e?[{type:"straight",start:new T(r,0),delta:new T(1,0)},{type:"arc",center:new T(n-r,r),startAngle:-en/2},{type:"straight",start:new T(n-r,e),delta:new T(-1,0)},{type:"arc",center:new T(r,r),startAngle:en/2}]:[{type:"straight",start:new T(n,r),delta:new T(0,1)},{type:"arc",center:new T(r,e-r),startAngle:0},{type:"straight",start:new T(0,e-r),delta:new T(0,-1)},{type:"arc",center:new T(r,r),startAngle:en}];let c=0;const u=[];for(let d=0;d<t;d++){const f=a[0];f.type==="straight"?u.push(T.Add(f.start,T.Mul(f.delta,c))):u.push(Cu(f.center,r,f.startAngle+c/r)),c+=o;let g=f.type==="straight"?i:en*r;for(;c>g;)c-=g,a.push(a.shift()),g=a[0].type==="straight"?i:en*r}return u}const Qle={s:50,m:70,l:100,xl:130},Jle=.2;function Gw(n,e,t,r,i){const s=No(t),o=wD(n,e),a=Math.max(Math.ceil(o/Qle[r]),6,Math.ceil(o/Math.min(n,e))),c=o/a*Jle,u=Math.max(n-c*2,1),d=Math.max(e-c*2,1),g=wD(u,d)/a,m=(n-u)/2,v=(e-d)/2,w=Zle(u,d,a).map(M=>M.addXY(m,v)),S=n<20?0:c*.3,b=e<20?0:c*.3,x=w.slice(0);for(let M=0;M<Math.floor(a/2);M++)x[M]=T.AddXY(x[M],s()*S*i,s()*b*i),x[a-M-1]=T.AddXY(x[a-M-1],s()*S*i,s()*b*i);const E=[];for(let M=0;M<x.length;M++){const j=M===x.length-1?0:M+1,D=x[M],H=x[j],L=w[M],U=w[j],z=T.Dist(L,U),Y=g-z,N=T.Dist(D,H)/z,_=(Math.max(m,v)+Y)*N,k=T.Lrp(L,U,.5).add(T.Sub(U,L).uni().per().mul(_));k.x<0?k.x=0:k.x>n&&(k.x=n),k.y<0?k.y=0:k.y>e&&(k.y=e);const O=ZC(D,H,k),W=T.Dist(O||T.Average([D,H]),D);E.push({leftPoint:D,rightPoint:H,arcPoint:k,center:O,radius:W})}return E}function eue(n,e,t,r,i){const s=[],o=Gw(n,e,t,r,i);for(const{center:a,radius:c,leftPoint:u,rightPoint:d}of o)s.push(...nY(u,d,a,c,10));return s}function EE(n,e,t,r,i){const s=Gw(n,e,t,r,i);let o=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:c,radius:u,center:d}of s){if(d===null){o+=` L${c.toFixed()}`;continue}const f=T.Clockwise(a,c,d)?"0":"1";o+=` A${ge(u)},${ge(u)} 0 ${f},1 ${c.toFixed()}`}return o+=" Z",o}const tue={s:.5,m:.7,l:.9,xl:1.6};function nue(n,e,t,r,i){const s=No(t),o=tue[r]*i,a=Gw(n,e,t,r,i),d=a.reduce((v,w)=>v+T.Dist2(w.leftPoint,w.rightPoint),0)/a.length>(o*15)**2?v=>T.AddXY(v,s()*o*2,s()*o*2):v=>v;let f=`M${a[0].leftPoint.toFixed()}`,g=d(a[0].leftPoint),m=`M${g.toFixed()}`;for(const{leftPoint:v,center:w,rightPoint:S,radius:b,arcPoint:x}of a){if(w===null){f+=` L${S.toFixed()}`;const L=d(S);m+=` L${L.toFixed()}`,g=L;continue}const E=T.Clockwise(v,S,w)?"0":"1";f+=` A${ge(b)},${ge(b)} 0 ${E},1 ${S.toFixed()}`;const M=d(S),j=d(x),D=ZC(g,M,j);if(!D){m+=` L${M.toFixed()}`,g=M;continue}const H=Math.abs(T.Dist(D,g));m+=` A${ge(H)},${ge(H)} 0 ${E},1 ${M.toFixed()}`,g=M}return f+m+" Z"}function CE(n,e){switch(n.geo){case"x-box":return rue(n.w,n.h,e,n.dash);case"check-box":return iue(n.w,n.h);default:return}}function rue(n,e,t,r){const i=r==="draw"?.62:0;if(r==="dashed")return[[new T(0,0),new T(n/2,e/2)],[new T(n,e),new T(n/2,e/2)],[new T(0,e),new T(n/2,e/2)],[new T(n,0),new T(n/2,e/2)]];const s=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new T(s(t*i),o(t*i)),new T(s(n-t*i),o(e-t*i))],[new T(s(t*i),o(e-t*i)),new T(s(n-t*i),o(t*i))]]}function iue(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,i=(e-t)/2,s=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new T(s(r+t*.25),o(i+t*.52)),new T(s(r+t*.45),o(i+t*.82))],[new T(s(r+t*.45),o(i+t*.82)),new T(s(r+t*.82),o(i+t*.22))]]}function vD({shape:n,shouldScale:e,forceSolid:t}){const r=e?n.props.scale:1,i=me(),s=io(),{id:o,props:a}=n,{w:c,color:u,fill:d,dash:f,growY:g,size:m,scale:v}=a,w=Ci[m]*r,S=a.h+g;switch(a.geo){case"cloud":if(f==="solid"){const b=EE(c,S,o,m,v);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:b,color:u,fill:d,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}else if(f==="draw"){const b=nue(c,S,o,m,v);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:b,color:u,fill:d,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}else{const b=EE(c,S,o,m,v),x=Gw(c,S,o,m,v);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:b,color:u,fill:d,scale:r}),p.jsx("g",{strokeWidth:w,stroke:s[u].solid,fill:"none",pointerEvents:"all",children:x.map(({leftPoint:E,rightPoint:M,center:j,radius:D},H)=>{const L=j?D*vu(vu(T.Angle(j,M))-vu(T.Angle(j,E))):T.Dist(E,M),{strokeDasharray:U,strokeDashoffset:z}=bo(L,w,{style:f,start:"outset",end:"outset",forceSolid:t});return p.jsx("path",{d:j?`M${E.x},${E.y}A${D},${D},0,0,1,${M.x},${M.y}`:`M${E.x},${E.y}L${M.x},${M.y}`,strokeDasharray:U,strokeDashoffset:z},H)})})]})}case"ellipse":{const b=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=b.getSvgPathData(!0);if(f==="dashed"||f==="dotted"){const E=b.length,{strokeDasharray:M,strokeDashoffset:j}=bo(E<64?E*2:E,w,{style:f,snap:4,closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:x,color:u,fill:d,scale:r}),p.jsx("path",{d:x,strokeWidth:w,fill:"none",stroke:s[u].solid,strokeDasharray:M,strokeDashoffset:j})]})}else{const M=(e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:M,color:u,fill:d,scale:r}),p.jsx("path",{d:M,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}}case"oval":{const b=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=b.getSvgPathData(!0);if(f==="dashed"||f==="dotted"){const E=b.getLength(),{strokeDasharray:M,strokeDashoffset:j}=bo(E<64?E*2:E,w,{style:f,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:x,color:u,fill:d,scale:r}),p.jsx("path",{d:x,strokeWidth:w,fill:"none",stroke:s[u].solid,strokeDasharray:M,strokeDashoffset:j})]})}else return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:x,color:u,fill:d,scale:r}),p.jsx("path",{d:x,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}case"heart":if(f==="dashed"||f==="dotted"||f==="solid"){const b=$U(c,S),x=xP(c,S);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:b,color:u,fill:d,scale:r}),x.map((E,M)=>{const{strokeDasharray:j,strokeDashoffset:D}=bo(E.length,w,{style:f,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsx("path",{d:E.getSvgPathData(),strokeWidth:w,fill:"none",stroke:s[u].solid,strokeDasharray:j,strokeDashoffset:D,pointerEvents:"all"},`curve_${M}`)})]})}else{const b=Gle(c,S,w,n.id);return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:b,color:u,fill:d,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}default:{const b=e?i.getShapeGeometry(n):i.getShapeUtil(n).getGeometry(n),x=b instanceof to?b.children[0].vertices:b.vertices,E=CE(n.props,w);if(f==="solid"){let M="M"+x[0]+"L"+x.slice(1)+"Z";if(E)for(const[j,D]of E)M+=`M${j.x},${j.y}L${D.x},${D.y}`;return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:M,color:u,fill:d,scale:r}),p.jsx("path",{d:M,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}else if(f==="dashed"||f==="dotted"){const M="M"+x[0]+"L"+x.slice(1)+"Z";return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:M,color:u,fill:d,scale:r}),p.jsxs("g",{strokeWidth:w,stroke:s[u].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(x.length)).map((j,D)=>{const H=T.ToFixed(x[D]),L=T.ToFixed(x[(D+1)%x.length]),U=T.Dist(H,L),{strokeDasharray:z,strokeDashoffset:Y}=bo(U,w,{style:f,start:"outset",end:"outset",forceSolid:t});return p.jsx("line",{x1:H.x,y1:H.y,x2:L.x,y2:L.y,strokeDasharray:z,strokeDashoffset:Y},D)}),E&&E.map(([j,D],H)=>{const L=T.Dist(j,D),{strokeDasharray:U,strokeDashoffset:z}=bo(L,w,{style:f,start:"skip",end:"skip",snap:f==="dotted"?4:void 0,forceSolid:t});return p.jsx("path",{d:`M${j.x},${j.y}L${D.x},${D.y}`,stroke:s[u].solid,strokeWidth:w,fill:"none",strokeDasharray:U,strokeDashoffset:z},`line_fg_${H}`)})]})]})}else if(f==="draw"){let M=_E(IE(o,x,w/3,w*2,2));if(E)for(const[D,H]of E)M+=`M${D.toFixed()}L${H.toFixed()}`;const j=_E(IE(o,x,0,w*2,1));return p.jsxs(p.Fragment,{children:[p.jsx(wi,{theme:s,d:j,color:u,fill:d,scale:r}),p.jsx("path",{d:M,stroke:s[u].solid,strokeWidth:w,fill:"none"})]})}}}}const SD=17*3;class My extends jh{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=t/2,s=r/2,o=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new gr({points:eue(t,r,e.id,e.props.size,e.props.scale),isFilled:o});break}case"triangle":{a=new gr({points:[new T(i,0),new T(t,r),new T(0,r)],isFilled:o});break}case"diamond":{a=new gr({points:[new T(i,0),new T(t,s),new T(i,r),new T(0,s)],isFilled:o});break}case"pentagon":{a=new gr({points:Zx(t,r,5),isFilled:o});break}case"hexagon":{a=new gr({points:Zx(t,r,6),isFilled:o});break}case"octagon":{a=new gr({points:Zx(t,r,8),isFilled:o});break}case"ellipse":{a=new fte({width:t,height:r,isFilled:o});break}case"oval":{a=new pte({width:t,height:r,isFilled:o});break}case"star":{const x=un/5/2,E=Math.floor(5/4)*2,M=5*2-E,j=0,D=Math.floor(5/2)*2,H=Math.cos(-jn+E*x)*t/2,L=Math.cos(-jn+M*x)*t/2,U=Math.sin(-jn+j*x)*r/2,z=Math.sin(-jn+D*x)*r/2,Y=t-Math.abs(H-L),V=r-Math.abs(z-U),N=t/2+L-(t/2-H),_=r/2+U-(r/2-z),k=1,O=(t-N)/2,W=(r-_)/2,q=(t+Y)/2,X=(r+V)/2,ne=q*k/2,$=X*k/2;a=new gr({points:Array.from(Array(5*2)).map((C,R)=>{const Z=-jn+R*x;return new T(O+(R%2?ne:q)*Math.cos(Z),W+(R%2?$:X)*Math.sin(Z))}),isFilled:o});break}case"rhombus":{const b=Math.min(t*.38,r*.38);a=new gr({points:[new T(b,0),new T(t,0),new T(t-b,r),new T(0,r)],isFilled:o});break}case"rhombus-2":{const b=Math.min(t*.38,r*.38);a=new gr({points:[new T(0,0),new T(t-b,0),new T(t,r),new T(b,r)],isFilled:o});break}case"trapezoid":{const b=Math.min(t*.38,r*.38);a=new gr({points:[new T(b,0),new T(t-b,0),new T(t,r),new T(0,r)],isFilled:o});break}case"arrow-right":{const b=Math.min(t,r)*.38,x=r*.16;a=new gr({points:[new T(0,x),new T(t-b,x),new T(t-b,0),new T(t,r/2),new T(t-b,r),new T(t-b,r-x),new T(0,r-x)],isFilled:o});break}case"arrow-left":{const b=Math.min(t,r)*.38,x=r*.16;a=new gr({points:[new T(b,0),new T(b,x),new T(t,x),new T(t,r-x),new T(b,r-x),new T(b,r),new T(0,r/2)],isFilled:o});break}case"arrow-up":{const b=t*.16,x=Math.min(t,r)*.38;a=new gr({points:[new T(t/2,0),new T(t,x),new T(t-b,x),new T(t-b,r),new T(b,r),new T(b,x),new T(0,x)],isFilled:o});break}case"arrow-down":{const b=t*.16,x=Math.min(t,r)*.38;a=new gr({points:[new T(b,0),new T(t-b,0),new T(t-b,r-x),new T(t,r-x),new T(t/2,r),new T(0,r-x),new T(b,r-x)],isFilled:o});break}case"check-box":case"x-box":case"rectangle":{a=new ga({width:t,height:r,isFilled:o});break}case"heart":{const x=xP(t,r).reduce((E,M)=>(E.push(...M.vertices),E),[]);a=new gr({points:x,isFilled:o});break}default:Pr(e.props.geo)}const c=Hm(this.editor,e),u=t/e.props.scale,d=r/e.props.scale,f=Math.min(100,u/2),g=Math.min(cc[e.props.size]*Pi.lineHeight+Vs*2,d/2),m=Math.min(u,Math.max(c.w,Math.min(f,Math.max(1,u-8)))),v=Math.min(d,Math.max(c.h,Math.min(g,Math.max(1,d-8)))),w=CE(e.props,Ci[e.props.size]*e.props.scale),S=w?w.map(b=>new kh({points:b})):[];return new to({children:[a,new ga({x:e.props.align==="start"?0:e.props.align==="end"?(u-m)*e.props.scale:(u-m)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(d-v)*e.props.scale:(d-v)/2*e.props.scale,width:m*e.props.scale,height:v*e.props.scale,isFilled:!0,isLabel:!0}),...S]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),r=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[t.bounds.center]};default:Pr(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:i.trimEnd()}}])}component(e){const{id:t,type:r,props:i}=e,{fill:s,font:o,align:a,verticalAlign:c,size:u,text:d}=i,f=io(),{editor:g}=this,m=xe("isGeoOnlySelected",()=>e.id===g.getOnlySelectedShapeId(),[]),w=g.getEditingShapeId()!==null||e.props.text,S=xe("force solid",()=>g.getZoomLevel()<.2,[g]);return p.jsxs(p.Fragment,{children:[p.jsx(yl,{children:p.jsx(vD,{shape:e,shouldScale:!0,forceSolid:S})}),w&&p.jsx(hl,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+i.growY},children:p.jsx(qw,{shapeId:t,type:r,font:o,fontSize:cc[u]*e.props.scale,lineHeight:Pi.lineHeight,padding:Vs*e.props.scale,fill:s,align:a,verticalAlign:c,text:d,isSelected:m,labelColor:f[i.labelColor].solid,wrap:!0})}),e.props.url&&p.jsx(fh,{url:e.props.url})]})}indicator(e){const{id:t,props:r}=e,{w:i,size:s}=r,o=r.h+r.growY,a=Ci[s],c=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?p.jsx("path",{d:Xle(t,i,o,a)}):p.jsx("path",{d:c.getSvgPathData(!0)});case"heart":return p.jsx("path",{d:$U(i,o)});case"oval":return p.jsx("path",{d:c.getSvgPathData(!0)});case"cloud":return p.jsx("path",{d:EE(i,o,t,s,e.props.scale)});default:{const u=this.editor.getShapeGeometry(e),d=u instanceof to?u.children[0].vertices:u.vertices;let f;if(r.dash==="draw"){const m=IE(t,d,0,a*2*e.props.scale,1);f=_E(m)}else f="M"+d[0]+"L"+d.slice(1)+"Z";const g=CE(e.props,a);if(g)for(const[m,v]of g)f+=`M${m.x},${m.y}L${v.x},${v.y}`;return p.jsx("path",{d:f})}}}toSvg(e,t){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},i=r.props;t.addExportDef(mP(i.fill));let s;if(i.text){t.addExportDef(Ww(i.font));const o=wc(t),a=new De(0,0,i.w,i.h+i.growY);s=p.jsx(Kw,{fontSize:cc[i.size],font:i.font,align:i.align,verticalAlign:i.verticalAlign,text:i.text,labelColor:o[i.labelColor].solid,bounds:a,padding:16})}return p.jsxs(p.Fragment,{children:[p.jsx(vD,{shouldScale:!1,shape:r,forceSolid:!1}),s]})}getCanvasSvgDefs(){return[yP()]}onResize(e,{handle:t,newPoint:r,scaleX:i,scaleY:s,initialShape:o}){const a=o.props.w/o.props.scale,c=o.props.h/o.props.scale,u=o.props.growY/o.props.scale;let d=a*i,f=(c+u)*s,g=0,m=0;const v=SD;if(e.props.text.trim()){let M=Math.max(Math.abs(d),v),j=Math.max(Math.abs(f),v);M<v&&j===v&&(M=v),M===v&&j<v&&(j=v);const D=Hm(this.editor,{...e,props:{...e.props,w:M*e.props.scale,h:j*e.props.scale}}),H=Math.max(Math.abs(d),D.w)*Math.sign(d),L=Math.max(Math.abs(f),D.h)*Math.sign(f);g=Math.abs(H)-Math.abs(d),m=Math.abs(L)-Math.abs(f),d=H,f=L}const w=d*e.props.scale,S=f*e.props.scale,b=new T(0,0);i<0&&(b.x+=w),(t==="left"||t==="top_left"||t==="bottom_left")&&(b.x+=i<0?g:-g),s<0&&(b.y+=S),(t==="top"||t==="top_left"||t==="top_right")&&(b.y+=s<0?m:-m);const{x,y:E}=b.rot(e.rotation).add(r);return{x,y:E,props:{w:Math.max(Math.abs(w),1),h:Math.max(Math.abs(S),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,r=Hm(this.editor,e).h;let i=null;if(r>t?i=r-t:e.props.growY&&(i=0),i!==null)return{...e,props:{...e.props,growY:i*e.props.scale}}}onBeforeUpdate(e,t){const r=e.props.text,i=t.props.text;if(r===i&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(r&&!i)return{...t,props:{...t.props,growY:0}};const s=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,c=Hm(this.editor,t);if(!r&&i&&i.length===1){let d=Math.max(s,c.w),f=Math.max(o,c.h);const g=SD;return s<g&&o<g&&(d=Math.max(d,g),f=Math.max(f,g),d=Math.max(d,f),f=Math.max(d,f)),{...t,props:{...t.props,w:d*t.props.scale,h:f*t.props.scale,growY:0}}}let u=null;if(c.h>o?u=c.h-o:a&&(u=0),u!==null){const d=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:u*t.props.scale,w:Math.max(d,c.w)*t.props.scale}}}if(c.w>s)return{...t,props:{...t.props,w:c.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:zt(e.props.w,t.props.w,r),h:zt(e.props.h,t.props.h,r),scale:zt(e.props.scale,t.props.scale,r)}}}G(My,"type","geo"),G(My,"props",uN),G(My,"migrations",dN);function Hm(n,e){const{text:t,font:r,size:i,w:s}=e.props;if(!t)return{w:0,h:0};const o=n.textMeasure.measureText("w",{...Pi,fontFamily:hc[r],fontSize:cc[i],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},c=n.textMeasure.measureText(t,{...Pi,fontFamily:hc[r],fontSize:cc[i],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+a[i]),Math.ceil(s/e.props.scale-Vs*2))});return{w:c.w+Vs*2,h:c.h+Vs*2}}function sue(){const[n,e]=P.useState(!1);return P.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),i=matchMedia("(color-gamut: p3)");e(r&&i.matches);const s=()=>e(r&&i.matches);return i.addEventListener("change",s),()=>i.removeEventListener("change",s)},[]),xe(mr.forceSrgb)||!n?"srgb":"p3"}const xD=.35,bD=.82;class Ty extends Ao{hideResizeHandles(e){return Wm(e)}hideRotateHandle(e){return Wm(e)}hideSelectionBoundsFg(e){return Wm(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=au(e);if(Wm(e))return new _2({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:r,sw:i}=_D(e,t,!0),s=SP({strokeWidth:i,showAsComplete:!0});return $w(r,s),new gr({points:fP(r,s),isFilled:!0})}component(e){const t=Bb(this.editor,e),r=au(e);return p.jsx(yl,{children:p.jsx(Km,{shape:e,forceSolid:t,strokeWidth:r,opacity:xD})})}backgroundComponent(e){const t=Bb(this.editor,e),r=au(e);return p.jsx(yl,{children:p.jsx(Km,{shape:e,forceSolid:t,strokeWidth:r,opacity:bD})})}indicator(e){const t=Bb(this.editor,e),r=au(e),{strokePoints:i,sw:s}=_D(e,r,t),o=ph(e.props.segments);let a;return i.length<2?a=aue(o[0],s):a=ju(i,!1),p.jsx("path",{d:a})}toSvg(e){const t=au(e),r=t<1.5,i=1/e.props.scale;return p.jsx("g",{transform:`scale(${i})`,children:p.jsx(Km,{forceSolid:r,strokeWidth:t,shape:e,opacity:xD})})}toBackgroundSvg(e){const t=au(e),r=t<1.5,i=1/e.props.scale;return p.jsx("g",{transform:`scale(${i})`,children:p.jsx(Km,{forceSolid:r,strokeWidth:t,shape:e,opacity:bD})})}onResize(e,t){const{scaleX:r,scaleY:i}=t,s=[];for(const o of e.props.segments)s.push({...o,points:o.points.map(({x:a,y:c,z:u})=>({x:r*a,y:i*c,z:u}))});return{props:{segments:s}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,...t.props,segments:NU(e.props.segments,t.props.segments,r),scale:zt(e.props.scale,t.props.scale,r)}}}G(Ty,"type","highlight"),G(Ty,"props",pN),G(Ty,"migrations",gN);function oue(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function aue(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function _D(n,e,t){var c;const r=ph(n.props.segments),i=n.props.isComplete||((c=Gr(n.props.segments))==null?void 0:c.type)==="straight";let s=e;!t&&!n.props.isPen&&r.length===1&&(s+=No(n.id)()*(e/6));const o=SP({strokeWidth:s,showAsComplete:i});return{strokePoints:wa(r,o),sw:s}}function au(n){return dh[n.props.size]*1.12*n.props.scale}function Wm(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function Km({strokeWidth:n,forceSolid:e,shape:t,opacity:r}){var g;const i=io(),s=ph(t.props.segments);let o=n;!e&&!t.props.isPen&&s.length===1&&(o+=No(t.id)()*(o/6));const a=SP({strokeWidth:o,showAsComplete:t.props.isComplete||((g=Gr(t.props.segments))==null?void 0:g.type)==="straight"}),c=wa(s,a),u=c.length>1?ju(c,!1):oue(t.props.segments[0].points[0]),d=sue(),f=i[t.props.color].highlight[d];return p.jsx("path",{d:u,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:f,strokeWidth:o,opacity:r})}function Bb(n,e){return xe("forceSolid",()=>{const t=au(e),r=n.getZoomLevel();return t/r<1.5},[n])}function HU(){return p.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),p.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),p.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function WU({shapeId:n,assetId:e}){const t=me(),r=!!Xp(),i=fQ(),[s,o]=P.useState(()=>({asset:e?t.getAsset(e)??null:null,url:null})),a=P.useRef(!1),c=P.useRef(null);return P.useEffect(()=>{if(!e)return;let u=!1,d;const f=To("update state",()=>{if(!r&&t.getCulledShapes().has(n))return;const g=t.getAsset(e);if(!g)return;const m=t.getShape(n);if(!m)return;if(!g.props.src){const w=t.getTemporaryAssetPreview(g.id);if(w){c.current!==w&&(c.current=w,o(S=>({...S,isPlaceholder:!0,url:w})),i());return}}const v=t.getZoomLevel()*(m.props.w/g.props.w);a.current?(ID(t,e,v,r,w=>{u||c.current!==w&&(c.current=w,o(()=>({asset:g,url:w})))}),d=ID.cancel):KU(t,e,v,r,w=>{u||(a.current=!0,c.current=w,o(()=>({asset:g,url:w})))})});return()=>{f(),d==null||d(),u=!0}},[t,e,r,i,n]),s}function KU(n,e,t,r,i){n.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:r}).then(s=>{i(s)})}const ID=H0(KU,500);function qU(){const[n,e]=P.useState(!1);return P.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}async function cue(n){const t=await(await fa(n)).blob();return Io.blobToDataUrl(t)}class ky extends jh{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let r=ww(e,t);const{flipX:i,flipY:s}=t.initialShape.props,{scaleX:o,scaleY:a,mode:c}=t;if(r={...r,props:{...r.props,flipX:o<0!==i,flipY:a<0!==s}},!e.props.crop)return r;const u=c==="scale_shape"&&o===-1||c==="resize_bounds"&&i!==r.props.flipX,d=c==="scale_shape"&&a===-1||c==="resize_bounds"&&s!==r.props.flipY,{topLeft:f,bottomRight:g}=e.props.crop;return r.props.crop={topLeft:{x:u?1-g.x:f.x,y:d?1-g.y:f.y},bottomRight:{x:u?1-f.x:g.x,y:d?1-f.y:g.y}},r}component(e){return p.jsx(lue,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:p.jsx("rect",{width:ge(e.props.w),height:ge(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});return r?((r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await cue(r)||""),p.jsx(due,{shape:e,src:r})):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const r=Un(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},i=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,o=new T(r.topLeft.x*i,r.topLeft.y*s).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:i,h:s}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,r){function i(s,o){var f,g,m,v;if(s.props.crop===null&&o.props.crop===null)return null;const a=((f=s.props.crop)==null?void 0:f.topLeft)||{x:0,y:0},c=((g=s.props.crop)==null?void 0:g.bottomRight)||{x:1,y:1},u=((m=o.props.crop)==null?void 0:m.topLeft)||{x:0,y:0},d=((v=o.props.crop)==null?void 0:v.bottomRight)||{x:1,y:1};return{topLeft:{x:zt(a.x,u.x,r),y:zt(a.y,u.y,r)},bottomRight:{x:zt(c.x,d.x,r),y:zt(c.y,d.y,r)}}}return{...r>.5?t.props:e.props,w:zt(e.props.w,t.props.w,r),h:zt(e.props.h,t.props.h,r),crop:i(e,t)}}}G(ky,"type","image"),G(ky,"props",mN),G(ky,"migrations",yN);const lue=P.memo(function({shape:e}){var b;const t=me(),{asset:r,url:i}=WU({shapeId:e.id,assetId:e.props.assetId}),s=qU(),[o,a]=P.useState(""),[c,u]=P.useState(null),d=uue(t,e);P.useEffect(()=>{if(i&&d){let x=!1;const E=hp();return E.onload=()=>{if(x)return;const M=document.createElement("canvas");M.width=E.width,M.height=E.height;const j=M.getContext("2d");j&&(j.drawImage(E,0,0),a(M.toDataURL()),u(i))},E.crossOrigin="anonymous",E.src=i,()=>{x=!0}}},[t,d,s,i]);const f=xe("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),g=s&&(((b=r==null?void 0:r.props.mimeType)==null?void 0:b.includes("video"))||d),m=GU(e),v=i===c?null:i,w=g?o:c;if(!i&&!(r!=null&&r.props.src))return p.jsxs(hl,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[p.jsx("div",{className:rt("tl-image-container",r&&"tl-image-container-loading"),style:m,children:r?null:p.jsx(HU,{})}),"url"in e.props&&e.props.url&&p.jsx(fh,{url:e.props.url})]});const S=d?"anonymous":void 0;return p.jsxs(p.Fragment,{children:[f&&w&&p.jsx("div",{style:m,children:p.jsx("img",{className:"tl-image",style:{...op(e),opacity:.1},crossOrigin:S,src:w,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),p.jsxs(hl,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[p.jsxs("div",{className:rt("tl-image-container"),style:m,children:[w&&p.jsx("img",{className:"tl-image",style:op(e),crossOrigin:S,src:w,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},w),v&&p.jsx("img",{className:"tl-image",style:op(e),crossOrigin:S,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>u(v)},v)]}),e.props.url&&p.jsx(fh,{url:e.props.url})]})]})});function uue(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):void 0;return t?"mimeType"in t.props&&Ps.isAnimatedImageType(t==null?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function GU(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,i=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,s=-t.x*r,o=-t.y*i;return{transform:`translate(${s}px, ${o}px)`,width:r,height:i}}function op(n,e){const{flipX:t,flipY:r}=n.props;if(!t&&!r)return;const i=`scale(${t?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${t?e.width:0}px, ${r?e.height:0}px)`:""} ${i}`,transformOrigin:e?"0 0":"center center"}}function due({shape:n,src:e}){const t=Mh(),r=GU(n),i=n.props.crop;if(r.transform&&i){const{transform:s,width:o,height:a}=r,c=(i.bottomRight.x-i.topLeft.x)*o,u=(i.bottomRight.y-i.topLeft.y)*a,d=[new T(0,0),new T(c,0),new T(c,u),new T(0,u)],f=op(n,{width:o,height:a});return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:t,children:p.jsx("polygon",{points:d.map(g=>`${g.x},${g.y}`).join(" ")})})}),p.jsx("g",{clipPath:`url(#${t})`,children:p.jsx("image",{href:e,width:o,height:a,style:f?{...f,transform:`${s} ${f.transform}`}:{transform:s}})})]})}else return p.jsx("image",{href:e,width:n.props.w,height:n.props.h,style:op(n,{width:n.props.w,height:n.props.h})})}function VU(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function YU(n,e,t){const r=e.vertices,i=VU(t);return wa(r,i)}function hue(n,e,t){const r=VU(t);return fP($w(YU(n,e,t),r),r)}function fue(n,e,t){const r=hue(n,e,t);return t2(r)}function pue(n,e,t){if(n.props.dash==="draw"){const r=YU(n,e,t);return ju(r)}return e.getSvgPathData()}function XU(n,e,t){let r=`M ${Qt(e[0])}L`,i=`M ${Qt(e[0])}L`;const s=t/3,o=t*2,a=No(n);let c=e[0],u,d=e[0],f;const g=e.length;for(let m=0,v=g-1;m<v;m++){u=e[m+1],f=T.AddXY(e[m+1],a()*s,a()*s);const w=T.Sub(u,c),S=T.Len(w),b=T.Div(w,S).mul(Math.min(S/4,o)),x=T.Add(c,b),E=T.Add(u,b.neg()),M=T.Sub(f,d),j=T.Len(M),D=T.Div(M,j).mul(Math.min(j/4,o)),H=T.Add(d,D),L=T.Add(f,D.neg());m===v-1?(r+=`${Qt(x)}L ${Qt(u)}`,i+=`${Qt(H)}L ${Qt(f)}`):(r+=`${Qt(x)}L ${Qt(E)}Q ${Qt(u)}`,i+=`${Qt(H)}L ${Qt(L)}Q ${Qt(f)}`,c=u,d=f)}return[r,r+i]}const gue=new ha;class Ay extends Ao{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=pp(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return Vf(e)}getHandles(e){return gue.get(e.props,()=>{const t=Vf(e),r=Gf(e),i=r.map(s=>({...s,id:s.index,type:"vertex",canSnap:!0}));for(let s=0;s<r.length-1;s++){const o=fp(r[s].index,r[s+1].index),c=t.segments[s].midPoint();i.push({id:o,type:"create",index:o,x:c.x,y:c.y,canSnap:!0})}return i.sort(_i)})}onResize(e,t){const{scaleX:r,scaleY:i}=t;return{props:{points:Np(e.props.points,(s,{id:o,index:a,x:c,y:u})=>({id:o,index:a,x:c*r,y:u*i}))}}}onBeforeCreate(e){const{props:{points:t}}=e,r=Object.keys(t);if(r.length<2)return;const i=t[r[0]];if(r.every(o=>{const a=t[o];return a.x===i.x&&a.y===i.y})){const o=r[r.length-1];return t[o]={...t[o],x:t[o].x+.1,y:t[o].y+.1},e}}onHandleDrag(e,{handle:t}){if(t.type!=="vertex")return;const r=jo(new T(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:r.x,y:r.y}}}}}component(e){return p.jsx(yl,{children:p.jsx(ED,{shape:e})})}indicator(e){const t=ua[e.props.size]*e.props.scale,r=Vf(e),{dash:i}=e.props;let s;if(e.props.spline==="line"){const o=r.points;if(i==="solid"||i==="dotted"||i==="dashed")s="M"+o[0]+"L"+o.slice(1);else{const[a]=XU(e.id,o,t);s=a}}else s=pue(e,r,t);return p.jsx("path",{d:s})}toSvg(e){return p.jsx(ED,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=Gf(e);return{points:t,getSelfSnapPoints:r=>{const i=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id);return t.filter((s,o)=>Math.abs(o-i)>1).map(T.From)},getSelfSnapOutline:r=>{const i=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id),s=Vf(e).segments.filter((o,a)=>a!==i-1&&a!==i);return s.length?new to({children:s}):null}}}getInterpolatedProps(e,t,r){const i=Gf(e),s=Gf(t),o=[],a=[];let c=Y4;if(i.length>s.length)for(let u=0;u<i.length;u++)o[u]={...i[u]},s[u]===void 0?a[u]={...s[s.length-1],id:c}:a[u]={...s[u],id:c},c=aa(c);else if(s.length>i.length)for(let u=0;u<s.length;u++)a[u]={...s[u]},i[u]===void 0?o[u]={...i[i.length-1],id:c}:o[u]={...i[u],id:c},c=aa(c);else for(let u=0;u<s.length;u++)o[u]=i[u],a[u]=s[u];return{...r>.5?t.props:e.props,points:Object.fromEntries(o.map((u,d)=>{const f=a[d];return[u.id,{...u,x:zt(u.x,f.x,r),y:zt(u.y,f.y,r)}]})),scale:zt(e.props.scale,t.props.scale,r)}}}G(Ay,"type","line"),G(Ay,"props",wN),G(Ay,"migrations",vN);function Gf(n){return Object.values(n.props.points).sort(_i)}function Vf(n){const e=Gf(n).map(T.From);switch(n.props.spline){case"cubic":return new hte({points:e});case"line":return new kh({points:e})}}function ED({shape:n,shouldScale:e=!1,forceSolid:t=!1}){const r=io(),i=Vf(n),{dash:s,color:o,size:a}=n.props,c=1/n.props.scale,u=e?c:1,d=ua[a]*n.props.scale;if(n.props.spline==="line"){if(s==="solid"){const f=i.points,g="M"+f[0]+"L"+f.slice(1);return p.jsx("path",{d:g,stroke:r[o].solid,strokeWidth:d,fill:"none",transform:`scale(${u})`})}if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[o].solid,strokeWidth:d,transform:`scale(${u})`,children:i.segments.map((f,g)=>{const{strokeDasharray:m,strokeDashoffset:v}=t?{strokeDasharray:"none",strokeDashoffset:"none"}:bo(f.length,d,{style:s,start:g>0?"outset":"none",end:g<i.segments.length-1?"outset":"none"});return p.jsx("path",{strokeDasharray:m,strokeDashoffset:v,d:f.getSvgPathData(!0),fill:"none"},g)})});if(s==="draw"){const f=i.points,[g,m]=XU(n.id,f,d);return p.jsx("path",{d:m,stroke:r[o].solid,strokeWidth:d,fill:"none",transform:`scale(${u})`})}}if(n.props.spline==="cubic"){const f=i.getSvgPathData();if(s==="solid")return p.jsx("path",{strokeWidth:d,stroke:r[o].solid,fill:"none",d:f,transform:`scale(${u})`});if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[o].solid,strokeWidth:d,transform:`scale(${u})`,children:i.segments.map((g,m)=>{const{strokeDasharray:v,strokeDashoffset:w}=bo(g.length,d,{style:s,start:m>0?"outset":"none",end:m<i.segments.length-1?"outset":"none",forceSolid:t});return p.jsx("path",{strokeDasharray:v,strokeDashoffset:w,d:g.getSvgPathData(),fill:"none"},m)})});if(s==="draw")return p.jsx("path",{d:fue(n,i,d),strokeWidth:1,stroke:r[o].solid,fill:r[o].solid,transform:`scale(${u})`})}}class Ry extends Ao{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:r}=ZU(this.editor,e),{scale:i}=e.props,s=t*i,o=r*i,a=yn*i,c=qm(e);return new to({children:[new ga({width:a,height:c,isFilled:!0}),new ga({x:e.props.align==="start"?0:e.props.align==="end"?a-o:(a-o)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?c-s:(c-s)/2,width:o,height:s,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const i=this.editor.getZoomLevel();if(i*t<.25)return[];const s=qm(e),o=yn*t,a=Dce/i*t;return i*t<.5?[{id:"bottom",index:"a3",type:"clone",x:o/2,y:s+a}]:[{id:"top",index:"a1",type:"clone",x:o/2,y:-a},{id:"right",index:"a2",type:"clone",x:o+a,y:s/2},{id:"bottom",index:"a3",type:"clone",x:o/2,y:s+a},{id:"left",index:"a4",type:"clone",x:-a,y:s/2}]}getText(e){return e.props.text}component(e){const{id:t,type:r,props:{labelColor:i,scale:s,color:o,font:a,size:c,align:u,text:d,verticalAlign:f,fontSizeAdjustment:g}}=e,m=wue(t),v=io(),w=yn*s,S=qm(e),b=xe("shape rotation",()=>{var j;return((j=this.editor.getShapePageTransform(t))==null?void 0:j.rotation())??0},[this.editor]),x=xe("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),E=xe("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),M=e.id===this.editor.getOnlySelectedShapeId();return p.jsxs(p.Fragment,{children:[p.jsx("div",{id:t,className:"tl-note__container",style:{width:w,height:S,backgroundColor:v[o].note.fill,borderBottom:x?E?`${2*s}px solid rgb(20, 20, 20)`:`${2*s}px solid rgb(144, 144, 144)`:"none",boxShadow:x?"none":vue(e.id,b,s)},children:p.jsx(qw,{shapeId:t,type:r,font:a,fontSize:(g||cc[c])*s,lineHeight:Pi.lineHeight,align:u,verticalAlign:f,text:d,isNote:!0,isSelected:M,labelColor:i==="black"?v[o].note.text:v[i].fill,wrap:!0,padding:16*s,onKeyDown:m})}),"url"in e.props&&e.props.url&&p.jsx(fh,{url:e.props.url})]})}indicator(e){const{scale:t}=e.props;return p.jsx("rect",{rx:t,width:ge(yn*t),height:ge(qm(e))})}toSvg(e,t){e.props.text&&t.addExportDef(Ww(e.props.font));const r=wc({isDarkMode:t.isDarkMode}),i=Sue(e);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{x:5,y:5,rx:1,width:yn-10,height:i.h,fill:"rgba(0,0,0,.1)"}),p.jsx("rect",{rx:1,width:yn,height:i.h,fill:r[e.props.color].note.fill}),p.jsx(Kw,{fontSize:e.props.fontSizeAdjustment||cc[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:i,stroke:!1})]})}onBeforeCreate(e){return CD(this.editor,e)}onBeforeUpdate(e,t){if(!(e.props.text===t.props.text&&e.props.font===t.props.font&&e.props.size===t.props.size))return CD(this.editor,t)}onEditEnd(e){const{id:t,type:r,props:{text:i}}=e;i.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:i.trimEnd()}}])}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,scale:zt(e.props.scale,t.props.scale,r)}}}G(Ry,"type","note"),G(Ry,"props",SN),G(Ry,"migrations",xN);function CD(n,e){const{labelHeight:t,fontSizeAdjustment:r}=ZU(n,e),i=Math.max(0,t-yn);if(i!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:i,fontSizeAdjustment:r}}}function mue(n,e){const{text:t}=e.props;if(!t)return{labelHeight:cc[e.props.size]*Pi.lineHeight+Vs*2,labelWidth:100,fontSizeAdjustment:0};const r=cc[e.props.size];let i=0,s=0,o=yn,a=yn;const c=1;do{i=Math.min(r,r-s);const u=n.textMeasure.measureText(t,{...Pi,fontFamily:hc[e.props.font],fontSize:i,maxWidth:yn-Vs*2-c,disableOverflowWrapBreaking:!0});if(o=u.h+Vs*2,a=u.w+Vs*2,i<=14){const d=n.textMeasure.measureText(t,{...Pi,fontFamily:hc[e.props.font],fontSize:i,maxWidth:yn-Vs*2-c});o=d.h+Vs*2,a=d.w+Vs*2;break}if(u.scrollWidth.toFixed(0)===u.w.toFixed(0))break}while(s++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:i}}const yue=new ha;function ZU(n,e){return yue.get(e,()=>mue(n,e))}function wue(n){const e=me(),t=Iz();return P.useCallback(r=>{const i=e.getShape(n);if(!i)return;const s=r.key==="Tab",o=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(s||o){r.preventDefault();const a=e.getShapePageTransform(n),c=a.rotation(),u=!!(t.dir==="rtl"||vU(i.props.text)),d=(yn+e.options.adjacentShapeMargin+(o&&!r.shiftKey?i.props.growY:0))*i.props.scale,f=new T(s?r.shiftKey!=u?-1:1:0,o?r.shiftKey?-1:1:0).mul(d).add(Hw.clone().mul(i.props.scale)).rot(c).add(a.point()),g=CU(e,i,f,c);g&&(e.markHistoryStoppingPoint("editing adjacent shape"),b0(e,g,!0))}},[n,e,t.dir])}function qm(n){return(yn+n.props.growY)*n.props.scale}function vue(n,e,t){const r=No(n),i=Math.abs(r())+.5,s=Math.cos(e),o=5*t,a=4*t,c=6*t,u=7*t;return`0px ${o-i}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+i*u)*Math.max(0,s)}px ${c+i*u}px -${a+i*c}px rgba(15, 23, 31, ${(.3+i*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+s)/2)).toFixed(2)})`}function Sue(n){return new De(0,0,yn,yn+n.props.growY)}function xue(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:i}){const s=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),o=new T(0,0);t<0&&(o.x=-(e.width*s)),r<0&&(o.y=-(e.height*s));const{x:a,y:c}=T.Add(i,o.rot(n.rotation));return{x:a,y:c,props:{scale:s*n.props.scale}}}const bue=new ha;class jy extends Ao{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return bue.get(e.props,t=>PD(this.editor,t))}getGeometry(e){const{scale:t}=e.props,{width:r,height:i}=this.getMinDimensions(e);return new ga({width:r*t,height:i*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:r,size:i,text:s,color:o,scale:a,textAlign:c}}=e,{width:u,height:d}=this.getMinDimensions(e),f=e.id===this.editor.getOnlySelectedShapeId(),g=io(),m=_ue(t);return p.jsx(qw,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:dh[i],lineHeight:Pi.lineHeight,align:c,verticalAlign:"middle",text:s,labelColor:g[o].solid,isSelected:f,textWidth:u,textHeight:d,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:m})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,r=me();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:p.jsx("rect",{width:ge(t.width),height:ge(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(Ww(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,i=r.width/(e.props.scale??1),s=r.height/(e.props.scale??1),o=wc(t);return p.jsx(Kw,{fontSize:dh[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:o[e.props.color].solid,bounds:new De(0,0,i,s),padding:0})}onResize(e,t){const{newPoint:r,initialBounds:i,initialShape:s,scaleX:o,handle:a}=t;if(t.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...xue(e,t)};{const c=Math.max(1,Math.abs(i.width*o)),{x:u,y:d}=o<0?T.Sub(r,T.FromAngle(e.rotation).mul(c)):r;return{id:e.id,type:e.type,x:u,y:d,props:{w:c/s.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:r,props:{text:i}}=e,s=e.props.text.trimEnd();s.length===0?this.editor.deleteShapes([e.id]):s!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:i.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,i=e.props.text!==t.props.text;if(!r&&!i)return;const s=this.getMinDimensions(e),o=PD(this.editor,t.props),a=s.width*e.props.scale,c=s.height*e.props.scale,u=o.width*t.props.scale,d=o.height*t.props.scale;let f;switch(t.props.textAlign){case"middle":{f=new T((u-a)/2,i?0:(d-c)/2);break}case"end":{f=new T(u-a,i?0:(d-c)/2);break}default:{if(i)break;f=new T(0,(d-c)/2);break}}if(f){f.rot(t.rotation);const{x:g,y:m}=t;return{...t,x:g-f.x,y:m-f.y,props:{...t.props,w:u}}}else return{...t,props:{...t.props,w:u}}}}G(jy,"type","text"),G(jy,"props",bN),G(jy,"migrations",_N);function PD(n,e){const{font:t,text:r,autoSize:i,size:s,w:o}=e,a=i?16:Math.max(16,o),c=dh[s],u=i?null:Math.floor(Math.max(a,o)),d=n.textMeasure.measureText(r,{...Pi,fontFamily:hc[t],fontSize:c,maxWidth:u});return i&&(d.w+=1),{width:Math.max(a,d.w),height:Math.max(c,d.h)}}function _ue(n){const e=me();return P.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{kt(t),t.shiftKey?hh.unindent(t.currentTarget):hh.indent(t.currentTarget);break}}},[e,n])}class Dy extends jh{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{asset:t,url:r}=WU({shapeId:e.id,assetId:e.props.assetId});return p.jsx(Iue,{editor:this.editor,shape:e,asset:t,url:r})}indicator(e){return p.jsx("rect",{width:ge(e.props.w),height:ge(e.props.h)})}async toSvg(e){const t=await Eue(this.editor,e);return t?p.jsx("image",{href:t,width:e.props.w,height:e.props.h}):null}}G(Dy,"type","video"),G(Dy,"props",IN),G(Dy,"migrations",EN);const Iue=P.memo(function({editor:e,shape:t,asset:r,url:i}){const s=e.getShapeGeometry(t).bounds.w*e.getZoomLevel()>=110,o=vw(t.id),a=qU(),{Spinner:c}=$n(),u=P.useRef(null),[d,f]=P.useState(!1),[g,m]=P.useState(!1);P.useEffect(()=>{const w=()=>m(document.fullscreenElement===u.current);return document.addEventListener("fullscreenchange",w),()=>document.removeEventListener("fullscreenchange",w)});const v=P.useCallback(w=>{w.currentTarget&&f(!0)},[]);return P.useEffect(()=>{const w=u.current;w&&o&&document.activeElement!==w&&w.focus()},[o,d]),P.useEffect(()=>{if(a){const w=u.current;if(!w)return;w.pause(),w.currentTime=0}},[u,a]),p.jsxs(p.Fragment,{children:[p.jsx(hl,{id:t.id,style:{color:"var(--color-text-3)",backgroundColor:r?"transparent":"var(--color-low)",border:r?"none":"1px solid var(--color-low-border)"},children:p.jsx("div",{className:"tl-counter-scaled",children:p.jsx("div",{className:"tl-video-container",children:r?c&&!r.props.src?p.jsx(c,{}):i?p.jsxs(p.Fragment,{children:[p.jsx("video",{ref:u,style:o?{pointerEvents:"all"}:d?void 0:{display:"none"},className:rt("tl-video",`tl-video-shape-${t.id.split(":")[1]}`,{"tl-video-is-fullscreen":g}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:o&&s,onLoadedData:v,hidden:!d,children:p.jsx("source",{src:i})}),!d&&c&&p.jsx(c,{})]}):null:p.jsx(HU,{})})})}),"url"in t.props&&t.props.url&&p.jsx(fh,{url:t.props.url})]})});async function Eue(n,e){const t=await n.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!t)return null;const r=await Ps.loadVideo(t);return Ps.getVideoFrameAsDataUrl(r,0)}const QU=[jy,Iy,Ey,My,Ry,Ay,Py,_y,Ty,Cy,ky,Dy];function Cue(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!n.isIn("select.editing_shape")){const r=n.getEditingShape();r&&r.type==="text"&&n.isInAny("text.pointing","select.resizing")&&n.getInstanceState().isToolLocked?n.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):n.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle")}}})}class JU extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"scribbleId","id");G(this,"markId","");G(this,"excludedShapeIds",new Set)}onEnter(t){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const o=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(o)}return!1}).map(s=>s.id));const i=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=i.id,this.update()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:t,excludedShapeIds:r}=this,i=t.getErasingShapeIds(),s=t.getZoomLevel(),o=t.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=t;this.pushPointToScribble();const u=new Set(i),d=this.editor.options.hitTestMargin/s;for(const f of o){if(t.isShapeOfType(f,"group"))continue;const g=t.getShapeMask(f.id);if(g&&!As(a,g))continue;const m=t.getShapeGeometry(f),v=t.getShapePageTransform(f);if(!m||!v)continue;const w=v.clone().invert(),S=w.applyToPoint(c),b=w.applyToPoint(a),{bounds:x}=m;x.minX-d>Math.max(S.x,b.x)||x.minY-d>Math.max(S.y,b.y)||x.maxX+d<Math.min(S.x,b.x)||x.maxY+d<Math.min(S.y,b.y)||m.hitTestLineSegment(S,b,d)&&u.add(t.getOutermostSelectableShape(f).id)}this.editor.setErasingShapes([...u].filter(f=>!r.has(f)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}G(JU,"id","erasing");var pI;let Pue=(pI=class extends Ye{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},G(pI,"id","idle"),pI);var gI;let Mue=(gI=class extends Ye{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,i=new Set,s=i.size;for(let o=t.length,a=o-1;a>=0;a--){const c=t[a];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const u=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(u,"frame")&&i.size>s)break;i.add(u.id)}}this.editor.setErasingShapes([...i])}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},G(gI,"id","pointing"),gI);class Oy extends Ye{static children(){return[Pue,Mue,JU]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}G(Oy,"id","eraser"),G(Oy,"initial","idle"),G(Oy,"isLockable",!1);class e$ extends Ye{constructor(){super(...arguments);G(this,"initialCamera",new T)}onEnter(){this.initialCamera=T.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:t,editor:r}=this,{currentScreenPoint:i,originScreenPoint:s}=r.inputs,o=T.Sub(i,s).div(r.getZoomLevel());o.len2()!==0&&r.setCamera(t.clone().add(o))}complete(){const{editor:t}=this,{pointerVelocity:r}=t.inputs,i=Math.min(r.len(),2);i>.1&&this.editor.slideCamera({speed:i,direction:r}),this.parent.transition("idle")}}G(e$,"id","dragging");var mI;let Tue=(mI=class extends Ye{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},G(mI,"id","idle"),mI);var yI;let kue=(yI=class extends Ye{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},G(yI,"id","pointing"),yI);class Ly extends Ye{static children(){return[Tue,kue,e$]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:Or.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:Or.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:Or.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:Or.easeOutQuint}})}}}G(Ly,"id","hand"),G(Ly,"initial","idle"),G(Ly,"isLockable",!1);var wI;let Aue=(wI=class extends Ye{onPointerDown(e){this.parent.transition("lasering",e)}},G(wI,"id","idle"),wI);class t$ extends Ye{constructor(){super(...arguments);G(this,"scribbleId","id")}onEnter(){const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}G(t$,"id","lasering");class Ny extends Ye{static children(){return[Aue,t$]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}G(Ny,"id","laser"),G(Ny,"initial","idle"),G(Ny,"isLockable",!1);class n$ extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"initialSelectedShapeIds",[]);G(this,"excludedShapeIds",new Set);G(this,"isWrapMode",!1);G(this,"initialStartShape",null)}onEnter(t){const{altKey:r,currentPagePoint:i}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(i)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(t){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)}onKeyDown(t){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:r,isWrapMode:i}=this,{inputs:{originPagePoint:s,currentPagePoint:o,shiftKey:a,ctrlKey:c}}=t,u=new Set(a?this.initialSelectedShapeIds:[]),d=i?!c:c,f=De.FromPoints([s,o]),{corners:g}=f;let m,v,w,S,b,x;const E=t.getCurrentPageRenderingShapesSorted(),M=t.getCurrentPageId();e:for(let H=0,L=E.length;H<L;H++){if(w=E[H],r.has(w.id)||u.has(w.id)||(S=t.getShapePageBounds(w),!S))continue e;if(f.contains(S)){this.handleHit(w,o,M,u,g);continue e}if(d||t.isShapeOfType(w,"frame"))continue e;if(f.collides(S)){if(b=t.getShapePageTransform(w),!b)continue e;x=b.clone().invert().applyToPoints(g);const U=t.getShapeGeometry(w);t:for(let z=0;z<4;z++)if(m=x[z],v=x[(z+1)%4],U.hitTestLineSegment(m,v,0)){this.handleHit(w,o,M,u,g);break t}}}const j=t.getInstanceState().brush;(!j||!f.equals(j))&&t.updateInstanceState({brush:{...f.toJson()}});const D=t.getSelectedShapeIds();(D.length!==u.size||D.some(H=>!u.has(H)))&&t.setSelectedShapes(Array.from(u))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(t,r,i,s,o){if(t.parentId===i){s.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),c=this.editor.getShapeMask(a.id);c&&!l2(c,o)&&!As(r,c)||s.add(a.id)}}G(n$,"id","brushing");const gh={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class r$ extends Ye{constructor(){super(...arguments);G(this,"info",{})}updateCursor(){const t=this.editor.getSelectedShapes(),r=gh[this.info.handle];this.editor.setCursor({type:r,rotation:t.length===1?this.editor.getSelectionRotation():0})}onEnter(t){this.info=t,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}G(r$,"id","pointing_resize_handle");const Ks=8;class bP extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"markId","");G(this,"snapshot",{})}onEnter(t){this.info=t,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=gh[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const s=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=o.clone().sub(a).rot(-t.rotation),u=s.crop??this.getDefaultCrop(),d=Un(u),f=new T(t.x,t.y),g=new T(0,0),m=1/(u.bottomRight.x-u.topLeft.x)*s.w,v=1/(u.bottomRight.y-u.topLeft.y)*s.h;let w=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(v<Ks)break;w=!0,d.topLeft.y=d.topLeft.y+c.y/v,v*(d.bottomRight.y-d.topLeft.y)<Ks?(d.topLeft.y=d.bottomRight.y-Ks/v,g.y=(d.topLeft.y-u.topLeft.y)*v):d.topLeft.y<=0?(d.topLeft.y=0,g.y=(d.topLeft.y-u.topLeft.y)*v):g.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(v<Ks)break;w=!0,d.bottomRight.y=Math.min(1,d.bottomRight.y+c.y/v),v*(d.bottomRight.y-d.topLeft.y)<Ks&&(d.bottomRight.y=d.topLeft.y+Ks/v);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(m<Ks)break;w=!0,d.topLeft.x=d.topLeft.x+c.x/m,m*(d.bottomRight.x-d.topLeft.x)<Ks?(d.topLeft.x=d.bottomRight.x-Ks/m,g.x=(d.topLeft.x-u.topLeft.x)*m):d.topLeft.x<=0?(d.topLeft.x=0,g.x=(d.topLeft.x-u.topLeft.x)*m):g.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(m<Ks)break;w=!0,d.bottomRight.x=Math.min(1,d.bottomRight.x+c.x/m),m*(d.bottomRight.x-d.topLeft.x)<Ks&&(d.bottomRight.x=d.topLeft.x+Ks/m);break}}if(!w)return;f.add(g.rot(t.rotation));const S={id:t.id,type:t.type,x:f.x,y:f.y,props:{crop:d,w:(d.bottomRight.x-d.topLeft.x)*m,h:(d.bottomRight.y-d.topLeft.y)*v}};this.editor.updateShapes([S]),this.updateCursor()}complete(){this.updateShapes(),An(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,i=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),o=T.RotWith(s.getHandlePoint(this.info.handle),s.point,t),a=T.Sub(r,o);return{shape:i,cursorHandleOffset:a}}}G(bP,"id","cropping");function i$(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:r}}=n;return n.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(r)}function s$(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const i=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;i==="x"?t.x=0:i==="y"&&(t.y=0),t.rot(-e.rotation);const s=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,o=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,u=Un(r);return u.topLeft.x=Math.min(1-c,Math.max(0,u.topLeft.x-t.x/s)),u.topLeft.y=Math.min(1-a,Math.max(0,u.topLeft.y-t.y/o)),u.bottomRight.x=u.topLeft.x+c,u.bottomRight.y=u.topLeft.y+a,{id:e.id,type:e.type,props:{crop:u}}}var vI;let Rue=(vI=class extends Ye{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var t;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=i$(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var s;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const i=this.editor.getShapeUtil(r);if(i){if(e.target==="selection"){(s=i.onDoubleClickEdge)==null||s.call(i,r);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new T(0,0);if(t.has("ArrowLeft")&&(i.x+=1),t.has("ArrowRight")&&(i.x-=1),t.has("ArrowUp")&&(i.y+=1),t.has("ArrowDown")&&(i.y-=1),i.equals(new T(0,0)))return;r&&i.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const o=s$(this.editor,s,i);o&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([o]))}},G(vI,"id","idle"),vI);class o$ extends Ye{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}G(o$,"id","pointing_crop");class _P extends Ye{constructor(){super(...arguments);G(this,"info",{})}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const i=gh[this.info.handle];this.editor.setCursor({type:i,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}G(_P,"id","pointing_crop_handle");class a$ extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"markId","");G(this,"snapshot",{})}onEnter(t){this.info=t,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(t){switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(t){switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:i}=this.editor.inputs,s=i.clone().sub(r),o=s$(this.editor,t,s);o&&this.editor.updateShapes([o])}}G(a$,"id","translating_crop");class PE extends Ye{constructor(){super(...arguments);G(this,"markId","");G(this,"didExit",!1)}static children(){return[Rue,a$,o$,_P,bP]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}G(PE,"id","crop"),G(PE,"initial","idle");class c$ extends Ye{constructor(){super(...arguments);G(this,"shapeId","");G(this,"initialHandle",{});G(this,"initialAdjacentHandle",null);G(this,"initialPagePoint",{});G(this,"markId","");G(this,"initialPageTransform");G(this,"initialPageRotation");G(this,"info",{});G(this,"isPrecise",!1);G(this,"isPreciseId",null);G(this,"pointingId",null);G(this,"exactTimeout",-1)}onEnter(t){const{shape:r,isCreating:i,creatingMarkId:s,handle:o}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId="",i)if(s)this.markId=s;else{const u=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);u&&(this.markId=u)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=Un(o),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[o.index]:{id:o.index,index:o.index,x:o.x,y:o.y}}}});const d=this.editor.getShapeHandles(r).find(f=>f.index===o.index);this.initialHandle=Un(d)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:i?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(r).sort(_i),c=a.findIndex(u=>u.id===t.handle.id);this.initialAdjacentHandle=null;for(let u=c+1;u<a.length;u++){const d=a[u];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(!this.initialAdjacentHandle)for(let u=a.length-1;u>=0;u--){const d=a[u];if(d.type==="vertex"&&d.id!=="middle"&&d.id!==t.handle.id){this.initialAdjacentHandle=d;break}}if(this.editor.isShapeOfType(r,"arrow")){const u=as(this.editor,r)[t.handle.id];this.isPrecise=!1,u?(this.editor.setHintingShapes([u.toId]),this.isPrecise=u.props.isPrecise,this.isPrecise?this.isPreciseId=u.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),An(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var H;const{editor:t,shapeId:r,initialPagePoint:i}=this,{initialHandle:s,initialPageRotation:o,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),u=this.editor.user.getIsSnapMode(),{snaps:d,inputs:{currentPagePoint:f,shiftKey:g,ctrlKey:m,altKey:v,pointerVelocity:w}}=t,S=this.info.shape,b=t.getShape(r);if(!b)return;const x=t.getShapeUtil(b);let E=f.clone().sub(i).rot(-o).add(s);if(g&&a&&s.id!=="middle"){const L=T.Angle(a,E),z=h0(L,24)-L;E=T.RotWith(E,a,z)}t.snaps.clearIndicators();let M={...s,x:E.x,y:E.y};if(s.canSnap&&(u?!m:m)){if(!t.getShapePageTransform(b.id))throw Error("Expected a page transform");const U=d.handles.snapHandle({currentShapeId:r,handle:M});U&&(U.nudge.rot(-t.getShapeParentTransform(b).rotation()),E.add(U.nudge),M={...s,x:E.x,y:E.y})}const j=(H=x.onHandleDrag)==null?void 0:H.call(x,b,{handle:M,isPrecise:this.isPrecise||v,initial:S}),D={id:b.id,type:b.type,...j};if(s.type==="vertex"&&this.editor.isShapeOfType(b,"arrow")){const L=as(t,b)[s.id];L?c[0]!==L.toId&&(t.setHintingShapes([L.toId]),this.pointingId=L.toId,this.isPrecise=w.len()<.5||v,this.isPreciseId=this.isPrecise?L.toId:null,this.resetExactTimeout()):c.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}j&&t.updateShapes([D])}}G(c$,"id","dragging_handle");function l$(n){return n.isLabel?[n]:n instanceof to?n.children.filter(e=>e.isLabel):[]}class u$ extends Ye{constructor(){super(...arguments);G(this,"hitShapeForPointerUp",null);G(this,"info",{})}onEnter(t){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=t,t.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),tc(this.editor),this.editor.select(r)}onExit(){var s;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),tc.cancel();const r=this.editor.getShape(t),i=this.editor.getShapeUtil(r);(s=i.onEditEnd)==null||s.call(i,r),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(t){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{tc(this.editor);return}}}onPointerDown(t){switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:r}=t,i=this.editor.getEditingShape();if(!i)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),o=l$(s),a=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(i,"text")&&i.props.text.trim()==="";if(a&&!c){const u=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(u,0)&&a.hitTestPoint(u)){if(r.id===i.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===i.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)}onPointerUp(t){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const i=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getIsReadonly()&&!i.canEditInReadOnly(r)){this.parent.transition("pointing_shape",t);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),tc(this.editor)}}onComplete(t){this.parent.transition("idle",t)}onCancel(t){this.parent.transition("idle",t)}}G(u$,"id","editing_shape");function MD(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function A0(n,e){const t=n.getSelectedShapeIds(),{currentPagePoint:r}=n.inputs,{shiftKey:i,altKey:s,accelKey:o}=e,a=i||o,c=n.getShapeAtPoint(r,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:u=>!u.isLocked});if(c){const u=n.getOutermostSelectableShape(c);if(a&&!s)n.cancelDoubleClick(),t.includes(u.id)?(n.markHistoryStoppingPoint("deselecting shape"),n.deselect(u)):(n.markHistoryStoppingPoint("shift selecting shape"),n.setSelectedShapes([...t,u.id]));else{let d;u===c||u.id===n.getFocusedGroupId()||t.includes(u.id)?d=c:d=u,d&&!t.includes(d.id)&&(n.markHistoryStoppingPoint("selecting shape"),n.select(d.id))}}else{if(a)return;{t.length>0&&(n.markHistoryStoppingPoint("selecting none"),n.selectNone());const u=n.getFocusedGroupId();if(is(u)){const d=n.getShape(u);n.isPointInShape(d,r,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const jue=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var SI;let Due=(SI=class extends Ye{onEnter(){this.parent.setCurrentToolIdMask(void 0),tc(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){tc.cancel()}onPointerMove(){tc(this.editor)}onPointerDown(e){const t=e.ctrlKey&&MD(this.editor);switch(e.target){case"canvas":{const r=i$(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&TD(this.editor,o)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e)}break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var t,r,i,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const o=this.editor.getHoveredShape(),a=o&&!this.editor.isShapeOfType(o,"group")?o:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(a){if(this.editor.isShapeOfType(a,"group")){A0(this.editor,e);return}else{const u=this.editor.getShape(a.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(c&&u.id===c)){A0(this.editor,e);return}}this.onDoubleClick({...e,shape:a,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const o=this.editor.getOnlySelectedShape();if(o){const a=this.editor.getShapeUtil(o);if(!this.canInteractWithShapeInReadOnly(o))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=a.onDoubleClickEdge)==null?void 0:t.call(a,o);if(c){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([c]),An(this.editor,[o.id]);return}}if(a.canCrop(o)&&!this.editor.isShapeOrAncestorLocked(o)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(o)&&this.startEditingShape(o,e,!0)}break}case"shape":{const{shape:o}=e,a=this.editor.getShapeUtil(o);if(o.type!=="video"&&o.type!=="embed"&&this.editor.getIsReadonly())break;if(a.onDoubleClick){const c=(r=a.onDoubleClick)==null?void 0:r.call(a,o);if(c){this.editor.updateShapes([c]);return}}if(a.canCrop(o)&&!this.editor.isShapeOrAncestorLocked(o)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((i=e.shape)==null?void 0:i.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(o)?this.startEditingShape(o,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:o,handle:a}=e,c=this.editor.getShapeUtil(o),u=(s=c.onDoubleClickHandle)==null?void 0:s.call(c,o,a);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(o)&&this.startEditingShape(o,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const i=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((i.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&TD(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,i=this.editor.getOutermostSelectableShape(r,s=>!t.includes(s.id));!t.includes(i.id)&&!this.editor.findShapeAncestor(i,s=>t.includes(s.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([i.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(mr.editOnType.get()&&!jue.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(i=>this.editor.isShapeOfType(i,"group"))){this.editor.setSelectedShapes(t.flatMap(i=>this.editor.getSortedChildIdsForParent(i.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}MD(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),b0(this.editor,e,r),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&As(t,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=wn(),{x:r,y:i}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:i,props:{text:"",autoSize:!0}}]);const s=this.editor.getShape(t);if(!s)return;const o=this.editor.getShapeUtil(s);this.editor.getIsReadonly()&&!o.canEditInReadOnly(s)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),i=new T(0,0);if(t.has("ArrowLeft")&&(i.x-=1),t.has("ArrowRight")&&(i.x+=1),t.has("ArrowUp")&&(i.y-=1),t.has("ArrowDown")&&(i.y+=1),i.equals(new T(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:s}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?r?s*Nue:s:r?Oue:Lue,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,i.mul(o)),An(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},G(SI,"id","idle"),SI);const Oue=10,Lue=1,Nue=5;function TD(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?As(e,t.corners.map(i=>T.RotWith(i,t.point,r))):t.containsPoint(e)}class d$ extends Ye{constructor(){super(...arguments);G(this,"shapeId","");G(this,"markId","");G(this,"wasAlreadySelected",!1);G(this,"didDrag",!1);G(this,"didCtrlOnEnter",!1);G(this,"info",{});G(this,"_labelDragOffset",new T(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(t){const{shape:r}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=t.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,o);this._labelDragOffset=T.Sub(s.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:t}=this.editor.inputs;if(!t)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const i=la(this.editor,r),s=this.editor.getShapeGeometry(r),o=s.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),c=o.nearestPoint(T.Add(a,this._labelDragOffset));let u;if(i.isStraight){const d=T.Dist(i.start.point,i.end.point);u=1-T.Dist(i.end.point,c)/d}else{const{_center:d,measure:f,angleEnd:g,angleStart:m}=s.children[0];u=jI(f,m,g,d.angle(c))}isNaN(u)&&(u=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:u}})}onPointerUp(){const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}G(d$,"id","pointing_arrow_label");class h$ extends Ye{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){A0(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}G(h$,"id","pointing_canvas");class f$ extends Ye{constructor(){super(...arguments);G(this,"didCtrlOnEnter",!1);G(this,"info",{})}onEnter(t){this.info=t,this.didCtrlOnEnter=t.accelKey;const{shape:r}=t;if(this.editor.isShapeOfType(r,"arrow")){const i=as(this.editor,r)[t.handle.id];i&&this.editor.setHintingShapes([i.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:t,handle:r}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:i}=this,s=kD(i,t,r,!1);if(s){b0(i,s,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(t){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:t}=this;if(t.getIsReadonly())return;const{shape:r,handle:i}=this.info;if(t.isShapeOfType(r,"note")){const s=kD(t,r,i,!0);if(s){const o=t.getPointInParentSpace(s,t.inputs.originPagePoint).sub(T.Rot(Hw.clone().mul(r.props.scale),s.rotation));t.updateShape({...s,x:o.x,y:o.y}),t.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{b0(t,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}G(f$,"id","pointing_handle");function kD(n,e,t,r){const i=n.getShapePageTransform(e.id),s=i.point(),o=i.rotation(),c=IU(n,s,o,e.props.growY,0,e.props.scale)[t.index];if(c)return CU(n,e,c,o,r)}class p$ extends Ye{constructor(){super(...arguments);G(this,"info",{})}updateCursor(){this.editor.setCursor({type:gh[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(t){this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}G(p$,"id","pointing_rotate_handle");class g$ extends Ye{constructor(){super(...arguments);G(this,"info",{})}onEnter(t){this.info=t}onPointerUp(t){A0(this.editor,t),this.parent.transition("idle",t)}onPointerMove(t){this.editor.inputs.isDragging&&this.startTranslating(t)}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||this.parent.transition("translating",t)}onDoubleClick(t){var s,o;const r=this.editor.getHoveredShape(),i=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(i){this.parent.transition("idle"),(o=(s=this.parent).onDoubleClick)==null||o.call(s,{...t,target:"shape",shape:this.editor.getShape(i)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}G(g$,"id","pointing_selection");class m$ extends Ye{constructor(){super(...arguments);G(this,"hitShape",{});G(this,"hitShapeForPointerUp",{});G(this,"isDoubleClick",!1);G(this,"didCtrlOnEnter",!1);G(this,"didSelectOnEnter",!1)}onEnter(t){const r=this.editor.getSelectedShapeIds(),i=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o}}=this.editor,{shiftKey:a,altKey:c,accelKey:u}=t;this.hitShape=t.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=u;const d=this.editor.getOutermostSelectableShape(t.shape),f=this.editor.findShapeAncestor(d,g=>r.includes(g.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(t.shape).onClick||d.id===s||r.includes(d.id)||f||r.length>1&&(i!=null&&i.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=d;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(d.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,d.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([d.id]))}onPointerUp(t){var d;const r=this.editor.getSelectedShapeIds(),i=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o}}=this.editor,a=t.shiftKey||t.accelKey,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,u=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(u){const f=this.editor.getShapeUtil(u);if(f.onClick){const g=(d=f.onClick)==null?void 0:d.call(f,u);if(g){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([g]),this.parent.transition("idle",t);return}}if(u.id===i){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const f=this.editor.getOutermostSelectableShape(c,g=>!r.includes(g.id));if(r.includes(f.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(u);else if(r.includes(u.id)){if(r.length===1){const g=this.editor.getShapeUtil(u).getGeometry(u),m=l$(g),v=m.length===1?m[0]:void 0;if(v){const w=this.editor.getPointInShapeSpace(u,o);if(v.bounds.containsPoint(w,0)&&v.hitTestPoint(w)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(u.id);const S=this.editor.getShapeUtil(u);this.editor.getIsReadonly()&&!S.canEditInReadOnly(u)||(this.editor.setEditingShape(u.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:u.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(u.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(u);else if(a){const g=this.editor.getShapeAncestors(f);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(m=>!g.find(v=>v.id===m)),f.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([f.id])}this.parent.transition("idle",t)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(t){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startTranslating(t))}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",t))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}G(m$,"id","pointing_shape");class y$ extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"markId","");G(this,"didHoldCommand",!1);G(this,"creationCursorOffset",{x:0,y:0});G(this,"snapshot",{})}onEnter(t){const{isCreating:r=!1,creatingMarkId:i,creationCursorOffset:s={x:0,y:0}}=t;if(this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=s,this.snapshot=this._createSnapshot(),this.markId="",r)if(i)this.markId=i;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(An(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var a;const s=this.editor.getShapeUtil(i),o=(a=s.onResizeStart)==null?void 0:a.call(s,i);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:i})=>{var c;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(c=o.onResizeEnd)==null?void 0:c.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:i,shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:u,canShapesDeform:d}=this.snapshot;let f=r||!d;if(s.size===1){const L=[...s.values()][0];this.editor.isShapeOfType(L.shape,"text")&&(f=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:g}=this.editor.inputs,m=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),v=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!g){const{gridSize:L}=this.editor.getDocumentSettings();m.snapToGrid(L)}const w=this.info.handle,S=AD(w,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!g:g)&&u%jn===0){const{nudge:L}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:T.Sub(m,v),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:AD(w,u),isAspectRatioLocked:f,isResizingFromCenter:t});m.add(L)}const x=T.RotWith(t?o.center:o.getHandlePoint(S),o.point,u),E=T.Sub(m,x).rot(-u),M=T.Sub(v,x).rot(-u),j=T.DivV(E,M);Number.isFinite(j.x)||(j.x=1),Number.isFinite(j.y)||(j.y=1);const D=w==="top"||w==="bottom",H=w==="left"||w==="right";f?H?j.y=Math.abs(j.x):D?j.x=Math.abs(j.y):Math.abs(j.x)>Math.abs(j.y)?j.y=Math.abs(j.x)*(j.y<0?-1:1):j.x=Math.abs(j.y)*(j.x<0?-1:1):(D&&(j.x=1),H&&(j.y=1)),this.info.isCreating||this.updateCursor({dragHandle:w,isFlippedX:j.x<0,isFlippedY:j.y<0,rotation:u});for(const L of s.keys()){const U=s.get(L);this.editor.resizeShape(L,j,{initialShape:U.shape,initialBounds:U.bounds,initialPageTransform:U.pageTransform,dragHandle:w,mode:c.length===1&&L===c[0]?"resize_bounds":"scale_shape",scaleOrigin:x,isAspectRatioLocked:f,scaleAxisRotation:u,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:L,children:U}of i){if(!U.length)continue;const z=s.get(L).shape,Y=this.editor.getShape(L);if(!(z&&Y))continue;const V=Y.x-z.x,N=Y.y-z.y,_=new T(V,N).rot(-z.rotation);if(_.x!==0||_.y!==0)for(const k of U)this.editor.updateShape({id:k.id,type:k.type,x:k.x-_.x,y:k.y-_.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:L}of i)if(L.length)for(const U of L)this.editor.updateShape({id:U.id,type:U.type,x:U.x,y:U.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:i,rotation:s}){const o={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{o.type="nwse-resize",r!==i&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",r!==i&&(o.type="nwse-resize");break}}o.rotation=s,this.editor.setCursor(o)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:i}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),o=T.RotWith(s.getHandlePoint(this.info.handle),s.point,r),a=T.Sub(i,o),c=new Map,u=[];t.forEach(f=>{const g=this.editor.getShape(f);if(g){if(g.type==="frame"&&u.push({id:f,children:St(this.editor.getSortedChildIdsForParent(g).map(m=>this.editor.getShape(m)))}),c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")&&t.length===1)return;this.editor.visitDescendants(g.id,m=>{const v=this.editor.getShape(m);if(v&&(c.set(v.id,this._createShapeSnapshot(v)),this.editor.isShapeOfType(v,"frame")))return!1})}});const d=![...c.values()].some(f=>!kN(f.pageRotation,r)||f.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:s,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:d,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:u}}_createShapeSnapshot(t){const r=this.editor.getShapePageTransform(t),i=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:Re.Decompose(r).rotation,isAspectRatioLocked:i.isAspectRatioLocked(t)}}}G(y$,"id","resizing");const Fb=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function AD(n,e){e=e%un;const t=Math.round(e/(en/4)),r=Fb.indexOf(n);return Fb[(r+t)%Fb.length]}const RD=Math.PI/180;class w$ extends Ye{constructor(){super(...arguments);G(this,"snapshot",{});G(this,"info",{});G(this,"markId","")}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=B5({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const i=this._getRotationFromPointerPosition({snapToNearestDegree:!1});hy({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:gh[this.info.handle],rotation:i+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});hy({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:gh[this.info.handle],rotation:t+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){hy({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),An(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),i=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:o}}=this.editor,{initialCursorAngle:a,initialShapesRotation:c}=this.snapshot;if(!i)return c;const d=i.center.clone().rotWith(i.point,r).angle(o)-a;let f=c+d;if(s)f=h0(f,24);else if(t&&(f=Math.round(f/RD)*RD,this.editor.getInstanceState().isCoarsePointer)){const g=h0(f,4),m=ly(f,g);Math.abs(m)<JV(5)&&(f=g)}return f-c}}G(w$,"id","rotating");class v$ extends Ye{constructor(){super(...arguments);G(this,"hits",new Set);G(this,"size",0);G(this,"scribbleId","id");G(this,"initialSelectedShapeIds",new Set);G(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}updateScribbleSelection(t){const{editor:r}=this,i=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:s,originPagePoint:o,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:u,initialSelectedShapeIds:d}=this;t&&this.pushPointToScribble();const f=i;let g,m,v,w;const S=0;for(let E=0,M=f.length;E<M;E++){if(g=f[E],r.isShapeOfType(g,"group")||u.has(g.id)||r.isShapeOrAncestorLocked(g)||(m=r.getShapeGeometry(g),r.isShapeOfType(g,"frame")&&m.bounds.containsPoint(r.getPointInShapeSpace(g,o))))continue;const j=r.getShapePageTransform(g);if(!m||!j)continue;const D=j.clone().invert();v=D.applyToPoint(a),w=D.applyToPoint(c);const{bounds:H}=m;if(!(H.minX-S>Math.max(v.x,w.x)||H.minY-S>Math.max(v.y,w.y)||H.maxX+S<Math.min(v.x,w.x)||H.maxY+S<Math.min(v.y,w.y))&&m.hitTestLineSegment(v,w,S)){const L=this.editor.getOutermostSelectableShape(g),U=this.editor.getShapeMask(L.id);if(U&&a2(a,c,U)!==null&&!As(c,U))continue;u.add(L.id)}}const b=r.getSelectedShapeIds(),x=new Set(s?[...u,...d]:[...u]);(b.length!==x.size||b.some(E=>!x.has(E)))&&this.editor.setSelectedShapes(Array.from(x))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}G(v$,"id","scribble_brushing");var Bue=Object.create,S$=Object.defineProperty,Fue=Object.getOwnPropertyDescriptor,zue=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),x$=n=>{throw TypeError(n)},b$=(n,e,t)=>e in n?S$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Uue=n=>[,,,Bue(null)],_$=["class","method","getter","setter","accessor","field","value","get","set"],I$=n=>n!==void 0&&typeof n!="function"?x$("Function expected"):n,$ue=(n,e,t,r,i)=>({kind:_$[n],name:e,metadata:r,addInitializer:s=>t._?x$("Already initialized"):i.push(I$(s||null))}),Hue=(n,e)=>b$(e,zue("metadata"),n[3]),Wue=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},Kue=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=_$[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,Fue(i,t)),b=r.length-1;b>=0;b--)c=$ue(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,I$(o)&&(S[v]=o);return S&&S$(i,t,S),i},zb=(n,e,t)=>b$(n,typeof e!="symbol"?e+"":e,t),E$,Vw;const que=20,Gue=100;E$=[ls];class IP{constructor(e){this.editor=e,Wue(Vw,5,this),zb(this,"prevDroppingShapeId",null),zb(this,"droppingNodeTimer",null),zb(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.editor.setHintingShapes(e.map(i=>this.editor.findShapeAncestor(i,s=>s.type!=="group")).filter(i=>i)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,que,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,Gue,t))}setDragTimer(e,t,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var c,u,d,f,g;t=St(t.map(m=>this.editor.getShape(m.id)));const i=((c=this.editor.getDroppingOverShape(e,t))==null?void 0:c.id)??null;if(i===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:s}=this,o=s&&this.editor.getShape(s),a=i&&this.editor.getShape(i);o&&((d=(u=this.editor.getShapeUtil(o)).onDragShapesOut)==null||d.call(u,o,t)),a&&((g=(f=this.editor.getShapeUtil(a)).onDragShapesOver)==null||g.call(f,a,t)),this.hintParents(t),r==null||r(),this.prevDroppingShapeId=i}hintParents(e){const t=new Map;for(const i of e){const s=this.editor.findShapeAncestor(i,o=>o.type!=="group");s&&(t.has(s.id)||t.set(s.id,[]),t.get(s.id).push(i.id))}const r=[];for(const[i,s]of t){const o=this.editor.getShape(i);o&&xz(this.editor,o).length<s.length&&r.push(o.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,i;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const s=this.editor.getShape(t);if(!s)return;(i=(r=this.editor.getShapeUtil(s)).onDropShapesOver)==null||i.call(r,s,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}Vw=Uue();Kue(Vw,1,"dispose",E$,IP);Hue(Vw,IP);var Vue=Object.create,C$=Object.defineProperty,Yue=Object.getOwnPropertyDescriptor,P$=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),M$=n=>{throw TypeError(n)},T$=(n,e,t)=>e in n?C$(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Xue=n=>[,,,Vue((n==null?void 0:n[P$("metadata")])??null)],k$=["class","method","getter","setter","accessor","field","value","get","set"],A$=n=>n!==void 0&&typeof n!="function"?M$("Function expected"):n,Zue=(n,e,t,r,i)=>({kind:k$[n],name:e,metadata:r,addInitializer:s=>t._?M$("Already initialized"):i.push(A$(s||null))}),Que=(n,e)=>T$(e,P$("metadata"),n[3]),Jue=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},ede=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=k$[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,Yue(i,t)),b=r.length-1;b>=0;b--)c=Zue(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,A$(o)&&(S[v]=o);return S&&C$(i,t,S),i},Jc=(n,e,t)=>T$(n,typeof e!="symbol"?e+"":e,t),R$,ME,Yw;class Xw extends(ME=Ye,R$=[ls],ME){constructor(){super(...arguments),Jue(Yw,5,this),Jc(this,"info",{}),Jc(this,"selectionSnapshot",{}),Jc(this,"snapshot",{}),Jc(this,"markId",""),Jc(this,"isCloning",!1),Jc(this,"isCreating",!1),Jc(this,"dragAndDropManager",new IP(this.editor))}onCreate(e){}onEnter(e){var s;const{isCreating:t=!1,creatingMarkId:r,onCreate:i=()=>{}}=e;if(!((s=this.editor.getSelectedShapeIds())!=null&&s.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(r)this.markId=r;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=i,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=jD(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=jD(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),An(this.editor,this.snapshot.movingShapes.map(t=>t.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(r=>{var o;const i=this.editor.getShapeUtil(r),s=(o=i.onTranslateStart)==null?void 0:o.call(i,r);s&&t.push(s)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=T.Average(e.map(s=>this.editor.getShapePageTransform(s.id).point())),i=T.Sub(r,this.selectionSnapshot.averagePagePoint);T.IsNaN(i)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(s=>s.id),offset:{x:i.x,y:i.y}}})}const t=[];e.forEach(r=>{var a;const i=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r),o=(a=s.onTranslateEnd)==null?void 0:a.call(s,r,i);o&&t.push(o)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),tde({editor:this.editor,snapshot:e});const{movingShapes:t}=e,r=[];t.forEach(i=>{var c;const s=this.editor.getShape(i.id),o=this.editor.getShapeUtil(i),a=(c=o.onTranslate)==null?void 0:c.call(o,i,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(r=>{const i=e.getShape(r.shape.id);if(!i)return null;const s=es(i.parentId)?null:Re.Inverse(e.getShapePageTransform(i.parentId));r.parentTransform=s})}}Yw=Xue(ME);ede(Yw,1,"updateParentTransforms",R$,Xw);Que(Yw,Xw);Jc(Xw,"id","translating");function jD(n){var f;const e=[],t=[],r=n.getSelectedShapeIds(),i=St(r.map(g=>{const m=n.getShape(g);if(!m)return null;e.push(m);const v=n.getShapePageTransform(g),w=v.point(),S=v.rotation();t.push(w);const b=Ds.isId(m.parentId)?null:Re.Inverse(n.getShapePageTransform(m.parentId));return{shape:m,pagePoint:w,pageRotation:S,parentTransform:b}})),s=n.getOnlySelectedShape();let o=[];if(s)o=n.snaps.shapeBounds.getSnapPoints(s.id);else{const g=n.getSelectionPageBounds();g&&(o=g.cornersAndCenter.map((m,v)=>({id:"selection:"+v,x:m.x,y:m.y})))}let a,c;const{originPagePoint:u}=n.inputs,d=i.filter(g=>n.isShapeOfType(g.shape,"note")&&n.isPointInShape(g.shape,u));if(d.length!==0)if(d.length===1)c=d[0];else{const g=n.getCurrentPageShapesSorted();c=(f=d.map(m=>({snapshot:m,index:g.findIndex(v=>v.id===m.shape.id)})).sort((m,v)=>v.index-m.index)[0])==null?void 0:f.snapshot}return c&&(a=EU(n,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:T.Average(t),movingShapes:e,shapeSnapshots:i,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:c}}function tde({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:r,noteAdjacentPositions:i,initialPageBounds:s,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:c}=e,u=n.getInstanceState().isGridMode,d=n.getDocumentSettings().gridSize,f=T.Sub(t.currentPagePoint,t.originPagePoint),g=n.inputs.shiftKey?Math.abs(f.x)<Math.abs(f.y)?"x":"y":null;g==="x"?f.x=0:g==="y"&&(f.y=0),n.snaps.clearIndicators();const m=n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let v=!1;if(m&&n.inputs.pointerVelocity.len()<.5){const{nudge:x}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:f,initialSelectionPageBounds:s,lockedAxis:g,initialSelectionSnapPoints:o});f.add(x)}else if(r&&i){const{scale:x}=r.shape.props,E=r.pagePoint.clone().add(f).add(Hw.clone().mul(x).rot(r.pageRotation));let M=_U/n.getZoomLevel(),j=new T(0,0);for(const D of i){const H=T.Sub(E,D),L=H.len();L<M&&(v=!0,M=L,j=H)}f.sub(j)}const w=T.Add(c,f),S=n.snaps.getIndicators();u&&!t.ctrlKey&&!v&&S.length===0&&w.snapToGrid(d);const b=T.Sub(w,c);n.updateShapes(St(a.map(({shape:x,pagePoint:E,parentTransform:M})=>{const j=T.Add(E,b),D=M?Re.applyToPoint(M,j):j;return{id:x.id,type:x.type,x:D.x,y:D.y}})))}class By extends Ye{constructor(){super(...arguments);G(this,"reactor")}static children(){return[PE,bP,Due,h$,m$,Xw,n$,v$,_P,g$,r$,u$,y$,w$,p$,d$,f$,c$]}cleanUpDuplicateProps(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const i=new Set(r.duplicateProps.shapeIds);t.length===i.size&&t.every(s=>i.has(s))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=To("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){typeof process<"u",console.error(t)}})}onExit(){var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}G(By,"id","select"),G(By,"initial","idle"),G(By,"isLockable",!1);class j$ extends Ye{constructor(){super(...arguments);G(this,"info",{})}onEnter(t){this.info=t}onPointerDown(){this.parent.transition("pointing",this.info)}}G(j$,"id","idle");class D$ extends Ye{constructor(){super(...arguments);G(this,"info",{})}onEnter(t){this.info=t}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}G(D$,"id","pointing");class O$ extends Ye{constructor(){super(...arguments);G(this,"info",{});G(this,"zoomBrush",new De)}onEnter(t){this.info=t,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(De.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const i=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(i,{animation:{duration:220}}):this.editor.zoomIn(i,{animation:{duration:220}})}else{const i=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:i,animation:{duration:220}})}this.parent.transition("idle",this.info)}}G(O$,"id","zoom_brushing");class Fy extends Ye{constructor(){super(...arguments);G(this,"info",{})}static children(){return[j$,O$,D$]}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(t){this.updateCursor(),t.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}G(Fy,"id","zoom"),G(Fy,"initial","idle"),G(Fy,"isLockable",!1);const nde=[Oy,Ly,Ny,Fy,By];function rde(){const n=me(),e=xe("follow",()=>n.getInstanceState().followingUserId,[n]);return e?p.jsx(ide,{userId:e}):null}function ide({userId:n}){const e=iw(n);return e?p.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let TE={fonts:{draw:`${ol()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${ol()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${ol()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${ol()}/fonts/IBMPlexMono-Medium.woff2`}};function L$(n){return P.useMemo(()=>n?{fonts:{...TE.fonts,...n==null?void 0:n.fonts}}:TE,[n])}const sde=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let kf={...TE,icons:Object.fromEntries(sde.map(n=>[n,`${ol()}/icons/icon/0_merged.svg#${n}`])),translations:Object.fromEntries(wp.map(n=>[n.locale,`${ol()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(sP.map(n=>[n.type,`${ol()}/embed-icons/${n.type}.png`]))};function ode(n){return n?{fonts:Object.assign({...kf.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...kf.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...kf.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...kf.translations},{...n==null?void 0:n.translations})}:kf}function ade(){const{addToast:n,removeToast:e,clearToasts:t}=Ea(),{addDialog:r,clearDialogs:i,removeDialog:s}=Wu(),a=$i()<lr.TABLET_SM,c=Nt();return P.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,removeDialog:s,clearDialogs:i,msg:c,isMobile:a}),[r,n,i,t,c,s,e,a])}function cde(n,e){const t={};for(const r of n)if(r.translations)for(const[i,s]of Jr(r.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return{actions:(r,i)=>{for(const s of n)s.actions&&(i=s.actions(r,i,e));return i},tools:(r,i,s)=>{for(const o of n)o.tools&&(i=o.tools(r,i,{...e,...s}));return i},translations:t}}function N$(n){return P.useMemo(()=>n,n)}function lde(n){const e=N$(n==null?[]:Array.isArray(n)?n:[n]);return P.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[i,s]of Jr(r.translations)){let o=t[i];o||(o=t[i]={}),Object.assign(o,s)}return t},[e])}function ude(n){const e=ade(),t=N$(n==null?[]:Array.isArray(n)?n:[n]);return P.useMemo(()=>cde(t,e),[t,e])}var EP="Popover",[B$,J1e]=$u(EP,[Cw]),ag=Cw(),[dde,Al]=B$(EP),F$=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:i,onOpenChange:s,modal:o=!1}=n,a=ag(e),c=P.useRef(null),[u,d]=P.useState(!1),[f=!1,g]=Tl({prop:r,defaultProp:i,onChange:s});return p.jsx(L2,{...a,children:p.jsx(dde,{scope:e,contentId:ac(),triggerRef:c,open:f,onOpenChange:g,onOpenToggle:P.useCallback(()=>g(m=>!m),[g]),hasCustomAnchor:u,onCustomAnchorAdd:P.useCallback(()=>d(!0),[]),onCustomAnchorRemove:P.useCallback(()=>d(!1),[]),modal:o,children:t})})};F$.displayName=EP;var z$="PopoverAnchor",hde=P.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Al(z$,t),s=ag(t),{onCustomAnchorAdd:o,onCustomAnchorRemove:a}=i;return P.useEffect(()=>(o(),()=>a()),[o,a]),p.jsx(N2,{...s,...r,ref:e})});hde.displayName=z$;var U$="PopoverTrigger",$$=P.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Al(U$,t),s=ag(t),o=Dn(e,i.triggerRef),a=p.jsx(Vt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":G$(i.open),...r,ref:o,onClick:Ge(n.onClick,i.onOpenToggle)});return i.hasCustomAnchor?a:p.jsx(N2,{asChild:!0,...s,children:a})});$$.displayName=U$;var CP="PopoverPortal",[fde,pde]=B$(CP,{forceMount:void 0}),H$=n=>{const{__scopePopover:e,forceMount:t,children:r,container:i}=n,s=Al(CP,e);return p.jsx(fde,{scope:e,forceMount:t,children:p.jsx(Fo,{present:t||s.open,children:p.jsx(rg,{asChild:!0,container:i,children:r})})})};H$.displayName=CP;var mh="PopoverContent",W$=P.forwardRef((n,e)=>{const t=pde(mh,n.__scopePopover),{forceMount:r=t.forceMount,...i}=n,s=Al(mh,n.__scopePopover);return p.jsx(Fo,{present:r||s.open,children:s.modal?p.jsx(gde,{...i,ref:e}):p.jsx(mde,{...i,ref:e})})});W$.displayName=mh;var gde=P.forwardRef((n,e)=>{const t=Al(mh,n.__scopePopover),r=P.useRef(null),i=Dn(e,r),s=P.useRef(!1);return P.useEffect(()=>{const o=r.current;if(o)return B2(o)},[]),p.jsx(Tw,{as:Pu,allowPinchZoom:!0,children:p.jsx(K$,{...n,ref:i,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ge(n.onCloseAutoFocus,o=>{var a;o.preventDefault(),s.current||(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Ge(n.onPointerDownOutside,o=>{const a=o.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,u=a.button===2||c;s.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Ge(n.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1})})})}),mde=P.forwardRef((n,e)=>{const t=Al(mh,n.__scopePopover),r=P.useRef(!1),i=P.useRef(!1);return p.jsx(K$,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var o,a;(o=n.onCloseAutoFocus)==null||o.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:s=>{var c,u;(c=n.onInteractOutside)==null||c.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const o=s.target;((u=t.triggerRef.current)==null?void 0:u.contains(o))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&i.current&&s.preventDefault()}})}),K$=P.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:s,disableOutsidePointerEvents:o,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:d,...f}=n,g=Al(mh,t),m=ag(t);return C2(),p.jsx(bw,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:s,children:p.jsx(tg,{asChild:!0,disableOutsidePointerEvents:o,onInteractOutside:d,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>g.onOpenChange(!1),children:p.jsx(YB,{"data-state":G$(g.open),role:"dialog",id:g.contentId,...m,...f,ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),q$="PopoverClose",yde=P.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=Al(q$,t);return p.jsx(Vt.button,{type:"button",...r,ref:e,onClick:Ge(n.onClick,()=>i.onOpenChange(!1))})});yde.displayName=q$;var wde="PopoverArrow",vde=P.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,i=ag(t);return p.jsx(XB,{...i,...r,ref:e})});vde.displayName=wde;function G$(n){return n?"open":"closed"}var PP=F$,MP=$$,TP=H$,kP=W$;function AP({id:n,children:e,onOpenChange:t,open:r}){const[i,s]=vc(n,t);return p.jsx(PP,{onOpenChange:s,open:r||i,children:p.jsx("div",{className:"tlui-popover",children:e})})}function RP({children:n}){return p.jsx(MP,{asChild:!0,dir:"ltr",children:n})}function jP({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:i=0,disableEscapeKeyDown:s=!1}){const o=Mr();return p.jsx(TP,{container:o,children:p.jsx(kP,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:i,dir:"ltr",onEscapeKeyDown:a=>s&&a.preventDefault(),children:e})})}function Sde(n){return n.getSelectedShapeIds().map(r=>n.getShape(r)).filter(r=>{if(!r)return!1;if(n.isShapeOfType(r,"arrow")){const i=as(n,r);if(i.start||i.end)return!1}return!0})}const V$=()=>{const n=me();return xe("threeStackableItems",()=>Sde(n).length>2,[n])},Sc=()=>{const n=me();return xe("isInSelectState",()=>n.isIn("select"),[n])},Y$=()=>{const n=me();return xe("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const r=as(n,t);if(r.start&&!e.some(i=>i.id===r.start.toId)||r.end&&!e.some(i=>i.id===r.end.toId))return!1}return!0},[n])},X$=()=>{const n=me();return xe("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},xde=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function Z$(n,e){const t=me();return xe("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function Hi(n,e){const t=me();return xe("selectedShapes",()=>{const r=t.getSelectedShapes().filter(i=>!t.isShapeOrAncestorLocked(i)).length;return n===void 0?r:r>=n},[t])}function bde(){const n=me();return xe("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function Q$(){const n=me();return xe("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function _de(){const n=me();return xe("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function J$(){const n=me();return xe("useCanRedo",()=>n.getCanRedo(),[n])}function e7(){const n=me();return xe("useCanUndo",()=>n.getCanUndo(),[n])}function Ide(){return p.jsxs(p.Fragment,{children:[p.jsx(Ede,{}),p.jsx(Cde,{}),p.jsx(Pde,{}),p.jsx(Mde,{}),p.jsx(Tde,{}),p.jsx(Rde,{}),p.jsx(jde,{}),p.jsx(Dde,{})]})}function Ede(){const n=Hi(2),e=Sc(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"align-left",disabled:!t}),p.jsx(Ee,{actionId:"align-center-horizontal",disabled:!t}),p.jsx(Ee,{actionId:"align-right",disabled:!t}),p.jsx(Ee,{actionId:"stretch-horizontal",disabled:!t}),p.jsx(Ee,{actionId:"align-top",disabled:!t}),p.jsx(Ee,{actionId:"align-center-vertical",disabled:!t}),p.jsx(Ee,{actionId:"align-bottom",disabled:!t}),p.jsx(Ee,{actionId:"stretch-vertical",disabled:!t})]})}function Cde(){const n=Hi(3),e=Sc(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"distribute-horizontal",disabled:!t}),p.jsx(Ee,{actionId:"distribute-vertical",disabled:!t})]})}function Pde(){const n=V$(),e=Sc(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"stack-horizontal",disabled:!t}),p.jsx(Ee,{actionId:"stack-vertical",disabled:!t})]})}function Mde(){const n=Hi(1),e=Sc(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"send-to-back",disabled:!t}),p.jsx(Ee,{actionId:"send-backward",disabled:!t}),p.jsx(Ee,{actionId:"bring-forward",disabled:!t}),p.jsx(Ee,{actionId:"bring-to-front",disabled:!t})]})}function Tde(){return $i()<lr.TABLET_SM?p.jsx(kde,{}):p.jsx(Ade,{})}function kde(){const n=me(),e=xe("zoom is 1",()=>n.getZoomLevel()===1,[n]);return p.jsx(Ee,{actionId:"zoom-to-100",disabled:e})}function Ade(){const n=Hi(1),e=Sc(),t=n&&e;return p.jsx(Ee,{actionId:"rotate-ccw",disabled:!t})}function Rde(){const n=Hi(1),e=Sc(),t=n&&e;return p.jsx(Ee,{actionId:"rotate-cw",disabled:!t})}function jde(){const n=Q$(),e=Sc(),t=n&&e;return p.jsx(Ee,{actionId:"edit-link",disabled:!t})}function Dde(){const n=Y$(),e=X$();return n?p.jsx(DD,{}):e?p.jsx(Ode,{}):p.jsx(DD,{})}function DD(){const n=Hi(2),e=Sc(),t=n&&e;return p.jsx(Ee,{actionId:"group",disabled:!t})}function Ode(){return p.jsx(Ee,{actionId:"ungroup"})}const Lde=P.memo(function({children:e}){const t=Nt(),r=$i(),i=Ls(),s=P.useRef(null);Ml(s);const o=me(),a=xe("should display quick actions when in readonly",()=>o.isInAny("hand","zoom"),[o]),c=e??p.jsx(Ide,{});if(!(i&&!a))return p.jsxs(AP,{id:"actions-menu",children:[p.jsx(RP,{children:p.jsx(ot,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:p.jsx(Ot,{icon:"dots-vertical",small:!0})})}),p.jsx(jP,{side:r>=lr.TABLET?"bottom":"top",sideOffset:6,children:p.jsx("div",{ref:s,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:p.jsx(no,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function t7(){return bde()?p.jsx(Ee,{actionId:"toggle-auto-size"}):null}function n7(){return Q$()?p.jsx(Ee,{actionId:"edit-link"}):null}function Nde(){return Hi(1)?p.jsx(Ee,{actionId:"duplicate"}):null}function r7(){const n=me();return xe("should display flatten option",()=>{if(n.getSelectedShapeIds().length===0)return!1;const r=n.getOnlySelectedShape();return!(r&&n.isShapeOfType(r,"image"))},[n])?p.jsx(Ee,{actionId:"flatten-to-image"}):null}function i7(){return Y$()?p.jsx(Ee,{actionId:"group"}):null}function s7(){return X$()?p.jsx(Ee,{actionId:"ungroup"}):null}function o7(){const n=me();return xe("allow unframe",()=>{const t=n.getSelectedShapes();return t.length===0?!1:t.every(r=>n.isShapeOfType(r,"frame"))},[n])?p.jsx(Ee,{actionId:"remove-frame"}):null}function a7(){const n=me();return xe("allow fit frame to content",()=>{const t=n.getOnlySelectedShape();return t?n.isShapeOfType(t,"frame")&&n.getSortedChildIdsForParent(t).length>0:!1},[n])?p.jsx(Ee,{actionId:"fit-frame-to-content"}):null}function c7(){const n=me();return xe("selected shapes",()=>n.getSelectedShapes().length>0,[n])?p.jsx(Ee,{actionId:"toggle-lock"}):null}function DP(){const n=me(),e=xe("isTransparentBg",()=>!n.getInstanceState().exportBackground,[n]);return p.jsx(Uo,{actionId:"toggle-transparent",checked:e,toggle:!0})}function Bde(){const n=me(),e=xe("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(Ee,{actionId:"unlock-all",disabled:!e})}function l7(){const n=me(),e=xe("zoomed to 100",()=>n.getZoomLevel()===1,[n]);return p.jsx(Ee,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function u7(){const n=me(),e=xe("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(Ee,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function d7(){const n=me(),e=xe("has shapes",()=>n.getSelectedShapeIds().length>0,[n]);return p.jsx(Ee,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function h7(){return p.jsxs(Pt,{id:"clipboard",children:[p.jsx(zde,{}),p.jsx(Ude,{}),p.jsx($de,{}),p.jsx(Nde,{}),p.jsx(Hde,{})]})}function Fde(){var t;const n=me(),e=xe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsxs(ms,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[p.jsxs(Pt,{id:"copy-as-group",children:[p.jsx(Ee,{actionId:"copy-as-svg"}),!!((t=window.navigator.clipboard)!=null&&t.write)&&p.jsx(Ee,{actionId:"copy-as-png"}),p.jsx(Ee,{actionId:"copy-as-json"})]}),p.jsx(Pt,{id:"copy-as-bg",children:p.jsx(DP,{})})]})}function zde(){const n=Hi(1);return p.jsx(Ee,{actionId:"cut",disabled:!n})}function Ude(){const n=Z$(1);return p.jsx(Ee,{actionId:"copy",disabled:!n})}function $de(){const n=xde;return p.jsx(Ee,{actionId:"paste",disabled:!n})}function f7(){const n=me();return xe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?p.jsxs(Pt,{id:"conversions",children:[p.jsx(Fde,{}),p.jsxs(ms,{id:"export-as",label:"context-menu.export-as",size:"small",children:[p.jsxs(Pt,{id:"export-as-group",children:[p.jsx(Ee,{actionId:"export-as-svg"}),p.jsx(Ee,{actionId:"export-as-png"}),p.jsx(Ee,{actionId:"export-as-json"})]}),p.jsx(Pt,{id:"export-as-bg",children:p.jsx(DP,{})})]})]}):null}function p7(){const n=me(),e=xe("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(Ee,{actionId:"select-all",disabled:!e})}function Hde(){const n=Hi(1);return p.jsx(Ee,{actionId:"delete",disabled:!n})}function Wde(){const n=Ls();return!Z$(1)||n?null:p.jsxs(ms,{id:"edit",label:"context-menu.edit",size:"small",children:[p.jsx(i7,{}),p.jsx(s7,{}),p.jsx(r7,{}),p.jsx(n7,{}),p.jsx(a7,{}),p.jsx(o7,{}),p.jsx(m7,{}),p.jsx(g7,{}),p.jsx(t7,{}),p.jsx(c7,{})]})}function Kde(){const n=Hi(2),e=_de();return Ls()||!(n||e)?null:p.jsxs(ms,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&p.jsxs(Pt,{id:"align",children:[p.jsx(Ee,{actionId:"align-left"}),p.jsx(Ee,{actionId:"align-center-horizontal"}),p.jsx(Ee,{actionId:"align-right"}),p.jsx(Ee,{actionId:"align-top"}),p.jsx(Ee,{actionId:"align-center-vertical"}),p.jsx(Ee,{actionId:"align-bottom"})]}),p.jsx(qde,{}),n&&p.jsxs(Pt,{id:"stretch",children:[p.jsx(Ee,{actionId:"stretch-horizontal"}),p.jsx(Ee,{actionId:"stretch-vertical"})]}),(n||e)&&p.jsxs(Pt,{id:"flip",children:[p.jsx(Ee,{actionId:"flip-horizontal"}),p.jsx(Ee,{actionId:"flip-vertical"})]}),p.jsx(Gde,{})]})}function qde(){return Hi(3)?p.jsxs(Pt,{id:"distribute",children:[p.jsx(Ee,{actionId:"distribute-horizontal"}),p.jsx(Ee,{actionId:"distribute-vertical"})]}):null}function Gde(){const n=Hi(2),e=V$();return n?p.jsxs(Pt,{id:"order",children:[p.jsx(Ee,{actionId:"pack"}),e&&p.jsx(Ee,{actionId:"stack-horizontal"}),e&&p.jsx(Ee,{actionId:"stack-vertical"})]}):null}function Vde(){const n=Ls(),e=Hi(1);return n||!e?null:p.jsx(ms,{id:"reorder",label:"context-menu.reorder",size:"small",children:p.jsxs(Pt,{id:"reorder",children:[p.jsx(Ee,{actionId:"bring-to-front"}),p.jsx(Ee,{actionId:"bring-forward"}),p.jsx(Ee,{actionId:"send-backward"}),p.jsx(Ee,{actionId:"send-to-back"})]})})}function Yde(){const n=me(),e=xe("pages",()=>n.getPages(),[n]),t=xe("current page id",()=>n.getCurrentPageId(),[n]),{addToast:r}=Ea(),i=ri(),s=Ls();return!Hi(1)||s?null:p.jsxs(ms,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[p.jsx(Pt,{id:"pages",children:e.map(a=>p.jsx(Vr,{id:a.id,disabled:t===a.id,label:a.name.length>30?`${a.name.slice(0,30)}`:a.name,onSelect:()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),a.id);const c=n.getPage(a.id);c&&r({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.markHistoryStoppingPoint("change-page"),n.setCurrentPage(t)}}]}),i("move-to-page",{source:"context-menu"})}},a.id))}),p.jsx(Pt,{id:"new-page",children:p.jsx(Ee,{actionId:"move-to-new-page"})})]})}function g7(){const n=me();return xe("oneEmbedSelected",()=>{const t=n.getOnlySelectedShape();return t?!!(n.isShapeOfType(t,"embed")&&t.props.url&&!n.isShapeOrAncestorLocked(t)):!1},[n])?p.jsx(Ee,{actionId:"convert-to-bookmark"}):null}function m7(){const n=me(),e=oP();return xe("oneEmbeddableBookmarkSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!n.isShapeOrAncestorLocked(r)):!1},[n])?p.jsx(Ee,{actionId:"convert-to-embed"}):null}function Xde(){const n=me(),e=xe("isSnapMode",()=>n.user.getIsSnapMode(),[n]);return p.jsx(Uo,{actionId:"toggle-snap-mode",checked:e})}function Zde(){const n=me(),e=xe("isToolLock",()=>n.getInstanceState().isToolLocked,[n]);return p.jsx(Uo,{actionId:"toggle-tool-lock",checked:e})}function Qde(){const n=me(),e=xe("isGridMode",()=>n.getInstanceState().isGridMode,[n]);return p.jsx(Uo,{actionId:"toggle-grid",checked:e})}function Jde(){const n=me(),e=xe("isWrapMode",()=>n.user.getIsWrapMode(),[n]);return p.jsx(Uo,{actionId:"toggle-wrap-mode",checked:e})}function ehe(){const n=me(),e=xe("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]);return p.jsx(Uo,{actionId:"toggle-focus-mode",checked:e})}function the(){const n=me(),e=xe("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]);return p.jsx(Uo,{actionId:"toggle-edge-scrolling",checked:e===1})}function nhe(){const n=me(),e=xe("animationSpeed",()=>n.user.getAnimationSpeed(),[n]);return p.jsx(Uo,{actionId:"toggle-reduce-motion",checked:e===0})}function rhe(){const n=me(),e=xe("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]);return p.jsx(Uo,{actionId:"toggle-debug-mode",checked:e})}function ihe(){const n=me(),e=xe("dynamic resize",()=>n.user.getIsDynamicResizeMode(),[n]);return p.jsx(Uo,{actionId:"toggle-dynamic-size-mode",checked:e})}function she(){const n=me(),e=xe("paste at cursor",()=>n.user.getIsPasteAtCursorMode(),[n]);return p.jsx(Uo,{actionId:"toggle-paste-at-cursor",checked:e})}function ohe(){const n=me();return xe("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?p.jsx(Ee,{actionId:"open-cursor-chat"}):null}function ahe(){const n=me(),e=Fw(),t=xe("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]),r=xe("isSinglePageMode",()=>n.options.maxPages<=1,[n]);return t?p.jsxs(p.Fragment,{children:[e&&p.jsx(ohe,{}),p.jsxs(Pt,{id:"modify",children:[p.jsx(Wde,{}),p.jsx(Kde,{}),p.jsx(Vde,{}),!r&&p.jsx(Yde,{})]}),p.jsx(h7,{}),p.jsx(f7,{}),p.jsx(Pt,{id:"select-all",children:p.jsx(p7,{})})]}):null}const che=P.memo(function({children:e,disabled:t=!1}){const r=me(),{Canvas:i}=$n(),s=P.useCallback(d=>{if(d){if(r.getInstanceState().isCoarsePointer){const f=r.getSelectedShapes(),{inputs:{currentPagePoint:g}}=r,m=r.getShapesAtPoint(g);if(!r.getSelectedShapes().length||!m.some(v=>f.includes(v))){const v=m.filter(w=>r.isShapeOrAncestorLocked(w));v.length&&r.select(...v.map(w=>w.id))}}}else{const f=r.getOnlySelectedShape();f&&r.isShapeOrAncestorLocked(f)&&r.setSelectedShapes([])}},[r]),o=Mr(),[a,c]=vc("context menu",s),u=e??p.jsx(ahe,{});return p.jsxs(Zie,{dir:"ltr",onOpenChange:c,modal:!1,children:[p.jsx(Qie,{onContextMenu:void 0,dir:"ltr",disabled:t,children:i?p.jsx(i,{}):null}),a&&p.jsx(Jie,{container:o,children:p.jsx(ese,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:kt,children:p.jsx(no,{type:"context-menu",sourceId:"context-menu",children:u})})})]})}),lhe=2e3,uhe=5e3,dhe=ti(function(){const e=me(),{isChatting:t,chatMessage:r}=e.getInstanceState(),i=P.useRef(-1),[s,o]=P.useState("");return P.useEffect(()=>{if(!t&&r||t){const c=t?uhe:lhe;i.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},c)}return()=>{clearTimeout(i.current)}},[e,r,t]),t?p.jsx(fhe,{value:s,setValue:o,chatMessage:r}):r.trim()?p.jsx(hhe,{chatMessage:r}):null});function y7(n){const e=me();P.useLayoutEffect(()=>{var o;if(!n.current)return;const{x:r,y:i}=e.inputs.currentScreenPoint;(o=n.current)==null||o.style.setProperty("transform",`translate(${r}px, ${i}px)`);function s(a){var d;const{minX:c,minY:u}=e.getViewportScreenBounds();(d=n.current)==null||d.style.setProperty("transform",`translate(${a.clientX-c}px, ${a.clientY-u}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[n,e])}const hhe=({chatMessage:n})=>{const e=me(),t=P.useRef(null);return y7(t),p.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},fhe=ti(function({chatMessage:e,value:t,setValue:r}){const i=me(),s=Nt(),o=P.useRef(null),a=e||s("cursor-chat.type-to-chat");y7(o),P.useLayoutEffect(()=>{const g=o.current;if(!g)return;const m=i.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});g.style.setProperty("width",m.w+"px")},[i,t,a]),P.useLayoutEffect(()=>{const g=i.timers.requestAnimationFrame(()=>{var m;(m=o.current)==null||m.focus()});return()=>{cancelAnimationFrame(g)}},[i]);const c=P.useCallback(()=>{i.updateInstanceState({isChatting:!1}),i.focus()},[i]),u=P.useCallback(g=>{const{value:m}=g.target;r(m.slice(0,64)),i.updateInstanceState({chatMessage:m})},[i,r]),d=P.useCallback(g=>{const m=o.current;if(!m)return;const{value:v}=m;switch(g.key){case"Enter":{if(kt(g),g.stopPropagation(),!v){c();return}r("");break}case"Escape":{kt(g),g.stopPropagation(),c();break}}},[c,r]),f=P.useCallback(g=>{g.stopPropagation()},[]);return p.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:i.user.getColor()},onBlur:c,onChange:u,onKeyDown:d,onPaste:f,value:t,placeholder:a,spellCheck:!1})});function kE({checked:n}){return p.jsx(ya,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function phe(){const n=me(),{addToast:e}=Ea(),{addDialog:t}=Wu(),[r,i]=Ce.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(Pt,{id:"items",children:[p.jsx(Vr,{id:"add-toast",onSelect:()=>{e({id:Jt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Jt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Jt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Jt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),p.jsx(Vr,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:s})=>p.jsx(yhe,{displayDontShowAgain:!0,onCancel:()=>s(),onContinue:()=>s()}),onClose:()=>{}})}}),p.jsx(Vr,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>whe(n,100)}),p.jsx(Vr,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const s=n.getSelectedShapes(),o=s.length===0?n.getRenderingShapes():s;window.alert(`Shapes ${o.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),p.jsx(Vr,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),p.jsx(Vr,{id:"hard-reset",onSelect:JN,label:"Hard reset"})]}),p.jsxs(Pt,{id:"flags",children:[p.jsx(ghe,{}),p.jsx(mhe,{})]})]})}function ghe(){const n=Object.values(mr);return n.length?p.jsx(ms,{id:"debug flags",label:"Debug Flags",children:p.jsx(Pt,{id:"debug flags",children:n.map(e=>p.jsx(w7,{flag:e},e.name))})}):null}function mhe(){const n=Object.values(sY);return n.length?p.jsx(ms,{id:"feature flags",label:"Feature Flags",children:p.jsx(Pt,{id:"feature flags",children:n.map(e=>p.jsx(w7,{flag:e},e.name))})}):null}function yhe({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:s,onContinue:o}){const[a,c]=Ce.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(jw,{children:[p.jsx(Dw,{children:n}),p.jsx(Ow,{})]}),p.jsx(Cp,{style:{maxWidth:350},children:e}),p.jsxs(iP,{className:"tlui-dialog__footer__actions",children:[i&&p.jsxs(ot,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[p.jsx(kE,{checked:a}),p.jsx(yr,{children:"Dont show again"})]}),p.jsx(ot,{type:"normal",onClick:s,children:p.jsx(yr,{children:t})}),p.jsx(ot,{type:"primary",onClick:async()=>o(),children:p.jsx(yr,{children:r})})]})]})}const w7=ti(function({flag:e,onChange:t}){const r=e.get();return p.jsx(Uw,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,i=>`${i[0]} ${i[1].toLowerCase()}`).replace(/^[a-z]/,i=>i.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),t==null||t(!r)}})});let OD=0;function whe(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let i=0;i<e;i++)OD++,t[i]={id:wn("box"+OD),type:"geo",x:i%r*132,y:Math.floor(i/r)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(i=>i.id))})}function vhe({children:n}){const e=n??p.jsx(phe,{});return p.jsxs(ku,{id:"debug",children:[p.jsx(Au,{children:p.jsx(ot,{type:"icon",title:"Debug menu",children:p.jsx(Ot,{icon:"dots-horizontal"})})}),p.jsx(Ru,{side:"top",align:"end",alignOffset:0,children:p.jsx(no,{type:"menu",sourceId:"debug-panel",children:e})})]})}const She=P.memo(function(){const{DebugMenu:e}=Rl(),t=P.useRef(null);return Ml(t),p.jsxs("div",{ref:t,className:"tlui-debug-panel",children:[p.jsx(bhe,{}),p.jsx(_he,{}),e&&p.jsx(e,{})]})});function xhe(n=!0){const[e,t]=P.useState(0),r=me();P.useEffect(()=>{if(!n)return;const i=()=>t(s=>s+1);return r.on("tick",i),()=>{r.off("tick",i)}},[r,n])}const bhe=ti(function(){xhe();const e=me(),t=e.getPath(),r=e.getHoveredShape(),i=e.getOnlySelectedShape(),s=t==="select.idle"||!t.includes("select.")?r:i,o=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${T.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${T.ToInt(e.inputs.originPagePoint)}]  [${T.ToInt(e.inputs.currentPagePoint)}] = ${T.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return p.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function _he(){const n=me(),e=xe("show_fps",()=>mr.showFps.get(),[mr]),t=P.useRef(null);return P.useEffect(()=>{if(!e)return;const r=250;let i=0,s=-1,o=performance.now(),a=0,c=0,u=!1;function d(){if(c++,a=performance.now()-o,a>r){const f=Math.round(c*(r/a)*(1e3/r));f>i&&(i=f);const g=i*.75;(f<g&&!u||f>=g&&u)&&(u=!u),t.current.innerHTML=`FPS ${f.toString()}`,t.current.className="tlui-debug-panel__fps"+(u?" tlui-debug-panel__fps__slow":""),a-=r,c=0,o=performance.now()}s=n.timers.requestAnimationFrame(d)}return d(),()=>{cancelAnimationFrame(s)}},[e,n]),e?p.jsx("div",{ref:t}):null}const Ihe=P.memo(function(){const e=$i(),t=P.useRef(null);Ml(t);const{MainMenu:r,QuickActions:i,ActionsMenu:s,PageMenu:o}=Rl(),a=me(),c=xe("isSinglePageMode",()=>a.options.maxPages<=1,[a]),u=a.options.actionShortcutsLocation==="menu"?!0:a.options.actionShortcutsLocation==="toolbar"?!1:e>=lr.TABLET;return!r&&!o&&!u?null:p.jsx("div",{ref:t,className:"tlui-menu-zone",children:p.jsxs("div",{className:"tlui-buttons__horizontal",children:[r&&p.jsx(r,{}),o&&!c&&p.jsx(o,{}),u?p.jsxs(p.Fragment,{children:[i&&p.jsx(i,{}),s&&p.jsx(s,{})]}):null]})})});function Ehe(){const n=me(),e=Ku(),[t,r]=P.useState(!1),i=P.useRef(!1);return ul("toggle showback to content",()=>{const s=i.current,o=n.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===n.getCulledShapes().size),s!==a&&(r(a),i.current=a)},[n]),t?p.jsx(Ee,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function Che(){const n=me();return xe("is pen mode",()=>n.getInstanceState().isPenMode,[n])?p.jsx(Ee,{actionId:"exit-pen-mode"}):null}function Phe(){const n=me(),e=Ku();return xe("is following user",()=>!!n.getInstanceState().followingUserId,[n])?p.jsx(Vr,{...e["stop-following"]}):null}function Mhe(){return p.jsxs(p.Fragment,{children:[p.jsx(Che,{}),p.jsx(Ehe,{}),p.jsx(Phe,{})]})}function The({children:n}){const e=n??p.jsx(Mhe,{});return p.jsx("div",{className:"tlui-helper-buttons",children:p.jsx(no,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function khe(){const n=Fw();return p.jsxs(p.Fragment,{children:[p.jsxs(Pt,{label:"shortcuts-dialog.tools",id:"tools",children:[p.jsx(Ee,{actionId:"toggle-tool-lock"}),p.jsx(Ee,{actionId:"insert-media"}),p.jsx(ts,{toolId:"select"}),p.jsx(ts,{toolId:"draw"}),p.jsx(ts,{toolId:"eraser"}),p.jsx(ts,{toolId:"hand"}),p.jsx(ts,{toolId:"rectangle"}),p.jsx(ts,{toolId:"ellipse"}),p.jsx(ts,{toolId:"arrow"}),p.jsx(ts,{toolId:"line"}),p.jsx(ts,{toolId:"text"}),p.jsx(ts,{toolId:"frame"}),p.jsx(ts,{toolId:"note"}),p.jsx(ts,{toolId:"laser"}),p.jsx(Vr,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),p.jsxs(Pt,{label:"shortcuts-dialog.preferences",id:"preferences",children:[p.jsx(Ee,{actionId:"toggle-dark-mode"}),p.jsx(Ee,{actionId:"toggle-focus-mode"}),p.jsx(Ee,{actionId:"toggle-grid"})]}),p.jsxs(Pt,{label:"shortcuts-dialog.edit",id:"edit",children:[p.jsx(Ee,{actionId:"undo"}),p.jsx(Ee,{actionId:"redo"}),p.jsx(Ee,{actionId:"cut"}),p.jsx(Ee,{actionId:"copy"}),p.jsx(Ee,{actionId:"paste"}),p.jsx(Ee,{actionId:"select-all"}),p.jsx(Ee,{actionId:"delete"}),p.jsx(Ee,{actionId:"duplicate"})]}),p.jsxs(Pt,{label:"shortcuts-dialog.view",id:"view",children:[p.jsx(Ee,{actionId:"zoom-in"}),p.jsx(Ee,{actionId:"zoom-out"}),p.jsx(Ee,{actionId:"zoom-to-100"}),p.jsx(Ee,{actionId:"zoom-to-fit"}),p.jsx(Ee,{actionId:"zoom-to-selection"})]}),p.jsxs(Pt,{label:"shortcuts-dialog.transform",id:"transform",children:[p.jsx(Ee,{actionId:"bring-to-front"}),p.jsx(Ee,{actionId:"bring-forward"}),p.jsx(Ee,{actionId:"send-backward"}),p.jsx(Ee,{actionId:"send-to-back"}),p.jsx(Ee,{actionId:"group"}),p.jsx(Ee,{actionId:"ungroup"}),p.jsx(Ee,{actionId:"flip-horizontal"}),p.jsx(Ee,{actionId:"flip-vertical"}),p.jsx(Ee,{actionId:"align-top"}),p.jsx(Ee,{actionId:"align-center-vertical"}),p.jsx(Ee,{actionId:"align-bottom"}),p.jsx(Ee,{actionId:"align-left"}),p.jsx(Ee,{actionId:"align-center-horizontal"}),p.jsx(Ee,{actionId:"align-right"})]}),n&&p.jsx(Pt,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:p.jsx(Ee,{actionId:"open-cursor-chat"})})]})}const Ahe=P.memo(function({children:e}){const t=Nt(),r=$i(),i=e??p.jsx(khe,{});return p.jsxs(p.Fragment,{children:[p.jsxs(jw,{className:"tlui-shortcuts-dialog__header",children:[p.jsx(Dw,{children:t("shortcuts-dialog.title")}),p.jsx(Ow,{})]}),p.jsx(Cp,{className:rt("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=lr.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=lr.TABLET}),children:p.jsx(no,{type:"keyboard-shortcuts",sourceId:"kbd",children:i})}),p.jsx("div",{className:"tlui-dialog__scrim"})]})});function v7(){const n=Cl(),e=ri(),t=xe("locale",()=>n==null?void 0:n.user.getLocale(),[n]);return n?p.jsx(ms,{id:"help menu language",label:"menu.language",children:p.jsx(Pt,{id:"languages",children:wp.map(({locale:r,label:i})=>p.jsx(Uw,{id:`language-${r}`,title:r,label:i,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function Rhe(){return p.jsxs(p.Fragment,{children:[p.jsx(v7,{}),p.jsx(S7,{})]})}function S7(){const{KeyboardShortcutsDialog:n}=Rl(),{addDialog:e}=Wu(),t=P.useCallback(()=>{n&&e({component:n})},[e,n]);return n?p.jsx(Vr,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}function jhe(){return p.jsxs(p.Fragment,{children:[p.jsx(Ohe,{}),p.jsx(Fhe,{}),p.jsx(Dhe,{}),p.jsx(zhe,{}),p.jsx(Uhe,{})]})}function Dhe(){return p.jsxs(ms,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[p.jsxs(Pt,{id:"export-all-as-group",children:[p.jsx(Ee,{actionId:"export-all-as-svg"}),p.jsx(Ee,{actionId:"export-all-as-png"}),p.jsx(Ee,{actionId:"export-all-as-json"})]}),p.jsx(Pt,{id:"export-all-as-bg",children:p.jsx(DP,{})})]})}function Ohe(){const n=me(),e=xe("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return p.jsxs(ms,{id:"edit",label:"menu.edit",disabled:!e,children:[p.jsx(Bhe,{}),p.jsx(h7,{}),p.jsx(f7,{}),p.jsx(Lhe,{}),p.jsx(Nhe,{}),p.jsx(Pt,{id:"select-all",children:p.jsx(p7,{})})]})}function Lhe(){return p.jsxs(Pt,{id:"misc",children:[p.jsx(i7,{}),p.jsx(s7,{}),p.jsx(n7,{}),p.jsx(t7,{}),p.jsx(o7,{}),p.jsx(a7,{}),p.jsx(m7,{}),p.jsx(g7,{}),p.jsx(r7,{})]})}function Nhe(){return p.jsxs(Pt,{id:"lock",children:[p.jsx(c7,{}),p.jsx(Bde,{})]})}function Bhe(){const n=e7(),e=J$();return p.jsxs(Pt,{id:"undo-redo",children:[p.jsx(Ee,{actionId:"undo",disabled:!n}),p.jsx(Ee,{actionId:"redo",disabled:!e})]})}function Fhe(){return p.jsx(ms,{id:"view",label:"menu.view",children:p.jsxs(Pt,{id:"view-actions",children:[p.jsx(Ee,{actionId:"zoom-in"}),p.jsx(Ee,{actionId:"zoom-out"}),p.jsx(l7,{}),p.jsx(u7,{}),p.jsx(d7,{})]})})}function zhe(){return p.jsxs(Pt,{id:"extras",children:[p.jsx(Ee,{actionId:"insert-embed"}),p.jsx(Ee,{actionId:"insert-media"})]})}function Uhe(){return p.jsxs(Pt,{id:"preferences",children:[p.jsxs(ms,{id:"preferences",label:"menu.preferences",children:[p.jsxs(Pt,{id:"preferences-actions",children:[p.jsx(Xde,{}),p.jsx(Zde,{}),p.jsx(Qde,{}),p.jsx(Jde,{}),p.jsx(ehe,{}),p.jsx(the,{}),p.jsx(nhe,{}),p.jsx(ihe,{}),p.jsx(she,{}),p.jsx(rhe,{})]}),p.jsx(Pt,{id:"color-scheme",children:p.jsx(Hae,{})})]}),p.jsx(v7,{}),p.jsx(S7,{})]})}const $he=P.memo(function({children:e}){const t=Mr(),[r,i]=vc("main menu"),s=Nt(),o=e??p.jsx(jhe,{});return p.jsxs(X2,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[p.jsx(Z2,{asChild:!0,dir:"ltr",children:p.jsx(ot,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:p.jsx(Ot,{icon:"menu",small:!0})})}),p.jsx(Rw,{container:t,children:p.jsx(Q2,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:p.jsx(no,{type:"menu",sourceId:"main-menu",children:o})})})]})}),Ub={};function Af(n){if(Ub[n])return Ub[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[r,i,s,o]=t.getImageData(0,0,1,1).data,a=new Float32Array([r/255,i/255,s/255,o/255]);return Ub[n]=a,a}const zy=10,x7=4*6*zy+12+4*12;function Nd(n,{center:e,radius:t,numArcSegments:r=20,startAngle:i=0,endAngle:s=un,offset:o=0}){const a=(s-i)/r;let c=o;for(let u=i;u<s;u+=a)n[c++]=e.x,n[c++]=e.y,n[c++]=e.x+Math.cos(u)*t,n[c++]=e.y+Math.sin(u)*t,n[c++]=e.x+Math.cos(u+a)*t,n[c++]=e.y+Math.sin(u+a)*t;return n}function Bd(n,e,t,r,i,s){n[e++]=t,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r,n[e++]=t+i,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+i,n[e++]=r+s}function Hhe(n,e,t){const r=zy;t=Math.min(t,Math.min(e.w,e.h)/2);const i=De.ExpandBy(e,-t);if(i.w<=0||i.h<=0)return Nd(n,{center:e.center,radius:t,numArcSegments:zy*4}),zy*4*6;let s=0;return Bd(n,s,i.minX,i.minY,i.w,i.h),s+=12,Bd(n,s,i.minX,e.minY,i.w,t),s+=12,Bd(n,s,i.maxX,i.minY,t,i.h),s+=12,Bd(n,s,i.minX,i.maxY,i.w,t),s+=12,Bd(n,s,e.minX,i.minY,t,i.h),s+=12,Nd(n,{numArcSegments:r,offset:s,center:i.point,radius:t,startAngle:en,endAngle:en*1.5}),s+=r*6,Nd(n,{numArcSegments:r,offset:s,center:T.Add(i.point,new T(i.w,0)),radius:t,startAngle:en*1.5,endAngle:un}),s+=r*6,Nd(n,{numArcSegments:r,offset:s,center:T.Add(i.point,i.size),radius:t,startAngle:0,endAngle:jn}),s+=r*6,Nd(n,{numArcSegments:r,offset:s,center:T.Add(i.point,new T(0,i.h)),radius:t,startAngle:jn,endAngle:en}),x7}function Whe(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const i=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,r),e.attachShader(o,s),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const c=e.getUniformLocation(o,"canvasPageBounds"),u=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:Gm(e,1024),unselectedShapes:Gm(e,4096),viewport:Gm(e,x7),collaborators:Gm(e,1024),prepareTriangles(g,m){e.bindBuffer(e.ARRAY_BUFFER,g.buffer),e.bufferData(e.ARRAY_BUFFER,g.vertices,e.STATIC_DRAW,0,m),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(g){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,g/2),e.disable(e.BLEND)},drawTriangles(g){e.drawArrays(e.TRIANGLES,0,g/2)},setFillColor(g){e.uniform4fv(u,g)},setCanvasPageBounds(g){e.uniform4fv(c,g)}}}function Gm(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function LD(n,e,t){let r=n.vertices.length;for(;r<e+t.length;)r*=2;if(r!=n.vertices.length){const i=new Float32Array(r);i.set(n.vertices),n.vertices=i}n.vertices.set(t,e)}var Khe=Object.create,b7=Object.defineProperty,qhe=Object.getOwnPropertyDescriptor,Ghe=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),_7=n=>{throw TypeError(n)},I7=(n,e,t)=>e in n?b7(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Vhe=n=>[,,,Khe(null)],E7=["class","method","getter","setter","accessor","field","value","get","set"],C7=n=>n!==void 0&&typeof n!="function"?_7("Function expected"):n,Yhe=(n,e,t,r,i)=>({kind:E7[n],name:e,metadata:r,addInitializer:s=>t._?_7("Already initialized"):i.push(C7(s||null))}),Xhe=(n,e)=>I7(e,Ghe("metadata"),n[3]),Zhe=(n,e,t,r)=>{for(var i=0,s=n[e>>1],o=s&&s.length;i<o;i++)s[i].call(t);return r},Ca=(n,e,t,r,i,s)=>{for(var o,a,c,u,d=e&7,f=!!(e&8),g=!!(e&16),m=2,v=E7[d+5],w=n[m]||(n[m]=[]),S=(i=i.prototype,qhe(i,t)),b=r.length-1;b>=0;b--)c=Yhe(d,t,a={},n[3],w),c.static=f,c.private=g,u=c.access={has:x=>t in x},u.get=x=>x[t],o=(0,r[b])(S[v],c),a._=1,C7(o)&&(S[v]=o);return S&&b7(i,t,S),i},$a=(n,e,t)=>I7(n,typeof e!="symbol"?e+"":e,t),P7,M7,T7,k7,A7,R7,j7,D7,O7,L7,Ns;L7=[ls],O7=[Ie],D7=[Ie],j7=[Ie],R7=[Ie],A7=[Ie],k7=[Ie],T7=[Ie],M7=[Ie],P7=[ls];class so{constructor(e,t,r){this.editor=e,this.elem=t,this.container=r,Zhe(Ns,5,this),$a(this,"disposables",[]),$a(this,"gl"),$a(this,"shapeGeometryCache"),$a(this,"colors"),$a(this,"id",Jt()),$a(this,"canvasBoundingClientRect",cr("canvasBoundingClientRect",new De)),$a(this,"originPagePoint",new T),$a(this,"originPageCenter",new T),$a(this,"isInViewport",!1),this.gl=Whe(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",i=>{const s=e.getShapeMaskedPageBounds(i.id);if(!s)return null;const o=new Float32Array(12);return Bd(o,0,s.x,s.y,s.w,s.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),To("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:Af(e.getPropertyValue("--color-text-3").trim()),selectFill:Af(e.getPropertyValue("--color-selected").trim()),viewportFill:Af(e.getPropertyValue("--color-muted-1").trim()),background:Af(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?De.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new T(e.maxX,e.maxY));return new De(t.x,t.y,r.x-t.x,r.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:r,height:i}=this.elem.getBoundingClientRect();return new De(e,t,r,i)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new T(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),r=e.width/e.height;let i=t.width,s=i/r;s<t.height&&(s=t.height,i=s*r);const o=new De(0,0,i,s);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:r,h:i}=this.getCanvasPageBounds();return new Float32Array([e,t,r,i])}getMinimapPagePoint(e,t){const r=this.getCanvasPageBounds(),i=this.getCanvasScreenBounds();let s=e-i.x,o=t-i.y;return s*=r.width/i.width,o*=r.height/i.height,s+=r.minX,o+=r.minY,new T(s,o,1)}minimapScreenPointToPagePoint(e,t,r=!1,i=!1){const{editor:s}=this,o=s.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(e,t);if(i){const u=this.editor.getCurrentPageBounds()??new De,d=u.minX-o.width/2,f=u.maxX+o.width/2,g=u.minY-o.height/2,m=u.maxY+o.height/2,v=Math.max(0,d+o.width-a),w=Math.max(0,-(f-o.width-a)),S=Math.max(0,g+o.height-c),b=Math.max(0,-(m-o.height-c));a+=(v-w)/2,c+=(S-b)/2,a=Wr(a,d,f),c=Wr(c,g,m)}if(r){const{originPagePoint:u}=this,d=Math.abs(a-u.x),f=Math.abs(c-u.y);d>f?c=u.y:a=u.x}return new T(a,c)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),i=this.colors;let s=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,u=a.length;c<u;c++){const d=a[c],f=this.shapeGeometryCache.get(d);if(!f)continue;const g=f.length;r.has(d)?(LD(this.gl.selectedShapes,s,f),s+=g):(LD(this.gl.unselectedShapes,o,f),o+=g)}this.drawShapes(this.gl.unselectedShapes,o,i.shapeFill),this.drawShapes(this.gl.selectedShapes,s,i.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,r){this.gl.prepareTriangles(e,t),this.gl.setFillColor(r),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=Hhe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),_n.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,r=t*6,i=r*e.length;this.gl.collaborators.vertices.length<i&&(this.gl.collaborators.vertices=new Float32Array(i));const s=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:c}of e)Nd(s,{center:T.From(c),radius:3*a,offset:o,numArcSegments:t}),o+=r;this.gl.prepareTriangles(this.gl.collaborators,i),o=0;for(const{color:c}of e)this.gl.setFillColor(Af(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,r/2),o+=r}}Ns=Vhe();Ca(Ns,1,"close",L7,so);Ca(Ns,1,"getDpr",O7,so);Ca(Ns,1,"getContentPageBounds",D7,so);Ca(Ns,1,"getContentScreenBounds",j7,so);Ca(Ns,1,"getCanvasSize",R7,so);Ca(Ns,1,"getCanvasClientPosition",A7,so);Ca(Ns,1,"getCanvasPageBounds",k7,so);Ca(Ns,1,"getZoom",T7,so);Ca(Ns,1,"getCanvasPageBoundsArray",M7,so);Ca(Ns,1,"render",P7,so);Xhe(Ns,so);function Qhe(){const n=me(),e=Mr(),t=P.useRef(null),r=P.useRef(!1),i=P.useRef();P.useEffect(()=>{try{const d=new so(n,t.current,e);return i.current=d,i.current.close}catch(d){n.annotateError(d,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw d})}},[n,e]);const s=P.useCallback(d=>{if(!n.getCurrentPageShapeIds().size||!i.current)return;const f=i.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),g=i.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);i.current.originPagePoint.setTo(g),i.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(f,{animation:{duration:n.options.animationMediumMs}})},[n]),o=P.useCallback(d=>{if(!i.current)return;const f=d.currentTarget;if(Kp(f,d),!n.getCurrentPageShapeIds().size)return;r.current=!0,i.current.isInViewport=!1;const g=i.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!1),m=n.getViewportPageBounds(),v=i.current.getContentPageBounds();if(new De(v.x-m.width/2,v.y-m.height/2,v.width+m.width,v.height+m.height).containsPoint(g)&&!m.containsPoint(g)){i.current.isInViewport=m.containsPoint(g);const b=T.Sub(m.center,m.point),x=T.Add(g,b);i.current.originPagePoint.setTo(x),i.current.originPageCenter.setTo(g),n.centerOnPoint(g,{animation:{duration:n.options.animationMediumMs}})}else{const b=i.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,!1,!0);i.current.isInViewport=m.containsPoint(b),i.current.originPagePoint.setTo(b),i.current.originPageCenter.setTo(m.center)}function S(b){f&&qp(f,b),r.current=!1,document.body.removeEventListener("pointerup",S)}document.body.addEventListener("pointerup",S)},[n]),a=P.useCallback(d=>{if(!i.current)return;const f=i.current.minimapScreenPointToPagePoint(d.clientX,d.clientY,d.shiftKey,!0);if(r.current){if(i.current.isInViewport){const w=i.current.originPagePoint.clone().sub(i.current.originPageCenter);n.centerOnPoint(T.Sub(f,w));return}n.centerOnPoint(f)}const g=i.current.getMinimapPagePoint(d.clientX,d.clientY),m=n.pageToScreen(g),v={type:"pointer",target:"canvas",name:"pointer_move",...Ms(d),point:m,isPen:n.getInstanceState().isPenMode};n.dispatch(v)},[n]),c=P.useCallback(d=>{const f=$N(d);n.dispatch({type:"wheel",name:"wheel",delta:f,point:new T(d.clientX,d.clientY),shiftKey:d.shiftKey,altKey:d.altKey,ctrlKey:d.metaKey||d.ctrlKey,metaKey:d.metaKey,accelKey:Ii(d)})},[n]),u=eg();return P.useEffect(()=>{n.timers.setTimeout(()=>{var d,f;(d=i.current)==null||d.updateColors(),(f=i.current)==null||f.render()})},[u,n]),p.jsx("div",{className:"tlui-minimap",children:p.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:a,onPointerDown:o,onWheelCapture:c})})}function Jhe(n,e){const[t,r]=Ce.useState(e);Ce.useLayoutEffect(()=>{const s=SC(n);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const i=Ce.useCallback(s=>{r(o=>{const a=typeof s=="function"?s(o):s;return xC(n,JSON.stringify(a)),a})},[n]);return[t,i]}const efe=P.memo(function(){const e=Ku(),t=Nt(),r=$i(),i=P.useRef(null);Ml(i);const[s,o]=Jhe("minimap",!0),a=P.useCallback(()=>{o(d=>!d)},[o]),{ZoomMenu:c,Minimap:u}=Rl();return r<lr.MOBILE?null:p.jsxs("div",{ref:i,className:"tlui-navigation-panel",children:[p.jsx("div",{className:"tlui-buttons__horizontal",children:c&&r<lr.TABLET?p.jsx(c,{}):s?p.jsxs(p.Fragment,{children:[c&&p.jsx(c,{}),u&&p.jsx(ot,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:p.jsx(Ot,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):p.jsxs(p.Fragment,{children:[p.jsx(ot,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(Pp(e["zoom-out"].label))} ${dE(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:p.jsx(Ot,{icon:"minus"})}),c&&p.jsx(c,{}),p.jsx(ot,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(Pp(e["zoom-in"].label))} ${dE(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:p.jsx(Ot,{icon:"plus"})}),u&&p.jsx(ot,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:p.jsx(Ot,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),u&&r>=lr.TABLET&&!s&&p.jsx(u,{})]})}),tfe=function({name:e,id:t,isCurrentPage:r,onCancel:i}){const s=me(),o=ri(),a=P.useRef(null),c=P.useRef(null),u=P.useCallback(()=>{c.current=s.markHistoryStoppingPoint("rename page")},[s]),d=P.useCallback(g=>{s.renamePage(t,g||"New Page"),o("rename-page",{source:"page-menu"})},[s,t,o]),f=P.useCallback(()=>{c.current&&s.bailToMark(c.current),i()},[s,i]);return p.jsx(Lw,{className:"tlui-page-menu__item__input",ref:g=>a.current=g,defaultValue:e,onValueChange:d,onCancel:f,onFocus:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},AE=(n,e,t,r,i)=>{let s;const o=n.getPages(),a=t>r?o[r-1]:o[r],c=t>r?o[r]:o[r+1];a&&!c?s=aa(a.index):!a&&c?s=HK(o[0].index):s=fp(a.index,c.index),s!==o[t].index&&(n.markHistoryStoppingPoint("moving page"),n.updatePage({id:e,index:s}),i("move-page",{source:"page-menu"}))},ND=ti(function({index:e,listSize:t,item:r,onRename:i}){const s=me(),o=Nt(),a=s.getPages(),c=ri(),u=P.useCallback(()=>{s.markHistoryStoppingPoint("creating page");const m=Ds.createId();s.duplicatePage(r.id,m),c("duplicate-page",{source:"page-menu"})},[s,r,c]),d=P.useCallback(()=>{AE(s,r.id,e,e-1,c)},[s,r,e,c]),f=P.useCallback(()=>{AE(s,r.id,e,e+1,c)},[s,r,e,c]),g=P.useCallback(()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(r.id),c("delete-page",{source:"page-menu"})},[s,r,c]);return p.jsxs(ku,{id:`page item submenu ${e}`,children:[p.jsx(Au,{children:p.jsx(ot,{type:"icon",title:o("page-menu.submenu.title"),children:p.jsx(Ot,{icon:"dots-vertical",small:!0})})}),p.jsx(Ru,{alignOffset:0,side:"right",sideOffset:-4,children:p.jsxs(no,{type:"menu",sourceId:"page-menu",children:[p.jsxs(Pt,{id:"modify",children:[i&&p.jsx(Vr,{id:"rename",label:"page-menu.submenu.rename",onSelect:i}),p.jsx(Vr,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:u,disabled:a.length>=s.options.maxPages}),e>0&&p.jsx(Vr,{id:"move-up",onSelect:d,label:"page-menu.submenu.move-up"}),e<t-1&&p.jsx(Vr,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:f})]}),t>1&&p.jsx(Pt,{id:"delete",children:p.jsx(Vr,{id:"delete",onSelect:g,label:"page-menu.submenu.delete"})})]})})]})}),nfe=P.memo(function(){const e=me(),t=ri(),r=Nt(),i=$i(),s=P.useCallback(()=>b(!1),[]),[o,a]=vc("page-menu",s),c=36,u=P.useRef(null),d=xe("pages",()=>e.getPages(),[e]),f=xe("currentPage",()=>e.getCurrentPage(),[e]),g=xe("currentPageId",()=>e.getCurrentPageId(),[e]),m=Ls(),v=xe("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),w=xe("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[S,b]=P.useState(!1),x=P.useCallback(()=>{m||b(N=>!N)},[m]),E=P.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[M,j]=P.useState(Object.fromEntries(d.map((N,_)=>[N.id,{y:_*c,offsetY:0,isSelected:!1}])));P.useLayoutEffect(()=>{j(Object.fromEntries(d.map((N,_)=>[N.id,{y:_*c,offsetY:0,isSelected:!1}])))},[c,d]),P.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const N=document.querySelector(`[data-testid="page-menu-item-${g}"]`);if(N){const _=u.current;if(!_)return;const k=N.offsetTop,O=_.scrollTop;k<O&&_.scrollTo({top:k});const W=k+c,q=_.scrollTop+_.offsetHeight;W>q&&_.scrollTo({top:W-_.offsetHeight})}})},[c,g,o,e]);const D=P.useCallback(N=>{const{clientY:_,currentTarget:k}=N,{dataset:{id:O,index:W}}=k;if(!O||!W)return;const q=E.current;Kp(N.currentTarget,N),q.status="pointing",q.pointing={id:O,index:+W};const ne=M[O].y;q.startY=_,q.startIndex=Math.max(0,Math.min(Math.round(ne/c),d.length-1))},[c,d.length,M]),H=P.useCallback(N=>{const _=E.current;if(_.status==="pointing"){const{clientY:k}=N,O=k-_.startY;Math.abs(O)>5&&(_.status="dragging")}if(_.status==="dragging"){const{clientY:k}=N,O=k-_.startY,W=M[_.pointing.id],{startIndex:q,pointing:X}=_,ne=W.y+O,$=Math.max(0,Math.min(Math.round(ne/c),d.length-1)),C={...M};if(C[X.id]={y:W.y,offsetY:O,isSelected:!0},$!==_.dragIndex){_.dragIndex=$;for(let R=0;R<d.length;R++){const Z=d[R];if(Z.id===_.pointing.id)continue;let{y:J}=C[Z.id];$===q?J=R*c:$<q?$<=R&&R<q?J=(R+1)*c:J=R*c:$>q&&($>=R&&R>q?J=(R-1)*c:J=R*c),J!==C[Z.id].y&&(C[Z.id]={y:J,offsetY:0,isSelected:!0})}}j(C)}},[c,d,M]),L=P.useCallback(N=>{const _=E.current;if(_.status==="dragging"){const{id:k,index:O}=_.pointing;AE(e,k,O,_.dragIndex,t)}qp(N.currentTarget,N),_.status="idle"},[e,t]),U=P.useCallback(N=>{const _=E.current;N.key==="Escape"&&(_.status==="dragging"&&j(Object.fromEntries(d.map((k,O)=>[k.id,{y:O*c,offsetY:0,isSelected:!1}]))),_.status="idle")},[c,d]),z=P.useCallback(()=>{m||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const N=Ds.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:N}),e.setCurrentPage(N),b(!0)}),t("new-page",{source:"page-menu"}))},[e,r,m,t]),Y=P.useCallback(N=>{e.setCurrentPage(N),t("change-page",{source:"page-menu"})},[e,t]),V=P.useCallback((N,_)=>{e.renamePage(N,_),t("rename-page",{source:"page-menu"})},[e,t]);return p.jsxs(AP,{id:"pages",onOpenChange:a,open:o,children:[p.jsx(RP,{"data-testid":"main.page-menu",children:p.jsxs(ot,{type:"menu",title:f.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[p.jsx("div",{className:"tlui-page-menu__name",children:f.name}),p.jsx(Ot,{icon:"chevron-down",small:!0})]})}),p.jsx(jP,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:S,children:p.jsxs("div",{className:"tlui-page-menu__wrapper",children:[p.jsxs("div",{className:"tlui-page-menu__header",children:[p.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!m&&p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsx(ot,{type:"icon","data-testid":"page-menu.edit",title:r(S?"page-menu.edit-done":"page-menu.edit-start"),onClick:x,children:p.jsx(Ot,{icon:S?"check":"edit"})}),p.jsx(ot,{type:"icon","data-testid":"page-menu.create",title:r(v?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:v,onClick:z,children:p.jsx(Ot,{icon:"plus"})})]})]}),p.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*d.length+4},ref:u,children:d.map((N,_)=>{const k=M[N.id]??{position:_*40,offsetY:0};return S?p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:N.id===f.id?888:_,transform:`translate(0px, ${k.y+k.offsetY}px)`},children:[p.jsx(ot,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:D,onPointerUp:L,onPointerMove:H,onKeyDown:U,"data-id":N.id,"data-index":_,children:p.jsx(Ot,{icon:"drag-handle-dots"})}),i<lr.TABLET_SM&&w?p.jsxs(ot,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const O=window.prompt("Rename page",N.name);O&&O!==N.name&&V(N.id,O)},onDoubleClick:x,children:[p.jsx(kE,{checked:N.id===f.id}),p.jsx(yr,{children:N.name})]}):p.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:p.jsx(tfe,{id:N.id,name:N.name,isCurrentPage:N.id===f.id,onCancel:()=>{b(!1),e.menus.clearOpenMenus()}})}),!m&&p.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":S,children:p.jsx(ND,{index:_,item:N,listSize:d.length})})]},N.id+"_editing"):p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[p.jsxs(ot,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>Y(N.id),onDoubleClick:x,title:r("page-menu.go-to-page"),children:[p.jsx(kE,{checked:N.id===f.id}),p.jsx(yr,{children:N.name})]}),!m&&p.jsx("div",{className:"tlui-page_menu__item__submenu",children:p.jsx(ND,{index:_,item:N,listSize:d.length,onRename:()=>{if(_n.isIos){const O=window.prompt("Rename page",N.name);O&&O!==N.name&&V(N.id,O)}else b(!0),g!==N.id&&Y(N.id)}})})]},N.id)})})]})})]})});function rfe(){const n=me(),e=e7(),t=J$(),r=Hi(1),i=Ls(),s=xe("should display quick actions",()=>n.isInAny("select","hand","zoom"),[n]),o=Sc(),a=r&&o;if(!(i&&!s))return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"undo",disabled:!e}),p.jsx(Ee,{actionId:"redo",disabled:!t}),p.jsx(Ee,{actionId:"delete",disabled:!a}),p.jsx(Ee,{actionId:"duplicate",disabled:!a})]})}const ife=P.memo(function({children:e}){const t=e??p.jsx(rfe,{});return p.jsx(no,{type:"small-icons",sourceId:"quick-actions",children:t})});function sfe({userId:n}){const e=iw(n);return e?p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const ofe=ti(function({userId:e}){const t=me(),r=Nt(),i=ri(),s=iw(e),o=P.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),i("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),i("start-following",{source:"people-menu"}))},[t,e,i]),a=(s==null?void 0:s.followingUserId)===t.user.getId(),c=t.getInstanceState().followingUserId===e;return s?p.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[p.jsxs(ot,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[p.jsx(ya,{icon:"color",color:s.color}),p.jsx("div",{className:"tlui-people-menu__name",children:s.userName??"New User"})]}),p.jsx(ot,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,"data-active":c||a,children:p.jsx(Ot,{icon:a?"leading":c?"following":"follow"})})]}):null});function afe({count:n}){return p.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const cfe=ti(function(){const e=me(),t=Mr(),r=Nt(),i=ri(),s=P.useRef(!1),[o,a]=P.useState(!1),c=P.useCallback(w=>{a(w)},[]),u=e.user.getColor(),d=P.useCallback(w=>{e.user.updateUserPreferences({color:w}),i("set-color",{source:"people-menu"})},[e,i]),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:m,handleButtonPointerUp:v}=Ce.useMemo(()=>{const w=()=>{s.current=!1,window.removeEventListener("pointerup",w)};return{handleButtonClick:M=>{const{id:j}=M.currentTarget.dataset;j&&u!==j&&d(j)},handleButtonPointerDown:M=>{const{id:j}=M.currentTarget.dataset;j&&(d(j),s.current=!0,window.addEventListener("pointerup",w))},handleButtonPointerEnter:M=>{if(!s.current)return;const{id:j}=M.currentTarget.dataset;j&&d(j)},handleButtonPointerUp:M=>{const{id:j}=M.currentTarget.dataset;j&&d(j)}}},[u,d]);return p.jsxs(PP,{onOpenChange:c,open:o,children:[p.jsx(MP,{dir:"ltr",asChild:!0,children:p.jsx(ot,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:p.jsx(Ot,{icon:"color"})})}),p.jsx(TP,{container:t,children:p.jsx(kP,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:p.jsx("div",{className:"tlui-buttons__grid",children:LI.map(w=>p.jsx(ot,{type:"icon","data-id":w,"data-testid":w,"aria-label":w,"data-state":u===w?"hinted":void 0,title:w,className:"tlui-button-grid__button",style:{color:w},onPointerEnter:m,onPointerDown:g,onPointerUp:v,onClick:f,children:p.jsx(Ot,{icon:"color"})},w))})})})]})});function lfe(){const n=me(),e=ri(),t=xe("userName",()=>n.user.getName(),[]),r=Nt(),i=P.useRef(t),s=P.useRef(t),[o,a]=P.useState(!1),c=P.useCallback(()=>{a(g=>!g)},[]),u=P.useCallback(g=>{s.current=g,n.user.updateUserPreferences({name:g})},[n]),d=P.useCallback(()=>{i.current!==s.current&&(e("change-user-name",{source:"people-menu"}),i.current=s.current)},[e]),f=P.useCallback(()=>{a(!1),n.user.updateUserPreferences({name:i.current}),n.menus.clearOpenMenus()},[n]);return p.jsxs("div",{className:"tlui-people-menu__user",children:[p.jsx(cfe,{}),o?p.jsx(Lw,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:u,onComplete:c,onCancel:f,onBlur:d,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:t}),t==="New User"?p.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),p.jsx(ot,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:p.jsx(Ot,{icon:o?"check":"edit"})})]})}function ufe({displayUserWhenAlone:n,children:e}){const t=Nt(),r=Mr(),i=me(),s=KN(),o=xe("user",()=>i.user.getColor(),[i]),a=xe("user",()=>i.user.getName(),[i]),[c,u]=vc("people menu");return p.jsxs(PP,{onOpenChange:u,open:c,children:[p.jsx(MP,{dir:"ltr",asChild:!0,children:p.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[s.length>5&&p.jsx(afe,{count:s.length-5}),p.jsxs("div",{className:"tlui-people-menu__avatars",children:[s.slice(-5).map(d=>p.jsx(sfe,{userId:d},d)),(n||s.length>0)&&p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:a==="New User"?"":a[0]??""})]})]})}),p.jsx(TP,{container:r,children:p.jsx(kP,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,onEscapeKeyDown:kt,children:p.jsxs("div",{className:"tlui-people-menu__wrapper",children:[p.jsx("div",{className:"tlui-people-menu__section",children:p.jsx(lfe,{})}),s.length>0&&p.jsx("div",{className:"tlui-people-menu__section",children:s.map(d=>p.jsx(ofe,{userId:d},d+"_presence"))}),e]})})})]})}function dfe(){return p.jsx("div",{className:"tlui-share-zone",draggable:!1,children:p.jsx(ufe,{displayUserWhenAlone:!0})})}const hfe=Object.freeze([hs,Iu,Eu,Ro]);function N7(n=hfe){const e=me();return xe("getRelevantStyles",()=>{var s;const t=new $I(e.getSharedStyles()),r=!!((s=e.root.getCurrent())!=null&&s.shapeType),i=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of n)t.applyValue(o,e.getStyleForNextShape(o));return r||i||t.size>0?t:null},[e])}const Qs={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},du=P.memo(function(e){const{uiType:t,items:r,title:i,style:s,value:o,onValueChange:a,onHistoryMark:c,theme:u}=e,d=Nt(),f=P.useRef(!1),g=P.useRef(null),{handleButtonClick:m,handleButtonPointerDown:v,handleButtonPointerEnter:w,handleButtonPointerUp:S}=P.useMemo(()=>{const b=()=>{f.current=!1,window.removeEventListener("pointerup",b);const D=g.current;D&&["TEXTAREA","INPUT"].includes(D.nodeName)&&D.focus(),g.current=null};return{handleButtonClick:D=>{const{id:H}=D.currentTarget.dataset;o.type==="shared"&&o.value===H||(c==null||c("point picker item"),a(s,H))},handleButtonPointerDown:D=>{const{id:H}=D.currentTarget.dataset;c==null||c("point picker item"),a(s,H),f.current=!0,g.current=document.activeElement,window.addEventListener("pointerup",b)},handleButtonPointerEnter:D=>{if(!f.current)return;const{id:H}=D.currentTarget.dataset;a(s,H)},handleButtonPointerUp:D=>{const{id:H}=D.currentTarget.dataset;o.type==="shared"&&o.value===H||a(s,H)}}},[o,c,a,s]);return p.jsx("div",{"data-testid":`style.${t}`,className:rt("tlui-buttons__grid"),children:r.map(b=>p.jsx(ot,{type:"icon","data-id":b.value,"data-testid":`style.${t}.${b.value}`,"aria-label":b.value,"data-state":o.type==="shared"&&o.value===b.value?"hinted":void 0,title:i+"  "+d(`${t}-style.${b.value}`),className:rt("tlui-button-grid__button"),style:s===hs?{color:u[b.value].solid}:void 0,onPointerEnter:w,onPointerDown:v,onPointerUp:S,onClick:m,children:p.jsx(Ot,{icon:b.icon})},b.value))})});function B7(n,[e,t]){return Math.min(t,Math.max(e,n))}function ffe(n){const e=P.useRef({value:n,previous:n});return P.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var F7=["PageUp","PageDown"],z7=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],U7={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Lh="Slider",[RE,pfe,gfe]=xw(Lh),[$7,exe]=$u(Lh,[gfe]),[mfe,Zw]=$7(Lh),H7=P.forwardRef((n,e)=>{const{name:t,min:r=0,max:i=100,step:s=1,orientation:o="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:u=[r],value:d,onValueChange:f=()=>{},onValueCommit:g=()=>{},inverted:m=!1,form:v,...w}=n,S=P.useRef(new Set),b=P.useRef(0),E=o==="horizontal"?yfe:wfe,[M=[],j]=Tl({prop:d,defaultProp:u,onChange:Y=>{var N;(N=[...S.current][b.current])==null||N.focus(),f(Y)}}),D=P.useRef(M);function H(Y){const V=_fe(M,Y);z(Y,V)}function L(Y){z(Y,b.current)}function U(){const Y=D.current[b.current];M[b.current]!==Y&&g(M)}function z(Y,V,{commit:N}={commit:!1}){const _=Pfe(s),k=Mfe(Math.round((Y-r)/s)*s+r,_),O=B7(k,[r,i]);j((W=[])=>{const q=xfe(W,O,V);if(Cfe(q,c*s)){b.current=q.indexOf(O);const X=String(q)!==String(W);return X&&N&&g(q),X?q:W}else return W})}return p.jsx(mfe,{scope:n.__scopeSlider,name:t,disabled:a,min:r,max:i,valueIndexToChangeRef:b,thumbs:S.current,values:M,orientation:o,form:v,children:p.jsx(RE.Provider,{scope:n.__scopeSlider,children:p.jsx(RE.Slot,{scope:n.__scopeSlider,children:p.jsx(E,{"aria-disabled":a,"data-disabled":a?"":void 0,...w,ref:e,onPointerDown:Ge(w.onPointerDown,()=>{a||(D.current=M)}),min:r,max:i,inverted:m,onSlideStart:a?void 0:H,onSlideMove:a?void 0:L,onSlideEnd:a?void 0:U,onHomeKeyDown:()=>!a&&z(r,0,{commit:!0}),onEndKeyDown:()=>!a&&z(i,M.length-1,{commit:!0}),onStepKeyDown:({event:Y,direction:V})=>{if(!a){const k=F7.includes(Y.key)||Y.shiftKey&&z7.includes(Y.key)?10:1,O=b.current,W=M[O],q=s*k*V;z(W+q,O,{commit:!0})}}})})})})});H7.displayName=Lh;var[W7,K7]=$7(Lh,{startEdge:"left",endEdge:"right",size:"width",direction:1}),yfe=P.forwardRef((n,e)=>{const{min:t,max:r,dir:i,inverted:s,onSlideStart:o,onSlideMove:a,onSlideEnd:c,onStepKeyDown:u,...d}=n,[f,g]=P.useState(null),m=Dn(e,E=>g(E)),v=P.useRef(),w=E2(i),S=w==="ltr",b=S&&!s||!S&&s;function x(E){const M=v.current||f.getBoundingClientRect(),j=[0,M.width],H=OP(j,b?[t,r]:[r,t]);return v.current=M,H(E-M.left)}return p.jsx(W7,{scope:n.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:p.jsx(q7,{dir:w,"data-orientation":"horizontal",...d,ref:m,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const M=x(E.clientX);o==null||o(M)},onSlideMove:E=>{const M=x(E.clientX);a==null||a(M)},onSlideEnd:()=>{v.current=void 0,c==null||c()},onStepKeyDown:E=>{const j=U7[b?"from-left":"from-right"].includes(E.key);u==null||u({event:E,direction:j?-1:1})}})})}),wfe=P.forwardRef((n,e)=>{const{min:t,max:r,inverted:i,onSlideStart:s,onSlideMove:o,onSlideEnd:a,onStepKeyDown:c,...u}=n,d=P.useRef(null),f=Dn(e,d),g=P.useRef(),m=!i;function v(w){const S=g.current||d.current.getBoundingClientRect(),b=[0,S.height],E=OP(b,m?[r,t]:[t,r]);return g.current=S,E(w-S.top)}return p.jsx(W7,{scope:n.__scopeSlider,startEdge:m?"bottom":"top",endEdge:m?"top":"bottom",size:"height",direction:m?1:-1,children:p.jsx(q7,{"data-orientation":"vertical",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:w=>{const S=v(w.clientY);s==null||s(S)},onSlideMove:w=>{const S=v(w.clientY);o==null||o(S)},onSlideEnd:()=>{g.current=void 0,a==null||a()},onStepKeyDown:w=>{const b=U7[m?"from-bottom":"from-top"].includes(w.key);c==null||c({event:w,direction:b?-1:1})}})})}),q7=P.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:i,onSlideEnd:s,onHomeKeyDown:o,onEndKeyDown:a,onStepKeyDown:c,...u}=n,d=Zw(Lh,t);return p.jsx(Vt.span,{...u,ref:e,onKeyDown:Ge(n.onKeyDown,f=>{f.key==="Home"?(o(f),f.preventDefault()):f.key==="End"?(a(f),f.preventDefault()):F7.concat(z7).includes(f.key)&&(c(f),f.preventDefault())}),onPointerDown:Ge(n.onPointerDown,f=>{const g=f.target;g.setPointerCapture(f.pointerId),f.preventDefault(),d.thumbs.has(g)?g.focus():r(f)}),onPointerMove:Ge(n.onPointerMove,f=>{f.target.hasPointerCapture(f.pointerId)&&i(f)}),onPointerUp:Ge(n.onPointerUp,f=>{const g=f.target;g.hasPointerCapture(f.pointerId)&&(g.releasePointerCapture(f.pointerId),s(f))})})}),G7="SliderTrack",V7=P.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Zw(G7,t);return p.jsx(Vt.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...r,ref:e})});V7.displayName=G7;var jE="SliderRange",Y7=P.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,i=Zw(jE,t),s=K7(jE,t),o=P.useRef(null),a=Dn(e,o),c=i.values.length,u=i.values.map(g=>Z7(g,i.min,i.max)),d=c>1?Math.min(...u):0,f=100-Math.max(...u);return p.jsx(Vt.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...r,ref:a,style:{...n.style,[s.startEdge]:d+"%",[s.endEdge]:f+"%"}})});Y7.displayName=jE;var DE="SliderThumb",X7=P.forwardRef((n,e)=>{const t=pfe(n.__scopeSlider),[r,i]=P.useState(null),s=Dn(e,a=>i(a)),o=P.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return p.jsx(vfe,{...n,ref:s,index:o})}),vfe=P.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,name:i,...s}=n,o=Zw(DE,t),a=K7(DE,t),[c,u]=P.useState(null),d=Dn(e,x=>u(x)),f=c?o.form||!!c.closest("form"):!0,g=FB(c),m=o.values[r],v=m===void 0?0:Z7(m,o.min,o.max),w=bfe(r,o.values.length),S=g==null?void 0:g[a.size],b=S?Ife(S,v,a.direction):0;return P.useEffect(()=>{if(c)return o.thumbs.add(c),()=>{o.thumbs.delete(c)}},[c,o.thumbs]),p.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${b}px)`},children:[p.jsx(RE.ItemSlot,{scope:n.__scopeSlider,children:p.jsx(Vt.span,{role:"slider","aria-label":n["aria-label"]||w,"aria-valuemin":o.min,"aria-valuenow":m,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0,...s,ref:d,style:m===void 0?{display:"none"}:n.style,onFocus:Ge(n.onFocus,()=>{o.valueIndexToChangeRef.current=r})})}),f&&p.jsx(Sfe,{name:i??(o.name?o.name+(o.values.length>1?"[]":""):void 0),form:o.form,value:m},r)]})});X7.displayName=DE;var Sfe=n=>{const{value:e,...t}=n,r=P.useRef(null),i=ffe(e);return P.useEffect(()=>{const s=r.current,o=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(o,"value").set;if(i!==e&&c){const u=new Event("input",{bubbles:!0});c.call(s,e),s.dispatchEvent(u)}},[i,e]),p.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:e})};function xfe(n=[],e,t){const r=[...n];return r[t]=e,r.sort((i,s)=>i-s)}function Z7(n,e,t){const s=100/(t-e)*(n-e);return B7(s,[0,100])}function bfe(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function _fe(n,e){if(n.length===1)return 0;const t=n.map(i=>Math.abs(i-e)),r=Math.min(...t);return t.indexOf(r)}function Ife(n,e,t){const r=n/2,s=OP([0,50],[0,r]);return(r-s(e)*t)*t}function Efe(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Cfe(n,e){if(e>0){const t=Efe(n);return Math.min(...t)>=e}return!0}function OP(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Pfe(n){return(String(n).split(".")[1]||"").length}function Mfe(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var Tfe=H7,kfe=V7,Afe=Y7,Rfe=X7;const jfe=P.memo(function({onHistoryMark:e,title:t,steps:r,value:i,label:s,onValueChange:o,["data-testid"]:a}){const c=Nt(),u=P.useCallback(g=>{o(g[0])},[o]),d=P.useCallback(()=>{e("click slider")},[e]),f=P.useCallback(()=>{i&&o(i)},[i,o]);return p.jsx("div",{className:"tlui-slider__container",children:p.jsxs(Tfe,{"data-testid":a,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:i?[i]:void 0,onPointerDown:d,onValueChange:u,onPointerUp:f,title:t+"  "+c(s),children:[p.jsx(kfe,{className:"tlui-slider__track",dir:"ltr",children:i!==null&&p.jsx(Afe,{className:"tlui-slider__range",dir:"ltr"})}),i!==null&&p.jsx(Rfe,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function Dfe({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:i,itemsA:s,itemsB:o,styleA:a,styleB:c,valueA:u,valueB:d,onValueChange:f}){const g=Nt(),m=P.useMemo(()=>{var w;return((w=s.find(S=>u.type==="shared"&&u.value===S.value))==null?void 0:w.icon)??"mixed"},[s,u]),v=P.useMemo(()=>{var w;return((w=o.find(S=>d.type==="shared"&&d.value===S.value))==null?void 0:w.icon)??"mixed"},[o,d]);return u===void 0&&d===void 0?null:p.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[p.jsx("div",{title:g(n),className:"tlui-style-panel__double-select-picker-label",children:g(n)}),p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsxs(ku,{id:`style panel ${e} A`,children:[p.jsx(Au,{children:p.jsx(ot,{type:"icon","data-testid":`style.${e}`,title:g(r)+"  "+(u===null||u.type==="mixed"?g("style-panel.mixed"):g(`${e}-style.${u.value}`)),children:p.jsx(Ot,{icon:m,small:!0,invertIcon:!0})})}),p.jsx(Ru,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map((w,S)=>p.jsx(Mp,{"data-testid":`style.${e}.${w.value}`,children:p.jsx(ot,{type:"icon",onClick:()=>f(a,w.value),title:`${g(r)}  ${g(`${e}-style.${w.value}`)}`,children:p.jsx(Ot,{icon:w.icon,invertIcon:!0})},w.value)},S))})})]}),p.jsxs(ku,{id:`style panel ${t}`,children:[p.jsx(Au,{children:p.jsx(ot,{type:"icon","data-testid":`style.${t}`,title:g(i)+"  "+(d===null||d.type==="mixed"?g("style-panel.mixed"):g(`${t}-style.${d.value}`)),children:p.jsx(Ot,{icon:v,small:!0})})}),p.jsx(Ru,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:o.map(w=>p.jsx(Mp,{children:p.jsx(ot,{type:"icon",title:`${g(i)}  ${g(`${t}-style.${w.value}`)}`,"data-testid":`style.${t}.${w.value}`,onClick:()=>f(c,w.value),children:p.jsx(Ot,{icon:w.icon})})},w.value))})})]})]})]})}const Ofe=P.memo(Dfe);function Lfe({id:n,label:e,uiType:t,stylePanelType:r,style:i,items:s,type:o,value:a,onValueChange:c}){const u=Nt(),d=me(),f=P.useMemo(()=>{var w;return(w=s.find(S=>a.type==="shared"&&S.value===a.value))==null?void 0:w.icon},[s,a]),g=u(`style-panel.${r}`),m=a.type==="mixed"?u("style-panel.mixed"):g+"  "+u(`${t}-style.${a.value}`),v=e?u(e):"";return p.jsxs(ku,{id:`style panel ${n}`,children:[p.jsx(Au,{children:p.jsxs(ot,{type:o,"data-testid":`style.${t}`,title:m,children:[v&&p.jsx(yr,{children:v}),p.jsx(Ot,{icon:f??"mixed"})]})}),p.jsx(Ru,{side:"left",align:"center",alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map(w=>p.jsx(Mp,{children:p.jsx(ot,{type:"icon","data-testid":`style.${t}.${w.value}`,title:g+"  "+u(`${t}-style.${w.value}`),onClick:()=>{d.markHistoryStoppingPoint("select style dropdown item"),c(i,w.value)},children:p.jsx(Ot,{icon:w.icon})})},w.value))})})]})}const LP=P.memo(Lfe);function Nfe({styles:n}){const e=eg();if(!n)return null;const t=n.get(Co),r=n.get(c0),i=n.get(a0),s=n.get(d0),o=n.get(pa),a=t===void 0,c=r===void 0&&i===void 0,u=s===void 0,d=o===void 0,f=wc({isDarkMode:e});return p.jsxs(p.Fragment,{children:[p.jsx(Bfe,{theme:f,styles:n}),!d&&p.jsx(Ffe,{theme:f,styles:n}),!(a&&c&&u)&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[p.jsx(zfe,{styles:n}),p.jsx($fe,{styles:n}),p.jsx(Ufe,{styles:n})]})]})}function cg(){const n=me(),e=ri();return Ce.useMemo(()=>function(r,i){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(r,i),n.setStyleForNextShapes(r,i),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:i})},[n,e])}function Bfe({styles:n,theme:e}){const t=Nt(),r=me(),i=P.useCallback(f=>r.markHistoryStoppingPoint(f),[r]),s=cg(),o=n.get(hs),a=n.get(Eu),c=n.get(Iu),u=n.get(Ro),d=a!==void 0||c!==void 0||u!==void 0;return p.jsxs(p.Fragment,{children:[p.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[o===void 0?null:p.jsx(du,{title:t("style-panel.color"),uiType:"color",style:hs,items:Qs.color,value:o,onValueChange:s,theme:e,onHistoryMark:i}),p.jsx(Hfe,{})]}),d&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:p.jsx(du,{title:t("style-panel.fill"),uiType:"fill",style:Eu,items:Qs.fill,value:a,onValueChange:s,theme:e,onHistoryMark:i}),c===void 0?null:p.jsx(du,{title:t("style-panel.dash"),uiType:"dash",style:Iu,items:Qs.dash,value:c,onValueChange:s,theme:e,onHistoryMark:i}),u===void 0?null:p.jsx(du,{title:t("style-panel.size"),uiType:"size",style:Ro,items:Qs.size,value:u,onValueChange:(f,g)=>{s(f,g);const m=r.getSelectedShapeIds();m.length>0&&An(r,m)},theme:e,onHistoryMark:i})]})]})}function Ffe({theme:n,styles:e}){const t=Nt(),r=cg(),i=me(),s=P.useCallback(d=>i.markHistoryStoppingPoint(d),[i]),o=e.get(pa),a=e.get(AI),c=e.get(l0),u=e.get(u0);return o===void 0&&c===void 0?null:p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[o===void 0?null:p.jsx(du,{title:t("style-panel.font"),uiType:"font",style:pa,items:Qs.font,value:o,onValueChange:r,theme:n,onHistoryMark:s}),a===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(du,{title:t("style-panel.align"),uiType:"align",style:AI,items:Qs.textAlign,value:a,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:p.jsx(ot,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(Ot,{icon:"vertical-align-middle"})})})]}),c===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(du,{title:t("style-panel.label-align"),uiType:"align",style:l0,items:Qs.horizontalAlign,value:c,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:u===void 0?p.jsx(ot,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(Ot,{icon:"vertical-align-middle"})}):p.jsx(LP,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:u0,items:Qs.verticalAlign,value:u,onValueChange:r})})]})]})}function zfe({styles:n}){const e=cg(),t=n.get(Co);return t===void 0?null:p.jsx(LP,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:Co,items:Qs.geo,value:t,onValueChange:e})}function Ufe({styles:n}){const e=cg(),t=n.get(d0);return t===void 0?null:p.jsx(LP,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:d0,items:Qs.spline,value:t,onValueChange:e})}function $fe({styles:n}){const e=cg(),t=n.get(c0),r=n.get(a0);return!t||!r?null:p.jsx(Ofe,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:a0,itemsA:Qs.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:c0,itemsB:Qs.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const Rf=[.1,.25,.5,.75,1];function Hfe(){const n=me(),e=P.useCallback(a=>n.markHistoryStoppingPoint(a),[n]),t=xe("opacity",()=>n.getSharedOpacity(),[n]),r=ri(),i=Nt(),s=Ce.useCallback(a=>{const c=Rf[a];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(c),n.setOpacityForNextShapes(c),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[n,r]);if(t===void 0)return null;const o=t.type==="mixed"?-1:Rf.indexOf(hK(Rf,a=>Math.abs(a-t.value)));return p.jsx(jfe,{"data-testid":"style.opacity",value:o>=0?o:Rf.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:s,steps:Rf.length-1,title:i("style-panel.opacity"),onHistoryMark:e})}const Wfe=P.memo(function({isMobile:e,children:t}){const r=me(),i=P.useRef(null);Ml(i);const s=N7(),o=P.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),a=t??p.jsx(Nfe,{styles:s});return p.jsx("div",{ref:i,className:rt("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:o,children:a})});function Kfe(){const n=me(),e=Nt(),t=N7(),r=t==null?void 0:t.get(hs),i=wc({isDarkMode:n.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?i[r.value]:i.black).solid,o=xe("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),a=P.useCallback(u=>{u||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:c}=Rl();return c?p.jsxs(AP,{id:"mobile style menu",onOpenChange:a,children:[p.jsx(RP,{children:p.jsx(ot,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":s},title:e("style-panel.title"),disabled:o,children:p.jsx(Ot,{icon:o?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),p.jsx(jP,{side:"top",align:"end",children:c&&p.jsx(c,{isMobile:!0})})]}):null}function qfe(){return p.jsxs(p.Fragment,{children:[p.jsx(Vfe,{}),p.jsx(Yfe,{}),p.jsx(Xfe,{}),p.jsx(Zfe,{}),p.jsx(Qfe,{}),p.jsx(Jfe,{}),p.jsx(epe,{}),p.jsx(tpe,{}),p.jsx(npe,{}),p.jsx(rpe,{}),p.jsx(spe,{}),p.jsx(ipe,{}),p.jsx(cpe,{}),p.jsx(dpe,{}),p.jsx(ope,{}),p.jsx(upe,{}),p.jsx(lpe,{}),p.jsx(ape,{}),p.jsx(hpe,{}),p.jsx(fpe,{}),p.jsx(ppe,{}),p.jsx(gpe,{}),p.jsx(mpe,{}),p.jsx(ype,{}),p.jsx(wpe,{}),p.jsx(vpe,{}),p.jsx(xpe,{}),p.jsx(Spe,{})]})}function Gfe(n){var r;const e=me(),t=(r=n.meta)==null?void 0:r.geo;return xe("is tool selected",()=>{const i=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(Co);return t?i==="geo"&&s===t:i===n.id},[e,n.id,t])}function In({tool:n}){const e=hP(),t=Gfe(e[n]);return p.jsx(ts,{toolId:n,isSelected:t})}function Vfe(){return p.jsx(In,{tool:"select"})}function Yfe(){return p.jsx(In,{tool:"hand"})}function Xfe(){return p.jsx(In,{tool:"draw"})}function Zfe(){return p.jsx(In,{tool:"eraser"})}function Qfe(){return p.jsx(In,{tool:"arrow"})}function Jfe(){return p.jsx(In,{tool:"text"})}function epe(){return p.jsx(In,{tool:"note"})}function tpe(){return p.jsx(ts,{toolId:"asset"})}function npe(){return p.jsx(In,{tool:"rectangle"})}function rpe(){return p.jsx(In,{tool:"ellipse"})}function ipe(){return p.jsx(In,{tool:"diamond"})}function spe(){return p.jsx(In,{tool:"triangle"})}function ope(){return p.jsx(In,{tool:"rhombus"})}function ape(){return p.jsx(In,{tool:"heart"})}function cpe(){return p.jsx(In,{tool:"hexagon"})}function lpe(){return p.jsx(In,{tool:"cloud"})}function upe(){return p.jsx(In,{tool:"star"})}function dpe(){return p.jsx(In,{tool:"oval"})}function hpe(){return p.jsx(In,{tool:"x-box"})}function fpe(){return p.jsx(In,{tool:"check-box"})}function ppe(){return p.jsx(In,{tool:"arrow-left"})}function gpe(){return p.jsx(In,{tool:"arrow-up"})}function mpe(){return p.jsx(In,{tool:"arrow-down"})}function ype(){return p.jsx(In,{tool:"arrow-right"})}function wpe(){return p.jsx(In,{tool:"line"})}function vpe(){return p.jsx(In,{tool:"highlight"})}function Spe(){return p.jsx(In,{tool:"frame"})}function xpe(){return p.jsx(In,{tool:"laser"})}const $b=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Hb(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function jf(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function Q7(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function J7(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function bpe(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let i=!0;for(let s=0;s<t.length;s++)r.indexOf(t[s])===-1&&(i=!1);return i}const Tp={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":$b?173:189,"=":$b?61:187,";":$b?59:186,"'":222,"[":219,"]":221,"\\":220},va={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},OE={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},qr={16:!1,18:!1,17:!1,91:!1},nr={};for(let n=1;n<20;n++)Tp["f".concat(n)]=111+n;let Rn=[],ap=null,e9="all";const qa=new Map,lg=n=>Tp[n.toLowerCase()]||va[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),_pe=n=>Object.keys(Tp).find(e=>Tp[e]===n),Ipe=n=>Object.keys(va).find(e=>va[e]===n);function t9(n){e9=n||"all"}function kp(){return e9||"all"}function Epe(){return Rn.slice(0)}function Cpe(){return Rn.map(n=>_pe(n)||Ipe(n)||String.fromCharCode(n))}function Ppe(){const n=[];return Object.keys(nr).forEach(e=>{nr[e].forEach(t=>{let{key:r,scope:i,mods:s,shortcut:o}=t;n.push({scope:i,shortcut:o,mods:s,keys:r.split("+").map(a=>lg(a))})})}),n}function Mpe(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const i=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(i||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function Tpe(n){return typeof n=="string"&&(n=lg(n)),Rn.indexOf(n)!==-1}function kpe(n,e){let t,r;n||(n=kp());for(const i in nr)if(Object.prototype.hasOwnProperty.call(nr,i))for(t=nr[i],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(o=>{let{element:a}=o;return NP(a)}):r++;kp()===n&&t9(e||"all")}function Ape(n){let e=n.keyCode||n.which||n.charCode;const t=Rn.indexOf(e);if(t>=0&&Rn.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&Rn.splice(0,Rn.length),(e===93||e===224)&&(e=91),e in qr){qr[e]=!1;for(const r in va)va[r]===e&&(us[r]=!1)}}function n9(n){if(typeof n>"u")Object.keys(nr).forEach(i=>{Array.isArray(nr[i])&&nr[i].forEach(s=>Vm(s)),delete nr[i]}),NP(null);else if(Array.isArray(n))n.forEach(i=>{i.key&&Vm(i)});else if(typeof n=="object")n.key&&Vm(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[i,s]=t;typeof i=="function"&&(s=i,i=""),Vm({key:n,scope:i,method:s,splitKey:"+"})}}const Vm=n=>{let{key:e,scope:t,method:r,splitKey:i="+"}=n;J7(e).forEach(o=>{const a=o.split(i),c=a.length,u=a[c-1],d=u==="*"?"*":lg(u);if(!nr[d])return;t||(t=kp());const f=c>1?Q7(va,a):[],g=[];nr[d]=nr[d].filter(m=>{const w=(r?m.method===r:!0)&&m.scope===t&&bpe(m.mods,f);return w&&g.push(m.element),!w}),g.forEach(m=>NP(m))})};function BD(n,e,t,r){if(e.element!==r)return;let i;if(e.scope===t||e.scope==="all"){i=e.mods.length>0;for(const s in qr)Object.prototype.hasOwnProperty.call(qr,s)&&(!qr[s]&&e.mods.indexOf(+s)>-1||qr[s]&&e.mods.indexOf(+s)===-1)&&(i=!1);(e.mods.length===0&&!qr[16]&&!qr[18]&&!qr[17]&&!qr[91]||i||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Rn),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function FD(n,e){const t=nr["*"];let r=n.keyCode||n.which||n.charCode;if(!us.filter.call(this,n))return;if((r===93||r===224)&&(r=91),Rn.indexOf(r)===-1&&r!==229&&Rn.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const c=OE[a];n[a]&&Rn.indexOf(c)===-1?Rn.push(c):!n[a]&&Rn.indexOf(c)>-1?Rn.splice(Rn.indexOf(c),1):a==="metaKey"&&n[a]&&Rn.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(Rn=Rn.slice(Rn.indexOf(c))))}),r in qr){qr[r]=!0;for(const a in va)va[a]===r&&(us[a]=!0);if(!t)return}for(const a in qr)Object.prototype.hasOwnProperty.call(qr,a)&&(qr[a]=n[OE[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(Rn.indexOf(17)===-1&&Rn.push(17),Rn.indexOf(18)===-1&&Rn.push(18),qr[17]=!0,qr[18]=!0);const i=kp();if(t)for(let a=0;a<t.length;a++)t[a].scope===i&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&BD(n,t[a],i,e);if(!(r in nr))return;const s=nr[r],o=s.length;for(let a=0;a<o;a++)if((n.type==="keydown"&&s[a].keydown||n.type==="keyup"&&s[a].keyup)&&s[a].key){const c=s[a],{splitKey:u}=c,d=c.key.split(u),f=[];for(let g=0;g<d.length;g++)f.push(lg(d[g]));f.sort().join("")===Rn.sort().join("")&&BD(n,c,i,e)}}function us(n,e,t){Rn=[];const r=J7(n);let i=[],s="all",o=document,a=0,c=!1,u=!0,d="+",f=!1,g=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(o=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(f=e.capture),typeof e.splitKey=="string"&&(d=e.splitKey),e.single===!0&&(g=!0)),typeof e=="string"&&(s=e),g&&n9(n,s);a<r.length;a++)n=r[a].split(d),i=[],n.length>1&&(i=Q7(va,n)),n=n[n.length-1],n=n==="*"?"*":lg(n),n in nr||(nr[n]=[]),nr[n].push({keyup:c,keydown:u,scope:s,mods:i,shortcut:r[a],method:t,key:r[a],splitKey:d,element:o});if(typeof o<"u"&&window){if(!qa.has(o)){const m=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return FD(w,o)},v=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;FD(w,o),Ape(w)};qa.set(o,{keydownListener:m,keyupListenr:v,capture:f}),Hb(o,"keydown",m,f),Hb(o,"keyup",v,f)}if(!ap){const m=()=>{Rn=[]};ap={listener:m,capture:f},Hb(window,"focus",m,f)}}}function Rpe(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(nr).forEach(t=>{nr[t].filter(i=>i.scope===e&&i.shortcut===n).forEach(i=>{i&&i.method&&i.method()})})}function NP(n){const e=Object.values(nr).flat();if(e.findIndex(r=>{let{element:i}=r;return i===n})<0){const{keydownListener:r,keyupListenr:i,capture:s}=qa.get(n)||{};r&&i&&(jf(n,"keyup",i,s),jf(n,"keydown",r,s),qa.delete(n))}if((e.length<=0||qa.size<=0)&&(Object.keys(qa).forEach(i=>{const{keydownListener:s,keyupListenr:o,capture:a}=qa.get(i)||{};s&&o&&(jf(i,"keyup",o,a),jf(i,"keydown",s,a),qa.delete(i))}),qa.clear(),Object.keys(nr).forEach(i=>delete nr[i]),ap)){const{listener:i,capture:s}=ap;jf(window,"focus",i,s),ap=null}}const Wb={getPressedKeyString:Cpe,setScope:t9,getScope:kp,deleteScope:kpe,getPressedKeyCodes:Epe,getAllKeyCodes:Ppe,isPressed:Tpe,filter:Mpe,trigger:Rpe,unbind:n9,keyMap:Tp,modifier:va,modifierMap:OE};for(const n in Wb)Object.prototype.hasOwnProperty.call(Wb,n)&&(us[n]=Wb[n]);if(typeof window<"u"){const n=window.hotkeys;us.noConflict=e=>(e&&window.hotkeys===us&&(window.hotkeys=n),us),window.hotkeys=us}const zD=["copy","cut","paste","asset"];function jpe(){const n=me(),e=Ls(),t=Ku(),r=hP(),i=xe("is focused",()=>n.getInstanceState().isFocused,[n]);P.useEffect(()=>{if(!i)return;const s=new Array,o=(c,u)=>{us(c,{element:document.body},u),s.push(()=>{us.unbind(c,u)})},a=(c,u)=>{us(c,{element:document.body,keyup:!0,keydown:!1},u),s.push(()=>{us.unbind(c,u)})};for(const c of Object.values(t))c.kbd&&(e&&!c.readonlyOk||zD.includes(c.id)||o(UD(c.kbd),u=>{Yf(n)||(kt(u),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&n.getIsReadonly()||zD.includes(c.id)||o(UD(c.kbd),u=>{Yf(n)||(kt(u),c.onSelect("kbd"))});return o(",",c=>{if(Yf(n)||n.inputs.keys.has("Comma"))return;kt(c),n.focus(),n.inputs.keys.add("Comma");const{x:u,y:d,z:f}=n.inputs.currentPagePoint,g=n.pageToScreen({x:u,y:d}),m={type:"pointer",name:"pointer_down",point:{x:g.x,y:g.y,z:f},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Ii(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(m)}),a(",",c=>{if(Yf(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:u,y:d,z:f}=n.inputs.currentScreenPoint,g={type:"pointer",name:"pointer_up",point:{x:u,y:d,z:f},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Ii(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(g)}),()=>{s.forEach(c=>c())}},[t,r,e,n,i])}function UD(n){return Dpe(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd++${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function Dpe(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Yf(n){return n.menus.hasAnyOpenMenus()||n.getEditingShapeId()!==null||n.getCrashingError()}const Ope=P.createContext(!1);function Lpe({children:n}){const e=me(),t=Mh(),r=$i(),i=Nt(),s=Math.min(8,5+r),[o,a]=P.useState(0),c=P.useRef(null),[u,d]=P.useState(null),f=P.useMemo(()=>{const m=u?`:not([data-value="${u}"])`:"";return`
			#${t}_main > *:nth-child(n + ${s+(u?1:2)})${m} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${s}) {
				display: none;
			}
        `},[u,t,s]),g=dw(()=>{if(!c.current)return;const m=Array.from(c.current.children);a(m.length),m.findIndex(S=>S.getAttribute("data-value")===u)<=s&&d(null);const w=Array.from(c.current.children).findIndex(S=>S.getAttribute("aria-checked")==="true");w!==-1&&w>=s&&d(m[w].getAttribute("data-value"))});return P.useLayoutEffect(()=>{g()}),P.useLayoutEffect(()=>{if(!c.current)return;const m=new MutationObserver(g);return m.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{m.disconnect()}},[g]),P.useEffect(()=>{const m=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[v,w]of m)us(v,S=>{var E;if(Yf(e))return;kt(S);const x=Array.from(((E=c.current)==null?void 0:E.children)??[]).filter(M=>!(M instanceof HTMLElement)||M.tagName.toLowerCase()!=="button"?!1:!!(M.offsetWidth||M.offsetHeight))[w];x&&x.click()});return()=>{us.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),p.jsxs(p.Fragment,{children:[p.jsx("style",{children:f}),p.jsxs("div",{className:rt("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<lr.TABLET_SM}),role:"radiogroup",children:[p.jsx("div",{id:`${t}_main`,ref:c,className:"tlui-toolbar__tools__list",children:p.jsx(no,{type:"toolbar",sourceId:"toolbar",children:n})}),o>s+1&&p.jsx(Ope.Provider,{value:!0,children:p.jsxs(ku,{id:"toolbar overflow",modal:!1,children:[p.jsx(Au,{children:p.jsx(ot,{title:i("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:p.jsx(Ot,{icon:"chevron-up"})})}),p.jsx(Ru,{side:"top",align:"center",children:p.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:p.jsx(no,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function Npe({activeToolId:n}){const e=me(),t=$i(),r=Nt(),i=xe("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=xe("current tool",()=>e.getCurrentTool(),[e]);return!n||!s.isLockable?null:p.jsx(ot,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:rt("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<lr.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!i}),children:p.jsx(Ot,{icon:i?"lock":"unlock",small:!0})})}const Bpe=P.memo(function({children:e}){const t=me(),r=$i(),i=Ls(),s=xe("current tool id",()=>t.getCurrentToolId(),[t]),o=P.useRef(null);Ml(o);const{ActionsMenu:a,QuickActions:c}=Rl(),u=t.options.actionShortcutsLocation==="menu"?!1:t.options.actionShortcutsLocation==="toolbar"?!0:r<lr.TABLET;return p.jsx("div",{ref:o,className:"tlui-toolbar",children:p.jsxs("div",{className:"tlui-toolbar__inner",children:[p.jsxs("div",{className:"tlui-toolbar__left",children:[!i&&p.jsxs("div",{className:"tlui-toolbar__extras",children:[u&&p.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&p.jsx(c,{}),a&&p.jsx(a,{})]}),p.jsx(Npe,{activeToolId:s})]}),p.jsx(Lpe,{children:e??p.jsx(qfe,{})})]}),r<lr.TABLET_SM&&!i&&p.jsx("div",{className:"tlui-toolbar__tools",children:p.jsx(Kfe,{})})]})})});function Fpe(){const n=Nt();return p.jsxs("div",{className:rt("tlui-offline-indicator"),children:[n("status.offline"),p.jsx(ya,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function zpe({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:r=12,squeezeAmount:i=52,children:s}){const o=P.useRef(null),a=$i(),c=P.useCallback(()=>{const u=o.current;if(!u)return;const d=u.parentElement.parentElement,f=d.querySelector(".tlui-layout__top__left"),g=d.querySelector(".tlui-layout__top__right"),m=d.offsetWidth,v=f.offsetWidth,w=g.offsetWidth,S=u.offsetWidth-e;let b=(m-S)/2;m%2!==0&&(b-=.5);const x=v+r,E=u.offsetLeft,M=Math.min(m-w-v-2*r,n),j=Math.max(b,x)-E;g.offsetWidth>t&&a<=6?u.style.setProperty("max-width",M-i+"px"):u.style.setProperty("max-width",M+"px"),u.style.setProperty("transform",`translate(${j}px, 0px)`)},[a,e,r,n,i,t]);return P.useLayoutEffect(()=>{const u=o.current;if(!u)return;const d=u.parentElement.parentElement,f=d.querySelector(".tlui-layout__top__left"),g=d.querySelector(".tlui-layout__top__right"),m=new ResizeObserver(c);return m.observe(f),m.observe(g),m.observe(d),m.observe(u),c(),()=>{m.disconnect()}},[c]),P.useLayoutEffect(()=>{c()}),p.jsx("div",{ref:o,className:"tlui-top-panel__container",children:s})}function Upe(){const n=Tae()==="offline";return p.jsx(zpe,{children:n&&p.jsx(Fpe,{})})}function $pe(){return p.jsxs(p.Fragment,{children:[p.jsx(Ee,{actionId:"zoom-in",noClose:!0}),p.jsx(Ee,{actionId:"zoom-out",noClose:!0}),p.jsx(l7,{}),p.jsx(u7,{}),p.jsx(d7,{})]})}const Hpe=P.memo(function({children:e}){const t=Mr(),[r,i]=vc("zoom menu"),s=e??p.jsx($pe,{});return p.jsxs(X2,{dir:"ltr",open:r,onOpenChange:i,modal:!1,children:[p.jsx(Z2,{asChild:!0,dir:"ltr",children:p.jsx(Wpe,{})}),p.jsx(Rw,{container:t,children:p.jsx(Q2,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:p.jsx(no,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),Wpe=P.forwardRef(function(e,t){const r=me(),i=$i(),s=xe("zoom",()=>r.getZoomLevel(),[r]),o=Nt(),a=P.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return p.jsx(ot,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:i<lr.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:i<lr.MOBILE?null:p.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(s*100),"%"]})})}),r9=P.createContext(null);function Kpe({overrides:n={},children:e}){const t=zu(n),r=Fw();return p.jsx(r9.Provider,{value:P.useMemo(()=>({ContextMenu:che,ActionsMenu:Lde,HelpMenu:null,ZoomMenu:Hpe,MainMenu:$he,Minimap:Qhe,StylePanel:Wfe,PageMenu:nfe,NavigationPanel:efe,Toolbar:Bpe,KeyboardShortcutsDialog:Ahe,QuickActions:ife,HelperButtons:The,DebugPanel:She,DebugMenu:vhe,MenuPanel:Ihe,SharePanel:r?dfe:null,CursorChatBubble:r?dhe:null,TopPanel:r?Upe:null,...t}),[t,r]),children:e})}function Rl(){const n=P.useContext(r9);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}const qpe=ti(function({overrides:e,components:t,assetUrls:r,onUiEvent:i,forceMobile:s,mediaMimeTypes:o,children:a}){const c=Cl();return p.jsx(cU.Provider,{value:o,children:p.jsx(Rse,{assetUrls:ode(r),children:p.jsx(Ose,{overrides:lde(e),locale:(c==null?void 0:c.user.getLocale())??qs.locale,children:p.jsx(yte,{onEvent:i,children:p.jsx(_ae,{children:p.jsx(Aae,{context:c==null?void 0:c.contextId,children:p.jsx(Dae,{forceMobile:s,children:p.jsx(Kpe,{overrides:t,children:c?p.jsx(Gpe,{overrides:e,children:a}):a})})})})})})})})});function Gpe({overrides:n,children:e}){const t=ude(n);return p.jsx(jae,{overrides:t.actions,children:p.jsx(Xae,{overrides:t.tools,children:e})})}function Vpe(){const n=me(),{addToast:e}=Ea();P.useEffect(()=>{function t({name:r,count:i}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${i}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const Ype=Ce.memo(function({renderDebugMenuItems:e,children:t,hideUi:r,components:i,...s}){return p.jsx(qpe,{...s,components:i,children:p.jsx(Xpe,{hideUi:r,renderDebugMenuItems:e,children:t})})}),Xpe=Ce.memo(function({children:e,hideUi:t,...r}){return p.jsxs(p.Fragment,{children:[e,t?null:p.jsx(Zpe,{...r})]})}),Zpe=Ce.memo(function(){const e=me(),t=Nt(),r=$i(),i=Ls(),s=xe("focus",()=>e.getInstanceState().isFocusMode,[e]),o=xe("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:c,MenuPanel:u,StylePanel:d,Toolbar:f,HelpMenu:g,NavigationPanel:m,HelperButtons:v,DebugPanel:w,CursorChatBubble:S}=Rl();jpe(),Doe(),Vpe();const{"toggle-focus-mode":b}=Ku();return p.jsxs("div",{className:rt("tlui-layout",{"tlui-layout__mobile":r<lr.TABLET_SM}),"data-breakpoint":r,children:[s?p.jsx("div",{className:"tlui-layout__top",children:p.jsx(ot,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>b.onSelect("menu"),children:p.jsx(Ot,{icon:"dot"})})}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"tlui-layout__top",children:[p.jsxs("div",{className:"tlui-layout__top__left",children:[u&&p.jsx(u,{}),v&&p.jsx(v,{})]}),p.jsx("div",{className:"tlui-layout__top__center",children:c&&p.jsx(c,{})}),p.jsxs("div",{className:"tlui-layout__top__right",children:[a&&p.jsx(a,{}),d&&r>=lr.TABLET_SM&&!i&&p.jsx(d,{})]})]}),p.jsxs("div",{className:"tlui-layout__bottom",children:[p.jsxs("div",{className:"tlui-layout__bottom__main",children:[m&&p.jsx(m,{}),f&&p.jsx(f,{}),g&&p.jsx(g,{})]}),o&&w&&p.jsx(w,{})]})]}),p.jsx(Yae,{}),p.jsx(Kae,{}),p.jsx(rde,{}),S&&p.jsx(S,{})]})});async function Qpe(n,e){const{url:t,style:r="normal",weight:i="500",display:s,featureSettings:o,stretch:a,unicodeRange:c,variant:u,format:d}=e,f={style:r,weight:i,display:s,featureSettings:o,stretch:a,unicodeRange:c,variant:u},g=new FontFace(n,`url(${t})`,f);return await g.load(),document.fonts.add(g),g.$$_url=t,g.$$_fontface=`
@font-face {
	font-family: ${g.family};
	font-stretch: ${g.stretch};
	font-weight: ${g.weight};
	font-style: ${g.style};
	src: url("${t}") format("${d}")
}`,g}const Ym=(n,e)=>{const[t,r]=P.useState(2);return P.useEffect(()=>{let i=!1;return r(2),Qpe(n,e).then(()=>{i||r(0)}).catch(s=>{i||(console.error(s),r(1))}),()=>{i=!0}},[n,e]),t};function Jpe(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function i9(n){const e=P.useMemo(()=>Jpe(n),[n]),t=[Ym("tldraw_draw",e.draw),Ym("tldraw_serif",e.serif),Ym("tldraw_sans",e.sansSerif),Ym("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function ege(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:s,onMount:o,components:a={},shapeUtils:c=[],bindingUtils:u=[],tools:d=[],embeds:f,...g}=n,m=zu(a),v=P.useMemo(()=>({Scribble:Zj,ShapeIndicators:ace,CollaboratorScribble:Zj,SelectionForeground:ice,SelectionBackground:nce,Handles:Zae,...m}),[m]),w=rl(c),S=P.useMemo(()=>[...QU,...w],[w]),b=rl(u),x=P.useMemo(()=>[...wU,...b],[b]),E=rl(d),M=P.useMemo(()=>[...nde,...Kce,...E],[E]),j=rl(i??W0),D=rl(s??pC),H=P.useMemo(()=>[...j,...D],[j,D]),L=L$(g.assetUrls),{done:U,error:z}=i9(L);return z?p.jsx(xB,{children:"Could not load assets. Please refresh the page."}):U?p.jsx(tte,{initialState:"select",...g,components:v,shapeUtils:S,bindingUtils:x,tools:M,children:p.jsxs(Ype,{...g,components:v,mediaMimeTypes:H,children:[p.jsx(tge,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:j,acceptedVideoMimeTypes:D,onMount:o,embeds:f}),e]})}):p.jsx(x2,{children:p.jsx(n2,{})})}function tge({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=W0,acceptedVideoMimeTypes:r=pC,onMount:i,embeds:s}){const o=me(),a=Ea(),c=Nt();bB(()=>{const f=o.getShapeUtil("embed");f&&s&&f.setEmbedDefinitions(s);const g=[];return g.push(Cue(o)),Ice(o,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r},{toasts:a,msg:c}),g.push(o.store.props.onMount(o)),g.push(i==null?void 0:i(o)),()=>{g.forEach(m=>m==null?void 0:m())}});const{Canvas:u}=$n(),{ContextMenu:d}=Rl();return d?p.jsx(d,{}):u?p.jsx(u,{}):null}P.memo(function(e){const[t,r]=P.useState(null),[i,s]=P.useState(null),o=rl(e.shapeUtils??[]),a=P.useMemo(()=>[...QU,...o],[o]),c=rl(e.bindingUtils??[]),u=P.useMemo(()=>[...wU,...c],[c]),d=cte({snapshot:e.snapshot,shapeUtils:a}),f=L$(e.assetUrls),{done:g,error:m}=i9(f),{pageId:v,bounds:w,scale:S,pixelRatio:b,background:x,padding:E,darkMode:M,preserveAspectRatio:j,format:D="svg",licenseKey:H}=e;return P.useLayoutEffect(()=>{if(!i||!d||!g)return;let L=!1;const U=document.createElement("div");i.appendChild(U),i.classList.add("tl-container","tl-theme__light");const z=new Fe({store:d,shapeUtils:a,bindingUtils:u,tools:[],getContainer:()=>U,licenseKey:H});v&&z.setCurrentPage(v);const Y=z.getCurrentPageShapeIds();async function V(){const N=await z.getSvgString([...Y],{bounds:w,scale:S,background:x,padding:E,darkMode:M,preserveAspectRatio:j});if(N&&!L){if(D==="svg"){if(!L){const _=new Blob([N.svg],{type:"image/svg+xml"}),k=URL.createObjectURL(_);r(k)}}else if(D==="png"){const _=await Kz(z,N.svg,{type:D,width:N.width,height:N.height,pixelRatio:b});if(_&&!L){const k=URL.createObjectURL(_);r(k)}}}z.dispose()}return V(),()=>{L=!0}},[D,i,d,a,u,v,w,S,x,E,M,j,g,m,H,b]),m?p.jsx(xB,{children:"Could not load assets."}):g?p.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&p.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):p.jsx(x2,{children:p.jsx(n2,{})})});P.memo(function({children:e}){const t=Nt(),r=$i(),i=P.useRef(null);Ml(i);const s=e??p.jsx(Rhe,{});return r<lr.MOBILE?null:p.jsx("div",{ref:i,className:"tlui-help-menu",children:p.jsxs(ku,{id:"help menu",children:[p.jsx(Au,{children:p.jsx(ot,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:p.jsx(Ot,{icon:"question-mark",small:!0})})}),p.jsx(Ru,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:p.jsx(no,{type:"menu",sourceId:"help-menu",children:s})})]})})});const nge=Lt({schemaVersion:Mi(1),storeVersion:cy,recordVersions:s0(xt,Lt({version:cy,subTypeVersions:s0(xt,cy).optional(),subTypeKey:xt.optional()}))}),rge=Lt({schemaVersion:Mi(2),sequences:s0(xt,cy)});Lt({tldrawFileFormatVersion:BG,schema:FG("schemaVersion",{1:nge,2:rge}),records:Xr(Lt({id:xt,typeName:xt}).allowUnknownProperties())});xa("tldraw","3.5.1","esm");const ige=()=>p.jsxs(p.Fragment,{children:[p.jsx("img",{id:"limit-ipad",className:"z-[9999] min-w-[2200px] user-select-none pointer-events-none absolute top-[100px] left-[-2px]",src:"/assets/ipad.png",alt:"limit"}),p.jsx("div",{style:{position:"absolute",top:-1e4,left:-1e4,width:1e4,height:2e4,backgroundColor:"white",zIndex:9999,userSelect:"unset"}}),p.jsx("div",{style:{position:"absolute",top:-9998,left:0,width:2200,height:10100,backgroundColor:"white",zIndex:9999,userSelect:"unset"}}),p.jsx("div",{style:{position:"absolute",top:-1e4,left:2196,width:1e4,height:2e4,backgroundColor:"white",zIndex:9999,userSelect:"unset"}}),p.jsx("div",{style:{position:"absolute",top:1650,left:0,width:2200,height:9145,backgroundColor:"white",zIndex:9999,userSelect:"unset"}})]}),sge=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],oge={black:"black",grey:"grey","light-violet":"#e085f4",violet:"#a146c2",blue:"blue","light-blue":"#88b6ef",yellow:"#e7af5d",orange:"#d27032",green:"green","light-green":"#4cb05e","light-red":"#f87777",red:"red"};function age({onChange:n}){const[e,t]=P.useState("black"),[r,i]=P.useState(!1),s=a=>{t(a),n(a)},o=a=>oge[a];return p.jsxs("div",{className:"relative inline-block",children:[p.jsx("button",{onClick:()=>i(!r),className:"w-8 h-8 p-2 bg-transparent cursor-pointer hover:bg-gray-200 rounded-md","aria-label":"Choose color",children:p.jsx("div",{className:"rounded-full w-full h-full border border-gray-300 shadow-sm",style:{backgroundColor:o(e)}})}),r&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"fixed inset-0",onClick:()=>i(!1)}),p.jsx("div",{className:"absolute left-0 w-[145px] top-full mt-2 p-3 bg-white rounded-lg shadow-lg border border-gray-200 z-50",children:p.jsx("div",{className:"grid grid-cols-4 gap-3",children:sge.map(a=>p.jsx("button",{onClick:()=>{s(a),i(!1)},className:"w-6 h-6 cursor-pointer rounded-full border border-gray-300 transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",style:{backgroundColor:o(a)},"aria-label":`Select color ${a}`},a))})})]})]})}function cge({currentTool:n,onChange:e,timeLeft:t}){return p.jsxs("div",{className:"flex gap-1",children:[p.jsx("button",{disabled:t===0,onClick:()=>e("draw"),className:`${n==="draw"?"bg-[#bdd9ff]":"bg-transparent"} p-[6px] cursor-pointer hover:bg-gray-200 rounded-md w-8 h-8 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`,children:p.jsx("img",{className:"w-full h-full",src:"/assets/pen4.png",alt:"Hand"})}),p.jsx("button",{disabled:t===0,onClick:()=>e("hand"),className:`${n==="hand"?"bg-[#bdd9ff]":"bg-transparent"} p-[6px] cursor-pointer hover:bg-gray-200 rounded-md w-8 h-8 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`,children:p.jsx("img",{className:"w-full h-full",src:"/assets/grab8.png",alt:"Hand"})}),p.jsx("button",{disabled:t===0,onClick:()=>e("eraser"),className:`${n==="eraser"?"bg-[#bdd9ff]":"bg-transparent"} p-[6px] cursor-pointer hover:bg-gray-200 rounded-md w-8 h-8 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed`,children:p.jsx("img",{className:"w-full h-full",src:"/assets/eraser4.png",alt:"Hand"})})]})}function lge({timeLeft:n,setTimeLeft:e}){const t=Math.floor(n/60),r=n%60;return P.useEffect(()=>{const i=setInterval(()=>{n===0||n===null||e(n-1)},1e3);return()=>clearInterval(i)},[n,e]),P.useEffect(()=>{if(n===0){const i=setTimeout(()=>{const s=new URL(window.location.href);s.searchParams.set("isTwitterModalOpen","true"),window.location.href=s.toString()},5e3);return()=>clearTimeout(i)}},[n]),n===0?p.jsx("p",{className:"text-black text-base",children:"Transformation into a work of art..."}):p.jsxs("p",{className:"text-black text-base",children:["Next post in ",t.toString().padStart(2,"0"),":",r.toString().padStart(2,"0")]})}const uge=({timeLeft:n,hideUi:e,setTimeLeft:t})=>{const r=me();P.useEffect(()=>{n===0&&r.setCurrentTool("hand")},[n]),P.useEffect(()=>{r.setCurrentTool("draw"),e?r.setCamera({x:-199,y:-204,z:.5}):window.innerWidth>500?r.setCamera({x:300,y:0,z:.5}):r.setCamera({x:-100,y:600,z:.19})},[]);const i=xe("current tool id",()=>r==null?void 0:r.getCurrentToolId(),[r]),s=o=>{r.setCurrentTool(o)};return p.jsxs("div",{style:{left:"50%",transform:"translate(-50%, 0)"},className:`flex items-center gap-2 custom-shadow glass px-4 py-2 rounded-lg fixed top-4 z-[99999] ${e?"hidden":""}`,children:[p.jsx("img",{src:"assets/logo.png",alt:"logo",className:"w-10 h-10"}),p.jsxs("div",{children:[p.jsxs("div",{className:"w-full",children:[p.jsx("a",{style:{fontWeight:500},className:"text-base hover:bg-[#3182ed] hover:text-white px-2 py-1 rounded-md",target:"_blank",href:"https://t.me/DWAI_DraWifAi",children:"Telegram"}),p.jsx("a",{style:{fontWeight:500},className:"text-base hover:bg-[#3182ed] hover:text-white px-2 py-1 rounded-md",target:"_blank",href:"https://x.com/DraWifAi",children:"Twitter"}),p.jsx("a",{style:{fontWeight:500},className:"text-base hover:bg-[#3182ed] hover:text-white px-2 py-1 rounded-md",target:"_blank",href:"https://drawwifai.gitbook.io/drawifai",children:"Gitbook"})]}),p.jsx("div",{className:"w-full bg-gray-200 h-[1px] mt-1 mb-2"}),p.jsxs("div",{className:"w-full flex gap-1 items-center",children:[p.jsx(age,{onChange:o=>r.setStyleForNextShapes(hs,o)}),p.jsx(cge,{timeLeft:n,currentTool:i,onChange:s}),n!==null&&p.jsx(lge,{setTimeLeft:t,timeLeft:n})]})]})]})},dge=()=>{let n=localStorage.getItem("userId");return n||(n=Jt(),localStorage.setItem("userId",n)),n},$D=()=>{const n=new Date,e=n.getMinutes()*60+n.getSeconds();return 4*60-e%(4*60)},Kb=({isOpen:n,onClose:e,children:t,title:r})=>n?p.jsx("div",{className:`fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center transition-opacity ${n?"opacity-100":"opacity-0 pointer-events-none"}`,children:p.jsxs("div",{className:"bg-white p-4 w-80 rounded-lg flex flex-col gap-2",children:[p.jsxs("div",{className:"flex justify-between items-center",children:[p.jsx("p",{className:"text-sm font-bold text-black",children:r}),p.jsx("button",{onClick:e,className:"font-light text-xl text-black w-[16px] h-[16px] flex justify-center items-center bg-white cursor-pointer",children:"x"})]}),p.jsx("div",{className:"text-[15px]",children:t}),p.jsx("div",{className:"flex justify-end",children:p.jsx("button",{onClick:e,className:"cursor-pointer text-white bg-black text-[14px] px-2 py-1 rounded-md flex justify-center items-center",children:"OK"})})]})}):null,hge=1024*1024,fge=4,pge=hge/fge;function gge(n,e=pge){if(n.length<e)return[n];{const t=[];let r=0,i=n.length;for(;i>0;){const s=`${r}_`,o=Math.max(Math.min(e-s.length,i),1);t.unshift(s+n.slice(i-o,i)),i-=o,r++}return t}}const Ga={Put:"put",Patch:"patch",Remove:"remove"};function mge(n){let e=null;for(const[t,r]of Jr(n.added))e||(e={}),e[t]=[Ga.Put,r];for(const[t,r]of Vn(n.updated)){const i=s9(t,r);i&&(e||(e={}),e[r.id]=[Ga.Patch,i])}for(const t of Object.keys(n.removed))e||(e={}),e[t]=[Ga.Remove];return e}const bi={Put:"put",Delete:"delete",Append:"append",Patch:"patch"};function s9(n,e){return BP(n,e,new Set(["props"]))}function BP(n,e,t){if(n===e)return null;let r=null;for(const i of Object.keys(n)){if(!(i in e)){r||(r={}),r[i]=[bi.Delete];continue}const s=n[i],o=e[i];if(!gl(s,o))if(t!=null&&t.has(i)&&s&&o){const a=BP(s,o);a&&(r||(r={}),r[i]=[bi.Patch,a])}else if(Array.isArray(o)&&Array.isArray(s)){const a=o9(s,o);a&&(r||(r={}),r[i]=a)}else r||(r={}),r[i]=[bi.Put,o]}for(const i of Object.keys(e))i in n||(r||(r={}),r[i]=[bi.Put,e[i]]);return r}function yge(n,e){if(Object.is(n,e))return null;if(Array.isArray(n)&&Array.isArray(e))return o9(n,e);if(!n||!e||typeof n!="object"||typeof e!="object")return gl(n,e)?null:[bi.Put,e];{const t=BP(n,e);return t?[bi.Patch,t]:null}}function o9(n,e){if(Object.is(n,e))return null;if(n.length===e.length){const t=Math.max(n.length/5,1),r=[];for(let s=0;s<n.length;s++)if(!gl(n[s],e[s])&&(r.push(s),r.length>t))return[bi.Put,e];if(r.length===0)return null;const i={};for(const s of r){const o=n[s],a=e[s];if(!o||!a)i[s]=[bi.Put,a];else if(typeof o=="object"&&typeof a=="object"){const c=yge(o,a);c&&(i[s]=c)}else i[s]=[bi.Put,a]}return[bi.Patch,i]}for(let t=0;t<n.length;t++)if(!gl(n[t],e[t]))return[bi.Put,e];return[bi.Append,e.slice(n.length),n.length]}function a9(n,e){if(!n||typeof n!="object")return n;const t=Array.isArray(n);let r;const i=(s,o)=>{r||(t?r=[...n]:r={...n}),t?r[Number(s)]=o:r[s]=o};for(const[s,o]of Object.entries(e))switch(o[0]){case bi.Put:{const a=o[1];gl(n[s],a)||i(s,a);break}case bi.Append:{const a=o[1],c=o[2],u=n[s];Array.isArray(u)&&u.length===c&&i(s,[...u,...a]);break}case bi.Patch:{if(n[s]&&typeof n[s]=="object"){const a=o[1],c=a9(n[s],a);c!==n[s]&&i(s,c)}break}case bi.Delete:s in n&&(r||(t?(console.error("Can't delete array item yet (this should never happen)"),r=[...n]):r={...n}),delete r[s])}return r??n}function HD(n,e){const t=setInterval(n,e);return()=>clearInterval(t)}const wge=7;function vge(){return wge}const Sge=4099,Xf={NOT_FOUND:"NOT_FOUND",FORBIDDEN:"FORBIDDEN",NOT_AUTHENTICATED:"NOT_AUTHENTICATED",UNKNOWN_ERROR:"UNKNOWN_ERROR",CLIENT_TOO_OLD:"CLIENT_TOO_OLD",SERVER_TOO_OLD:"SERVER_TOO_OLD",INVALID_RECORD:"INVALID_RECORD",RATE_LIMITED:"RATE_LIMITED"},LE=5e3,xge=LE*2;class bge{constructor(e){G(this,"lastServerClock",0);G(this,"lastServerInteractionTimestamp",Date.now());G(this,"pendingPushRequests",[]);G(this,"speculativeChanges",{added:{},updated:{},removed:{}});G(this,"disposables",[]);G(this,"store");G(this,"socket");G(this,"presenceState");G(this,"isConnectedToRoom",!1);G(this,"clientClock",0);G(this,"onAfterConnect");G(this,"isDebugging",!1);G(this,"presenceType");G(this,"didCancel");G(this,"latestConnectRequestId",null);G(this,"incomingDiffBuffer",[]);G(this,"lastPushedPresenceState",null);G(this,"flushPendingPushRequests",$k(()=>{if(this.debug("flushing pending push requests",{isConnectedToRoom:this.isConnectedToRoom,pendingPushRequests:this.pendingPushRequests}),!(!this.isConnectedToRoom||this.store.isPossiblyCorrupted())){for(const e of this.pendingPushRequests)if(!e.sent){if(this.socket.connectionStatus!=="online")return;this.socket.sendMessage(e.request),e.sent=!0}}}));G(this,"rebase",()=>{var t;if(this.store._flushHistory(),this.incomingDiffBuffer.length===0)return;const e=this.incomingDiffBuffer;this.incomingDiffBuffer=[];try{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(gp(this.speculativeChanges),{runCallbacks:!1});for(const r of e){if(r.type==="patch"){this.applyNetworkDiff(r.diff,!0);continue}if(this.pendingPushRequests.length===0)throw new Error("Received push_result but there are no pending push requests");if(this.pendingPushRequests[0].request.clientClock!==r.clientClock)throw new Error("Received push_result for a push request that is not at the front of the queue");if(r.action==="discard")this.pendingPushRequests.shift();else if(r.action==="commit"){const{request:i}=this.pendingPushRequests.shift();"diff"in i&&i.diff&&this.applyNetworkDiff(i.diff,!0)}else this.applyNetworkDiff(r.action.rebaseWithDiff,!0),this.pendingPushRequests.shift()}try{this.speculativeChanges=this.store.extractingChanges(()=>{for(const{request:r}of this.pendingPushRequests)!("diff"in r)||!r.diff||this.applyNetworkDiff(r.diff,!0)})}catch(r){console.error(r),this.speculativeChanges={added:{},updated:{},removed:{}},this.resetConnection()}}),this.lastServerClock=((t=e.at(-1))==null?void 0:t.serverClock)??this.lastServerClock}catch(r){console.error(r),this.store.ensureStoreIsUsable(),this.resetConnection()}});G(this,"scheduleRebase",$k(this.rebase));this.didCancel=e.didCancel,this.presenceType=e.store.scopedTypes.presence.values().next().value??null,typeof window<"u"&&(window.tlsync=this),this.store=e.store,this.socket=e.socket,this.onAfterConnect=e.onAfterConnect;let t=!1;this.presenceState=e.presence,this.disposables.push(this.store.listen(({changes:r})=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("received store changes",{changes:r}),this.push(r)},{source:"user",scope:"document"}),this.socket.onReceiveMessage(r=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("received message from server",r),this.handleServerEvent(r),t||(t=!0,e.onLoad(this))}),this.socket.onStatusChange(r=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();this.debug("socket status changed",r.status),r.status==="online"?this.sendConnectMessage():(this.resetConnection(),r.status==="error"&&(t=!0,e.onSyncError(r.reason),this.close()))}),HD(()=>{var r;if((r=this.didCancel)!=null&&r.call(this))return this.close();if(this.debug("ping loop",{isConnectedToRoom:this.isConnectedToRoom}),!!this.isConnectedToRoom)try{this.socket.sendMessage({type:"ping"})}catch(i){console.warn("ping failed, resetting",i),this.resetConnection()}},LE),HD(()=>{var i;if((i=this.didCancel)!=null&&i.call(this))return this.close();if(this.debug("health check loop",{isConnectedToRoom:this.isConnectedToRoom}),!this.isConnectedToRoom)return;const r=Date.now()-this.lastServerInteractionTimestamp;if(r<xge){this.debug("health check passed",{timeSinceLastServerInteraction:r});return}console.warn("Haven't heard from the server in a while, resetting connection..."),this.resetConnection()},LE*2)),this.presenceState&&this.disposables.push(To("pushPresence",()=>{var r;if((r=this.didCancel)!=null&&r.call(this))return this.close();this.pushPresence(this.presenceState.get())})),this.socket.connectionStatus==="online"&&this.sendConnectMessage()}debug(...e){this.isDebugging&&console.debug(...e)}sendConnectMessage(){if(this.isConnectedToRoom){console.error("sendConnectMessage called while already connected");return}this.debug("sending connect message"),this.latestConnectRequestId=Jt(),this.socket.sendMessage({type:"connect",connectRequestId:this.latestConnectRequestId,schema:this.store.schema.serialize(),protocolVersion:vge(),lastServerClock:this.lastServerClock})}resetConnection(e=!1){this.debug("resetting connection"),e&&(this.lastServerClock=0),this.store.mergeRemoteChanges(()=>{this.store.remove(Object.keys(this.store.serialize("presence")))}),this.lastPushedPresenceState=null,this.isConnectedToRoom=!1,this.pendingPushRequests=[],this.incomingDiffBuffer=[],this.socket.connectionStatus==="online"&&this.socket.restart()}didReconnect(e){if(this.debug("did reconnect",e),e.connectRequestId===this.latestConnectRequestId){if(this.latestConnectRequestId=null,this.isConnectedToRoom){console.error("didReconnect called while already connected"),this.resetConnection(!0);return}if(this.pendingPushRequests.length>0){console.error("pendingPushRequests should already be empty when we reconnect"),this.resetConnection(!0);return}Js(()=>{var r;const t=this.speculativeChanges;this.speculativeChanges={added:{},updated:{},removed:{}},this.store.mergeRemoteChanges(()=>{const i={},s=e.hydrationType==="wipe_all";s||this.store.applyDiff(gp(t),{runCallbacks:!1});for(const[a,c]of Jr(this.store.serialize("all")))(s&&this.store.scopedTypes.document.has(c.typeName)||c.typeName===this.presenceType)&&(i[a]=[Ga.Remove]);this.applyNetworkDiff({...i,...e.diff},!0),this.isConnectedToRoom=!0;const o=this.store.filterChangesByScope(this.store.extractingChanges(()=>{this.store.applyDiff(t)}),"document");o&&this.push(o)}),(r=this.onAfterConnect)==null||r.call(this,this,{isReadonly:e.isReadonly})}),this.lastServerClock=e.serverClock}}handleServerEvent(e){switch(this.debug("received server event",e),this.lastServerInteractionTimestamp=Date.now(),e.type){case"connect":this.didReconnect(e);break;case"patch":case"push_result":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(e),this.scheduleRebase();break;case"data":if(!this.isConnectedToRoom)break;this.incomingDiffBuffer.push(...e.data),this.scheduleRebase();break;case"incompatibility_error":console.error("incompatibility error is legacy and should no longer be sent by the server");break;case"pong":break;default:Pr(e)}}close(){var e,t,r,i;this.debug("closing"),this.disposables.forEach(s=>s()),(t=(e=this.flushPendingPushRequests).cancel)==null||t.call(e),(i=(r=this.scheduleRebase).cancel)==null||i.call(r)}pushPresence(e){if(this.store._flushHistory(),!this.isConnectedToRoom)return;let t;if(!this.lastPushedPresenceState&&e)t=[Ga.Put,e];else if(this.lastPushedPresenceState&&e){const s=s9(this.lastPushedPresenceState,e);s&&(t=[Ga.Patch,s])}if(!t)return;this.lastPushedPresenceState=e;const r=this.pendingPushRequests.at(-1);if(r&&!r.sent&&!r.request.presence){r.request.presence=t;return}const i={type:"push",clientClock:this.clientClock++,presence:t};i&&(this.pendingPushRequests.push({request:i,sent:!1}),this.flushPendingPushRequests())}push(e){this.debug("push",e);const t=mge(e);if(!t||(this.speculativeChanges=Q0([this.speculativeChanges,e]),!this.isConnectedToRoom))return;const r={type:"push",diff:t,clientClock:this.clientClock++};this.pendingPushRequests.push({request:r,sent:!1}),this.flushPendingPushRequests()}applyNetworkDiff(e,t){this.debug("applyNetworkDiff",e);const r={added:{},updated:{},removed:{}};let i=!1;for(const[s,o]of Jr(e))if(o[0]===Ga.Put){const a=this.store.get(s);a&&!gl(a,o[1])?(i=!0,r.updated[s]=[a,o[1]]):(i=!0,r.added[s]=o[1])}else if(o[0]===Ga.Patch){const a=this.store.get(s);if(!a)continue;const c=a9(a,o[1]);i=!0,r.updated[s]=[a,c]}else o[0]===Ga.Remove&&this.store.has(s)&&(i=!0,r.removed[s]=this.store.get(s));i&&this.store.applyDiff(r,{runCallbacks:t})}}function Xm(n,e,t){return n.addEventListener(e,t),()=>{n.removeEventListener(e,t)}}function zn(...n){if(typeof window<"u"&&window.__tldraw_socket_debug){const e=new Date;console.log(`${e.getHours()}:${e.getMinutes()}:${e.getSeconds()}.${e.getMilliseconds()}`,...n)}}class _ge{constructor(e){G(this,"_ws",null);G(this,"isDisposed",!1);G(this,"_reconnectManager");G(this,"_connectionStatus",cr("websocket connection status","initial"));G(this,"messageListeners",new Set);G(this,"statusListeners",new Set);this._reconnectManager=new Mge(this,e)}close(){var e;this.isDisposed=!0,this._reconnectManager.close(),(e=this._ws)==null||e.close()}_handleConnect(){zn("handleConnect"),this._connectionStatus.set("online"),this.statusListeners.forEach(e=>e({status:"online"})),this._reconnectManager.connected()}_handleDisconnect(e,t,r,i){i=i||Xf.UNKNOWN_ERROR,zn("handleDisconnect",{currentStatus:this.connectionStatus,closeCode:t,reason:e});let s;switch(e){case"closed":t===Sge?s="error":s="offline";break;case"manual":s="offline";break}t===1006&&!r&&JK("Could not open WebSocket connection. This might be because you're trying to load a URL that doesn't support websockets. Check the URL you're trying to connect to."),this.connectionStatus!==s&&!(s==="error"&&this.connectionStatus==="offline")&&(this._connectionStatus.set(s),this.statusListeners.forEach(o=>o(s==="error"?{status:"error",reason:i}:{status:s}))),this._reconnectManager.disconnected()}_setNewSocket(e){var r;bt(!this.isDisposed,"Tried to set a new websocket on a disposed socket"),bt(this._ws===null||this._ws.readyState===WebSocket.CLOSED||this._ws.readyState===WebSocket.CLOSING,`Tried to set a new websocket in when the existing one was ${(r=this._ws)==null?void 0:r.readyState}`);let t=!1;e.onopen=()=>{zn("ws.onopen"),bt(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't open"),t=!0,this._handleConnect()},e.onclose=i=>{zn("ws.onclose",i),this._ws===e?this._handleDisconnect("closed",i.code,t,i.reason):zn("ignoring onclose for an orphaned socket")},e.onerror=i=>{zn("ws.onerror",i),this._ws===e?this._handleDisconnect("closed"):zn("ignoring onerror for an orphaned socket")},e.onmessage=i=>{bt(this._ws===e,"sockets must only be orphaned when they are CLOSING or CLOSED, so they can't receive messages");const s=JSON.parse(i.data.toString());this.messageListeners.forEach(o=>o(s))},this._ws=e}_closeSocket(){this._ws!==null&&(this._ws.close(),this._ws=null,this._handleDisconnect("manual"))}get connectionStatus(){const e=this._connectionStatus.get();return e==="initial"?"offline":e}sendMessage(e){if(bt(!this.isDisposed,"Tried to send message on a disposed socket"),!!this._ws)if(this.connectionStatus==="online"){const t=gge(JSON.stringify(e));for(const r of t)this._ws.send(r)}else console.warn("Tried to send message while "+this.connectionStatus)}onReceiveMessage(e){return bt(!this.isDisposed,"Tried to add message listener on a disposed socket"),this.messageListeners.add(e),()=>{this.messageListeners.delete(e)}}onStatusChange(e){return bt(!this.isDisposed,"Tried to add status listener on a disposed socket"),this.statusListeners.add(e),()=>{this.statusListeners.delete(e)}}restart(){bt(!this.isDisposed,"Tried to restart a disposed socket"),zn("restarting"),this._closeSocket(),this._reconnectManager.maybeReconnected()}}const Df=500,Ige=2e3,Ege=1e3,Cge=1e3*60*5,Pge=1.5,WD=1e3;class Mge{constructor(e,t){G(this,"isDisposed",!1);G(this,"disposables",[()=>{this.reconnectTimeout&&clearTimeout(this.reconnectTimeout),this.recheckConnectingTimeout&&clearTimeout(this.recheckConnectingTimeout)}]);G(this,"reconnectTimeout",null);G(this,"recheckConnectingTimeout",null);G(this,"lastAttemptStart",null);G(this,"intendedDelay",Df);G(this,"state");this.socketAdapter=e,this.getUri=t,this.subscribeToReconnectHints(),this.disposables.push(Xm(window,"offline",()=>{zn("window went offline"),this.socketAdapter._closeSocket()})),this.state="pendingAttempt",this.intendedDelay=Df,this.scheduleAttempt()}subscribeToReconnectHints(){if(this.disposables.push(Xm(window,"online",()=>{zn("window went online"),this.maybeReconnected()}),Xm(document,"visibilitychange",()=>{document.hidden||(zn("document became visible"),this.maybeReconnected())})),Object.prototype.hasOwnProperty.call(navigator,"connection")){const e=navigator.connection;this.disposables.push(Xm(e,"change",()=>{zn("navigator.connection change"),this.maybeReconnected()}))}}scheduleAttempt(){bt(this.state==="pendingAttempt"),zn("scheduling a connection attempt"),Promise.resolve(this.getUri()).then(e=>{var t;this.state!=="pendingAttempt"||this.isDisposed||(bt(((t=this.socketAdapter._ws)==null?void 0:t.readyState)!==WebSocket.OPEN,"There should be no connection attempts while already connected"),this.lastAttemptStart=Date.now(),this.socketAdapter._setNewSocket(new WebSocket(Tge(e))),this.state="pendingAttemptResult")})}getMaxDelay(){return document.hidden?Cge:Ige}getMinDelay(){return document.hidden?Ege:Df}clearReconnectTimeout(){this.reconnectTimeout&&(clearTimeout(this.reconnectTimeout),this.reconnectTimeout=null)}clearRecheckConnectingTimeout(){this.recheckConnectingTimeout&&(clearTimeout(this.recheckConnectingTimeout),this.recheckConnectingTimeout=null)}maybeReconnected(){var e,t;if(zn("ReconnectManager.maybeReconnected"),this.clearRecheckConnectingTimeout(),((e=this.socketAdapter._ws)==null?void 0:e.readyState)===WebSocket.OPEN){zn("ReconnectManager.maybeReconnected: already connected");return}if(((t=this.socketAdapter._ws)==null?void 0:t.readyState)===WebSocket.CONNECTING){zn("ReconnectManager.maybeReconnected: connecting"),bt(this.lastAttemptStart,"ReadyState=CONNECTING without lastAttemptStart should be impossible");const r=Date.now()-this.lastAttemptStart;r<WD?(zn("ReconnectManager.maybeReconnected: connecting, rechecking later"),this.recheckConnectingTimeout=setTimeout(()=>this.maybeReconnected(),WD-r)):(zn("ReconnectManager.maybeReconnected: connecting, but for too long, retry now"),this.clearRecheckConnectingTimeout(),this.socketAdapter._closeSocket());return}zn("ReconnectManager.maybeReconnected: closing/closed/null, retry now"),this.intendedDelay=Df,this.disconnected()}disconnected(){var e,t;if(zn("ReconnectManager.disconnected"),((e=this.socketAdapter._ws)==null?void 0:e.readyState)!==WebSocket.OPEN&&((t=this.socketAdapter._ws)==null?void 0:t.readyState)!==WebSocket.CONNECTING){zn("ReconnectManager.disconnected: websocket is not OPEN or CONNECTING"),this.clearReconnectTimeout();let r;this.state==="connected"?(this.intendedDelay=this.getMinDelay(),r=this.intendedDelay):r=this.lastAttemptStart!==null?this.lastAttemptStart+this.intendedDelay-Date.now():0,r>0?(zn("ReconnectManager.disconnected: delaying, delayLeft",r),this.state="delay",this.reconnectTimeout=setTimeout(()=>this.disconnected(),r)):(this.state="pendingAttempt",this.intendedDelay=Math.min(this.getMaxDelay(),Math.max(this.getMinDelay(),this.intendedDelay)*Pge),zn("ReconnectManager.disconnected: attempting a connection, next delay",this.intendedDelay),this.scheduleAttempt())}}connected(){var e;zn("ReconnectManager.connected"),((e=this.socketAdapter._ws)==null?void 0:e.readyState)===WebSocket.OPEN&&(zn("ReconnectManager.connected: websocket is OPEN"),this.state="connected",this.clearReconnectTimeout(),this.intendedDelay=Df)}close(){this.disposables.forEach(e=>e()),this.isDisposed=!0}}function Tge(n){return n.replace(/^http(s)?:/,"ws$1:")}class kge extends Error{constructor(t){super(`sync error: ${t}`);G(this,"name","RemoteSyncError");this.reason=t}}xa("@tldraw/sync-core","3.5.1","esm");const jd="multiplayer.client";function Age(n){const[e,t]=S2(null),{uri:r,roomId:i="default",assets:s,onMount:o,trackAnalyticsEvent:a,userInfo:c,...u}=n,d=lte(u),f=zu(c),g=LC("userAtom",f);return P.useEffect(()=>{g.set(f)},[f,g]),P.useEffect(()=>{const m=Jt(),v=Ie("userPreferences",()=>{const j=g.get(),D=(mG(j)?j.get():j)??i2();return{id:D.id,color:D.color??qs.color,name:D.name??qs.name}}),w=new _ge(async()=>{const j=typeof r=="string"?r:await r(),D=new URL(j);if(D.searchParams.has("sessionId"))throw new Error('useSync. "sessionId" is a reserved query param name. Please use a different name');if(D.searchParams.has("storeId"))throw new Error('useSync. "storeId" is a reserved query param name. Please use a different name');return D.searchParams.set("sessionId",Sp),D.searchParams.set("storeId",m),D.toString()});let S=!1;const b=Ie("collaboration status",()=>w.connectionStatus==="error"?"offline":w.connectionStatus),x=cr("sync mode","readwrite"),E=xp({id:m,schema:d,assets:s,onMount:o,collaboration:{status:b,mode:x}}),M=new bge({store:E,socket:w,didCancel:()=>S,onLoad(j){a==null||a(jd,{name:"load",roomId:i}),t({readyClient:j})},onSyncError(j){switch(console.error("sync error",j),j){case Xf.NOT_FOUND:a==null||a(jd,{name:"room-not-found",roomId:i});break;case Xf.FORBIDDEN:a==null||a(jd,{name:"forbidden",roomId:i});break;case Xf.NOT_AUTHENTICATED:a==null||a(jd,{name:"not-authenticated",roomId:i});break;case Xf.RATE_LIMITED:a==null||a(jd,{name:"rate-limited",roomId:i});break;default:a==null||a(jd,{name:"sync-error:"+j,roomId:i});break}t({error:new kge(j)}),w.close()},onAfterConnect(j,{isReadonly:D}){Js(()=>{x.set(D?"readonly":"readwrite"),E.ensureStoreIsUsable()})},presence:wV(v)(E)});return()=>{S=!0,M.close(),w.close(),t(null)}},[s,o,g,i,d,t,a,r]),xe("remote synced store",()=>{if(!e)return{status:"loading"};if(e.error)return{status:"error",error:e.error};if(!e.readyClient)return{status:"loading"};const m=e.readyClient.socket.connectionStatus;return{status:"synced-remote",connectionStatus:m==="error"?"offline":m,store:e.readyClient.store}},[e])}var Rge={};function c9(n){try{return n()}catch{return}}c9(()=>"https://demo.tldraw.xyz");c9(()=>Rge.TLDRAW_IMAGE_URL);xa("@tldraw/sync","3.5.1","esm");function jge({userId:n}){const e=me();return e.getInitialMetaForShape=()=>({createdBy:n}),e.sideEffects.registerBeforeDeleteHandler("shape",(t,r)=>{if(r==="remote")return;const i=t.meta;if((i==null?void 0:i.createdBy)!==n)return!1}),e.sideEffects.registerBeforeChangeHandler("shape",(t,r,i)=>{if(i==="remote")return r;const s=r.meta;return(s==null?void 0:s.createdBy)!==n?t:r}),null}const l9="https://drawifai.com",Dge="war-canvas",Oge={OnTheCanvas:ige};function Lge(){const[n,e]=P.useState(!1),[t,r]=P.useState(localStorage.getItem("isFirstTime")!=="false"),[i,s]=P.useState($D()),[o,a]=P.useState(!1),c=new URLSearchParams(window.location.search).get("hideUi")==="true",u=new URLSearchParams(window.location.search).get("isTwitterModalOpen")==="true",d=dge();P.useEffect(()=>{u&&a(!0)},[u]),P.useEffect(()=>{const g=()=>{document.visibilityState==="visible"&&s($D())};return document.addEventListener("visibilitychange",g),()=>{document.removeEventListener("visibilitychange",g)}},[]),c&&document.querySelectorAll(".tl-cursor").forEach(m=>{m.classList.add("hidden")});const f=Age({uri:`${l9}/connect/${Dge}`,assets:Nge});return Ro.setDefaultValue("s"),p.jsxs(p.Fragment,{children:[p.jsx("div",{style:{position:"fixed",inset:0},children:p.jsxs(ege,{store:f,components:Oge,hideUi:!0,children:[p.jsx(uge,{setTimeLeft:s,hideUi:c,timeLeft:i}),p.jsx(jge,{userId:d})]})}),p.jsx(Kb,{isOpen:n,onClose:()=>e(!1),title:"Ink Level",children:p.jsx("p",{children:"Your ink level is at 0. Wait until the next session for it to reset itself."})}),p.jsx(Kb,{isOpen:c?!1:t,onClose:()=>{localStorage.setItem("isFirstTime","false"),r(!1)},title:"Welcome",children:p.jsxs("p",{children:["Welcome to DraWifAi! You can start drawing by clicking on the canvas. The painting is transformed into a work of art and added to Twitter every 3 minutes. Each token transaction lowers the timer by 10s ",p.jsx("br",{}),p.jsx("br",{}),window.innerWidth<=500?"You can zoom in and out and move around the board with 2 fingers.":"You can move around on the whiteboard."]})}),p.jsx(Kb,{isOpen:o,onClose:()=>a(!1),title:"Welcome",children:p.jsxs("p",{children:["Go on Twitter to see your work of art! The artwork will be posted in a few minutes. ",p.jsx("br",{})," ",p.jsx("br",{}),p.jsx("a",{href:"https://x.com/DraWifAi",className:"text-[#3182ed]",target:"_blank",children:"https://x.com/DraWifAi"})]})})]})}const Nge={async upload(n,e){const r=`${Jt()}-${e.name}`,i=`${l9}/uploads/${encodeURIComponent(r)}`,s=await fetch(i,{method:"PUT",body:e});if(!s.ok)throw new Error(`Failed to upload asset: ${s.statusText}`);return i},resolve(n){return n.props.src}};var qb={},Of={},KD;function Bge(){if(KD)return Of;KD=1,Of.byteLength=a,Of.toByteArray=u,Of.fromByteArray=g;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=r.length;i<s;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function o(m){var v=m.length;if(v%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=m.indexOf("=");w===-1&&(w=v);var S=w===v?0:4-w%4;return[w,S]}function a(m){var v=o(m),w=v[0],S=v[1];return(w+S)*3/4-S}function c(m,v,w){return(v+w)*3/4-w}function u(m){var v,w=o(m),S=w[0],b=w[1],x=new t(c(m,S,b)),E=0,M=b>0?S-4:S,j;for(j=0;j<M;j+=4)v=e[m.charCodeAt(j)]<<18|e[m.charCodeAt(j+1)]<<12|e[m.charCodeAt(j+2)]<<6|e[m.charCodeAt(j+3)],x[E++]=v>>16&255,x[E++]=v>>8&255,x[E++]=v&255;return b===2&&(v=e[m.charCodeAt(j)]<<2|e[m.charCodeAt(j+1)]>>4,x[E++]=v&255),b===1&&(v=e[m.charCodeAt(j)]<<10|e[m.charCodeAt(j+1)]<<4|e[m.charCodeAt(j+2)]>>2,x[E++]=v>>8&255,x[E++]=v&255),x}function d(m){return n[m>>18&63]+n[m>>12&63]+n[m>>6&63]+n[m&63]}function f(m,v,w){for(var S,b=[],x=v;x<w;x+=3)S=(m[x]<<16&16711680)+(m[x+1]<<8&65280)+(m[x+2]&255),b.push(d(S));return b.join("")}function g(m){for(var v,w=m.length,S=w%3,b=[],x=16383,E=0,M=w-S;E<M;E+=x)b.push(f(m,E,E+x>M?M:E+x));return S===1?(v=m[w-1],b.push(n[v>>2]+n[v<<4&63]+"==")):S===2&&(v=(m[w-2]<<8)+m[w-1],b.push(n[v>>10]+n[v>>4&63]+n[v<<2&63]+"=")),b.join("")}return Of}var Zm={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var qD;function Fge(){return qD||(qD=1,Zm.read=function(n,e,t,r,i){var s,o,a=i*8-r-1,c=(1<<a)-1,u=c>>1,d=-7,f=t?i-1:0,g=t?-1:1,m=n[e+f];for(f+=g,s=m&(1<<-d)-1,m>>=-d,d+=a;d>0;s=s*256+n[e+f],f+=g,d-=8);for(o=s&(1<<-d)-1,s>>=-d,d+=r;d>0;o=o*256+n[e+f],f+=g,d-=8);if(s===0)s=1-u;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-u}return(m?-1:1)*o*Math.pow(2,s-r)},Zm.write=function(n,e,t,r,i,s){var o,a,c,u=s*8-i-1,d=(1<<u)-1,f=d>>1,g=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=r?0:s-1,v=r?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=d):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=g/c:e+=g*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=d?(a=0,o=d):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;n[t+m]=a&255,m+=v,a/=256,i-=8);for(o=o<<i|a,u+=i;u>0;n[t+m]=o&255,m+=v,o/=256,u-=8);n[t+m-v]|=w*128}),Zm}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var GD;function FP(){return GD||(GD=1,function(n){const e=Bge(),t=Fge(),r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=a,n.SlowBuffer=x,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const te=new Uint8Array(1),F={foo:function(){return 42}};return Object.setPrototypeOf(F,Uint8Array.prototype),Object.setPrototypeOf(te,F),te.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(te){if(te>i)throw new RangeError('The value "'+te+'" is invalid for option "size"');const F=new Uint8Array(te);return Object.setPrototypeOf(F,a.prototype),F}function a(te,F,K){if(typeof te=="number"){if(typeof F=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(te)}return c(te,F,K)}a.poolSize=8192;function c(te,F,K){if(typeof te=="string")return g(te,F);if(ArrayBuffer.isView(te))return v(te);if(te==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof te);if(On(te,ArrayBuffer)||te&&On(te.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(On(te,SharedArrayBuffer)||te&&On(te.buffer,SharedArrayBuffer)))return w(te,F,K);if(typeof te=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const Q=te.valueOf&&te.valueOf();if(Q!=null&&Q!==te)return a.from(Q,F,K);const re=S(te);if(re)return re;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof te[Symbol.toPrimitive]=="function")return a.from(te[Symbol.toPrimitive]("string"),F,K);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof te)}a.from=function(te,F,K){return c(te,F,K)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function u(te){if(typeof te!="number")throw new TypeError('"size" argument must be of type number');if(te<0)throw new RangeError('The value "'+te+'" is invalid for option "size"')}function d(te,F,K){return u(te),te<=0?o(te):F!==void 0?typeof K=="string"?o(te).fill(F,K):o(te).fill(F):o(te)}a.alloc=function(te,F,K){return d(te,F,K)};function f(te){return u(te),o(te<0?0:b(te)|0)}a.allocUnsafe=function(te){return f(te)},a.allocUnsafeSlow=function(te){return f(te)};function g(te,F){if((typeof F!="string"||F==="")&&(F="utf8"),!a.isEncoding(F))throw new TypeError("Unknown encoding: "+F);const K=E(te,F)|0;let Q=o(K);const re=Q.write(te,F);return re!==K&&(Q=Q.slice(0,re)),Q}function m(te){const F=te.length<0?0:b(te.length)|0,K=o(F);for(let Q=0;Q<F;Q+=1)K[Q]=te[Q]&255;return K}function v(te){if(On(te,Uint8Array)){const F=new Uint8Array(te);return w(F.buffer,F.byteOffset,F.byteLength)}return m(te)}function w(te,F,K){if(F<0||te.byteLength<F)throw new RangeError('"offset" is outside of buffer bounds');if(te.byteLength<F+(K||0))throw new RangeError('"length" is outside of buffer bounds');let Q;return F===void 0&&K===void 0?Q=new Uint8Array(te):K===void 0?Q=new Uint8Array(te,F):Q=new Uint8Array(te,F,K),Object.setPrototypeOf(Q,a.prototype),Q}function S(te){if(a.isBuffer(te)){const F=b(te.length)|0,K=o(F);return K.length===0||te.copy(K,0,0,F),K}if(te.length!==void 0)return typeof te.length!="number"||qt(te.length)?o(0):m(te);if(te.type==="Buffer"&&Array.isArray(te.data))return m(te.data)}function b(te){if(te>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return te|0}function x(te){return+te!=te&&(te=0),a.alloc(+te)}a.isBuffer=function(F){return F!=null&&F._isBuffer===!0&&F!==a.prototype},a.compare=function(F,K){if(On(F,Uint8Array)&&(F=a.from(F,F.offset,F.byteLength)),On(K,Uint8Array)&&(K=a.from(K,K.offset,K.byteLength)),!a.isBuffer(F)||!a.isBuffer(K))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(F===K)return 0;let Q=F.length,re=K.length;for(let ce=0,ye=Math.min(Q,re);ce<ye;++ce)if(F[ce]!==K[ce]){Q=F[ce],re=K[ce];break}return Q<re?-1:re<Q?1:0},a.isEncoding=function(F){switch(String(F).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(F,K){if(!Array.isArray(F))throw new TypeError('"list" argument must be an Array of Buffers');if(F.length===0)return a.alloc(0);let Q;if(K===void 0)for(K=0,Q=0;Q<F.length;++Q)K+=F[Q].length;const re=a.allocUnsafe(K);let ce=0;for(Q=0;Q<F.length;++Q){let ye=F[Q];if(On(ye,Uint8Array))ce+ye.length>re.length?(a.isBuffer(ye)||(ye=a.from(ye)),ye.copy(re,ce)):Uint8Array.prototype.set.call(re,ye,ce);else if(a.isBuffer(ye))ye.copy(re,ce);else throw new TypeError('"list" argument must be an Array of Buffers');ce+=ye.length}return re};function E(te,F){if(a.isBuffer(te))return te.length;if(ArrayBuffer.isView(te)||On(te,ArrayBuffer))return te.byteLength;if(typeof te!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof te);const K=te.length,Q=arguments.length>2&&arguments[2]===!0;if(!Q&&K===0)return 0;let re=!1;for(;;)switch(F){case"ascii":case"latin1":case"binary":return K;case"utf8":case"utf-8":return _t(te).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return K*2;case"hex":return K>>>1;case"base64":return At(te).length;default:if(re)return Q?-1:_t(te).length;F=(""+F).toLowerCase(),re=!0}}a.byteLength=E;function M(te,F,K){let Q=!1;if((F===void 0||F<0)&&(F=0),F>this.length||((K===void 0||K>this.length)&&(K=this.length),K<=0)||(K>>>=0,F>>>=0,K<=F))return"";for(te||(te="utf8");;)switch(te){case"hex":return X(this,F,K);case"utf8":case"utf-8":return _(this,F,K);case"ascii":return W(this,F,K);case"latin1":case"binary":return q(this,F,K);case"base64":return N(this,F,K);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ne(this,F,K);default:if(Q)throw new TypeError("Unknown encoding: "+te);te=(te+"").toLowerCase(),Q=!0}}a.prototype._isBuffer=!0;function j(te,F,K){const Q=te[F];te[F]=te[K],te[K]=Q}a.prototype.swap16=function(){const F=this.length;if(F%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let K=0;K<F;K+=2)j(this,K,K+1);return this},a.prototype.swap32=function(){const F=this.length;if(F%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let K=0;K<F;K+=4)j(this,K,K+3),j(this,K+1,K+2);return this},a.prototype.swap64=function(){const F=this.length;if(F%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let K=0;K<F;K+=8)j(this,K,K+7),j(this,K+1,K+6),j(this,K+2,K+5),j(this,K+3,K+4);return this},a.prototype.toString=function(){const F=this.length;return F===0?"":arguments.length===0?_(this,0,F):M.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(F){if(!a.isBuffer(F))throw new TypeError("Argument must be a Buffer");return this===F?!0:a.compare(this,F)===0},a.prototype.inspect=function(){let F="";const K=n.INSPECT_MAX_BYTES;return F=this.toString("hex",0,K).replace(/(.{2})/g,"$1 ").trim(),this.length>K&&(F+=" ... "),"<Buffer "+F+">"},r&&(a.prototype[r]=a.prototype.inspect),a.prototype.compare=function(F,K,Q,re,ce){if(On(F,Uint8Array)&&(F=a.from(F,F.offset,F.byteLength)),!a.isBuffer(F))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof F);if(K===void 0&&(K=0),Q===void 0&&(Q=F?F.length:0),re===void 0&&(re=0),ce===void 0&&(ce=this.length),K<0||Q>F.length||re<0||ce>this.length)throw new RangeError("out of range index");if(re>=ce&&K>=Q)return 0;if(re>=ce)return-1;if(K>=Q)return 1;if(K>>>=0,Q>>>=0,re>>>=0,ce>>>=0,this===F)return 0;let ye=ce-re,ut=Q-K;const st=Math.min(ye,ut),at=this.slice(re,ce),Rt=F.slice(K,Q);for(let Qe=0;Qe<st;++Qe)if(at[Qe]!==Rt[Qe]){ye=at[Qe],ut=Rt[Qe];break}return ye<ut?-1:ut<ye?1:0};function D(te,F,K,Q,re){if(te.length===0)return-1;if(typeof K=="string"?(Q=K,K=0):K>2147483647?K=2147483647:K<-2147483648&&(K=-2147483648),K=+K,qt(K)&&(K=re?0:te.length-1),K<0&&(K=te.length+K),K>=te.length){if(re)return-1;K=te.length-1}else if(K<0)if(re)K=0;else return-1;if(typeof F=="string"&&(F=a.from(F,Q)),a.isBuffer(F))return F.length===0?-1:H(te,F,K,Q,re);if(typeof F=="number")return F=F&255,typeof Uint8Array.prototype.indexOf=="function"?re?Uint8Array.prototype.indexOf.call(te,F,K):Uint8Array.prototype.lastIndexOf.call(te,F,K):H(te,[F],K,Q,re);throw new TypeError("val must be string, number or Buffer")}function H(te,F,K,Q,re){let ce=1,ye=te.length,ut=F.length;if(Q!==void 0&&(Q=String(Q).toLowerCase(),Q==="ucs2"||Q==="ucs-2"||Q==="utf16le"||Q==="utf-16le")){if(te.length<2||F.length<2)return-1;ce=2,ye/=2,ut/=2,K/=2}function st(Rt,Qe){return ce===1?Rt[Qe]:Rt.readUInt16BE(Qe*ce)}let at;if(re){let Rt=-1;for(at=K;at<ye;at++)if(st(te,at)===st(F,Rt===-1?0:at-Rt)){if(Rt===-1&&(Rt=at),at-Rt+1===ut)return Rt*ce}else Rt!==-1&&(at-=at-Rt),Rt=-1}else for(K+ut>ye&&(K=ye-ut),at=K;at>=0;at--){let Rt=!0;for(let Qe=0;Qe<ut;Qe++)if(st(te,at+Qe)!==st(F,Qe)){Rt=!1;break}if(Rt)return at}return-1}a.prototype.includes=function(F,K,Q){return this.indexOf(F,K,Q)!==-1},a.prototype.indexOf=function(F,K,Q){return D(this,F,K,Q,!0)},a.prototype.lastIndexOf=function(F,K,Q){return D(this,F,K,Q,!1)};function L(te,F,K,Q){K=Number(K)||0;const re=te.length-K;Q?(Q=Number(Q),Q>re&&(Q=re)):Q=re;const ce=F.length;Q>ce/2&&(Q=ce/2);let ye;for(ye=0;ye<Q;++ye){const ut=parseInt(F.substr(ye*2,2),16);if(qt(ut))return ye;te[K+ye]=ut}return ye}function U(te,F,K,Q){return Et(_t(F,te.length-K),te,K,Q)}function z(te,F,K,Q){return Et(Ut(F),te,K,Q)}function Y(te,F,K,Q){return Et(At(F),te,K,Q)}function V(te,F,K,Q){return Et(ur(F,te.length-K),te,K,Q)}a.prototype.write=function(F,K,Q,re){if(K===void 0)re="utf8",Q=this.length,K=0;else if(Q===void 0&&typeof K=="string")re=K,Q=this.length,K=0;else if(isFinite(K))K=K>>>0,isFinite(Q)?(Q=Q>>>0,re===void 0&&(re="utf8")):(re=Q,Q=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const ce=this.length-K;if((Q===void 0||Q>ce)&&(Q=ce),F.length>0&&(Q<0||K<0)||K>this.length)throw new RangeError("Attempt to write outside buffer bounds");re||(re="utf8");let ye=!1;for(;;)switch(re){case"hex":return L(this,F,K,Q);case"utf8":case"utf-8":return U(this,F,K,Q);case"ascii":case"latin1":case"binary":return z(this,F,K,Q);case"base64":return Y(this,F,K,Q);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return V(this,F,K,Q);default:if(ye)throw new TypeError("Unknown encoding: "+re);re=(""+re).toLowerCase(),ye=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function N(te,F,K){return F===0&&K===te.length?e.fromByteArray(te):e.fromByteArray(te.slice(F,K))}function _(te,F,K){K=Math.min(te.length,K);const Q=[];let re=F;for(;re<K;){const ce=te[re];let ye=null,ut=ce>239?4:ce>223?3:ce>191?2:1;if(re+ut<=K){let st,at,Rt,Qe;switch(ut){case 1:ce<128&&(ye=ce);break;case 2:st=te[re+1],(st&192)===128&&(Qe=(ce&31)<<6|st&63,Qe>127&&(ye=Qe));break;case 3:st=te[re+1],at=te[re+2],(st&192)===128&&(at&192)===128&&(Qe=(ce&15)<<12|(st&63)<<6|at&63,Qe>2047&&(Qe<55296||Qe>57343)&&(ye=Qe));break;case 4:st=te[re+1],at=te[re+2],Rt=te[re+3],(st&192)===128&&(at&192)===128&&(Rt&192)===128&&(Qe=(ce&15)<<18|(st&63)<<12|(at&63)<<6|Rt&63,Qe>65535&&Qe<1114112&&(ye=Qe))}}ye===null?(ye=65533,ut=1):ye>65535&&(ye-=65536,Q.push(ye>>>10&1023|55296),ye=56320|ye&1023),Q.push(ye),re+=ut}return O(Q)}const k=4096;function O(te){const F=te.length;if(F<=k)return String.fromCharCode.apply(String,te);let K="",Q=0;for(;Q<F;)K+=String.fromCharCode.apply(String,te.slice(Q,Q+=k));return K}function W(te,F,K){let Q="";K=Math.min(te.length,K);for(let re=F;re<K;++re)Q+=String.fromCharCode(te[re]&127);return Q}function q(te,F,K){let Q="";K=Math.min(te.length,K);for(let re=F;re<K;++re)Q+=String.fromCharCode(te[re]);return Q}function X(te,F,K){const Q=te.length;(!F||F<0)&&(F=0),(!K||K<0||K>Q)&&(K=Q);let re="";for(let ce=F;ce<K;++ce)re+=tn[te[ce]];return re}function ne(te,F,K){const Q=te.slice(F,K);let re="";for(let ce=0;ce<Q.length-1;ce+=2)re+=String.fromCharCode(Q[ce]+Q[ce+1]*256);return re}a.prototype.slice=function(F,K){const Q=this.length;F=~~F,K=K===void 0?Q:~~K,F<0?(F+=Q,F<0&&(F=0)):F>Q&&(F=Q),K<0?(K+=Q,K<0&&(K=0)):K>Q&&(K=Q),K<F&&(K=F);const re=this.subarray(F,K);return Object.setPrototypeOf(re,a.prototype),re};function $(te,F,K){if(te%1!==0||te<0)throw new RangeError("offset is not uint");if(te+F>K)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(F,K,Q){F=F>>>0,K=K>>>0,Q||$(F,K,this.length);let re=this[F],ce=1,ye=0;for(;++ye<K&&(ce*=256);)re+=this[F+ye]*ce;return re},a.prototype.readUintBE=a.prototype.readUIntBE=function(F,K,Q){F=F>>>0,K=K>>>0,Q||$(F,K,this.length);let re=this[F+--K],ce=1;for(;K>0&&(ce*=256);)re+=this[F+--K]*ce;return re},a.prototype.readUint8=a.prototype.readUInt8=function(F,K){return F=F>>>0,K||$(F,1,this.length),this[F]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(F,K){return F=F>>>0,K||$(F,2,this.length),this[F]|this[F+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(F,K){return F=F>>>0,K||$(F,2,this.length),this[F]<<8|this[F+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(F,K){return F=F>>>0,K||$(F,4,this.length),(this[F]|this[F+1]<<8|this[F+2]<<16)+this[F+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(F,K){return F=F>>>0,K||$(F,4,this.length),this[F]*16777216+(this[F+1]<<16|this[F+2]<<8|this[F+3])},a.prototype.readBigUInt64LE=dr(function(F){F=F>>>0,dt(F,"offset");const K=this[F],Q=this[F+7];(K===void 0||Q===void 0)&&et(F,this.length-8);const re=K+this[++F]*2**8+this[++F]*2**16+this[++F]*2**24,ce=this[++F]+this[++F]*2**8+this[++F]*2**16+Q*2**24;return BigInt(re)+(BigInt(ce)<<BigInt(32))}),a.prototype.readBigUInt64BE=dr(function(F){F=F>>>0,dt(F,"offset");const K=this[F],Q=this[F+7];(K===void 0||Q===void 0)&&et(F,this.length-8);const re=K*2**24+this[++F]*2**16+this[++F]*2**8+this[++F],ce=this[++F]*2**24+this[++F]*2**16+this[++F]*2**8+Q;return(BigInt(re)<<BigInt(32))+BigInt(ce)}),a.prototype.readIntLE=function(F,K,Q){F=F>>>0,K=K>>>0,Q||$(F,K,this.length);let re=this[F],ce=1,ye=0;for(;++ye<K&&(ce*=256);)re+=this[F+ye]*ce;return ce*=128,re>=ce&&(re-=Math.pow(2,8*K)),re},a.prototype.readIntBE=function(F,K,Q){F=F>>>0,K=K>>>0,Q||$(F,K,this.length);let re=K,ce=1,ye=this[F+--re];for(;re>0&&(ce*=256);)ye+=this[F+--re]*ce;return ce*=128,ye>=ce&&(ye-=Math.pow(2,8*K)),ye},a.prototype.readInt8=function(F,K){return F=F>>>0,K||$(F,1,this.length),this[F]&128?(255-this[F]+1)*-1:this[F]},a.prototype.readInt16LE=function(F,K){F=F>>>0,K||$(F,2,this.length);const Q=this[F]|this[F+1]<<8;return Q&32768?Q|4294901760:Q},a.prototype.readInt16BE=function(F,K){F=F>>>0,K||$(F,2,this.length);const Q=this[F+1]|this[F]<<8;return Q&32768?Q|4294901760:Q},a.prototype.readInt32LE=function(F,K){return F=F>>>0,K||$(F,4,this.length),this[F]|this[F+1]<<8|this[F+2]<<16|this[F+3]<<24},a.prototype.readInt32BE=function(F,K){return F=F>>>0,K||$(F,4,this.length),this[F]<<24|this[F+1]<<16|this[F+2]<<8|this[F+3]},a.prototype.readBigInt64LE=dr(function(F){F=F>>>0,dt(F,"offset");const K=this[F],Q=this[F+7];(K===void 0||Q===void 0)&&et(F,this.length-8);const re=this[F+4]+this[F+5]*2**8+this[F+6]*2**16+(Q<<24);return(BigInt(re)<<BigInt(32))+BigInt(K+this[++F]*2**8+this[++F]*2**16+this[++F]*2**24)}),a.prototype.readBigInt64BE=dr(function(F){F=F>>>0,dt(F,"offset");const K=this[F],Q=this[F+7];(K===void 0||Q===void 0)&&et(F,this.length-8);const re=(K<<24)+this[++F]*2**16+this[++F]*2**8+this[++F];return(BigInt(re)<<BigInt(32))+BigInt(this[++F]*2**24+this[++F]*2**16+this[++F]*2**8+Q)}),a.prototype.readFloatLE=function(F,K){return F=F>>>0,K||$(F,4,this.length),t.read(this,F,!0,23,4)},a.prototype.readFloatBE=function(F,K){return F=F>>>0,K||$(F,4,this.length),t.read(this,F,!1,23,4)},a.prototype.readDoubleLE=function(F,K){return F=F>>>0,K||$(F,8,this.length),t.read(this,F,!0,52,8)},a.prototype.readDoubleBE=function(F,K){return F=F>>>0,K||$(F,8,this.length),t.read(this,F,!1,52,8)};function C(te,F,K,Q,re,ce){if(!a.isBuffer(te))throw new TypeError('"buffer" argument must be a Buffer instance');if(F>re||F<ce)throw new RangeError('"value" argument is out of bounds');if(K+Q>te.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(F,K,Q,re){if(F=+F,K=K>>>0,Q=Q>>>0,!re){const ut=Math.pow(2,8*Q)-1;C(this,F,K,Q,ut,0)}let ce=1,ye=0;for(this[K]=F&255;++ye<Q&&(ce*=256);)this[K+ye]=F/ce&255;return K+Q},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(F,K,Q,re){if(F=+F,K=K>>>0,Q=Q>>>0,!re){const ut=Math.pow(2,8*Q)-1;C(this,F,K,Q,ut,0)}let ce=Q-1,ye=1;for(this[K+ce]=F&255;--ce>=0&&(ye*=256);)this[K+ce]=F/ye&255;return K+Q},a.prototype.writeUint8=a.prototype.writeUInt8=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,1,255,0),this[K]=F&255,K+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,2,65535,0),this[K]=F&255,this[K+1]=F>>>8,K+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,2,65535,0),this[K]=F>>>8,this[K+1]=F&255,K+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,4,4294967295,0),this[K+3]=F>>>24,this[K+2]=F>>>16,this[K+1]=F>>>8,this[K]=F&255,K+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,4,4294967295,0),this[K]=F>>>24,this[K+1]=F>>>16,this[K+2]=F>>>8,this[K+3]=F&255,K+4};function R(te,F,K,Q,re){Ze(F,Q,re,te,K,7);let ce=Number(F&BigInt(4294967295));te[K++]=ce,ce=ce>>8,te[K++]=ce,ce=ce>>8,te[K++]=ce,ce=ce>>8,te[K++]=ce;let ye=Number(F>>BigInt(32)&BigInt(4294967295));return te[K++]=ye,ye=ye>>8,te[K++]=ye,ye=ye>>8,te[K++]=ye,ye=ye>>8,te[K++]=ye,K}function Z(te,F,K,Q,re){Ze(F,Q,re,te,K,7);let ce=Number(F&BigInt(4294967295));te[K+7]=ce,ce=ce>>8,te[K+6]=ce,ce=ce>>8,te[K+5]=ce,ce=ce>>8,te[K+4]=ce;let ye=Number(F>>BigInt(32)&BigInt(4294967295));return te[K+3]=ye,ye=ye>>8,te[K+2]=ye,ye=ye>>8,te[K+1]=ye,ye=ye>>8,te[K]=ye,K+8}a.prototype.writeBigUInt64LE=dr(function(F,K=0){return R(this,F,K,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=dr(function(F,K=0){return Z(this,F,K,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(F,K,Q,re){if(F=+F,K=K>>>0,!re){const st=Math.pow(2,8*Q-1);C(this,F,K,Q,st-1,-st)}let ce=0,ye=1,ut=0;for(this[K]=F&255;++ce<Q&&(ye*=256);)F<0&&ut===0&&this[K+ce-1]!==0&&(ut=1),this[K+ce]=(F/ye>>0)-ut&255;return K+Q},a.prototype.writeIntBE=function(F,K,Q,re){if(F=+F,K=K>>>0,!re){const st=Math.pow(2,8*Q-1);C(this,F,K,Q,st-1,-st)}let ce=Q-1,ye=1,ut=0;for(this[K+ce]=F&255;--ce>=0&&(ye*=256);)F<0&&ut===0&&this[K+ce+1]!==0&&(ut=1),this[K+ce]=(F/ye>>0)-ut&255;return K+Q},a.prototype.writeInt8=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,1,127,-128),F<0&&(F=255+F+1),this[K]=F&255,K+1},a.prototype.writeInt16LE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,2,32767,-32768),this[K]=F&255,this[K+1]=F>>>8,K+2},a.prototype.writeInt16BE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,2,32767,-32768),this[K]=F>>>8,this[K+1]=F&255,K+2},a.prototype.writeInt32LE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,4,2147483647,-2147483648),this[K]=F&255,this[K+1]=F>>>8,this[K+2]=F>>>16,this[K+3]=F>>>24,K+4},a.prototype.writeInt32BE=function(F,K,Q){return F=+F,K=K>>>0,Q||C(this,F,K,4,2147483647,-2147483648),F<0&&(F=4294967295+F+1),this[K]=F>>>24,this[K+1]=F>>>16,this[K+2]=F>>>8,this[K+3]=F&255,K+4},a.prototype.writeBigInt64LE=dr(function(F,K=0){return R(this,F,K,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=dr(function(F,K=0){return Z(this,F,K,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function J(te,F,K,Q,re,ce){if(K+Q>te.length)throw new RangeError("Index out of range");if(K<0)throw new RangeError("Index out of range")}function oe(te,F,K,Q,re){return F=+F,K=K>>>0,re||J(te,F,K,4),t.write(te,F,K,Q,23,4),K+4}a.prototype.writeFloatLE=function(F,K,Q){return oe(this,F,K,!0,Q)},a.prototype.writeFloatBE=function(F,K,Q){return oe(this,F,K,!1,Q)};function ue(te,F,K,Q,re){return F=+F,K=K>>>0,re||J(te,F,K,8),t.write(te,F,K,Q,52,8),K+8}a.prototype.writeDoubleLE=function(F,K,Q){return ue(this,F,K,!0,Q)},a.prototype.writeDoubleBE=function(F,K,Q){return ue(this,F,K,!1,Q)},a.prototype.copy=function(F,K,Q,re){if(!a.isBuffer(F))throw new TypeError("argument should be a Buffer");if(Q||(Q=0),!re&&re!==0&&(re=this.length),K>=F.length&&(K=F.length),K||(K=0),re>0&&re<Q&&(re=Q),re===Q||F.length===0||this.length===0)return 0;if(K<0)throw new RangeError("targetStart out of bounds");if(Q<0||Q>=this.length)throw new RangeError("Index out of range");if(re<0)throw new RangeError("sourceEnd out of bounds");re>this.length&&(re=this.length),F.length-K<re-Q&&(re=F.length-K+Q);const ce=re-Q;return this===F&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(K,Q,re):Uint8Array.prototype.set.call(F,this.subarray(Q,re),K),ce},a.prototype.fill=function(F,K,Q,re){if(typeof F=="string"){if(typeof K=="string"?(re=K,K=0,Q=this.length):typeof Q=="string"&&(re=Q,Q=this.length),re!==void 0&&typeof re!="string")throw new TypeError("encoding must be a string");if(typeof re=="string"&&!a.isEncoding(re))throw new TypeError("Unknown encoding: "+re);if(F.length===1){const ye=F.charCodeAt(0);(re==="utf8"&&ye<128||re==="latin1")&&(F=ye)}}else typeof F=="number"?F=F&255:typeof F=="boolean"&&(F=Number(F));if(K<0||this.length<K||this.length<Q)throw new RangeError("Out of range index");if(Q<=K)return this;K=K>>>0,Q=Q===void 0?this.length:Q>>>0,F||(F=0);let ce;if(typeof F=="number")for(ce=K;ce<Q;++ce)this[ce]=F;else{const ye=a.isBuffer(F)?F:a.from(F,re),ut=ye.length;if(ut===0)throw new TypeError('The value "'+F+'" is invalid for argument "value"');for(ce=0;ce<Q-K;++ce)this[ce+K]=ye[ce%ut]}return this};const fe={};function _e(te,F,K){fe[te]=class extends K{constructor(){super(),Object.defineProperty(this,"message",{value:F.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${te}]`,this.stack,delete this.name}get code(){return te}set code(re){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:re,writable:!0})}toString(){return`${this.name} [${te}]: ${this.message}`}}}_e("ERR_BUFFER_OUT_OF_BOUNDS",function(te){return te?`${te} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),_e("ERR_INVALID_ARG_TYPE",function(te,F){return`The "${te}" argument must be of type number. Received type ${typeof F}`},TypeError),_e("ERR_OUT_OF_RANGE",function(te,F,K){let Q=`The value of "${te}" is out of range.`,re=K;return Number.isInteger(K)&&Math.abs(K)>2**32?re=Le(String(K)):typeof K=="bigint"&&(re=String(K),(K>BigInt(2)**BigInt(32)||K<-(BigInt(2)**BigInt(32)))&&(re=Le(re)),re+="n"),Q+=` It must be ${F}. Received ${re}`,Q},RangeError);function Le(te){let F="",K=te.length;const Q=te[0]==="-"?1:0;for(;K>=Q+4;K-=3)F=`_${te.slice(K-3,K)}${F}`;return`${te.slice(0,K)}${F}`}function Ne(te,F,K){dt(F,"offset"),(te[F]===void 0||te[F+K]===void 0)&&et(F,te.length-(K+1))}function Ze(te,F,K,Q,re,ce){if(te>K||te<F){const ye=typeof F=="bigint"?"n":"";let ut;throw F===0||F===BigInt(0)?ut=`>= 0${ye} and < 2${ye} ** ${(ce+1)*8}${ye}`:ut=`>= -(2${ye} ** ${(ce+1)*8-1}${ye}) and < 2 ** ${(ce+1)*8-1}${ye}`,new fe.ERR_OUT_OF_RANGE("value",ut,te)}Ne(Q,re,ce)}function dt(te,F){if(typeof te!="number")throw new fe.ERR_INVALID_ARG_TYPE(F,"number",te)}function et(te,F,K){throw Math.floor(te)!==te?(dt(te,K),new fe.ERR_OUT_OF_RANGE("offset","an integer",te)):F<0?new fe.ERR_BUFFER_OUT_OF_BOUNDS:new fe.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${F}`,te)}const Xe=/[^+/0-9A-Za-z-_]/g;function Kt(te){if(te=te.split("=")[0],te=te.trim().replace(Xe,""),te.length<2)return"";for(;te.length%4!==0;)te=te+"=";return te}function _t(te,F){F=F||1/0;let K;const Q=te.length;let re=null;const ce=[];for(let ye=0;ye<Q;++ye){if(K=te.charCodeAt(ye),K>55295&&K<57344){if(!re){if(K>56319){(F-=3)>-1&&ce.push(239,191,189);continue}else if(ye+1===Q){(F-=3)>-1&&ce.push(239,191,189);continue}re=K;continue}if(K<56320){(F-=3)>-1&&ce.push(239,191,189),re=K;continue}K=(re-55296<<10|K-56320)+65536}else re&&(F-=3)>-1&&ce.push(239,191,189);if(re=null,K<128){if((F-=1)<0)break;ce.push(K)}else if(K<2048){if((F-=2)<0)break;ce.push(K>>6|192,K&63|128)}else if(K<65536){if((F-=3)<0)break;ce.push(K>>12|224,K>>6&63|128,K&63|128)}else if(K<1114112){if((F-=4)<0)break;ce.push(K>>18|240,K>>12&63|128,K>>6&63|128,K&63|128)}else throw new Error("Invalid code point")}return ce}function Ut(te){const F=[];for(let K=0;K<te.length;++K)F.push(te.charCodeAt(K)&255);return F}function ur(te,F){let K,Q,re;const ce=[];for(let ye=0;ye<te.length&&!((F-=2)<0);++ye)K=te.charCodeAt(ye),Q=K>>8,re=K%256,ce.push(re),ce.push(Q);return ce}function At(te){return e.toByteArray(Kt(te))}function Et(te,F,K,Q){let re;for(re=0;re<Q&&!(re+K>=F.length||re>=te.length);++re)F[re+K]=te[re];return re}function On(te,F){return te instanceof F||te!=null&&te.constructor!=null&&te.constructor.name!=null&&te.constructor.name===F.name}function qt(te){return te!==te}const tn=function(){const te="0123456789abcdef",F=new Array(256);for(let K=0;K<16;++K){const Q=K*16;for(let re=0;re<16;++re)F[Q+re]=te[K]+te[re]}return F}();function dr(te){return typeof BigInt>"u"?nn:te}function nn(){throw new Error("BigInt not supported")}}(qb)),qb}var Ct=FP();function VD(n){if(!Number.isSafeInteger(n)||n<0)throw new Error("positive integer expected, got "+n)}function zge(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function Qw(n,...e){if(!zge(n))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(n.length))throw new Error("Uint8Array expected of length "+e+", got length="+n.length)}function Uge(n){if(typeof n!="function"||typeof n.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");VD(n.outputLen),VD(n.blockLen)}function R0(n,e=!0){if(n.destroyed)throw new Error("Hash instance has been destroyed");if(e&&n.finished)throw new Error("Hash#digest() has already been called")}function $ge(n,e){Qw(n);const t=e.outputLen;if(n.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const Dd=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Gb=n=>new DataView(n.buffer,n.byteOffset,n.byteLength),na=(n,e)=>n<<32-e|n>>>e;function Hge(n){if(typeof n!="string")throw new Error("utf8ToBytes expected string, got "+typeof n);return new Uint8Array(new TextEncoder().encode(n))}function zP(n){return typeof n=="string"&&(n=Hge(n)),Qw(n),n}function Wge(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];Qw(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}class u9{clone(){return this._cloneInto()}}function d9(n){const e=r=>n().update(zP(r)).digest(),t=n();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>n(),e}function h9(n=32){if(Dd&&typeof Dd.getRandomValues=="function")return Dd.getRandomValues(new Uint8Array(n));if(Dd&&typeof Dd.randomBytes=="function")return Dd.randomBytes(n);throw new Error("crypto.getRandomValues must be defined")}function Kge(n,e,t,r){if(typeof n.setBigUint64=="function")return n.setBigUint64(e,t,r);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=r?4:0,u=r?0:4;n.setUint32(e+c,o,r),n.setUint32(e+u,a,r)}const qge=(n,e,t)=>n&e^~n&t,Gge=(n,e,t)=>n&e^n&t^e&t;class f9 extends u9{constructor(e,t,r,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=r,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Gb(this.buffer)}update(e){R0(this);const{view:t,buffer:r,blockLen:i}=this;e=zP(e);const s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Gb(e);for(;i<=s-o;o+=i)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){R0(this),$ge(e,this),this.finished=!0;const{buffer:t,view:r,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>i-o&&(this.process(r,0),o=0);for(let f=o;f<i;f++)t[f]=0;Kge(r,i-8,BigInt(this.length*8),s),this.process(r,0);const a=Gb(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=c/4,d=this.get();if(u>d.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<u;f++)a.setUint32(4*f,d[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const r=e.slice(0,t);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:r,length:i,finished:s,destroyed:o,pos:a}=this;return e.length=i,e.pos=a,e.finished=s,e.destroyed=o,i%t&&e.buffer.set(r),e}}const Qm=BigInt(2**32-1),NE=BigInt(32);function p9(n,e=!1){return e?{h:Number(n&Qm),l:Number(n>>NE&Qm)}:{h:Number(n>>NE&Qm)|0,l:Number(n&Qm)|0}}function Vge(n,e=!1){let t=new Uint32Array(n.length),r=new Uint32Array(n.length);for(let i=0;i<n.length;i++){const{h:s,l:o}=p9(n[i],e);[t[i],r[i]]=[s,o]}return[t,r]}const Yge=(n,e)=>BigInt(n>>>0)<<NE|BigInt(e>>>0),Xge=(n,e,t)=>n>>>t,Zge=(n,e,t)=>n<<32-t|e>>>t,Qge=(n,e,t)=>n>>>t|e<<32-t,Jge=(n,e,t)=>n<<32-t|e>>>t,eme=(n,e,t)=>n<<64-t|e>>>t-32,tme=(n,e,t)=>n>>>t-32|e<<64-t,nme=(n,e)=>e,rme=(n,e)=>n,ime=(n,e,t)=>n<<t|e>>>32-t,sme=(n,e,t)=>e<<t|n>>>32-t,ome=(n,e,t)=>e<<t-32|n>>>64-t,ame=(n,e,t)=>n<<t-32|e>>>64-t;function cme(n,e,t,r){const i=(e>>>0)+(r>>>0);return{h:n+t+(i/2**32|0)|0,l:i|0}}const lme=(n,e,t)=>(n>>>0)+(e>>>0)+(t>>>0),ume=(n,e,t,r)=>e+t+r+(n/2**32|0)|0,dme=(n,e,t,r)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0),hme=(n,e,t,r,i)=>e+t+r+i+(n/2**32|0)|0,fme=(n,e,t,r,i)=>(n>>>0)+(e>>>0)+(t>>>0)+(r>>>0)+(i>>>0),pme=(n,e,t,r,i,s)=>e+t+r+i+s+(n/2**32|0)|0,Mt={fromBig:p9,split:Vge,toBig:Yge,shrSH:Xge,shrSL:Zge,rotrSH:Qge,rotrSL:Jge,rotrBH:eme,rotrBL:tme,rotr32H:nme,rotr32L:rme,rotlSH:ime,rotlSL:sme,rotlBH:ome,rotlBL:ame,add:cme,add3L:lme,add3H:ume,add4L:dme,add4H:hme,add5H:pme,add5L:fme},[gme,mme]=Mt.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(n=>BigInt(n))),Kc=new Uint32Array(80),qc=new Uint32Array(80);class yme extends f9{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:r,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:d,Fh:f,Fl:g,Gh:m,Gl:v,Hh:w,Hl:S}=this;return[e,t,r,i,s,o,a,c,u,d,f,g,m,v,w,S]}set(e,t,r,i,s,o,a,c,u,d,f,g,m,v,w,S){this.Ah=e|0,this.Al=t|0,this.Bh=r|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=d|0,this.Fh=f|0,this.Fl=g|0,this.Gh=m|0,this.Gl=v|0,this.Hh=w|0,this.Hl=S|0}process(e,t){for(let E=0;E<16;E++,t+=4)Kc[E]=e.getUint32(t),qc[E]=e.getUint32(t+=4);for(let E=16;E<80;E++){const M=Kc[E-15]|0,j=qc[E-15]|0,D=Mt.rotrSH(M,j,1)^Mt.rotrSH(M,j,8)^Mt.shrSH(M,j,7),H=Mt.rotrSL(M,j,1)^Mt.rotrSL(M,j,8)^Mt.shrSL(M,j,7),L=Kc[E-2]|0,U=qc[E-2]|0,z=Mt.rotrSH(L,U,19)^Mt.rotrBH(L,U,61)^Mt.shrSH(L,U,6),Y=Mt.rotrSL(L,U,19)^Mt.rotrBL(L,U,61)^Mt.shrSL(L,U,6),V=Mt.add4L(H,Y,qc[E-7],qc[E-16]),N=Mt.add4H(V,D,z,Kc[E-7],Kc[E-16]);Kc[E]=N|0,qc[E]=V|0}let{Ah:r,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:d,Eh:f,El:g,Fh:m,Fl:v,Gh:w,Gl:S,Hh:b,Hl:x}=this;for(let E=0;E<80;E++){const M=Mt.rotrSH(f,g,14)^Mt.rotrSH(f,g,18)^Mt.rotrBH(f,g,41),j=Mt.rotrSL(f,g,14)^Mt.rotrSL(f,g,18)^Mt.rotrBL(f,g,41),D=f&m^~f&w,H=g&v^~g&S,L=Mt.add5L(x,j,H,mme[E],qc[E]),U=Mt.add5H(L,b,M,D,gme[E],Kc[E]),z=L|0,Y=Mt.rotrSH(r,i,28)^Mt.rotrBH(r,i,34)^Mt.rotrBH(r,i,39),V=Mt.rotrSL(r,i,28)^Mt.rotrBL(r,i,34)^Mt.rotrBL(r,i,39),N=r&s^r&a^s&a,_=i&o^i&c^o&c;b=w|0,x=S|0,w=m|0,S=v|0,m=f|0,v=g|0,{h:f,l:g}=Mt.add(u|0,d|0,U|0,z|0),u=a|0,d=c|0,a=s|0,c=o|0,s=r|0,o=i|0;const k=Mt.add3L(z,V,_);r=Mt.add3H(k,U,Y,N),i=k|0}({h:r,l:i}=Mt.add(this.Ah|0,this.Al|0,r|0,i|0)),{h:s,l:o}=Mt.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Mt.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l:d}=Mt.add(this.Dh|0,this.Dl|0,u|0,d|0),{h:f,l:g}=Mt.add(this.Eh|0,this.El|0,f|0,g|0),{h:m,l:v}=Mt.add(this.Fh|0,this.Fl|0,m|0,v|0),{h:w,l:S}=Mt.add(this.Gh|0,this.Gl|0,w|0,S|0),{h:b,l:x}=Mt.add(this.Hh|0,this.Hl|0,b|0,x|0),this.set(r,i,s,o,a,c,u,d,f,g,m,v,w,S,b,x)}roundClean(){Kc.fill(0),qc.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const wme=d9(()=>new yme);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Jw=BigInt(0),ev=BigInt(1),vme=BigInt(2);function Du(n){return n instanceof Uint8Array||ArrayBuffer.isView(n)&&n.constructor.name==="Uint8Array"}function ug(n){if(!Du(n))throw new Error("Uint8Array expected")}function lc(n,e){if(typeof e!="boolean")throw new Error(n+" boolean expected, got "+e)}const Sme=Array.from({length:256},(n,e)=>e.toString(16).padStart(2,"0"));function Ou(n){ug(n);let e="";for(let t=0;t<n.length;t++)e+=Sme[n[t]];return e}function Vd(n){const e=n.toString(16);return e.length&1?"0"+e:e}function UP(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);return n===""?Jw:BigInt("0x"+n)}const Ha={_0:48,_9:57,A:65,F:70,a:97,f:102};function YD(n){if(n>=Ha._0&&n<=Ha._9)return n-Ha._0;if(n>=Ha.A&&n<=Ha.F)return n-(Ha.A-10);if(n>=Ha.a&&n<=Ha.f)return n-(Ha.a-10)}function yh(n){if(typeof n!="string")throw new Error("hex string expected, got "+typeof n);const e=n.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const r=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=YD(n.charCodeAt(s)),a=YD(n.charCodeAt(s+1));if(o===void 0||a===void 0){const c=n[s]+n[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}r[i]=o*16+a}return r}function xu(n){return UP(Ou(n))}function sh(n){return ug(n),UP(Ou(Uint8Array.from(n).reverse()))}function wh(n,e){return yh(n.toString(16).padStart(e*2,"0"))}function Ap(n,e){return wh(n,e).reverse()}function xme(n){return yh(Vd(n))}function _r(n,e,t){let r;if(typeof e=="string")try{r=yh(e)}catch(s){throw new Error(n+" must be hex string or Uint8Array, cause: "+s)}else if(Du(e))r=Uint8Array.from(e);else throw new Error(n+" must be hex string or Uint8Array");const i=r.length;if(typeof t=="number"&&i!==t)throw new Error(n+" of length "+t+" expected, got "+i);return r}function Lu(...n){let e=0;for(let r=0;r<n.length;r++){const i=n[r];ug(i),e+=i.length}const t=new Uint8Array(e);for(let r=0,i=0;r<n.length;r++){const s=n[r];t.set(s,i),i+=s.length}return t}function bme(n,e){if(n.length!==e.length)return!1;let t=0;for(let r=0;r<n.length;r++)t|=n[r]^e[r];return t===0}function _me(n){if(typeof n!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(n))}const Vb=n=>typeof n=="bigint"&&Jw<=n;function tv(n,e,t){return Vb(n)&&Vb(e)&&Vb(t)&&e<=n&&n<t}function Xs(n,e,t,r){if(!tv(e,t,r))throw new Error("expected valid "+n+": "+t+" <= n < "+r+", got "+e)}function g9(n){let e;for(e=0;n>Jw;n>>=ev,e+=1);return e}function Ime(n,e){return n>>BigInt(e)&ev}function Eme(n,e,t){return n|(t?ev:Jw)<<BigInt(e)}const $P=n=>(vme<<BigInt(n-1))-ev,Yb=n=>new Uint8Array(n),XD=n=>Uint8Array.from(n);function m9(n,e,t){if(typeof n!="number"||n<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let r=Yb(n),i=Yb(n),s=0;const o=()=>{r.fill(1),i.fill(0),s=0},a=(...f)=>t(i,r,...f),c=(f=Yb())=>{i=a(XD([0]),f),r=a(),f.length!==0&&(i=a(XD([1]),f),r=a())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const g=[];for(;f<e;){r=a();const m=r.slice();g.push(m),f+=r.length}return Lu(...g)};return(f,g)=>{o(),c(f);let m;for(;!(m=g(u()));)c();return o(),m}}const Cme={bigint:n=>typeof n=="bigint",function:n=>typeof n=="function",boolean:n=>typeof n=="boolean",string:n=>typeof n=="string",stringOrUint8Array:n=>typeof n=="string"||Du(n),isSafeInteger:n=>Number.isSafeInteger(n),array:n=>Array.isArray(n),field:(n,e)=>e.Fp.isValid(n),hash:n=>typeof n=="function"&&Number.isSafeInteger(n.outputLen)};function Nh(n,e,t={}){const r=(i,s,o)=>{const a=Cme[s];if(typeof a!="function")throw new Error("invalid validator function");const c=n[i];if(!(o&&c===void 0)&&!a(c,n))throw new Error("param "+String(i)+" is invalid. Expected "+s+", got "+c)};for(const[i,s]of Object.entries(e))r(i,s,!1);for(const[i,s]of Object.entries(t))r(i,s,!0);return n}const Pme=()=>{throw new Error("not implemented")};function Rp(n){const e=new WeakMap;return(t,...r)=>{const i=e.get(t);if(i!==void 0)return i;const s=n(t,...r);return e.set(t,s),s}}const Mme=Object.freeze(Object.defineProperty({__proto__:null,aInRange:Xs,abool:lc,abytes:ug,bitGet:Ime,bitLen:g9,bitMask:$P,bitSet:Eme,bytesToHex:Ou,bytesToNumberBE:xu,bytesToNumberLE:sh,concatBytes:Lu,createHmacDrbg:m9,ensureBytes:_r,equalBytes:bme,hexToBytes:yh,hexToNumber:UP,inRange:tv,isBytes:Du,memoized:Rp,notImplemented:Pme,numberToBytesBE:wh,numberToBytesLE:Ap,numberToHexUnpadded:Vd,numberToVarBytesBE:xme,utf8ToBytes:_me,validateObject:Nh},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lr=BigInt(0),er=BigInt(1),uu=BigInt(2),Tme=BigInt(3),BE=BigInt(4),ZD=BigInt(5),QD=BigInt(8);function Xn(n,e){const t=n%e;return t>=Lr?t:e+t}function kme(n,e,t){if(e<Lr)throw new Error("invalid exponent, negatives unsupported");if(t<=Lr)throw new Error("invalid modulus");if(t===er)return Lr;let r=er;for(;e>Lr;)e&er&&(r=r*n%t),n=n*n%t,e>>=er;return r}function or(n,e,t){let r=n;for(;e-- >Lr;)r*=r,r%=t;return r}function FE(n,e){if(n===Lr)throw new Error("invert: expected non-zero number");if(e<=Lr)throw new Error("invert: expected positive modulus, got "+e);let t=Xn(n,e),r=e,i=Lr,s=er;for(;t!==Lr;){const a=r/t,c=r%t,u=i-s*a;r=t,t=c,i=s,s=u}if(r!==er)throw new Error("invert: does not exist");return Xn(i,e)}function Ame(n){const e=(n-er)/uu;let t,r,i;for(t=n-er,r=0;t%uu===Lr;t/=uu,r++);for(i=uu;i<n&&kme(i,e,n)!==n-er;i++)if(i>1e3)throw new Error("Cannot find square root: likely non-prime P");if(r===1){const o=(n+er)/BE;return function(c,u){const d=c.pow(u,o);if(!c.eql(c.sqr(d),u))throw new Error("Cannot find square root");return d}}const s=(t+er)/uu;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let u=r,d=a.pow(a.mul(a.ONE,i),t),f=a.pow(c,s),g=a.pow(c,t);for(;!a.eql(g,a.ONE);){if(a.eql(g,a.ZERO))return a.ZERO;let m=1;for(let w=a.sqr(g);m<u&&!a.eql(w,a.ONE);m++)w=a.sqr(w);const v=a.pow(d,er<<BigInt(u-m-1));d=a.sqr(v),f=a.mul(f,v),g=a.mul(g,d),u=m}return f}}function Rme(n){if(n%BE===Tme){const e=(n+er)/BE;return function(r,i){const s=r.pow(i,e);if(!r.eql(r.sqr(s),i))throw new Error("Cannot find square root");return s}}if(n%QD===ZD){const e=(n-ZD)/QD;return function(r,i){const s=r.mul(i,uu),o=r.pow(s,e),a=r.mul(i,o),c=r.mul(r.mul(a,uu),o),u=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(u),i))throw new Error("Cannot find square root");return u}}return Ame(n)}const jme=(n,e)=>(Xn(n,e)&er)===er,Dme=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Ome(n){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=Dme.reduce((r,i)=>(r[i]="function",r),e);return Nh(n,t)}function Lme(n,e,t){if(t<Lr)throw new Error("invalid exponent, negatives unsupported");if(t===Lr)return n.ONE;if(t===er)return e;let r=n.ONE,i=e;for(;t>Lr;)t&er&&(r=n.mul(r,i)),i=n.sqr(i),t>>=er;return r}function Nme(n,e){const t=new Array(e.length),r=e.reduce((s,o,a)=>n.is0(o)?s:(t[a]=s,n.mul(s,o)),n.ONE),i=n.inv(r);return e.reduceRight((s,o,a)=>n.is0(o)?s:(t[a]=n.mul(s,t[a]),n.mul(s,o)),i),t}function y9(n,e){const t=e!==void 0?e:n.toString(2).length,r=Math.ceil(t/8);return{nBitLength:t,nByteLength:r}}function nv(n,e,t=!1,r={}){if(n<=Lr)throw new Error("invalid field: expected ORDER > 0, got "+n);const{nBitLength:i,nByteLength:s}=y9(n,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:n,BITS:i,BYTES:s,MASK:$P(i),ZERO:Lr,ONE:er,create:c=>Xn(c,n),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Lr<=c&&c<n},is0:c=>c===Lr,isOdd:c=>(c&er)===er,neg:c=>Xn(-c,n),eql:(c,u)=>c===u,sqr:c=>Xn(c*c,n),add:(c,u)=>Xn(c+u,n),sub:(c,u)=>Xn(c-u,n),mul:(c,u)=>Xn(c*u,n),pow:(c,u)=>Lme(a,c,u),div:(c,u)=>Xn(c*FE(u,n),n),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>FE(c,n),sqrt:r.sqrt||(c=>(o||(o=Rme(n)),o(a,c))),invertBatch:c=>Nme(a,c),cmov:(c,u,d)=>d?u:c,toBytes:c=>t?Ap(c,s):wh(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?sh(c):xu(c)}});return Object.freeze(a)}function w9(n){if(typeof n!="bigint")throw new Error("field order must be bigint");const e=n.toString(2).length;return Math.ceil(e/8)}function v9(n){const e=w9(n);return e+Math.ceil(e/2)}function Bme(n,e,t=!1){const r=n.length,i=w9(e),s=v9(e);if(r<16||r<s||r>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+r);const o=t?xu(n):sh(n),a=Xn(o,e-er)+er;return t?Ap(a,i):wh(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const JD=BigInt(0),Jm=BigInt(1);function Xb(n,e){const t=e.negate();return n?t:e}function S9(n,e){if(!Number.isSafeInteger(n)||n<=0||n>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+n)}function Zb(n,e){S9(n,e);const t=Math.ceil(e/n)+1,r=2**(n-1);return{windows:t,windowSize:r}}function Fme(n,e){if(!Array.isArray(n))throw new Error("array expected");n.forEach((t,r)=>{if(!(t instanceof e))throw new Error("invalid point at index "+r)})}function zme(n,e){if(!Array.isArray(n))throw new Error("array of scalars expected");n.forEach((t,r)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+r)})}const Qb=new WeakMap,x9=new WeakMap;function Jb(n){return x9.get(n)||1}function b9(n,e){return{constTimeNegate:Xb,hasPrecomputes(t){return Jb(t)!==1},unsafeLadder(t,r,i=n.ZERO){let s=t;for(;r>JD;)r&Jm&&(i=i.add(s)),s=s.double(),r>>=Jm;return i},precomputeWindow(t,r){const{windows:i,windowSize:s}=Zb(r,e),o=[];let a=t,c=a;for(let u=0;u<i;u++){c=a,o.push(c);for(let d=1;d<s;d++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,r,i){const{windows:s,windowSize:o}=Zb(t,e);let a=n.ZERO,c=n.BASE;const u=BigInt(2**t-1),d=2**t,f=BigInt(t);for(let g=0;g<s;g++){const m=g*o;let v=Number(i&u);i>>=f,v>o&&(v-=d,i+=Jm);const w=m,S=m+Math.abs(v)-1,b=g%2!==0,x=v<0;v===0?c=c.add(Xb(b,r[w])):a=a.add(Xb(x,r[S]))}return{p:a,f:c}},wNAFUnsafe(t,r,i,s=n.ZERO){const{windows:o,windowSize:a}=Zb(t,e),c=BigInt(2**t-1),u=2**t,d=BigInt(t);for(let f=0;f<o;f++){const g=f*a;if(i===JD)break;let m=Number(i&c);if(i>>=d,m>a&&(m-=u,i+=Jm),m===0)continue;let v=r[g+Math.abs(m)-1];m<0&&(v=v.negate()),s=s.add(v)}return s},getPrecomputes(t,r,i){let s=Qb.get(r);return s||(s=this.precomputeWindow(r,t),t!==1&&Qb.set(r,i(s))),s},wNAFCached(t,r,i){const s=Jb(t);return this.wNAF(s,this.getPrecomputes(s,t,i),r)},wNAFCachedUnsafe(t,r,i,s){const o=Jb(t);return o===1?this.unsafeLadder(t,r,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),r,s)},setWindowSize(t,r){S9(r,e),x9.set(t,r),Qb.delete(t)}}}function _9(n,e,t,r){if(Fme(t,n),zme(r,e),t.length!==r.length)throw new Error("arrays of points and scalars must have equal length");const i=n.ZERO,s=g9(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(i),u=Math.floor((e.BITS-1)/o)*o;let d=i;for(let f=u;f>=0;f-=o){c.fill(i);for(let m=0;m<r.length;m++){const v=r[m],w=Number(v>>BigInt(f)&BigInt(a));c[w]=c[w].add(t[m])}let g=i;for(let m=c.length-1,v=i;m>0;m--)v=v.add(c[m]),g=g.add(v);if(d=d.add(g),f!==0)for(let m=0;m<o;m++)d=d.double()}return d}function HP(n){return Ome(n.Fp),Nh(n,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...y9(n.n,n.nBitLength),...n,p:n.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const wo=BigInt(0),Qi=BigInt(1),ey=BigInt(2),Ume=BigInt(8),$me={zip215:!0};function Hme(n){const e=HP(n);return Nh(n,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function Wme(n){const e=Hme(n),{Fp:t,n:r,prehash:i,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=ey<<BigInt(a*8)-Qi,d=t.create,f=nv(e.n,e.nBitLength),g=e.uvRatio||((O,W)=>{try{return{isValid:!0,value:t.sqrt(O*t.inv(W))}}catch{return{isValid:!1,value:wo}}}),m=e.adjustScalarBytes||(O=>O),v=e.domain||((O,W,q)=>{if(lc("phflag",q),W.length||q)throw new Error("Contexts/pre-hash are not supported");return O});function w(O,W){Xs("coordinate "+O,W,wo,u)}function S(O){if(!(O instanceof E))throw new Error("ExtendedPoint expected")}const b=Rp((O,W)=>{const{ex:q,ey:X,ez:ne}=O,$=O.is0();W==null&&(W=$?Ume:t.inv(ne));const C=d(q*W),R=d(X*W),Z=d(ne*W);if($)return{x:wo,y:Qi};if(Z!==Qi)throw new Error("invZ was invalid");return{x:C,y:R}}),x=Rp(O=>{const{a:W,d:q}=e;if(O.is0())throw new Error("bad point: ZERO");const{ex:X,ey:ne,ez:$,et:C}=O,R=d(X*X),Z=d(ne*ne),J=d($*$),oe=d(J*J),ue=d(R*W),fe=d(J*d(ue+Z)),_e=d(oe+d(q*d(R*Z)));if(fe!==_e)throw new Error("bad point: equation left != right (1)");const Le=d(X*ne),Ne=d($*C);if(Le!==Ne)throw new Error("bad point: equation left != right (2)");return!0});class E{constructor(W,q,X,ne){this.ex=W,this.ey=q,this.ez=X,this.et=ne,w("x",W),w("y",q),w("z",X),w("t",ne),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(W){if(W instanceof E)throw new Error("extended point not allowed");const{x:q,y:X}=W||{};return w("x",q),w("y",X),new E(q,X,Qi,d(q*X))}static normalizeZ(W){const q=t.invertBatch(W.map(X=>X.ez));return W.map((X,ne)=>X.toAffine(q[ne])).map(E.fromAffine)}static msm(W,q){return _9(E,f,W,q)}_setWindowSize(W){D.setWindowSize(this,W)}assertValidity(){x(this)}equals(W){S(W);const{ex:q,ey:X,ez:ne}=this,{ex:$,ey:C,ez:R}=W,Z=d(q*R),J=d($*ne),oe=d(X*R),ue=d(C*ne);return Z===J&&oe===ue}is0(){return this.equals(E.ZERO)}negate(){return new E(d(-this.ex),this.ey,this.ez,d(-this.et))}double(){const{a:W}=e,{ex:q,ey:X,ez:ne}=this,$=d(q*q),C=d(X*X),R=d(ey*d(ne*ne)),Z=d(W*$),J=q+X,oe=d(d(J*J)-$-C),ue=Z+C,fe=ue-R,_e=Z-C,Le=d(oe*fe),Ne=d(ue*_e),Ze=d(oe*_e),dt=d(fe*ue);return new E(Le,Ne,dt,Ze)}add(W){S(W);const{a:q,d:X}=e,{ex:ne,ey:$,ez:C,et:R}=this,{ex:Z,ey:J,ez:oe,et:ue}=W;if(q===BigInt(-1)){const At=d(($-ne)*(J+Z)),Et=d(($+ne)*(J-Z)),On=d(Et-At);if(On===wo)return this.double();const qt=d(C*ey*ue),tn=d(R*ey*oe),dr=tn+qt,nn=Et+At,te=tn-qt,F=d(dr*On),K=d(nn*te),Q=d(dr*te),re=d(On*nn);return new E(F,K,re,Q)}const fe=d(ne*Z),_e=d($*J),Le=d(R*X*ue),Ne=d(C*oe),Ze=d((ne+$)*(Z+J)-fe-_e),dt=Ne-Le,et=Ne+Le,Xe=d(_e-q*fe),Kt=d(Ze*dt),_t=d(et*Xe),Ut=d(Ze*Xe),ur=d(dt*et);return new E(Kt,_t,ur,Ut)}subtract(W){return this.add(W.negate())}wNAF(W){return D.wNAFCached(this,W,E.normalizeZ)}multiply(W){const q=W;Xs("scalar",q,Qi,r);const{p:X,f:ne}=this.wNAF(q);return E.normalizeZ([X,ne])[0]}multiplyUnsafe(W,q=E.ZERO){const X=W;return Xs("scalar",X,wo,r),X===wo?j:this.is0()||X===Qi?this:D.wNAFCachedUnsafe(this,X,E.normalizeZ,q)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return D.unsafeLadder(this,r).is0()}toAffine(W){return b(this,W)}clearCofactor(){const{h:W}=e;return W===Qi?this:this.multiplyUnsafe(W)}static fromHex(W,q=!1){const{d:X,a:ne}=e,$=t.BYTES;W=_r("pointHex",W,$),lc("zip215",q);const C=W.slice(),R=W[$-1];C[$-1]=R&-129;const Z=sh(C),J=q?u:t.ORDER;Xs("pointHex.y",Z,wo,J);const oe=d(Z*Z),ue=d(oe-Qi),fe=d(X*oe-ne);let{isValid:_e,value:Le}=g(ue,fe);if(!_e)throw new Error("Point.fromHex: invalid y coordinate");const Ne=(Le&Qi)===Qi,Ze=(R&128)!==0;if(!q&&Le===wo&&Ze)throw new Error("Point.fromHex: x=0 and x_0=1");return Ze!==Ne&&(Le=d(-Le)),E.fromAffine({x:Le,y:Z})}static fromPrivateKey(W){return U(W).point}toRawBytes(){const{x:W,y:q}=this.toAffine(),X=Ap(q,t.BYTES);return X[X.length-1]|=W&Qi?128:0,X}toHex(){return Ou(this.toRawBytes())}}E.BASE=new E(e.Gx,e.Gy,Qi,d(e.Gx*e.Gy)),E.ZERO=new E(wo,Qi,Qi,wo);const{BASE:M,ZERO:j}=E,D=b9(E,a*8);function H(O){return Xn(O,r)}function L(O){return H(sh(O))}function U(O){const W=t.BYTES;O=_r("private key",O,W);const q=_r("hashed private key",s(O),2*W),X=m(q.slice(0,W)),ne=q.slice(W,2*W),$=L(X),C=M.multiply($),R=C.toRawBytes();return{head:X,prefix:ne,scalar:$,point:C,pointBytes:R}}function z(O){return U(O).pointBytes}function Y(O=new Uint8Array,...W){const q=Lu(...W);return L(s(v(q,_r("context",O),!!i)))}function V(O,W,q={}){O=_r("message",O),i&&(O=i(O));const{prefix:X,scalar:ne,pointBytes:$}=U(W),C=Y(q.context,X,O),R=M.multiply(C).toRawBytes(),Z=Y(q.context,R,$,O),J=H(C+Z*ne);Xs("signature.s",J,wo,r);const oe=Lu(R,Ap(J,t.BYTES));return _r("result",oe,t.BYTES*2)}const N=$me;function _(O,W,q,X=N){const{context:ne,zip215:$}=X,C=t.BYTES;O=_r("signature",O,2*C),W=_r("message",W),q=_r("publicKey",q,C),$!==void 0&&lc("zip215",$),i&&(W=i(W));const R=sh(O.slice(C,2*C));let Z,J,oe;try{Z=E.fromHex(q,$),J=E.fromHex(O.slice(0,C),$),oe=M.multiplyUnsafe(R)}catch{return!1}if(!$&&Z.isSmallOrder())return!1;const ue=Y(ne,J.toRawBytes(),Z.toRawBytes(),W);return J.add(Z.multiplyUnsafe(ue)).subtract(oe).clearCofactor().equals(E.ZERO)}return M._setWindowSize(8),{CURVE:e,getPublicKey:z,sign:V,verify:_,ExtendedPoint:E,utils:{getExtendedPublicKey:U,randomPrivateKey:()=>o(t.BYTES),precompute(O=8,W=E.BASE){return W._setWindowSize(O),W.multiply(BigInt(3)),W}}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const WP=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),eO=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const Kme=BigInt(1),tO=BigInt(2);BigInt(3);const qme=BigInt(5),Gme=BigInt(8);function Vme(n){const e=BigInt(10),t=BigInt(20),r=BigInt(40),i=BigInt(80),s=WP,a=n*n%s*n%s,c=or(a,tO,s)*a%s,u=or(c,Kme,s)*n%s,d=or(u,qme,s)*u%s,f=or(d,e,s)*d%s,g=or(f,t,s)*f%s,m=or(g,r,s)*g%s,v=or(m,i,s)*m%s,w=or(v,i,s)*m%s,S=or(w,e,s)*d%s;return{pow_p_5_8:or(S,tO,s)*n%s,b2:a}}function Yme(n){return n[0]&=248,n[31]&=127,n[31]|=64,n}function Xme(n,e){const t=WP,r=Xn(e*e*e,t),i=Xn(r*r*e,t),s=Vme(n*i).pow_p_5_8;let o=Xn(n*r*s,t);const a=Xn(e*o*o,t),c=o,u=Xn(o*eO,t),d=a===n,f=a===Xn(-n,t),g=a===Xn(-n*eO,t);return d&&(o=c),(f||g)&&(o=u),jme(o,t)&&(o=Xn(-o,t)),{isValid:d||f,value:o}}const Zme=nv(WP,void 0,!0),Qme={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Zme,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:Gme,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:wme,randomBytes:h9,adjustScalarBytes:Yme,uvRatio:Xme},KP=Wme(Qme);var Uy={exports:{}};const Jme={},eye=Object.freeze(Object.defineProperty({__proto__:null,default:Jme},Symbol.toStringTag,{value:"Module"})),tye=lC(eye);var nye=Uy.exports,nO;function I9(){return nO||(nO=1,function(n){(function(e,t){function r(N,_){if(!N)throw new Error(_||"Assertion failed")}function i(N,_){N.super_=_;var k=function(){};k.prototype=_.prototype,N.prototype=new k,N.prototype.constructor=N}function s(N,_,k){if(s.isBN(N))return N;this.negative=0,this.words=null,this.length=0,this.red=null,N!==null&&((_==="le"||_==="be")&&(k=_,_=10),this._init(N||0,_||10,k||"be"))}typeof e=="object"?e.exports=s:t.BN=s,s.BN=s,s.wordSize=26;var o;try{typeof window<"u"&&typeof window.Buffer<"u"?o=window.Buffer:o=tye.Buffer}catch{}s.isBN=function(_){return _ instanceof s?!0:_!==null&&typeof _=="object"&&_.constructor.wordSize===s.wordSize&&Array.isArray(_.words)},s.max=function(_,k){return _.cmp(k)>0?_:k},s.min=function(_,k){return _.cmp(k)<0?_:k},s.prototype._init=function(_,k,O){if(typeof _=="number")return this._initNumber(_,k,O);if(typeof _=="object")return this._initArray(_,k,O);k==="hex"&&(k=16),r(k===(k|0)&&k>=2&&k<=36),_=_.toString().replace(/\s+/g,"");var W=0;_[0]==="-"&&(W++,this.negative=1),W<_.length&&(k===16?this._parseHex(_,W,O):(this._parseBase(_,k,W),O==="le"&&this._initArray(this.toArray(),k,O)))},s.prototype._initNumber=function(_,k,O){_<0&&(this.negative=1,_=-_),_<67108864?(this.words=[_&67108863],this.length=1):_<4503599627370496?(this.words=[_&67108863,_/67108864&67108863],this.length=2):(r(_<9007199254740992),this.words=[_&67108863,_/67108864&67108863,1],this.length=3),O==="le"&&this._initArray(this.toArray(),k,O)},s.prototype._initArray=function(_,k,O){if(r(typeof _.length=="number"),_.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(_.length/3),this.words=new Array(this.length);for(var W=0;W<this.length;W++)this.words[W]=0;var q,X,ne=0;if(O==="be")for(W=_.length-1,q=0;W>=0;W-=3)X=_[W]|_[W-1]<<8|_[W-2]<<16,this.words[q]|=X<<ne&67108863,this.words[q+1]=X>>>26-ne&67108863,ne+=24,ne>=26&&(ne-=26,q++);else if(O==="le")for(W=0,q=0;W<_.length;W+=3)X=_[W]|_[W+1]<<8|_[W+2]<<16,this.words[q]|=X<<ne&67108863,this.words[q+1]=X>>>26-ne&67108863,ne+=24,ne>=26&&(ne-=26,q++);return this._strip()};function a(N,_){var k=N.charCodeAt(_);if(k>=48&&k<=57)return k-48;if(k>=65&&k<=70)return k-55;if(k>=97&&k<=102)return k-87;r(!1,"Invalid character in "+N)}function c(N,_,k){var O=a(N,k);return k-1>=_&&(O|=a(N,k-1)<<4),O}s.prototype._parseHex=function(_,k,O){this.length=Math.ceil((_.length-k)/6),this.words=new Array(this.length);for(var W=0;W<this.length;W++)this.words[W]=0;var q=0,X=0,ne;if(O==="be")for(W=_.length-1;W>=k;W-=2)ne=c(_,k,W)<<q,this.words[X]|=ne&67108863,q>=18?(q-=18,X+=1,this.words[X]|=ne>>>26):q+=8;else{var $=_.length-k;for(W=$%2===0?k+1:k;W<_.length;W+=2)ne=c(_,k,W)<<q,this.words[X]|=ne&67108863,q>=18?(q-=18,X+=1,this.words[X]|=ne>>>26):q+=8}this._strip()};function u(N,_,k,O){for(var W=0,q=0,X=Math.min(N.length,k),ne=_;ne<X;ne++){var $=N.charCodeAt(ne)-48;W*=O,$>=49?q=$-49+10:$>=17?q=$-17+10:q=$,r($>=0&&q<O,"Invalid character"),W+=q}return W}s.prototype._parseBase=function(_,k,O){this.words=[0],this.length=1;for(var W=0,q=1;q<=67108863;q*=k)W++;W--,q=q/k|0;for(var X=_.length-O,ne=X%W,$=Math.min(X,X-ne)+O,C=0,R=O;R<$;R+=W)C=u(_,R,R+W,k),this.imuln(q),this.words[0]+C<67108864?this.words[0]+=C:this._iaddn(C);if(ne!==0){var Z=1;for(C=u(_,R,_.length,k),R=0;R<ne;R++)Z*=k;this.imuln(Z),this.words[0]+C<67108864?this.words[0]+=C:this._iaddn(C)}this._strip()},s.prototype.copy=function(_){_.words=new Array(this.length);for(var k=0;k<this.length;k++)_.words[k]=this.words[k];_.length=this.length,_.negative=this.negative,_.red=this.red};function d(N,_){N.words=_.words,N.length=_.length,N.negative=_.negative,N.red=_.red}if(s.prototype._move=function(_){d(_,this)},s.prototype.clone=function(){var _=new s(null);return this.copy(_),_},s.prototype._expand=function(_){for(;this.length<_;)this.words[this.length++]=0;return this},s.prototype._strip=function(){for(;this.length>1&&this.words[this.length-1]===0;)this.length--;return this._normSign()},s.prototype._normSign=function(){return this.length===1&&this.words[0]===0&&(this.negative=0),this},typeof Symbol<"u"&&typeof Symbol.for=="function")try{s.prototype[Symbol.for("nodejs.util.inspect.custom")]=f}catch{s.prototype.inspect=f}else s.prototype.inspect=f;function f(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}var g=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],m=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],v=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];s.prototype.toString=function(_,k){_=_||10,k=k|0||1;var O;if(_===16||_==="hex"){O="";for(var W=0,q=0,X=0;X<this.length;X++){var ne=this.words[X],$=((ne<<W|q)&16777215).toString(16);q=ne>>>24-W&16777215,W+=2,W>=26&&(W-=26,X--),q!==0||X!==this.length-1?O=g[6-$.length]+$+O:O=$+O}for(q!==0&&(O=q.toString(16)+O);O.length%k!==0;)O="0"+O;return this.negative!==0&&(O="-"+O),O}if(_===(_|0)&&_>=2&&_<=36){var C=m[_],R=v[_];O="";var Z=this.clone();for(Z.negative=0;!Z.isZero();){var J=Z.modrn(R).toString(_);Z=Z.idivn(R),Z.isZero()?O=J+O:O=g[C-J.length]+J+O}for(this.isZero()&&(O="0"+O);O.length%k!==0;)O="0"+O;return this.negative!==0&&(O="-"+O),O}r(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var _=this.words[0];return this.length===2?_+=this.words[1]*67108864:this.length===3&&this.words[2]===1?_+=4503599627370496+this.words[1]*67108864:this.length>2&&r(!1,"Number can only safely store up to 53 bits"),this.negative!==0?-_:_},s.prototype.toJSON=function(){return this.toString(16,2)},o&&(s.prototype.toBuffer=function(_,k){return this.toArrayLike(o,_,k)}),s.prototype.toArray=function(_,k){return this.toArrayLike(Array,_,k)};var w=function(_,k){return _.allocUnsafe?_.allocUnsafe(k):new _(k)};s.prototype.toArrayLike=function(_,k,O){this._strip();var W=this.byteLength(),q=O||Math.max(1,W);r(W<=q,"byte array longer than desired length"),r(q>0,"Requested array length <= 0");var X=w(_,q),ne=k==="le"?"LE":"BE";return this["_toArrayLike"+ne](X,W),X},s.prototype._toArrayLikeLE=function(_,k){for(var O=0,W=0,q=0,X=0;q<this.length;q++){var ne=this.words[q]<<X|W;_[O++]=ne&255,O<_.length&&(_[O++]=ne>>8&255),O<_.length&&(_[O++]=ne>>16&255),X===6?(O<_.length&&(_[O++]=ne>>24&255),W=0,X=0):(W=ne>>>24,X+=2)}if(O<_.length)for(_[O++]=W;O<_.length;)_[O++]=0},s.prototype._toArrayLikeBE=function(_,k){for(var O=_.length-1,W=0,q=0,X=0;q<this.length;q++){var ne=this.words[q]<<X|W;_[O--]=ne&255,O>=0&&(_[O--]=ne>>8&255),O>=0&&(_[O--]=ne>>16&255),X===6?(O>=0&&(_[O--]=ne>>24&255),W=0,X=0):(W=ne>>>24,X+=2)}if(O>=0)for(_[O--]=W;O>=0;)_[O--]=0},Math.clz32?s.prototype._countBits=function(_){return 32-Math.clz32(_)}:s.prototype._countBits=function(_){var k=_,O=0;return k>=4096&&(O+=13,k>>>=13),k>=64&&(O+=7,k>>>=7),k>=8&&(O+=4,k>>>=4),k>=2&&(O+=2,k>>>=2),O+k},s.prototype._zeroBits=function(_){if(_===0)return 26;var k=_,O=0;return k&8191||(O+=13,k>>>=13),k&127||(O+=7,k>>>=7),k&15||(O+=4,k>>>=4),k&3||(O+=2,k>>>=2),k&1||O++,O},s.prototype.bitLength=function(){var _=this.words[this.length-1],k=this._countBits(_);return(this.length-1)*26+k};function S(N){for(var _=new Array(N.bitLength()),k=0;k<_.length;k++){var O=k/26|0,W=k%26;_[k]=N.words[O]>>>W&1}return _}s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var _=0,k=0;k<this.length;k++){var O=this._zeroBits(this.words[k]);if(_+=O,O!==26)break}return _},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(_){return this.negative!==0?this.abs().inotn(_).iaddn(1):this.clone()},s.prototype.fromTwos=function(_){return this.testn(_-1)?this.notn(_).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return this.negative!==0},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(_){for(;this.length<_.length;)this.words[this.length++]=0;for(var k=0;k<_.length;k++)this.words[k]=this.words[k]|_.words[k];return this._strip()},s.prototype.ior=function(_){return r((this.negative|_.negative)===0),this.iuor(_)},s.prototype.or=function(_){return this.length>_.length?this.clone().ior(_):_.clone().ior(this)},s.prototype.uor=function(_){return this.length>_.length?this.clone().iuor(_):_.clone().iuor(this)},s.prototype.iuand=function(_){var k;this.length>_.length?k=_:k=this;for(var O=0;O<k.length;O++)this.words[O]=this.words[O]&_.words[O];return this.length=k.length,this._strip()},s.prototype.iand=function(_){return r((this.negative|_.negative)===0),this.iuand(_)},s.prototype.and=function(_){return this.length>_.length?this.clone().iand(_):_.clone().iand(this)},s.prototype.uand=function(_){return this.length>_.length?this.clone().iuand(_):_.clone().iuand(this)},s.prototype.iuxor=function(_){var k,O;this.length>_.length?(k=this,O=_):(k=_,O=this);for(var W=0;W<O.length;W++)this.words[W]=k.words[W]^O.words[W];if(this!==k)for(;W<k.length;W++)this.words[W]=k.words[W];return this.length=k.length,this._strip()},s.prototype.ixor=function(_){return r((this.negative|_.negative)===0),this.iuxor(_)},s.prototype.xor=function(_){return this.length>_.length?this.clone().ixor(_):_.clone().ixor(this)},s.prototype.uxor=function(_){return this.length>_.length?this.clone().iuxor(_):_.clone().iuxor(this)},s.prototype.inotn=function(_){r(typeof _=="number"&&_>=0);var k=Math.ceil(_/26)|0,O=_%26;this._expand(k),O>0&&k--;for(var W=0;W<k;W++)this.words[W]=~this.words[W]&67108863;return O>0&&(this.words[W]=~this.words[W]&67108863>>26-O),this._strip()},s.prototype.notn=function(_){return this.clone().inotn(_)},s.prototype.setn=function(_,k){r(typeof _=="number"&&_>=0);var O=_/26|0,W=_%26;return this._expand(O+1),k?this.words[O]=this.words[O]|1<<W:this.words[O]=this.words[O]&~(1<<W),this._strip()},s.prototype.iadd=function(_){var k;if(this.negative!==0&&_.negative===0)return this.negative=0,k=this.isub(_),this.negative^=1,this._normSign();if(this.negative===0&&_.negative!==0)return _.negative=0,k=this.isub(_),_.negative=1,k._normSign();var O,W;this.length>_.length?(O=this,W=_):(O=_,W=this);for(var q=0,X=0;X<W.length;X++)k=(O.words[X]|0)+(W.words[X]|0)+q,this.words[X]=k&67108863,q=k>>>26;for(;q!==0&&X<O.length;X++)k=(O.words[X]|0)+q,this.words[X]=k&67108863,q=k>>>26;if(this.length=O.length,q!==0)this.words[this.length]=q,this.length++;else if(O!==this)for(;X<O.length;X++)this.words[X]=O.words[X];return this},s.prototype.add=function(_){var k;return _.negative!==0&&this.negative===0?(_.negative=0,k=this.sub(_),_.negative^=1,k):_.negative===0&&this.negative!==0?(this.negative=0,k=_.sub(this),this.negative=1,k):this.length>_.length?this.clone().iadd(_):_.clone().iadd(this)},s.prototype.isub=function(_){if(_.negative!==0){_.negative=0;var k=this.iadd(_);return _.negative=1,k._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(_),this.negative=1,this._normSign();var O=this.cmp(_);if(O===0)return this.negative=0,this.length=1,this.words[0]=0,this;var W,q;O>0?(W=this,q=_):(W=_,q=this);for(var X=0,ne=0;ne<q.length;ne++)k=(W.words[ne]|0)-(q.words[ne]|0)+X,X=k>>26,this.words[ne]=k&67108863;for(;X!==0&&ne<W.length;ne++)k=(W.words[ne]|0)+X,X=k>>26,this.words[ne]=k&67108863;if(X===0&&ne<W.length&&W!==this)for(;ne<W.length;ne++)this.words[ne]=W.words[ne];return this.length=Math.max(this.length,ne),W!==this&&(this.negative=1),this._strip()},s.prototype.sub=function(_){return this.clone().isub(_)};function b(N,_,k){k.negative=_.negative^N.negative;var O=N.length+_.length|0;k.length=O,O=O-1|0;var W=N.words[0]|0,q=_.words[0]|0,X=W*q,ne=X&67108863,$=X/67108864|0;k.words[0]=ne;for(var C=1;C<O;C++){for(var R=$>>>26,Z=$&67108863,J=Math.min(C,_.length-1),oe=Math.max(0,C-N.length+1);oe<=J;oe++){var ue=C-oe|0;W=N.words[ue]|0,q=_.words[oe]|0,X=W*q+Z,R+=X/67108864|0,Z=X&67108863}k.words[C]=Z|0,$=R|0}return $!==0?k.words[C]=$|0:k.length--,k._strip()}var x=function(_,k,O){var W=_.words,q=k.words,X=O.words,ne=0,$,C,R,Z=W[0]|0,J=Z&8191,oe=Z>>>13,ue=W[1]|0,fe=ue&8191,_e=ue>>>13,Le=W[2]|0,Ne=Le&8191,Ze=Le>>>13,dt=W[3]|0,et=dt&8191,Xe=dt>>>13,Kt=W[4]|0,_t=Kt&8191,Ut=Kt>>>13,ur=W[5]|0,At=ur&8191,Et=ur>>>13,On=W[6]|0,qt=On&8191,tn=On>>>13,dr=W[7]|0,nn=dr&8191,te=dr>>>13,F=W[8]|0,K=F&8191,Q=F>>>13,re=W[9]|0,ce=re&8191,ye=re>>>13,ut=q[0]|0,st=ut&8191,at=ut>>>13,Rt=q[1]|0,Qe=Rt&8191,$t=Rt>>>13,ii=q[2]|0,Ht=ii&8191,rn=ii>>>13,Ma=q[3]|0,dn=Ma&8191,vn=Ma>>>13,Ta=q[4]|0,Sn=Ta&8191,ln=Ta>>>13,jl=q[5]|0,mn=jl&8191,En=jl>>>13,$o=q[6]|0,Hn=$o&8191,hn=$o>>>13,oo=q[7]|0,Yt=oo&8191,Cn=oo>>>13,Zu=q[8]|0,Wn=Zu&8191,Kn=Zu>>>13,Bs=q[9]|0,Xt=Bs&8191,Ln=Bs>>>13;O.negative=_.negative^k.negative,O.length=19,$=Math.imul(J,st),C=Math.imul(J,at),C=C+Math.imul(oe,st)|0,R=Math.imul(oe,at);var Dl=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Dl>>>26)|0,Dl&=67108863,$=Math.imul(fe,st),C=Math.imul(fe,at),C=C+Math.imul(_e,st)|0,R=Math.imul(_e,at),$=$+Math.imul(J,Qe)|0,C=C+Math.imul(J,$t)|0,C=C+Math.imul(oe,Qe)|0,R=R+Math.imul(oe,$t)|0;var xc=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(xc>>>26)|0,xc&=67108863,$=Math.imul(Ne,st),C=Math.imul(Ne,at),C=C+Math.imul(Ze,st)|0,R=Math.imul(Ze,at),$=$+Math.imul(fe,Qe)|0,C=C+Math.imul(fe,$t)|0,C=C+Math.imul(_e,Qe)|0,R=R+Math.imul(_e,$t)|0,$=$+Math.imul(J,Ht)|0,C=C+Math.imul(J,rn)|0,C=C+Math.imul(oe,Ht)|0,R=R+Math.imul(oe,rn)|0;var bc=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(bc>>>26)|0,bc&=67108863,$=Math.imul(et,st),C=Math.imul(et,at),C=C+Math.imul(Xe,st)|0,R=Math.imul(Xe,at),$=$+Math.imul(Ne,Qe)|0,C=C+Math.imul(Ne,$t)|0,C=C+Math.imul(Ze,Qe)|0,R=R+Math.imul(Ze,$t)|0,$=$+Math.imul(fe,Ht)|0,C=C+Math.imul(fe,rn)|0,C=C+Math.imul(_e,Ht)|0,R=R+Math.imul(_e,rn)|0,$=$+Math.imul(J,dn)|0,C=C+Math.imul(J,vn)|0,C=C+Math.imul(oe,dn)|0,R=R+Math.imul(oe,vn)|0;var _c=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(_c>>>26)|0,_c&=67108863,$=Math.imul(_t,st),C=Math.imul(_t,at),C=C+Math.imul(Ut,st)|0,R=Math.imul(Ut,at),$=$+Math.imul(et,Qe)|0,C=C+Math.imul(et,$t)|0,C=C+Math.imul(Xe,Qe)|0,R=R+Math.imul(Xe,$t)|0,$=$+Math.imul(Ne,Ht)|0,C=C+Math.imul(Ne,rn)|0,C=C+Math.imul(Ze,Ht)|0,R=R+Math.imul(Ze,rn)|0,$=$+Math.imul(fe,dn)|0,C=C+Math.imul(fe,vn)|0,C=C+Math.imul(_e,dn)|0,R=R+Math.imul(_e,vn)|0,$=$+Math.imul(J,Sn)|0,C=C+Math.imul(J,ln)|0,C=C+Math.imul(oe,Sn)|0,R=R+Math.imul(oe,ln)|0;var Wi=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Wi>>>26)|0,Wi&=67108863,$=Math.imul(At,st),C=Math.imul(At,at),C=C+Math.imul(Et,st)|0,R=Math.imul(Et,at),$=$+Math.imul(_t,Qe)|0,C=C+Math.imul(_t,$t)|0,C=C+Math.imul(Ut,Qe)|0,R=R+Math.imul(Ut,$t)|0,$=$+Math.imul(et,Ht)|0,C=C+Math.imul(et,rn)|0,C=C+Math.imul(Xe,Ht)|0,R=R+Math.imul(Xe,rn)|0,$=$+Math.imul(Ne,dn)|0,C=C+Math.imul(Ne,vn)|0,C=C+Math.imul(Ze,dn)|0,R=R+Math.imul(Ze,vn)|0,$=$+Math.imul(fe,Sn)|0,C=C+Math.imul(fe,ln)|0,C=C+Math.imul(_e,Sn)|0,R=R+Math.imul(_e,ln)|0,$=$+Math.imul(J,mn)|0,C=C+Math.imul(J,En)|0,C=C+Math.imul(oe,mn)|0,R=R+Math.imul(oe,En)|0;var Ol=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Ol>>>26)|0,Ol&=67108863,$=Math.imul(qt,st),C=Math.imul(qt,at),C=C+Math.imul(tn,st)|0,R=Math.imul(tn,at),$=$+Math.imul(At,Qe)|0,C=C+Math.imul(At,$t)|0,C=C+Math.imul(Et,Qe)|0,R=R+Math.imul(Et,$t)|0,$=$+Math.imul(_t,Ht)|0,C=C+Math.imul(_t,rn)|0,C=C+Math.imul(Ut,Ht)|0,R=R+Math.imul(Ut,rn)|0,$=$+Math.imul(et,dn)|0,C=C+Math.imul(et,vn)|0,C=C+Math.imul(Xe,dn)|0,R=R+Math.imul(Xe,vn)|0,$=$+Math.imul(Ne,Sn)|0,C=C+Math.imul(Ne,ln)|0,C=C+Math.imul(Ze,Sn)|0,R=R+Math.imul(Ze,ln)|0,$=$+Math.imul(fe,mn)|0,C=C+Math.imul(fe,En)|0,C=C+Math.imul(_e,mn)|0,R=R+Math.imul(_e,En)|0,$=$+Math.imul(J,Hn)|0,C=C+Math.imul(J,hn)|0,C=C+Math.imul(oe,Hn)|0,R=R+Math.imul(oe,hn)|0;var Ll=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Ll>>>26)|0,Ll&=67108863,$=Math.imul(nn,st),C=Math.imul(nn,at),C=C+Math.imul(te,st)|0,R=Math.imul(te,at),$=$+Math.imul(qt,Qe)|0,C=C+Math.imul(qt,$t)|0,C=C+Math.imul(tn,Qe)|0,R=R+Math.imul(tn,$t)|0,$=$+Math.imul(At,Ht)|0,C=C+Math.imul(At,rn)|0,C=C+Math.imul(Et,Ht)|0,R=R+Math.imul(Et,rn)|0,$=$+Math.imul(_t,dn)|0,C=C+Math.imul(_t,vn)|0,C=C+Math.imul(Ut,dn)|0,R=R+Math.imul(Ut,vn)|0,$=$+Math.imul(et,Sn)|0,C=C+Math.imul(et,ln)|0,C=C+Math.imul(Xe,Sn)|0,R=R+Math.imul(Xe,ln)|0,$=$+Math.imul(Ne,mn)|0,C=C+Math.imul(Ne,En)|0,C=C+Math.imul(Ze,mn)|0,R=R+Math.imul(Ze,En)|0,$=$+Math.imul(fe,Hn)|0,C=C+Math.imul(fe,hn)|0,C=C+Math.imul(_e,Hn)|0,R=R+Math.imul(_e,hn)|0,$=$+Math.imul(J,Yt)|0,C=C+Math.imul(J,Cn)|0,C=C+Math.imul(oe,Yt)|0,R=R+Math.imul(oe,Cn)|0;var xn=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(xn>>>26)|0,xn&=67108863,$=Math.imul(K,st),C=Math.imul(K,at),C=C+Math.imul(Q,st)|0,R=Math.imul(Q,at),$=$+Math.imul(nn,Qe)|0,C=C+Math.imul(nn,$t)|0,C=C+Math.imul(te,Qe)|0,R=R+Math.imul(te,$t)|0,$=$+Math.imul(qt,Ht)|0,C=C+Math.imul(qt,rn)|0,C=C+Math.imul(tn,Ht)|0,R=R+Math.imul(tn,rn)|0,$=$+Math.imul(At,dn)|0,C=C+Math.imul(At,vn)|0,C=C+Math.imul(Et,dn)|0,R=R+Math.imul(Et,vn)|0,$=$+Math.imul(_t,Sn)|0,C=C+Math.imul(_t,ln)|0,C=C+Math.imul(Ut,Sn)|0,R=R+Math.imul(Ut,ln)|0,$=$+Math.imul(et,mn)|0,C=C+Math.imul(et,En)|0,C=C+Math.imul(Xe,mn)|0,R=R+Math.imul(Xe,En)|0,$=$+Math.imul(Ne,Hn)|0,C=C+Math.imul(Ne,hn)|0,C=C+Math.imul(Ze,Hn)|0,R=R+Math.imul(Ze,hn)|0,$=$+Math.imul(fe,Yt)|0,C=C+Math.imul(fe,Cn)|0,C=C+Math.imul(_e,Yt)|0,R=R+Math.imul(_e,Cn)|0,$=$+Math.imul(J,Wn)|0,C=C+Math.imul(J,Kn)|0,C=C+Math.imul(oe,Wn)|0,R=R+Math.imul(oe,Kn)|0;var Nl=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Nl>>>26)|0,Nl&=67108863,$=Math.imul(ce,st),C=Math.imul(ce,at),C=C+Math.imul(ye,st)|0,R=Math.imul(ye,at),$=$+Math.imul(K,Qe)|0,C=C+Math.imul(K,$t)|0,C=C+Math.imul(Q,Qe)|0,R=R+Math.imul(Q,$t)|0,$=$+Math.imul(nn,Ht)|0,C=C+Math.imul(nn,rn)|0,C=C+Math.imul(te,Ht)|0,R=R+Math.imul(te,rn)|0,$=$+Math.imul(qt,dn)|0,C=C+Math.imul(qt,vn)|0,C=C+Math.imul(tn,dn)|0,R=R+Math.imul(tn,vn)|0,$=$+Math.imul(At,Sn)|0,C=C+Math.imul(At,ln)|0,C=C+Math.imul(Et,Sn)|0,R=R+Math.imul(Et,ln)|0,$=$+Math.imul(_t,mn)|0,C=C+Math.imul(_t,En)|0,C=C+Math.imul(Ut,mn)|0,R=R+Math.imul(Ut,En)|0,$=$+Math.imul(et,Hn)|0,C=C+Math.imul(et,hn)|0,C=C+Math.imul(Xe,Hn)|0,R=R+Math.imul(Xe,hn)|0,$=$+Math.imul(Ne,Yt)|0,C=C+Math.imul(Ne,Cn)|0,C=C+Math.imul(Ze,Yt)|0,R=R+Math.imul(Ze,Cn)|0,$=$+Math.imul(fe,Wn)|0,C=C+Math.imul(fe,Kn)|0,C=C+Math.imul(_e,Wn)|0,R=R+Math.imul(_e,Kn)|0,$=$+Math.imul(J,Xt)|0,C=C+Math.imul(J,Ln)|0,C=C+Math.imul(oe,Xt)|0,R=R+Math.imul(oe,Ln)|0;var ka=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(ka>>>26)|0,ka&=67108863,$=Math.imul(ce,Qe),C=Math.imul(ce,$t),C=C+Math.imul(ye,Qe)|0,R=Math.imul(ye,$t),$=$+Math.imul(K,Ht)|0,C=C+Math.imul(K,rn)|0,C=C+Math.imul(Q,Ht)|0,R=R+Math.imul(Q,rn)|0,$=$+Math.imul(nn,dn)|0,C=C+Math.imul(nn,vn)|0,C=C+Math.imul(te,dn)|0,R=R+Math.imul(te,vn)|0,$=$+Math.imul(qt,Sn)|0,C=C+Math.imul(qt,ln)|0,C=C+Math.imul(tn,Sn)|0,R=R+Math.imul(tn,ln)|0,$=$+Math.imul(At,mn)|0,C=C+Math.imul(At,En)|0,C=C+Math.imul(Et,mn)|0,R=R+Math.imul(Et,En)|0,$=$+Math.imul(_t,Hn)|0,C=C+Math.imul(_t,hn)|0,C=C+Math.imul(Ut,Hn)|0,R=R+Math.imul(Ut,hn)|0,$=$+Math.imul(et,Yt)|0,C=C+Math.imul(et,Cn)|0,C=C+Math.imul(Xe,Yt)|0,R=R+Math.imul(Xe,Cn)|0,$=$+Math.imul(Ne,Wn)|0,C=C+Math.imul(Ne,Kn)|0,C=C+Math.imul(Ze,Wn)|0,R=R+Math.imul(Ze,Kn)|0,$=$+Math.imul(fe,Xt)|0,C=C+Math.imul(fe,Ln)|0,C=C+Math.imul(_e,Xt)|0,R=R+Math.imul(_e,Ln)|0;var ao=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(ao>>>26)|0,ao&=67108863,$=Math.imul(ce,Ht),C=Math.imul(ce,rn),C=C+Math.imul(ye,Ht)|0,R=Math.imul(ye,rn),$=$+Math.imul(K,dn)|0,C=C+Math.imul(K,vn)|0,C=C+Math.imul(Q,dn)|0,R=R+Math.imul(Q,vn)|0,$=$+Math.imul(nn,Sn)|0,C=C+Math.imul(nn,ln)|0,C=C+Math.imul(te,Sn)|0,R=R+Math.imul(te,ln)|0,$=$+Math.imul(qt,mn)|0,C=C+Math.imul(qt,En)|0,C=C+Math.imul(tn,mn)|0,R=R+Math.imul(tn,En)|0,$=$+Math.imul(At,Hn)|0,C=C+Math.imul(At,hn)|0,C=C+Math.imul(Et,Hn)|0,R=R+Math.imul(Et,hn)|0,$=$+Math.imul(_t,Yt)|0,C=C+Math.imul(_t,Cn)|0,C=C+Math.imul(Ut,Yt)|0,R=R+Math.imul(Ut,Cn)|0,$=$+Math.imul(et,Wn)|0,C=C+Math.imul(et,Kn)|0,C=C+Math.imul(Xe,Wn)|0,R=R+Math.imul(Xe,Kn)|0,$=$+Math.imul(Ne,Xt)|0,C=C+Math.imul(Ne,Ln)|0,C=C+Math.imul(Ze,Xt)|0,R=R+Math.imul(Ze,Ln)|0;var Ho=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Ho>>>26)|0,Ho&=67108863,$=Math.imul(ce,dn),C=Math.imul(ce,vn),C=C+Math.imul(ye,dn)|0,R=Math.imul(ye,vn),$=$+Math.imul(K,Sn)|0,C=C+Math.imul(K,ln)|0,C=C+Math.imul(Q,Sn)|0,R=R+Math.imul(Q,ln)|0,$=$+Math.imul(nn,mn)|0,C=C+Math.imul(nn,En)|0,C=C+Math.imul(te,mn)|0,R=R+Math.imul(te,En)|0,$=$+Math.imul(qt,Hn)|0,C=C+Math.imul(qt,hn)|0,C=C+Math.imul(tn,Hn)|0,R=R+Math.imul(tn,hn)|0,$=$+Math.imul(At,Yt)|0,C=C+Math.imul(At,Cn)|0,C=C+Math.imul(Et,Yt)|0,R=R+Math.imul(Et,Cn)|0,$=$+Math.imul(_t,Wn)|0,C=C+Math.imul(_t,Kn)|0,C=C+Math.imul(Ut,Wn)|0,R=R+Math.imul(Ut,Kn)|0,$=$+Math.imul(et,Xt)|0,C=C+Math.imul(et,Ln)|0,C=C+Math.imul(Xe,Xt)|0,R=R+Math.imul(Xe,Ln)|0;var Bl=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Bl>>>26)|0,Bl&=67108863,$=Math.imul(ce,Sn),C=Math.imul(ce,ln),C=C+Math.imul(ye,Sn)|0,R=Math.imul(ye,ln),$=$+Math.imul(K,mn)|0,C=C+Math.imul(K,En)|0,C=C+Math.imul(Q,mn)|0,R=R+Math.imul(Q,En)|0,$=$+Math.imul(nn,Hn)|0,C=C+Math.imul(nn,hn)|0,C=C+Math.imul(te,Hn)|0,R=R+Math.imul(te,hn)|0,$=$+Math.imul(qt,Yt)|0,C=C+Math.imul(qt,Cn)|0,C=C+Math.imul(tn,Yt)|0,R=R+Math.imul(tn,Cn)|0,$=$+Math.imul(At,Wn)|0,C=C+Math.imul(At,Kn)|0,C=C+Math.imul(Et,Wn)|0,R=R+Math.imul(Et,Kn)|0,$=$+Math.imul(_t,Xt)|0,C=C+Math.imul(_t,Ln)|0,C=C+Math.imul(Ut,Xt)|0,R=R+Math.imul(Ut,Ln)|0;var Ai=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Ai>>>26)|0,Ai&=67108863,$=Math.imul(ce,mn),C=Math.imul(ce,En),C=C+Math.imul(ye,mn)|0,R=Math.imul(ye,En),$=$+Math.imul(K,Hn)|0,C=C+Math.imul(K,hn)|0,C=C+Math.imul(Q,Hn)|0,R=R+Math.imul(Q,hn)|0,$=$+Math.imul(nn,Yt)|0,C=C+Math.imul(nn,Cn)|0,C=C+Math.imul(te,Yt)|0,R=R+Math.imul(te,Cn)|0,$=$+Math.imul(qt,Wn)|0,C=C+Math.imul(qt,Kn)|0,C=C+Math.imul(tn,Wn)|0,R=R+Math.imul(tn,Kn)|0,$=$+Math.imul(At,Xt)|0,C=C+Math.imul(At,Ln)|0,C=C+Math.imul(Et,Xt)|0,R=R+Math.imul(Et,Ln)|0;var Wo=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Wo>>>26)|0,Wo&=67108863,$=Math.imul(ce,Hn),C=Math.imul(ce,hn),C=C+Math.imul(ye,Hn)|0,R=Math.imul(ye,hn),$=$+Math.imul(K,Yt)|0,C=C+Math.imul(K,Cn)|0,C=C+Math.imul(Q,Yt)|0,R=R+Math.imul(Q,Cn)|0,$=$+Math.imul(nn,Wn)|0,C=C+Math.imul(nn,Kn)|0,C=C+Math.imul(te,Wn)|0,R=R+Math.imul(te,Kn)|0,$=$+Math.imul(qt,Xt)|0,C=C+Math.imul(qt,Ln)|0,C=C+Math.imul(tn,Xt)|0,R=R+Math.imul(tn,Ln)|0;var si=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(si>>>26)|0,si&=67108863,$=Math.imul(ce,Yt),C=Math.imul(ce,Cn),C=C+Math.imul(ye,Yt)|0,R=Math.imul(ye,Cn),$=$+Math.imul(K,Wn)|0,C=C+Math.imul(K,Kn)|0,C=C+Math.imul(Q,Wn)|0,R=R+Math.imul(Q,Kn)|0,$=$+Math.imul(nn,Xt)|0,C=C+Math.imul(nn,Ln)|0,C=C+Math.imul(te,Xt)|0,R=R+Math.imul(te,Ln)|0;var Fl=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Fl>>>26)|0,Fl&=67108863,$=Math.imul(ce,Wn),C=Math.imul(ce,Kn),C=C+Math.imul(ye,Wn)|0,R=Math.imul(ye,Kn),$=$+Math.imul(K,Xt)|0,C=C+Math.imul(K,Ln)|0,C=C+Math.imul(Q,Xt)|0,R=R+Math.imul(Q,Ln)|0;var Fr=(ne+$|0)+((C&8191)<<13)|0;ne=(R+(C>>>13)|0)+(Fr>>>26)|0,Fr&=67108863,$=Math.imul(ce,Xt),C=Math.imul(ce,Ln),C=C+Math.imul(ye,Xt)|0,R=Math.imul(ye,Ln);var zl=(ne+$|0)+((C&8191)<<13)|0;return ne=(R+(C>>>13)|0)+(zl>>>26)|0,zl&=67108863,X[0]=Dl,X[1]=xc,X[2]=bc,X[3]=_c,X[4]=Wi,X[5]=Ol,X[6]=Ll,X[7]=xn,X[8]=Nl,X[9]=ka,X[10]=ao,X[11]=Ho,X[12]=Bl,X[13]=Ai,X[14]=Wo,X[15]=si,X[16]=Fl,X[17]=Fr,X[18]=zl,ne!==0&&(X[19]=ne,O.length++),O};Math.imul||(x=b);function E(N,_,k){k.negative=_.negative^N.negative,k.length=N.length+_.length;for(var O=0,W=0,q=0;q<k.length-1;q++){var X=W;W=0;for(var ne=O&67108863,$=Math.min(q,_.length-1),C=Math.max(0,q-N.length+1);C<=$;C++){var R=q-C,Z=N.words[R]|0,J=_.words[C]|0,oe=Z*J,ue=oe&67108863;X=X+(oe/67108864|0)|0,ue=ue+ne|0,ne=ue&67108863,X=X+(ue>>>26)|0,W+=X>>>26,X&=67108863}k.words[q]=ne,O=X,X=W}return O!==0?k.words[q]=O:k.length--,k._strip()}function M(N,_,k){return E(N,_,k)}s.prototype.mulTo=function(_,k){var O,W=this.length+_.length;return this.length===10&&_.length===10?O=x(this,_,k):W<63?O=b(this,_,k):W<1024?O=E(this,_,k):O=M(this,_,k),O},s.prototype.mul=function(_){var k=new s(null);return k.words=new Array(this.length+_.length),this.mulTo(_,k)},s.prototype.mulf=function(_){var k=new s(null);return k.words=new Array(this.length+_.length),M(this,_,k)},s.prototype.imul=function(_){return this.clone().mulTo(_,this)},s.prototype.imuln=function(_){var k=_<0;k&&(_=-_),r(typeof _=="number"),r(_<67108864);for(var O=0,W=0;W<this.length;W++){var q=(this.words[W]|0)*_,X=(q&67108863)+(O&67108863);O>>=26,O+=q/67108864|0,O+=X>>>26,this.words[W]=X&67108863}return O!==0&&(this.words[W]=O,this.length++),k?this.ineg():this},s.prototype.muln=function(_){return this.clone().imuln(_)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(_){var k=S(_);if(k.length===0)return new s(1);for(var O=this,W=0;W<k.length&&k[W]===0;W++,O=O.sqr());if(++W<k.length)for(var q=O.sqr();W<k.length;W++,q=q.sqr())k[W]!==0&&(O=O.mul(q));return O},s.prototype.iushln=function(_){r(typeof _=="number"&&_>=0);var k=_%26,O=(_-k)/26,W=67108863>>>26-k<<26-k,q;if(k!==0){var X=0;for(q=0;q<this.length;q++){var ne=this.words[q]&W,$=(this.words[q]|0)-ne<<k;this.words[q]=$|X,X=ne>>>26-k}X&&(this.words[q]=X,this.length++)}if(O!==0){for(q=this.length-1;q>=0;q--)this.words[q+O]=this.words[q];for(q=0;q<O;q++)this.words[q]=0;this.length+=O}return this._strip()},s.prototype.ishln=function(_){return r(this.negative===0),this.iushln(_)},s.prototype.iushrn=function(_,k,O){r(typeof _=="number"&&_>=0);var W;k?W=(k-k%26)/26:W=0;var q=_%26,X=Math.min((_-q)/26,this.length),ne=67108863^67108863>>>q<<q,$=O;if(W-=X,W=Math.max(0,W),$){for(var C=0;C<X;C++)$.words[C]=this.words[C];$.length=X}if(X!==0)if(this.length>X)for(this.length-=X,C=0;C<this.length;C++)this.words[C]=this.words[C+X];else this.words[0]=0,this.length=1;var R=0;for(C=this.length-1;C>=0&&(R!==0||C>=W);C--){var Z=this.words[C]|0;this.words[C]=R<<26-q|Z>>>q,R=Z&ne}return $&&R!==0&&($.words[$.length++]=R),this.length===0&&(this.words[0]=0,this.length=1),this._strip()},s.prototype.ishrn=function(_,k,O){return r(this.negative===0),this.iushrn(_,k,O)},s.prototype.shln=function(_){return this.clone().ishln(_)},s.prototype.ushln=function(_){return this.clone().iushln(_)},s.prototype.shrn=function(_){return this.clone().ishrn(_)},s.prototype.ushrn=function(_){return this.clone().iushrn(_)},s.prototype.testn=function(_){r(typeof _=="number"&&_>=0);var k=_%26,O=(_-k)/26,W=1<<k;if(this.length<=O)return!1;var q=this.words[O];return!!(q&W)},s.prototype.imaskn=function(_){r(typeof _=="number"&&_>=0);var k=_%26,O=(_-k)/26;if(r(this.negative===0,"imaskn works only with positive numbers"),this.length<=O)return this;if(k!==0&&O++,this.length=Math.min(O,this.length),k!==0){var W=67108863^67108863>>>k<<k;this.words[this.length-1]&=W}return this._strip()},s.prototype.maskn=function(_){return this.clone().imaskn(_)},s.prototype.iaddn=function(_){return r(typeof _=="number"),r(_<67108864),_<0?this.isubn(-_):this.negative!==0?this.length===1&&(this.words[0]|0)<=_?(this.words[0]=_-(this.words[0]|0),this.negative=0,this):(this.negative=0,this.isubn(_),this.negative=1,this):this._iaddn(_)},s.prototype._iaddn=function(_){this.words[0]+=_;for(var k=0;k<this.length&&this.words[k]>=67108864;k++)this.words[k]-=67108864,k===this.length-1?this.words[k+1]=1:this.words[k+1]++;return this.length=Math.max(this.length,k+1),this},s.prototype.isubn=function(_){if(r(typeof _=="number"),r(_<67108864),_<0)return this.iaddn(-_);if(this.negative!==0)return this.negative=0,this.iaddn(_),this.negative=1,this;if(this.words[0]-=_,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var k=0;k<this.length&&this.words[k]<0;k++)this.words[k]+=67108864,this.words[k+1]-=1;return this._strip()},s.prototype.addn=function(_){return this.clone().iaddn(_)},s.prototype.subn=function(_){return this.clone().isubn(_)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(_,k,O){var W=_.length+O,q;this._expand(W);var X,ne=0;for(q=0;q<_.length;q++){X=(this.words[q+O]|0)+ne;var $=(_.words[q]|0)*k;X-=$&67108863,ne=(X>>26)-($/67108864|0),this.words[q+O]=X&67108863}for(;q<this.length-O;q++)X=(this.words[q+O]|0)+ne,ne=X>>26,this.words[q+O]=X&67108863;if(ne===0)return this._strip();for(r(ne===-1),ne=0,q=0;q<this.length;q++)X=-(this.words[q]|0)+ne,ne=X>>26,this.words[q]=X&67108863;return this.negative=1,this._strip()},s.prototype._wordDiv=function(_,k){var O=this.length-_.length,W=this.clone(),q=_,X=q.words[q.length-1]|0,ne=this._countBits(X);O=26-ne,O!==0&&(q=q.ushln(O),W.iushln(O),X=q.words[q.length-1]|0);var $=W.length-q.length,C;if(k!=="mod"){C=new s(null),C.length=$+1,C.words=new Array(C.length);for(var R=0;R<C.length;R++)C.words[R]=0}var Z=W.clone()._ishlnsubmul(q,1,$);Z.negative===0&&(W=Z,C&&(C.words[$]=1));for(var J=$-1;J>=0;J--){var oe=(W.words[q.length+J]|0)*67108864+(W.words[q.length+J-1]|0);for(oe=Math.min(oe/X|0,67108863),W._ishlnsubmul(q,oe,J);W.negative!==0;)oe--,W.negative=0,W._ishlnsubmul(q,1,J),W.isZero()||(W.negative^=1);C&&(C.words[J]=oe)}return C&&C._strip(),W._strip(),k!=="div"&&O!==0&&W.iushrn(O),{div:C||null,mod:W}},s.prototype.divmod=function(_,k,O){if(r(!_.isZero()),this.isZero())return{div:new s(0),mod:new s(0)};var W,q,X;return this.negative!==0&&_.negative===0?(X=this.neg().divmod(_,k),k!=="mod"&&(W=X.div.neg()),k!=="div"&&(q=X.mod.neg(),O&&q.negative!==0&&q.iadd(_)),{div:W,mod:q}):this.negative===0&&_.negative!==0?(X=this.divmod(_.neg(),k),k!=="mod"&&(W=X.div.neg()),{div:W,mod:X.mod}):this.negative&_.negative?(X=this.neg().divmod(_.neg(),k),k!=="div"&&(q=X.mod.neg(),O&&q.negative!==0&&q.isub(_)),{div:X.div,mod:q}):_.length>this.length||this.cmp(_)<0?{div:new s(0),mod:this}:_.length===1?k==="div"?{div:this.divn(_.words[0]),mod:null}:k==="mod"?{div:null,mod:new s(this.modrn(_.words[0]))}:{div:this.divn(_.words[0]),mod:new s(this.modrn(_.words[0]))}:this._wordDiv(_,k)},s.prototype.div=function(_){return this.divmod(_,"div",!1).div},s.prototype.mod=function(_){return this.divmod(_,"mod",!1).mod},s.prototype.umod=function(_){return this.divmod(_,"mod",!0).mod},s.prototype.divRound=function(_){var k=this.divmod(_);if(k.mod.isZero())return k.div;var O=k.div.negative!==0?k.mod.isub(_):k.mod,W=_.ushrn(1),q=_.andln(1),X=O.cmp(W);return X<0||q===1&&X===0?k.div:k.div.negative!==0?k.div.isubn(1):k.div.iaddn(1)},s.prototype.modrn=function(_){var k=_<0;k&&(_=-_),r(_<=67108863);for(var O=(1<<26)%_,W=0,q=this.length-1;q>=0;q--)W=(O*W+(this.words[q]|0))%_;return k?-W:W},s.prototype.modn=function(_){return this.modrn(_)},s.prototype.idivn=function(_){var k=_<0;k&&(_=-_),r(_<=67108863);for(var O=0,W=this.length-1;W>=0;W--){var q=(this.words[W]|0)+O*67108864;this.words[W]=q/_|0,O=q%_}return this._strip(),k?this.ineg():this},s.prototype.divn=function(_){return this.clone().idivn(_)},s.prototype.egcd=function(_){r(_.negative===0),r(!_.isZero());var k=this,O=_.clone();k.negative!==0?k=k.umod(_):k=k.clone();for(var W=new s(1),q=new s(0),X=new s(0),ne=new s(1),$=0;k.isEven()&&O.isEven();)k.iushrn(1),O.iushrn(1),++$;for(var C=O.clone(),R=k.clone();!k.isZero();){for(var Z=0,J=1;!(k.words[0]&J)&&Z<26;++Z,J<<=1);if(Z>0)for(k.iushrn(Z);Z-- >0;)(W.isOdd()||q.isOdd())&&(W.iadd(C),q.isub(R)),W.iushrn(1),q.iushrn(1);for(var oe=0,ue=1;!(O.words[0]&ue)&&oe<26;++oe,ue<<=1);if(oe>0)for(O.iushrn(oe);oe-- >0;)(X.isOdd()||ne.isOdd())&&(X.iadd(C),ne.isub(R)),X.iushrn(1),ne.iushrn(1);k.cmp(O)>=0?(k.isub(O),W.isub(X),q.isub(ne)):(O.isub(k),X.isub(W),ne.isub(q))}return{a:X,b:ne,gcd:O.iushln($)}},s.prototype._invmp=function(_){r(_.negative===0),r(!_.isZero());var k=this,O=_.clone();k.negative!==0?k=k.umod(_):k=k.clone();for(var W=new s(1),q=new s(0),X=O.clone();k.cmpn(1)>0&&O.cmpn(1)>0;){for(var ne=0,$=1;!(k.words[0]&$)&&ne<26;++ne,$<<=1);if(ne>0)for(k.iushrn(ne);ne-- >0;)W.isOdd()&&W.iadd(X),W.iushrn(1);for(var C=0,R=1;!(O.words[0]&R)&&C<26;++C,R<<=1);if(C>0)for(O.iushrn(C);C-- >0;)q.isOdd()&&q.iadd(X),q.iushrn(1);k.cmp(O)>=0?(k.isub(O),W.isub(q)):(O.isub(k),q.isub(W))}var Z;return k.cmpn(1)===0?Z=W:Z=q,Z.cmpn(0)<0&&Z.iadd(_),Z},s.prototype.gcd=function(_){if(this.isZero())return _.abs();if(_.isZero())return this.abs();var k=this.clone(),O=_.clone();k.negative=0,O.negative=0;for(var W=0;k.isEven()&&O.isEven();W++)k.iushrn(1),O.iushrn(1);do{for(;k.isEven();)k.iushrn(1);for(;O.isEven();)O.iushrn(1);var q=k.cmp(O);if(q<0){var X=k;k=O,O=X}else if(q===0||O.cmpn(1)===0)break;k.isub(O)}while(!0);return O.iushln(W)},s.prototype.invm=function(_){return this.egcd(_).a.umod(_)},s.prototype.isEven=function(){return(this.words[0]&1)===0},s.prototype.isOdd=function(){return(this.words[0]&1)===1},s.prototype.andln=function(_){return this.words[0]&_},s.prototype.bincn=function(_){r(typeof _=="number");var k=_%26,O=(_-k)/26,W=1<<k;if(this.length<=O)return this._expand(O+1),this.words[O]|=W,this;for(var q=W,X=O;q!==0&&X<this.length;X++){var ne=this.words[X]|0;ne+=q,q=ne>>>26,ne&=67108863,this.words[X]=ne}return q!==0&&(this.words[X]=q,this.length++),this},s.prototype.isZero=function(){return this.length===1&&this.words[0]===0},s.prototype.cmpn=function(_){var k=_<0;if(this.negative!==0&&!k)return-1;if(this.negative===0&&k)return 1;this._strip();var O;if(this.length>1)O=1;else{k&&(_=-_),r(_<=67108863,"Number is too big");var W=this.words[0]|0;O=W===_?0:W<_?-1:1}return this.negative!==0?-O|0:O},s.prototype.cmp=function(_){if(this.negative!==0&&_.negative===0)return-1;if(this.negative===0&&_.negative!==0)return 1;var k=this.ucmp(_);return this.negative!==0?-k|0:k},s.prototype.ucmp=function(_){if(this.length>_.length)return 1;if(this.length<_.length)return-1;for(var k=0,O=this.length-1;O>=0;O--){var W=this.words[O]|0,q=_.words[O]|0;if(W!==q){W<q?k=-1:W>q&&(k=1);break}}return k},s.prototype.gtn=function(_){return this.cmpn(_)===1},s.prototype.gt=function(_){return this.cmp(_)===1},s.prototype.gten=function(_){return this.cmpn(_)>=0},s.prototype.gte=function(_){return this.cmp(_)>=0},s.prototype.ltn=function(_){return this.cmpn(_)===-1},s.prototype.lt=function(_){return this.cmp(_)===-1},s.prototype.lten=function(_){return this.cmpn(_)<=0},s.prototype.lte=function(_){return this.cmp(_)<=0},s.prototype.eqn=function(_){return this.cmpn(_)===0},s.prototype.eq=function(_){return this.cmp(_)===0},s.red=function(_){return new Y(_)},s.prototype.toRed=function(_){return r(!this.red,"Already a number in reduction context"),r(this.negative===0,"red works only with positives"),_.convertTo(this)._forceRed(_)},s.prototype.fromRed=function(){return r(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(_){return this.red=_,this},s.prototype.forceRed=function(_){return r(!this.red,"Already a number in reduction context"),this._forceRed(_)},s.prototype.redAdd=function(_){return r(this.red,"redAdd works only with red numbers"),this.red.add(this,_)},s.prototype.redIAdd=function(_){return r(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,_)},s.prototype.redSub=function(_){return r(this.red,"redSub works only with red numbers"),this.red.sub(this,_)},s.prototype.redISub=function(_){return r(this.red,"redISub works only with red numbers"),this.red.isub(this,_)},s.prototype.redShl=function(_){return r(this.red,"redShl works only with red numbers"),this.red.shl(this,_)},s.prototype.redMul=function(_){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,_),this.red.mul(this,_)},s.prototype.redIMul=function(_){return r(this.red,"redMul works only with red numbers"),this.red._verify2(this,_),this.red.imul(this,_)},s.prototype.redSqr=function(){return r(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return r(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return r(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return r(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return r(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(_){return r(this.red&&!_.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,_)};var j={k256:null,p224:null,p192:null,p25519:null};function D(N,_){this.name=N,this.p=new s(_,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}D.prototype._tmp=function(){var _=new s(null);return _.words=new Array(Math.ceil(this.n/13)),_},D.prototype.ireduce=function(_){var k=_,O;do this.split(k,this.tmp),k=this.imulK(k),k=k.iadd(this.tmp),O=k.bitLength();while(O>this.n);var W=O<this.n?-1:k.ucmp(this.p);return W===0?(k.words[0]=0,k.length=1):W>0?k.isub(this.p):k.strip!==void 0?k.strip():k._strip(),k},D.prototype.split=function(_,k){_.iushrn(this.n,0,k)},D.prototype.imulK=function(_){return _.imul(this.k)};function H(){D.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}i(H,D),H.prototype.split=function(_,k){for(var O=4194303,W=Math.min(_.length,9),q=0;q<W;q++)k.words[q]=_.words[q];if(k.length=W,_.length<=9){_.words[0]=0,_.length=1;return}var X=_.words[9];for(k.words[k.length++]=X&O,q=10;q<_.length;q++){var ne=_.words[q]|0;_.words[q-10]=(ne&O)<<4|X>>>22,X=ne}X>>>=22,_.words[q-10]=X,X===0&&_.length>10?_.length-=10:_.length-=9},H.prototype.imulK=function(_){_.words[_.length]=0,_.words[_.length+1]=0,_.length+=2;for(var k=0,O=0;O<_.length;O++){var W=_.words[O]|0;k+=W*977,_.words[O]=k&67108863,k=W*64+(k/67108864|0)}return _.words[_.length-1]===0&&(_.length--,_.words[_.length-1]===0&&_.length--),_};function L(){D.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}i(L,D);function U(){D.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}i(U,D);function z(){D.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}i(z,D),z.prototype.imulK=function(_){for(var k=0,O=0;O<_.length;O++){var W=(_.words[O]|0)*19+k,q=W&67108863;W>>>=26,_.words[O]=q,k=W}return k!==0&&(_.words[_.length++]=k),_},s._prime=function(_){if(j[_])return j[_];var k;if(_==="k256")k=new H;else if(_==="p224")k=new L;else if(_==="p192")k=new U;else if(_==="p25519")k=new z;else throw new Error("Unknown prime "+_);return j[_]=k,k};function Y(N){if(typeof N=="string"){var _=s._prime(N);this.m=_.p,this.prime=_}else r(N.gtn(1),"modulus must be greater than 1"),this.m=N,this.prime=null}Y.prototype._verify1=function(_){r(_.negative===0,"red works only with positives"),r(_.red,"red works only with red numbers")},Y.prototype._verify2=function(_,k){r((_.negative|k.negative)===0,"red works only with positives"),r(_.red&&_.red===k.red,"red works only with red numbers")},Y.prototype.imod=function(_){return this.prime?this.prime.ireduce(_)._forceRed(this):(d(_,_.umod(this.m)._forceRed(this)),_)},Y.prototype.neg=function(_){return _.isZero()?_.clone():this.m.sub(_)._forceRed(this)},Y.prototype.add=function(_,k){this._verify2(_,k);var O=_.add(k);return O.cmp(this.m)>=0&&O.isub(this.m),O._forceRed(this)},Y.prototype.iadd=function(_,k){this._verify2(_,k);var O=_.iadd(k);return O.cmp(this.m)>=0&&O.isub(this.m),O},Y.prototype.sub=function(_,k){this._verify2(_,k);var O=_.sub(k);return O.cmpn(0)<0&&O.iadd(this.m),O._forceRed(this)},Y.prototype.isub=function(_,k){this._verify2(_,k);var O=_.isub(k);return O.cmpn(0)<0&&O.iadd(this.m),O},Y.prototype.shl=function(_,k){return this._verify1(_),this.imod(_.ushln(k))},Y.prototype.imul=function(_,k){return this._verify2(_,k),this.imod(_.imul(k))},Y.prototype.mul=function(_,k){return this._verify2(_,k),this.imod(_.mul(k))},Y.prototype.isqr=function(_){return this.imul(_,_.clone())},Y.prototype.sqr=function(_){return this.mul(_,_)},Y.prototype.sqrt=function(_){if(_.isZero())return _.clone();var k=this.m.andln(3);if(r(k%2===1),k===3){var O=this.m.add(new s(1)).iushrn(2);return this.pow(_,O)}for(var W=this.m.subn(1),q=0;!W.isZero()&&W.andln(1)===0;)q++,W.iushrn(1);r(!W.isZero());var X=new s(1).toRed(this),ne=X.redNeg(),$=this.m.subn(1).iushrn(1),C=this.m.bitLength();for(C=new s(2*C*C).toRed(this);this.pow(C,$).cmp(ne)!==0;)C.redIAdd(ne);for(var R=this.pow(C,W),Z=this.pow(_,W.addn(1).iushrn(1)),J=this.pow(_,W),oe=q;J.cmp(X)!==0;){for(var ue=J,fe=0;ue.cmp(X)!==0;fe++)ue=ue.redSqr();r(fe<oe);var _e=this.pow(R,new s(1).iushln(oe-fe-1));Z=Z.redMul(_e),R=_e.redSqr(),J=J.redMul(R),oe=fe}return Z},Y.prototype.invm=function(_){var k=_._invmp(this.m);return k.negative!==0?(k.negative=0,this.imod(k).redNeg()):this.imod(k)},Y.prototype.pow=function(_,k){if(k.isZero())return new s(1).toRed(this);if(k.cmpn(1)===0)return _.clone();var O=4,W=new Array(1<<O);W[0]=new s(1).toRed(this),W[1]=_;for(var q=2;q<W.length;q++)W[q]=this.mul(W[q-1],_);var X=W[0],ne=0,$=0,C=k.bitLength()%26;for(C===0&&(C=26),q=k.length-1;q>=0;q--){for(var R=k.words[q],Z=C-1;Z>=0;Z--){var J=R>>Z&1;if(X!==W[0]&&(X=this.sqr(X)),J===0&&ne===0){$=0;continue}ne<<=1,ne|=J,$++,!($!==O&&(q!==0||Z!==0))&&(X=this.mul(X,W[ne]),$=0,ne=0)}C=26}return X},Y.prototype.convertTo=function(_){var k=_.umod(this.m);return k===_?k.clone():k},Y.prototype.convertFrom=function(_){var k=_.clone();return k.red=null,k},s.mont=function(_){return new V(_)};function V(N){Y.call(this,N),this.shift=this.m.bitLength(),this.shift%26!==0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}i(V,Y),V.prototype.convertTo=function(_){return this.imod(_.ushln(this.shift))},V.prototype.convertFrom=function(_){var k=this.imod(_.mul(this.rinv));return k.red=null,k},V.prototype.imul=function(_,k){if(_.isZero()||k.isZero())return _.words[0]=0,_.length=1,_;var O=_.imul(k),W=O.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),q=O.isub(W).iushrn(this.shift),X=q;return q.cmp(this.m)>=0?X=q.isub(this.m):q.cmpn(0)<0&&(X=q.iadd(this.m)),X._forceRed(this)},V.prototype.mul=function(_,k){if(_.isZero()||k.isZero())return new s(0)._forceRed(this);var O=_.mul(k),W=O.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),q=O.isub(W).iushrn(this.shift),X=q;return q.cmp(this.m)>=0?X=q.isub(this.m):q.cmpn(0)<0&&(X=q.iadd(this.m)),X._forceRed(this)},V.prototype.invm=function(_){var k=this.imod(_._invmp(this.m).mul(this.r2));return k._forceRed(this)}})(n,nye)}(Uy)),Uy.exports}var rye=I9();const rO=fs(rye);var ty={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var iO;function qP(){return iO||(iO=1,function(n,e){var t=FP(),r=t.Buffer;function i(o,a){for(var c in o)a[c]=o[c]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=s);function s(o,a,c){return r(o,a,c)}s.prototype=Object.create(r.prototype),i(r,s),s.from=function(o,a,c){if(typeof o=="number")throw new TypeError("Argument must not be a number");return r(o,a,c)},s.alloc=function(o,a,c){if(typeof o!="number")throw new TypeError("Argument must be a number");var u=r(o);return a!==void 0?typeof c=="string"?u.fill(a,c):u.fill(a):u.fill(0),u},s.allocUnsafe=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return r(o)},s.allocUnsafeSlow=function(o){if(typeof o!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(o)}}(ty,ty.exports)),ty.exports}var e_,sO;function iye(){if(sO)return e_;sO=1;var n=qP().Buffer;function e(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),a=o.charCodeAt(0);if(r[a]!==255)throw new TypeError(o+" is ambiguous");r[a]=s}var c=t.length,u=t.charAt(0),d=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(w){if((Array.isArray(w)||w instanceof Uint8Array)&&(w=n.from(w)),!n.isBuffer(w))throw new TypeError("Expected Buffer");if(w.length===0)return"";for(var S=0,b=0,x=0,E=w.length;x!==E&&w[x]===0;)x++,S++;for(var M=(E-x)*f+1>>>0,j=new Uint8Array(M);x!==E;){for(var D=w[x],H=0,L=M-1;(D!==0||H<b)&&L!==-1;L--,H++)D+=256*j[L]>>>0,j[L]=D%c>>>0,D=D/c>>>0;if(D!==0)throw new Error("Non-zero carry");b=H,x++}for(var U=M-b;U!==M&&j[U]===0;)U++;for(var z=u.repeat(S);U<M;++U)z+=t.charAt(j[U]);return z}function m(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return n.alloc(0);for(var S=0,b=0,x=0;w[S]===u;)b++,S++;for(var E=(w.length-S)*d+1>>>0,M=new Uint8Array(E);S<w.length;){var j=r[w.charCodeAt(S)];if(j===255)return;for(var D=0,H=E-1;(j!==0||D<x)&&H!==-1;H--,D++)j+=c*M[H]>>>0,M[H]=j%256>>>0,j=j/256>>>0;if(j!==0)throw new Error("Non-zero carry");x=D,S++}for(var L=E-x;L!==E&&M[L]===0;)L++;var U=n.allocUnsafe(b+(E-L));U.fill(0,0,b);for(var z=b;L!==E;)U[z++]=M[L++];return U}function v(w){var S=m(w);if(S)return S;throw new Error("Non-base"+c+" character")}return{encode:g,decodeUnsafe:m,decode:v}}return e_=e,e_}var t_,oO;function sye(){if(oO)return t_;oO=1;var n=iye(),e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return t_=n(e),t_}var oye=sye();const Yr=fs(oye),aye=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Gc=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Vc=new Uint32Array(64);class cye extends f9{constructor(){super(64,32,8,!1),this.A=Gc[0]|0,this.B=Gc[1]|0,this.C=Gc[2]|0,this.D=Gc[3]|0,this.E=Gc[4]|0,this.F=Gc[5]|0,this.G=Gc[6]|0,this.H=Gc[7]|0}get(){const{A:e,B:t,C:r,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,r,i,s,o,a,c]}set(e,t,r,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=r|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Vc[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const g=Vc[f-15],m=Vc[f-2],v=na(g,7)^na(g,18)^g>>>3,w=na(m,17)^na(m,19)^m>>>10;Vc[f]=w+Vc[f-7]+v+Vc[f-16]|0}let{A:r,B:i,C:s,D:o,E:a,F:c,G:u,H:d}=this;for(let f=0;f<64;f++){const g=na(a,6)^na(a,11)^na(a,25),m=d+g+qge(a,c,u)+aye[f]+Vc[f]|0,w=(na(r,2)^na(r,13)^na(r,22))+Gge(r,i,s)|0;d=u,u=c,c=a,a=o+m|0,o=s,s=i,i=r,r=m+w|0}r=r+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,d=d+this.H|0,this.set(r,i,s,o,a,c,u,d)}roundClean(){Vc.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const zE=d9(()=>new cye);var pn={},n_,aO;function lye(){if(aO)return n_;aO=1;var n=qP().Buffer;function e(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),a=o.charCodeAt(0);if(r[a]!==255)throw new TypeError(o+" is ambiguous");r[a]=s}var c=t.length,u=t.charAt(0),d=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(w){if((Array.isArray(w)||w instanceof Uint8Array)&&(w=n.from(w)),!n.isBuffer(w))throw new TypeError("Expected Buffer");if(w.length===0)return"";for(var S=0,b=0,x=0,E=w.length;x!==E&&w[x]===0;)x++,S++;for(var M=(E-x)*f+1>>>0,j=new Uint8Array(M);x!==E;){for(var D=w[x],H=0,L=M-1;(D!==0||H<b)&&L!==-1;L--,H++)D+=256*j[L]>>>0,j[L]=D%c>>>0,D=D/c>>>0;if(D!==0)throw new Error("Non-zero carry");b=H,x++}for(var U=M-b;U!==M&&j[U]===0;)U++;for(var z=u.repeat(S);U<M;++U)z+=t.charAt(j[U]);return z}function m(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return n.alloc(0);for(var S=0,b=0,x=0;w[S]===u;)b++,S++;for(var E=(w.length-S)*d+1>>>0,M=new Uint8Array(E);S<w.length;){var j=r[w.charCodeAt(S)];if(j===255)return;for(var D=0,H=E-1;(j!==0||D<x)&&H!==-1;H--,D++)j+=c*M[H]>>>0,M[H]=j%256>>>0,j=j/256>>>0;if(j!==0)throw new Error("Non-zero carry");x=D,S++}for(var L=E-x;L!==E&&M[L]===0;)L++;var U=n.allocUnsafe(b+(E-L));U.fill(0,0,b);for(var z=b;L!==E;)U[z++]=M[L++];return U}function v(w){var S=m(w);if(S)return S;throw new Error("Non-base"+c+" character")}return{encode:g,decodeUnsafe:m,decode:v}}return n_=e,n_}var r_,cO;function uye(){if(cO)return r_;cO=1;var n=lye(),e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return r_=n(e),r_}function Xa(n,e,t){return e<=n&&n<=t}function rv(n){if(n===void 0)return{};if(n===Object(n))return n;throw TypeError("Could not convert argument to dictionary")}function dye(n){for(var e=String(n),t=e.length,r=0,i=[];r<t;){var s=e.charCodeAt(r);if(s<55296||s>57343)i.push(s);else if(56320<=s&&s<=57343)i.push(65533);else if(55296<=s&&s<=56319)if(r===t-1)i.push(65533);else{var o=n.charCodeAt(r+1);if(56320<=o&&o<=57343){var a=s&1023,c=o&1023;i.push(65536+(a<<10)+c),r+=1}else i.push(65533)}r+=1}return i}function hye(n){for(var e="",t=0;t<n.length;++t){var r=n[t];r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode((r>>10)+55296,(r&1023)+56320))}return e}var j0=-1;function GP(n){this.tokens=[].slice.call(n)}GP.prototype={endOfStream:function(){return!this.tokens.length},read:function(){return this.tokens.length?this.tokens.shift():j0},prepend:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.unshift(e.pop());else this.tokens.unshift(n)},push:function(n){if(Array.isArray(n))for(var e=n;e.length;)this.tokens.push(e.shift());else this.tokens.push(n)}};var vh=-1;function i_(n,e){if(n)throw TypeError("Decoder error");return e||65533}var D0="utf-8";function O0(n,e){if(!(this instanceof O0))return new O0(n,e);if(n=n!==void 0?String(n).toLowerCase():D0,n!==D0)throw new Error("Encoding not supported. Only utf-8 is supported");e=rv(e),this._streaming=!1,this._BOMseen=!1,this._decoder=null,this._fatal=!!e.fatal,this._ignoreBOM=!!e.ignoreBOM,Object.defineProperty(this,"encoding",{value:"utf-8"}),Object.defineProperty(this,"fatal",{value:this._fatal}),Object.defineProperty(this,"ignoreBOM",{value:this._ignoreBOM})}O0.prototype={decode:function(e,t){var r;typeof e=="object"&&e instanceof ArrayBuffer?r=new Uint8Array(e):typeof e=="object"&&"buffer"in e&&e.buffer instanceof ArrayBuffer?r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):r=new Uint8Array(0),t=rv(t),this._streaming||(this._decoder=new fye({fatal:this._fatal}),this._BOMseen=!1),this._streaming=!!t.stream;for(var i=new GP(r),s=[],o;!i.endOfStream()&&(o=this._decoder.handler(i,i.read()),o!==vh);)o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o));if(!this._streaming){do{if(o=this._decoder.handler(i,i.read()),o===vh)break;o!==null&&(Array.isArray(o)?s.push.apply(s,o):s.push(o))}while(!i.endOfStream());this._decoder=null}return s.length&&["utf-8"].indexOf(this.encoding)!==-1&&!this._ignoreBOM&&!this._BOMseen&&(s[0]===65279?(this._BOMseen=!0,s.shift()):this._BOMseen=!0),hye(s)}};function L0(n,e){if(!(this instanceof L0))return new L0(n,e);if(n=n!==void 0?String(n).toLowerCase():D0,n!==D0)throw new Error("Encoding not supported. Only utf-8 is supported");e=rv(e),this._streaming=!1,this._encoder=null,this._options={fatal:!!e.fatal},Object.defineProperty(this,"encoding",{value:"utf-8"})}L0.prototype={encode:function(e,t){e=e?String(e):"",t=rv(t),this._streaming||(this._encoder=new pye(this._options)),this._streaming=!!t.stream;for(var r=[],i=new GP(dye(e)),s;!i.endOfStream()&&(s=this._encoder.handler(i,i.read()),s!==vh);)Array.isArray(s)?r.push.apply(r,s):r.push(s);if(!this._streaming){for(;s=this._encoder.handler(i,i.read()),s!==vh;)Array.isArray(s)?r.push.apply(r,s):r.push(s);this._encoder=null}return new Uint8Array(r)}};function fye(n){var e=n.fatal,t=0,r=0,i=0,s=128,o=191;this.handler=function(a,c){if(c===j0&&i!==0)return i=0,i_(e);if(c===j0)return vh;if(i===0){if(Xa(c,0,127))return c;if(Xa(c,194,223))i=1,t=c-192;else if(Xa(c,224,239))c===224&&(s=160),c===237&&(o=159),i=2,t=c-224;else if(Xa(c,240,244))c===240&&(s=144),c===244&&(o=143),i=3,t=c-240;else return i_(e);return t=t<<6*i,null}if(!Xa(c,s,o))return t=i=r=0,s=128,o=191,a.prepend(c),i_(e);if(s=128,o=191,r+=1,t+=c-128<<6*(i-r),r!==i)return null;var u=t;return t=i=r=0,u}}function pye(n){n.fatal,this.handler=function(e,t){if(t===j0)return vh;if(Xa(t,0,127))return t;var r,i;Xa(t,128,2047)?(r=1,i=192):Xa(t,2048,65535)?(r=2,i=224):Xa(t,65536,1114111)&&(r=3,i=240);for(var s=[(t>>6*r)+i];r>0;){var o=t>>6*(r-1);s.push(128|o&63),r-=1}return s}}const gye=Object.freeze(Object.defineProperty({__proto__:null,TextDecoder:O0,TextEncoder:L0},Symbol.toStringTag,{value:"Module"})),mye=lC(gye);var lO;function yye(){if(lO)return pn;lO=1;var n=pn&&pn.__createBinding||(Object.create?function(U,z,Y,V){V===void 0&&(V=Y),Object.defineProperty(U,V,{enumerable:!0,get:function(){return z[Y]}})}:function(U,z,Y,V){V===void 0&&(V=Y),U[V]=z[Y]}),e=pn&&pn.__setModuleDefault||(Object.create?function(U,z){Object.defineProperty(U,"default",{enumerable:!0,value:z})}:function(U,z){U.default=z}),t=pn&&pn.__decorate||function(U,z,Y,V){var N=arguments.length,_=N<3?z:V===null?V=Object.getOwnPropertyDescriptor(z,Y):V,k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")_=Reflect.decorate(U,z,Y,V);else for(var O=U.length-1;O>=0;O--)(k=U[O])&&(_=(N<3?k(_):N>3?k(z,Y,_):k(z,Y))||_);return N>3&&_&&Object.defineProperty(z,Y,_),_},r=pn&&pn.__importStar||function(U){if(U&&U.__esModule)return U;var z={};if(U!=null)for(var Y in U)Y!=="default"&&Object.hasOwnProperty.call(U,Y)&&n(z,U,Y);return e(z,U),z},i=pn&&pn.__importDefault||function(U){return U&&U.__esModule?U:{default:U}};Object.defineProperty(pn,"__esModule",{value:!0}),pn.deserializeUnchecked=pn.deserialize=pn.serialize=pn.BinaryReader=pn.BinaryWriter=pn.BorshError=pn.baseDecode=pn.baseEncode=void 0;const s=i(I9()),o=i(uye()),a=r(mye),c=typeof TextDecoder!="function"?a.TextDecoder:TextDecoder,u=new c("utf-8",{fatal:!0});function d(U){return typeof U=="string"&&(U=Buffer.from(U,"utf8")),o.default.encode(Buffer.from(U))}pn.baseEncode=d;function f(U){return Buffer.from(o.default.decode(U))}pn.baseDecode=f;const g=1024;class m extends Error{constructor(z){super(z),this.fieldPath=[],this.originalMessage=z}addToFieldPath(z){this.fieldPath.splice(0,0,z),this.message=this.originalMessage+": "+this.fieldPath.join(".")}}pn.BorshError=m;class v{constructor(){this.buf=Buffer.alloc(g),this.length=0}maybeResize(){this.buf.length<16+this.length&&(this.buf=Buffer.concat([this.buf,Buffer.alloc(g)]))}writeU8(z){this.maybeResize(),this.buf.writeUInt8(z,this.length),this.length+=1}writeU16(z){this.maybeResize(),this.buf.writeUInt16LE(z,this.length),this.length+=2}writeU32(z){this.maybeResize(),this.buf.writeUInt32LE(z,this.length),this.length+=4}writeU64(z){this.maybeResize(),this.writeBuffer(Buffer.from(new s.default(z).toArray("le",8)))}writeU128(z){this.maybeResize(),this.writeBuffer(Buffer.from(new s.default(z).toArray("le",16)))}writeU256(z){this.maybeResize(),this.writeBuffer(Buffer.from(new s.default(z).toArray("le",32)))}writeU512(z){this.maybeResize(),this.writeBuffer(Buffer.from(new s.default(z).toArray("le",64)))}writeBuffer(z){this.buf=Buffer.concat([Buffer.from(this.buf.subarray(0,this.length)),z,Buffer.alloc(g)]),this.length+=z.length}writeString(z){this.maybeResize();const Y=Buffer.from(z,"utf8");this.writeU32(Y.length),this.writeBuffer(Y)}writeFixedArray(z){this.writeBuffer(Buffer.from(z))}writeArray(z,Y){this.maybeResize(),this.writeU32(z.length);for(const V of z)this.maybeResize(),Y(V)}toArray(){return this.buf.subarray(0,this.length)}}pn.BinaryWriter=v;function w(U,z,Y){const V=Y.value;Y.value=function(...N){try{return V.apply(this,N)}catch(_){if(_ instanceof RangeError){const k=_.code;if(["ERR_BUFFER_OUT_OF_BOUNDS","ERR_OUT_OF_RANGE"].indexOf(k)>=0)throw new m("Reached the end of buffer when deserializing")}throw _}}}class S{constructor(z){this.buf=z,this.offset=0}readU8(){const z=this.buf.readUInt8(this.offset);return this.offset+=1,z}readU16(){const z=this.buf.readUInt16LE(this.offset);return this.offset+=2,z}readU32(){const z=this.buf.readUInt32LE(this.offset);return this.offset+=4,z}readU64(){const z=this.readBuffer(8);return new s.default(z,"le")}readU128(){const z=this.readBuffer(16);return new s.default(z,"le")}readU256(){const z=this.readBuffer(32);return new s.default(z,"le")}readU512(){const z=this.readBuffer(64);return new s.default(z,"le")}readBuffer(z){if(this.offset+z>this.buf.length)throw new m(`Expected buffer length ${z} isn't within bounds`);const Y=this.buf.slice(this.offset,this.offset+z);return this.offset+=z,Y}readString(){const z=this.readU32(),Y=this.readBuffer(z);try{return u.decode(Y)}catch(V){throw new m(`Error decoding UTF-8 string: ${V}`)}}readFixedArray(z){return new Uint8Array(this.readBuffer(z))}readArray(z){const Y=this.readU32(),V=Array();for(let N=0;N<Y;++N)V.push(z());return V}}t([w],S.prototype,"readU8",null),t([w],S.prototype,"readU16",null),t([w],S.prototype,"readU32",null),t([w],S.prototype,"readU64",null),t([w],S.prototype,"readU128",null),t([w],S.prototype,"readU256",null),t([w],S.prototype,"readU512",null),t([w],S.prototype,"readString",null),t([w],S.prototype,"readFixedArray",null),t([w],S.prototype,"readArray",null),pn.BinaryReader=S;function b(U){return U.charAt(0).toUpperCase()+U.slice(1)}function x(U,z,Y,V,N){try{if(typeof V=="string")N[`write${b(V)}`](Y);else if(V instanceof Array)if(typeof V[0]=="number"){if(Y.length!==V[0])throw new m(`Expecting byte array of length ${V[0]}, but got ${Y.length} bytes`);N.writeFixedArray(Y)}else if(V.length===2&&typeof V[1]=="number"){if(Y.length!==V[1])throw new m(`Expecting byte array of length ${V[1]}, but got ${Y.length} bytes`);for(let _=0;_<V[1];_++)x(U,null,Y[_],V[0],N)}else N.writeArray(Y,_=>{x(U,z,_,V[0],N)});else if(V.kind!==void 0)switch(V.kind){case"option":{Y==null?N.writeU8(0):(N.writeU8(1),x(U,z,Y,V.type,N));break}case"map":{N.writeU32(Y.size),Y.forEach((_,k)=>{x(U,z,k,V.key,N),x(U,z,_,V.value,N)});break}default:throw new m(`FieldType ${V} unrecognized`)}else E(U,Y,N)}catch(_){throw _ instanceof m&&_.addToFieldPath(z),_}}function E(U,z,Y){if(typeof z.borshSerialize=="function"){z.borshSerialize(Y);return}const V=U.get(z.constructor);if(!V)throw new m(`Class ${z.constructor.name} is missing in schema`);if(V.kind==="struct")V.fields.map(([N,_])=>{x(U,N,z[N],_,Y)});else if(V.kind==="enum"){const N=z[V.field];for(let _=0;_<V.values.length;++_){const[k,O]=V.values[_];if(k===N){Y.writeU8(_),x(U,k,z[k],O,Y);break}}}else throw new m(`Unexpected schema kind: ${V.kind} for ${z.constructor.name}`)}function M(U,z,Y=v){const V=new Y;return E(U,z,V),V.toArray()}pn.serialize=M;function j(U,z,Y,V){try{if(typeof Y=="string")return V[`read${b(Y)}`]();if(Y instanceof Array){if(typeof Y[0]=="number")return V.readFixedArray(Y[0]);if(typeof Y[1]=="number"){const N=[];for(let _=0;_<Y[1];_++)N.push(j(U,null,Y[0],V));return N}else return V.readArray(()=>j(U,z,Y[0],V))}if(Y.kind==="option")return V.readU8()?j(U,z,Y.type,V):void 0;if(Y.kind==="map"){let N=new Map;const _=V.readU32();for(let k=0;k<_;k++){const O=j(U,z,Y.key,V),W=j(U,z,Y.value,V);N.set(O,W)}return N}return D(U,Y,V)}catch(N){throw N instanceof m&&N.addToFieldPath(z),N}}function D(U,z,Y){if(typeof z.borshDeserialize=="function")return z.borshDeserialize(Y);const V=U.get(z);if(!V)throw new m(`Class ${z.name} is missing in schema`);if(V.kind==="struct"){const N={};for(const[_,k]of U.get(z).fields)N[_]=j(U,_,k,Y);return new z(N)}if(V.kind==="enum"){const N=Y.readU8();if(N>=V.values.length)throw new m(`Enum index: ${N} is out of range`);const[_,k]=V.values[N],O=j(U,_,k,Y);return new z({[_]:O})}throw new m(`Unexpected schema kind: ${V.kind} for ${z.constructor.name}`)}function H(U,z,Y,V=S){const N=new V(Y),_=D(U,z,N);if(N.offset<Y.length)throw new m(`Unexpected ${Y.length-N.offset} bytes after deserialized data`);return _}pn.deserialize=H;function L(U,z,Y,V=S){const N=new V(Y);return D(U,z,N)}return pn.deserializeUnchecked=L,pn}var s_=yye(),Se={},uO;function wye(){if(uO)return Se;uO=1,Object.defineProperty(Se,"__esModule",{value:!0}),Se.s16=Se.s8=Se.nu64be=Se.u48be=Se.u40be=Se.u32be=Se.u24be=Se.u16be=Se.nu64=Se.u48=Se.u40=Se.u32=Se.u24=Se.u16=Se.u8=Se.offset=Se.greedy=Se.Constant=Se.UTF8=Se.CString=Se.Blob=Se.Boolean=Se.BitField=Se.BitStructure=Se.VariantLayout=Se.Union=Se.UnionLayoutDiscriminator=Se.UnionDiscriminator=Se.Structure=Se.Sequence=Se.DoubleBE=Se.Double=Se.FloatBE=Se.Float=Se.NearInt64BE=Se.NearInt64=Se.NearUInt64BE=Se.NearUInt64=Se.IntBE=Se.Int=Se.UIntBE=Se.UInt=Se.OffsetLayout=Se.GreedyCount=Se.ExternalLayout=Se.bindConstructorLayout=Se.nameWithProperty=Se.Layout=Se.uint8ArrayToBuffer=Se.checkUint8Array=void 0,Se.constant=Se.utf8=Se.cstr=Se.blob=Se.unionLayoutDiscriminator=Se.union=Se.seq=Se.bits=Se.struct=Se.f64be=Se.f64=Se.f32be=Se.f32=Se.ns64be=Se.s48be=Se.s40be=Se.s32be=Se.s24be=Se.s16be=Se.ns64=Se.s48=Se.s40=Se.s32=Se.s24=void 0;const n=FP();function e(C){if(!(C instanceof Uint8Array))throw new TypeError("b must be a Uint8Array")}Se.checkUint8Array=e;function t(C){return e(C),n.Buffer.from(C.buffer,C.byteOffset,C.length)}Se.uint8ArrayToBuffer=t;let r=class{constructor(R,Z){if(!Number.isInteger(R))throw new TypeError("span must be an integer");this.span=R,this.property=Z}makeDestinationObject(){return{}}getSpan(R,Z){if(0>this.span)throw new RangeError("indeterminate span");return this.span}replicate(R){const Z=Object.create(this.constructor.prototype);return Object.assign(Z,this),Z.property=R,Z}fromArray(R){}};Se.Layout=r;function i(C,R){return R.property?C+"["+R.property+"]":C}Se.nameWithProperty=i;function s(C,R){if(typeof C!="function")throw new TypeError("Class must be constructor");if(Object.prototype.hasOwnProperty.call(C,"layout_"))throw new Error("Class is already bound to a layout");if(!(R&&R instanceof r))throw new TypeError("layout must be a Layout");if(Object.prototype.hasOwnProperty.call(R,"boundConstructor_"))throw new Error("layout is already bound to a constructor");C.layout_=R,R.boundConstructor_=C,R.makeDestinationObject=()=>new C,Object.defineProperty(C.prototype,"encode",{value(Z,J){return R.encode(this,Z,J)},writable:!0}),Object.defineProperty(C,"decode",{value(Z,J){return R.decode(Z,J)},writable:!0})}Se.bindConstructorLayout=s;class o extends r{isCount(){throw new Error("ExternalLayout is abstract")}}Se.ExternalLayout=o;class a extends o{constructor(R=1,Z){if(!Number.isInteger(R)||0>=R)throw new TypeError("elementSpan must be a (positive) integer");super(-1,Z),this.elementSpan=R}isCount(){return!0}decode(R,Z=0){e(R);const J=R.length-Z;return Math.floor(J/this.elementSpan)}encode(R,Z,J){return 0}}Se.GreedyCount=a;class c extends o{constructor(R,Z=0,J){if(!(R instanceof r))throw new TypeError("layout must be a Layout");if(!Number.isInteger(Z))throw new TypeError("offset must be integer or undefined");super(R.span,J||R.property),this.layout=R,this.offset=Z}isCount(){return this.layout instanceof u||this.layout instanceof d}decode(R,Z=0){return this.layout.decode(R,Z+this.offset)}encode(R,Z,J=0){return this.layout.encode(R,Z,J+this.offset)}}Se.OffsetLayout=c;class u extends r{constructor(R,Z){if(super(R,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(R,Z=0){return t(R).readUIntLE(Z,this.span)}encode(R,Z,J=0){return t(Z).writeUIntLE(R,J,this.span),this.span}}Se.UInt=u;class d extends r{constructor(R,Z){if(super(R,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(R,Z=0){return t(R).readUIntBE(Z,this.span)}encode(R,Z,J=0){return t(Z).writeUIntBE(R,J,this.span),this.span}}Se.UIntBE=d;class f extends r{constructor(R,Z){if(super(R,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(R,Z=0){return t(R).readIntLE(Z,this.span)}encode(R,Z,J=0){return t(Z).writeIntLE(R,J,this.span),this.span}}Se.Int=f;class g extends r{constructor(R,Z){if(super(R,Z),6<this.span)throw new RangeError("span must not exceed 6 bytes")}decode(R,Z=0){return t(R).readIntBE(Z,this.span)}encode(R,Z,J=0){return t(Z).writeIntBE(R,J,this.span),this.span}}Se.IntBE=g;const m=Math.pow(2,32);function v(C){const R=Math.floor(C/m),Z=C-R*m;return{hi32:R,lo32:Z}}function w(C,R){return C*m+R}class S extends r{constructor(R){super(8,R)}decode(R,Z=0){const J=t(R),oe=J.readUInt32LE(Z),ue=J.readUInt32LE(Z+4);return w(ue,oe)}encode(R,Z,J=0){const oe=v(R),ue=t(Z);return ue.writeUInt32LE(oe.lo32,J),ue.writeUInt32LE(oe.hi32,J+4),8}}Se.NearUInt64=S;class b extends r{constructor(R){super(8,R)}decode(R,Z=0){const J=t(R),oe=J.readUInt32BE(Z),ue=J.readUInt32BE(Z+4);return w(oe,ue)}encode(R,Z,J=0){const oe=v(R),ue=t(Z);return ue.writeUInt32BE(oe.hi32,J),ue.writeUInt32BE(oe.lo32,J+4),8}}Se.NearUInt64BE=b;class x extends r{constructor(R){super(8,R)}decode(R,Z=0){const J=t(R),oe=J.readUInt32LE(Z),ue=J.readInt32LE(Z+4);return w(ue,oe)}encode(R,Z,J=0){const oe=v(R),ue=t(Z);return ue.writeUInt32LE(oe.lo32,J),ue.writeInt32LE(oe.hi32,J+4),8}}Se.NearInt64=x;class E extends r{constructor(R){super(8,R)}decode(R,Z=0){const J=t(R),oe=J.readInt32BE(Z),ue=J.readUInt32BE(Z+4);return w(oe,ue)}encode(R,Z,J=0){const oe=v(R),ue=t(Z);return ue.writeInt32BE(oe.hi32,J),ue.writeUInt32BE(oe.lo32,J+4),8}}Se.NearInt64BE=E;class M extends r{constructor(R){super(4,R)}decode(R,Z=0){return t(R).readFloatLE(Z)}encode(R,Z,J=0){return t(Z).writeFloatLE(R,J),4}}Se.Float=M;class j extends r{constructor(R){super(4,R)}decode(R,Z=0){return t(R).readFloatBE(Z)}encode(R,Z,J=0){return t(Z).writeFloatBE(R,J),4}}Se.FloatBE=j;class D extends r{constructor(R){super(8,R)}decode(R,Z=0){return t(R).readDoubleLE(Z)}encode(R,Z,J=0){return t(Z).writeDoubleLE(R,J),8}}Se.Double=D;class H extends r{constructor(R){super(8,R)}decode(R,Z=0){return t(R).readDoubleBE(Z)}encode(R,Z,J=0){return t(Z).writeDoubleBE(R,J),8}}Se.DoubleBE=H;class L extends r{constructor(R,Z,J){if(!(R instanceof r))throw new TypeError("elementLayout must be a Layout");if(!(Z instanceof o&&Z.isCount()||Number.isInteger(Z)&&0<=Z))throw new TypeError("count must be non-negative integer or an unsigned integer ExternalLayout");let oe=-1;!(Z instanceof o)&&0<R.span&&(oe=Z*R.span),super(oe,J),this.elementLayout=R,this.count=Z}getSpan(R,Z=0){if(0<=this.span)return this.span;let J=0,oe=this.count;if(oe instanceof o&&(oe=oe.decode(R,Z)),0<this.elementLayout.span)J=oe*this.elementLayout.span;else{let ue=0;for(;ue<oe;)J+=this.elementLayout.getSpan(R,Z+J),++ue}return J}decode(R,Z=0){const J=[];let oe=0,ue=this.count;for(ue instanceof o&&(ue=ue.decode(R,Z));oe<ue;)J.push(this.elementLayout.decode(R,Z)),Z+=this.elementLayout.getSpan(R,Z),oe+=1;return J}encode(R,Z,J=0){const oe=this.elementLayout,ue=R.reduce((fe,_e)=>fe+oe.encode(_e,Z,J+fe),0);return this.count instanceof o&&this.count.encode(R.length,Z,J),ue}}Se.Sequence=L;class U extends r{constructor(R,Z,J){if(!(Array.isArray(R)&&R.reduce((ue,fe)=>ue&&fe instanceof r,!0)))throw new TypeError("fields must be array of Layout instances");typeof Z=="boolean"&&J===void 0&&(J=Z,Z=void 0);for(const ue of R)if(0>ue.span&&ue.property===void 0)throw new Error("fields cannot contain unnamed variable-length layout");let oe=-1;try{oe=R.reduce((ue,fe)=>ue+fe.getSpan(),0)}catch{}super(oe,Z),this.fields=R,this.decodePrefixes=!!J}getSpan(R,Z=0){if(0<=this.span)return this.span;let J=0;try{J=this.fields.reduce((oe,ue)=>{const fe=ue.getSpan(R,Z);return Z+=fe,oe+fe},0)}catch{throw new RangeError("indeterminate span")}return J}decode(R,Z=0){e(R);const J=this.makeDestinationObject();for(const oe of this.fields)if(oe.property!==void 0&&(J[oe.property]=oe.decode(R,Z)),Z+=oe.getSpan(R,Z),this.decodePrefixes&&R.length===Z)break;return J}encode(R,Z,J=0){const oe=J;let ue=0,fe=0;for(const _e of this.fields){let Le=_e.span;if(fe=0<Le?Le:0,_e.property!==void 0){const Ne=R[_e.property];Ne!==void 0&&(fe=_e.encode(Ne,Z,J),0>Le&&(Le=_e.getSpan(Z,J)))}ue=J,J+=Le}return ue+fe-oe}fromArray(R){const Z=this.makeDestinationObject();for(const J of this.fields)J.property!==void 0&&0<R.length&&(Z[J.property]=R.shift());return Z}layoutFor(R){if(typeof R!="string")throw new TypeError("property must be string");for(const Z of this.fields)if(Z.property===R)return Z}offsetOf(R){if(typeof R!="string")throw new TypeError("property must be string");let Z=0;for(const J of this.fields){if(J.property===R)return Z;0>J.span?Z=-1:0<=Z&&(Z+=J.span)}}}Se.Structure=U;class z{constructor(R){this.property=R}decode(R,Z){throw new Error("UnionDiscriminator is abstract")}encode(R,Z,J){throw new Error("UnionDiscriminator is abstract")}}Se.UnionDiscriminator=z;class Y extends z{constructor(R,Z){if(!(R instanceof o&&R.isCount()))throw new TypeError("layout must be an unsigned integer ExternalLayout");super(Z||R.property||"variant"),this.layout=R}decode(R,Z){return this.layout.decode(R,Z)}encode(R,Z,J){return this.layout.encode(R,Z,J)}}Se.UnionLayoutDiscriminator=Y;class V extends r{constructor(R,Z,J){let oe;if(R instanceof u||R instanceof d)oe=new Y(new c(R));else if(R instanceof o&&R.isCount())oe=new Y(R);else if(R instanceof z)oe=R;else throw new TypeError("discr must be a UnionDiscriminator or an unsigned integer layout");if(Z===void 0&&(Z=null),!(Z===null||Z instanceof r))throw new TypeError("defaultLayout must be null or a Layout");if(Z!==null){if(0>Z.span)throw new Error("defaultLayout must have constant span");Z.property===void 0&&(Z=Z.replicate("content"))}let ue=-1;Z&&(ue=Z.span,0<=ue&&(R instanceof u||R instanceof d)&&(ue+=oe.layout.span)),super(ue,J),this.discriminator=oe,this.usesPrefixDiscriminator=R instanceof u||R instanceof d,this.defaultLayout=Z,this.registry={};let fe=this.defaultGetSourceVariant.bind(this);this.getSourceVariant=function(_e){return fe(_e)},this.configGetSourceVariant=function(_e){fe=_e.bind(this)}}getSpan(R,Z=0){if(0<=this.span)return this.span;const J=this.getVariant(R,Z);if(!J)throw new Error("unable to determine span for unrecognized variant");return J.getSpan(R,Z)}defaultGetSourceVariant(R){if(Object.prototype.hasOwnProperty.call(R,this.discriminator.property)){if(this.defaultLayout&&this.defaultLayout.property&&Object.prototype.hasOwnProperty.call(R,this.defaultLayout.property))return;const Z=this.registry[R[this.discriminator.property]];if(Z&&(!Z.layout||Z.property&&Object.prototype.hasOwnProperty.call(R,Z.property)))return Z}else for(const Z in this.registry){const J=this.registry[Z];if(J.property&&Object.prototype.hasOwnProperty.call(R,J.property))return J}throw new Error("unable to infer src variant")}decode(R,Z=0){let J;const oe=this.discriminator,ue=oe.decode(R,Z),fe=this.registry[ue];if(fe===void 0){const _e=this.defaultLayout;let Le=0;this.usesPrefixDiscriminator&&(Le=oe.layout.span),J=this.makeDestinationObject(),J[oe.property]=ue,J[_e.property]=_e.decode(R,Z+Le)}else J=fe.decode(R,Z);return J}encode(R,Z,J=0){const oe=this.getSourceVariant(R);if(oe===void 0){const ue=this.discriminator,fe=this.defaultLayout;let _e=0;return this.usesPrefixDiscriminator&&(_e=ue.layout.span),ue.encode(R[ue.property],Z,J),_e+fe.encode(R[fe.property],Z,J+_e)}return oe.encode(R,Z,J)}addVariant(R,Z,J){const oe=new N(this,R,Z,J);return this.registry[R]=oe,oe}getVariant(R,Z=0){let J;return R instanceof Uint8Array?J=this.discriminator.decode(R,Z):J=R,this.registry[J]}}Se.Union=V;class N extends r{constructor(R,Z,J,oe){if(!(R instanceof V))throw new TypeError("union must be a Union");if(!Number.isInteger(Z)||0>Z)throw new TypeError("variant must be a (non-negative) integer");if(typeof J=="string"&&oe===void 0&&(oe=J,J=null),J){if(!(J instanceof r))throw new TypeError("layout must be a Layout");if(R.defaultLayout!==null&&0<=J.span&&J.span>R.defaultLayout.span)throw new Error("variant span exceeds span of containing union");if(typeof oe!="string")throw new TypeError("variant must have a String property")}let ue=R.span;0>R.span&&(ue=J?J.span:0,0<=ue&&R.usesPrefixDiscriminator&&(ue+=R.discriminator.layout.span)),super(ue,oe),this.union=R,this.variant=Z,this.layout=J||null}getSpan(R,Z=0){if(0<=this.span)return this.span;let J=0;this.union.usesPrefixDiscriminator&&(J=this.union.discriminator.layout.span);let oe=0;return this.layout&&(oe=this.layout.getSpan(R,Z+J)),J+oe}decode(R,Z=0){const J=this.makeDestinationObject();if(this!==this.union.getVariant(R,Z))throw new Error("variant mismatch");let oe=0;return this.union.usesPrefixDiscriminator&&(oe=this.union.discriminator.layout.span),this.layout?J[this.property]=this.layout.decode(R,Z+oe):this.property?J[this.property]=!0:this.union.usesPrefixDiscriminator&&(J[this.union.discriminator.property]=this.variant),J}encode(R,Z,J=0){let oe=0;if(this.union.usesPrefixDiscriminator&&(oe=this.union.discriminator.layout.span),this.layout&&!Object.prototype.hasOwnProperty.call(R,this.property))throw new TypeError("variant lacks property "+this.property);this.union.discriminator.encode(this.variant,Z,J);let ue=oe;if(this.layout&&(this.layout.encode(R[this.property],Z,J+oe),ue+=this.layout.getSpan(Z,J+oe),0<=this.union.span&&ue>this.union.span))throw new Error("encoded variant overruns containing union");return ue}fromArray(R){if(this.layout)return this.layout.fromArray(R)}}Se.VariantLayout=N;function _(C){return 0>C&&(C+=4294967296),C}class k extends r{constructor(R,Z,J){if(!(R instanceof u||R instanceof d))throw new TypeError("word must be a UInt or UIntBE layout");if(typeof Z=="string"&&J===void 0&&(J=Z,Z=!1),4<R.span)throw new RangeError("word cannot exceed 32 bits");super(R.span,J),this.word=R,this.msb=!!Z,this.fields=[];let oe=0;this._packedSetValue=function(ue){return oe=_(ue),this},this._packedGetValue=function(){return oe}}decode(R,Z=0){const J=this.makeDestinationObject(),oe=this.word.decode(R,Z);this._packedSetValue(oe);for(const ue of this.fields)ue.property!==void 0&&(J[ue.property]=ue.decode(R));return J}encode(R,Z,J=0){const oe=this.word.decode(Z,J);this._packedSetValue(oe);for(const ue of this.fields)if(ue.property!==void 0){const fe=R[ue.property];fe!==void 0&&ue.encode(fe)}return this.word.encode(this._packedGetValue(),Z,J)}addField(R,Z){const J=new O(this,R,Z);return this.fields.push(J),J}addBoolean(R){const Z=new W(this,R);return this.fields.push(Z),Z}fieldFor(R){if(typeof R!="string")throw new TypeError("property must be string");for(const Z of this.fields)if(Z.property===R)return Z}}Se.BitStructure=k;class O{constructor(R,Z,J){if(!(R instanceof k))throw new TypeError("container must be a BitStructure");if(!Number.isInteger(Z)||0>=Z)throw new TypeError("bits must be positive integer");const oe=8*R.span,ue=R.fields.reduce((fe,_e)=>fe+_e.bits,0);if(Z+ue>oe)throw new Error("bits too long for span remainder ("+(oe-ue)+" of "+oe+" remain)");this.container=R,this.bits=Z,this.valueMask=(1<<Z)-1,Z===32&&(this.valueMask=4294967295),this.start=ue,this.container.msb&&(this.start=oe-ue-Z),this.wordMask=_(this.valueMask<<this.start),this.property=J}decode(R,Z){const J=this.container._packedGetValue();return _(J&this.wordMask)>>>this.start}encode(R){if(typeof R!="number"||!Number.isInteger(R)||R!==_(R&this.valueMask))throw new TypeError(i("BitField.encode",this)+" value must be integer not exceeding "+this.valueMask);const Z=this.container._packedGetValue(),J=_(R<<this.start);this.container._packedSetValue(_(Z&~this.wordMask)|J)}}Se.BitField=O;class W extends O{constructor(R,Z){super(R,1,Z)}decode(R,Z){return!!super.decode(R,Z)}encode(R){typeof R=="boolean"&&(R=+R),super.encode(R)}}Se.Boolean=W;class q extends r{constructor(R,Z){if(!(R instanceof o&&R.isCount()||Number.isInteger(R)&&0<=R))throw new TypeError("length must be positive integer or an unsigned integer ExternalLayout");let J=-1;R instanceof o||(J=R),super(J,Z),this.length=R}getSpan(R,Z){let J=this.span;return 0>J&&(J=this.length.decode(R,Z)),J}decode(R,Z=0){let J=this.span;return 0>J&&(J=this.length.decode(R,Z)),t(R).slice(Z,Z+J)}encode(R,Z,J){let oe=this.length;if(this.length instanceof o&&(oe=R.length),!(R instanceof Uint8Array&&oe===R.length))throw new TypeError(i("Blob.encode",this)+" requires (length "+oe+") Uint8Array as src");if(J+oe>Z.length)throw new RangeError("encoding overruns Uint8Array");const ue=t(R);return t(Z).write(ue.toString("hex"),J,oe,"hex"),this.length instanceof o&&this.length.encode(oe,Z,J),oe}}Se.Blob=q;class X extends r{constructor(R){super(-1,R)}getSpan(R,Z=0){e(R);let J=Z;for(;J<R.length&&R[J]!==0;)J+=1;return 1+J-Z}decode(R,Z=0){const J=this.getSpan(R,Z);return t(R).slice(Z,Z+J-1).toString("utf-8")}encode(R,Z,J=0){typeof R!="string"&&(R=String(R));const oe=n.Buffer.from(R,"utf8"),ue=oe.length;if(J+ue>Z.length)throw new RangeError("encoding overruns Buffer");const fe=t(Z);return oe.copy(fe,J),fe[J+ue]=0,ue+1}}Se.CString=X;class ne extends r{constructor(R,Z){if(typeof R=="string"&&Z===void 0&&(Z=R,R=void 0),R===void 0)R=-1;else if(!Number.isInteger(R))throw new TypeError("maxSpan must be an integer");super(-1,Z),this.maxSpan=R}getSpan(R,Z=0){return e(R),R.length-Z}decode(R,Z=0){const J=this.getSpan(R,Z);if(0<=this.maxSpan&&this.maxSpan<J)throw new RangeError("text length exceeds maxSpan");return t(R).slice(Z,Z+J).toString("utf-8")}encode(R,Z,J=0){typeof R!="string"&&(R=String(R));const oe=n.Buffer.from(R,"utf8"),ue=oe.length;if(0<=this.maxSpan&&this.maxSpan<ue)throw new RangeError("text length exceeds maxSpan");if(J+ue>Z.length)throw new RangeError("encoding overruns Buffer");return oe.copy(t(Z),J),ue}}Se.UTF8=ne;class $ extends r{constructor(R,Z){super(0,Z),this.value=R}decode(R,Z){return this.value}encode(R,Z,J){return 0}}return Se.Constant=$,Se.greedy=(C,R)=>new a(C,R),Se.offset=(C,R,Z)=>new c(C,R,Z),Se.u8=C=>new u(1,C),Se.u16=C=>new u(2,C),Se.u24=C=>new u(3,C),Se.u32=C=>new u(4,C),Se.u40=C=>new u(5,C),Se.u48=C=>new u(6,C),Se.nu64=C=>new S(C),Se.u16be=C=>new d(2,C),Se.u24be=C=>new d(3,C),Se.u32be=C=>new d(4,C),Se.u40be=C=>new d(5,C),Se.u48be=C=>new d(6,C),Se.nu64be=C=>new b(C),Se.s8=C=>new f(1,C),Se.s16=C=>new f(2,C),Se.s24=C=>new f(3,C),Se.s32=C=>new f(4,C),Se.s40=C=>new f(5,C),Se.s48=C=>new f(6,C),Se.ns64=C=>new x(C),Se.s16be=C=>new g(2,C),Se.s24be=C=>new g(3,C),Se.s32be=C=>new g(4,C),Se.s40be=C=>new g(5,C),Se.s48be=C=>new g(6,C),Se.ns64be=C=>new E(C),Se.f32=C=>new M(C),Se.f32be=C=>new j(C),Se.f64=C=>new D(C),Se.f64be=C=>new H(C),Se.struct=(C,R,Z)=>new U(C,R,Z),Se.bits=(C,R,Z)=>new k(C,R,Z),Se.seq=(C,R,Z)=>new L(C,R,Z),Se.union=(C,R,Z)=>new V(C,R,Z),Se.unionLayoutDiscriminator=(C,R)=>new Y(C,R),Se.blob=(C,R)=>new q(C,R),Se.cstr=C=>new X(C),Se.utf8=(C,R)=>new ne(C,R),Se.constant=(C,R)=>new $(C,R),Se}var ae=wye(),su={},dO;function vye(){if(dO)return su;dO=1,Object.defineProperty(su,"__esModule",{value:!0});function n(i){{const s=Buffer.from(i);s.reverse();const o=s.toString("hex");return o.length===0?BigInt(0):BigInt(`0x${o}`)}}su.toBigIntLE=n;function e(i){{const s=i.toString("hex");return s.length===0?BigInt(0):BigInt(`0x${s}`)}}su.toBigIntBE=e;function t(i,s){{const o=i.toString(16),a=Buffer.from(o.padStart(s*2,"0").slice(0,s*2),"hex");return a.reverse(),a}}su.toBufferLE=t;function r(i,s){{const o=i.toString(16);return Buffer.from(o.padStart(s*2,"0").slice(0,s*2),"hex")}}return su.toBufferBE=r,su}var hO=vye();class Sye extends TypeError{constructor(e,t){let r;const{message:i,explanation:s,...o}=e,{path:a}=e,c=a.length===0?i:`At path: ${a.join(".")} -- ${i}`;super(s??c),s!=null&&(this.cause=c),Object.assign(this,o),this.name=this.constructor.name,this.failures=()=>r??(r=[e,...t()])}}function xye(n){return dg(n)&&typeof n[Symbol.iterator]=="function"}function dg(n){return typeof n=="object"&&n!=null}function N0(n){return dg(n)&&!Array.isArray(n)}function Lo(n){return typeof n=="symbol"?n.toString():typeof n=="string"?JSON.stringify(n):`${n}`}function bye(n){const{done:e,value:t}=n.next();return e?void 0:t}function _ye(n,e,t,r){if(n===!0)return;n===!1?n={}:typeof n=="string"&&(n={message:n});const{path:i,branch:s}=e,{type:o}=t,{refinement:a,message:c=`Expected a value of type \`${o}\`${a?` with refinement \`${a}\``:""}, but received: \`${Lo(r)}\``}=n;return{value:r,type:o,refinement:a,key:i[i.length-1],path:i,branch:s,...n,message:c}}function*fO(n,e,t,r){xye(n)||(n=[n]);for(const i of n){const s=_ye(i,e,t,r);s&&(yield s)}}function*VP(n,e,t={}){const{path:r=[],branch:i=[n],coerce:s=!1,mask:o=!1}=t,a={path:r,branch:i,mask:o};s&&(n=e.coercer(n,a));let c="valid";for(const u of e.validator(n,a))u.explanation=t.message,c="not_valid",yield[u,void 0];for(let[u,d,f]of e.entries(n,a)){const g=VP(d,f,{path:u===void 0?r:[...r,u],branch:u===void 0?i:[...i,d],coerce:s,mask:o,message:t.message});for(const m of g)m[0]?(c=m[0].refinement!=null?"not_refined":"not_valid",yield[m[0],void 0]):s&&(d=m[1],u===void 0?n=d:n instanceof Map?n.set(u,d):n instanceof Set?n.add(d):dg(n)&&(d!==void 0||u in n)&&(n[u]=d))}if(c!=="not_valid")for(const u of e.refiner(n,a))u.explanation=t.message,c="not_refined",yield[u,void 0];c==="valid"&&(yield[void 0,n])}let Pa=class{constructor(e){const{type:t,schema:r,validator:i,refiner:s,coercer:o=c=>c,entries:a=function*(){}}=e;this.type=t,this.schema=r,this.entries=a,this.coercer=o,i?this.validator=(c,u)=>{const d=i(c,u);return fO(d,u,this,c)}:this.validator=()=>[],s?this.refiner=(c,u)=>{const d=s(c,u);return fO(d,u,this,c)}:this.refiner=()=>[]}assert(e,t){return Iye(e,this,t)}create(e,t){return Be(e,this,t)}is(e){return E9(e,this)}mask(e,t){return Eye(e,this,t)}validate(e,t={}){return hg(e,this,t)}};function Iye(n,e,t){const r=hg(n,e,{message:t});if(r[0])throw r[0]}function Be(n,e,t){const r=hg(n,e,{coerce:!0,message:t});if(r[0])throw r[0];return r[1]}function Eye(n,e,t){const r=hg(n,e,{coerce:!0,mask:!0,message:t});if(r[0])throw r[0];return r[1]}function E9(n,e){return!hg(n,e)[0]}function hg(n,e,t={}){const r=VP(n,e,t),i=bye(r);return i[0]?[new Sye(i[0],function*(){for(const o of r)o[0]&&(yield o[0])}),void 0]:[void 0,i[1]]}function qu(n,e){return new Pa({type:n,schema:null,validator:e})}function Cye(){return qu("any",()=>!0)}function ze(n){return new Pa({type:"array",schema:n,*entries(e){if(n&&Array.isArray(e))for(const[t,r]of e.entries())yield[t,r,n]},coercer(e){return Array.isArray(e)?e.slice():e},validator(e){return Array.isArray(e)||`Expected an array value, but received: ${Lo(e)}`}})}function Sa(){return qu("boolean",n=>typeof n=="boolean")}function YP(n){return qu("instance",e=>e instanceof n||`Expected a \`${n.name}\` instance, but received: ${Lo(e)}`)}function Jn(n){const e=Lo(n),t=typeof n;return new Pa({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?n:null,validator(r){return r===n||`Expected the literal \`${e}\`, but received: ${Lo(r)}`}})}function Pye(){return qu("never",()=>!1)}function $e(n){return new Pa({...n,validator:(e,t)=>e===null||n.validator(e,t),refiner:(e,t)=>e===null||n.refiner(e,t)})}function we(){return qu("number",n=>typeof n=="number"&&!isNaN(n)||`Expected a number, but received: ${Lo(n)}`)}function gt(n){return new Pa({...n,validator:(e,t)=>e===void 0||n.validator(e,t),refiner:(e,t)=>e===void 0||n.refiner(e,t)})}function C9(n,e){return new Pa({type:"record",schema:null,*entries(t){if(dg(t))for(const r in t){const i=t[r];yield[r,r,n],yield[r,i,e]}},validator(t){return N0(t)||`Expected an object, but received: ${Lo(t)}`},coercer(t){return N0(t)?{...t}:t}})}function Oe(){return qu("string",n=>typeof n=="string"||`Expected a string, but received: ${Lo(n)}`)}function XP(n){const e=Pye();return new Pa({type:"tuple",schema:null,*entries(t){if(Array.isArray(t)){const r=Math.max(n.length,t.length);for(let i=0;i<r;i++)yield[i,t[i],n[i]||e]}},validator(t){return Array.isArray(t)||`Expected an array, but received: ${Lo(t)}`},coercer(t){return Array.isArray(t)?t.slice():t}})}function Te(n){const e=Object.keys(n);return new Pa({type:"type",schema:n,*entries(t){if(dg(t))for(const r of e)yield[r,t[r],n[r]]},validator(t){return N0(t)||`Expected an object, but received: ${Lo(t)}`},coercer(t){return N0(t)?{...t}:t}})}function Li(n){const e=n.map(t=>t.type).join(" | ");return new Pa({type:"union",schema:null,coercer(t,r){for(const i of n){const[s,o]=i.validate(t,{coerce:!0,mask:r.mask});if(!s)return o}return t},validator(t,r){const i=[];for(const s of n){const[...o]=VP(t,s,r),[a]=o;if(a[0])for(const[c]of o)c&&i.push(c);else return[]}return[`Expected the value to satisfy a union of \`${e}\`, but received: ${Lo(t)}`,...i]}})}function Bh(){return qu("unknown",()=>!0)}function fg(n,e,t){return new Pa({...n,coercer:(r,i)=>E9(r,e)?n.coercer(t(r,i),i):n.coercer(r,i)})}var ny,Mye=new Uint8Array(16);function P9(){if(!ny&&(ny=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!ny))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ny(Mye)}const Tye=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function iv(n){return typeof n=="string"&&Tye.test(n)}var Hr=[];for(var o_=0;o_<256;++o_)Hr.push((o_+256).toString(16).substr(1));function sv(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=(Hr[n[e+0]]+Hr[n[e+1]]+Hr[n[e+2]]+Hr[n[e+3]]+"-"+Hr[n[e+4]]+Hr[n[e+5]]+"-"+Hr[n[e+6]]+Hr[n[e+7]]+"-"+Hr[n[e+8]]+Hr[n[e+9]]+"-"+Hr[n[e+10]]+Hr[n[e+11]]+Hr[n[e+12]]+Hr[n[e+13]]+Hr[n[e+14]]+Hr[n[e+15]]).toLowerCase();if(!iv(t))throw TypeError("Stringified UUID is invalid");return t}var pO,a_,c_=0,l_=0;function kye(n,e,t){var r=e&&t||0,i=e||new Array(16);n=n||{};var s=n.node||pO,o=n.clockseq!==void 0?n.clockseq:a_;if(s==null||o==null){var a=n.random||(n.rng||P9)();s==null&&(s=pO=[a[0]|1,a[1],a[2],a[3],a[4],a[5]]),o==null&&(o=a_=(a[6]<<8|a[7])&16383)}var c=n.msecs!==void 0?n.msecs:Date.now(),u=n.nsecs!==void 0?n.nsecs:l_+1,d=c-c_+(u-l_)/1e4;if(d<0&&n.clockseq===void 0&&(o=o+1&16383),(d<0||c>c_)&&n.nsecs===void 0&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c_=c,l_=u,a_=o,c+=122192928e5;var f=((c&268435455)*1e4+u)%4294967296;i[r++]=f>>>24&255,i[r++]=f>>>16&255,i[r++]=f>>>8&255,i[r++]=f&255;var g=c/4294967296*1e4&268435455;i[r++]=g>>>8&255,i[r++]=g&255,i[r++]=g>>>24&15|16,i[r++]=g>>>16&255,i[r++]=o>>>8|128,i[r++]=o&255;for(var m=0;m<6;++m)i[r+m]=s[m];return e||sv(i)}function M9(n){if(!iv(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}function Aye(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var Rye="6ba7b810-9dad-11d1-80b4-00c04fd430c8",jye="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function T9(n,e,t){function r(i,s,o,a){if(typeof i=="string"&&(i=Aye(i)),typeof s=="string"&&(s=M9(s)),s.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(s),c.set(i,s.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,o){a=a||0;for(var u=0;u<16;++u)o[a+u]=c[u];return o}return sv(c)}try{r.name=n}catch{}return r.DNS=Rye,r.URL=jye,r}function Dye(n){if(typeof n=="string"){var e=unescape(encodeURIComponent(n));n=new Uint8Array(e.length);for(var t=0;t<e.length;++t)n[t]=e.charCodeAt(t)}return Oye(Lye(Nye(n),n.length*8))}function Oye(n){for(var e=[],t=n.length*32,r="0123456789abcdef",i=0;i<t;i+=8){var s=n[i>>5]>>>i%32&255,o=parseInt(r.charAt(s>>>4&15)+r.charAt(s&15),16);e.push(o)}return e}function k9(n){return(n+64>>>9<<4)+14+1}function Lye(n,e){n[e>>5]|=128<<e%32,n[k9(e)-1]=e;for(var t=1732584193,r=-271733879,i=-1732584194,s=271733878,o=0;o<n.length;o+=16){var a=t,c=r,u=i,d=s;t=hi(t,r,i,s,n[o],7,-680876936),s=hi(s,t,r,i,n[o+1],12,-389564586),i=hi(i,s,t,r,n[o+2],17,606105819),r=hi(r,i,s,t,n[o+3],22,-1044525330),t=hi(t,r,i,s,n[o+4],7,-176418897),s=hi(s,t,r,i,n[o+5],12,1200080426),i=hi(i,s,t,r,n[o+6],17,-1473231341),r=hi(r,i,s,t,n[o+7],22,-45705983),t=hi(t,r,i,s,n[o+8],7,1770035416),s=hi(s,t,r,i,n[o+9],12,-1958414417),i=hi(i,s,t,r,n[o+10],17,-42063),r=hi(r,i,s,t,n[o+11],22,-1990404162),t=hi(t,r,i,s,n[o+12],7,1804603682),s=hi(s,t,r,i,n[o+13],12,-40341101),i=hi(i,s,t,r,n[o+14],17,-1502002290),r=hi(r,i,s,t,n[o+15],22,1236535329),t=fi(t,r,i,s,n[o+1],5,-165796510),s=fi(s,t,r,i,n[o+6],9,-1069501632),i=fi(i,s,t,r,n[o+11],14,643717713),r=fi(r,i,s,t,n[o],20,-373897302),t=fi(t,r,i,s,n[o+5],5,-701558691),s=fi(s,t,r,i,n[o+10],9,38016083),i=fi(i,s,t,r,n[o+15],14,-660478335),r=fi(r,i,s,t,n[o+4],20,-405537848),t=fi(t,r,i,s,n[o+9],5,568446438),s=fi(s,t,r,i,n[o+14],9,-1019803690),i=fi(i,s,t,r,n[o+3],14,-187363961),r=fi(r,i,s,t,n[o+8],20,1163531501),t=fi(t,r,i,s,n[o+13],5,-1444681467),s=fi(s,t,r,i,n[o+2],9,-51403784),i=fi(i,s,t,r,n[o+7],14,1735328473),r=fi(r,i,s,t,n[o+12],20,-1926607734),t=pi(t,r,i,s,n[o+5],4,-378558),s=pi(s,t,r,i,n[o+8],11,-2022574463),i=pi(i,s,t,r,n[o+11],16,1839030562),r=pi(r,i,s,t,n[o+14],23,-35309556),t=pi(t,r,i,s,n[o+1],4,-1530992060),s=pi(s,t,r,i,n[o+4],11,1272893353),i=pi(i,s,t,r,n[o+7],16,-155497632),r=pi(r,i,s,t,n[o+10],23,-1094730640),t=pi(t,r,i,s,n[o+13],4,681279174),s=pi(s,t,r,i,n[o],11,-358537222),i=pi(i,s,t,r,n[o+3],16,-722521979),r=pi(r,i,s,t,n[o+6],23,76029189),t=pi(t,r,i,s,n[o+9],4,-640364487),s=pi(s,t,r,i,n[o+12],11,-421815835),i=pi(i,s,t,r,n[o+15],16,530742520),r=pi(r,i,s,t,n[o+2],23,-995338651),t=gi(t,r,i,s,n[o],6,-198630844),s=gi(s,t,r,i,n[o+7],10,1126891415),i=gi(i,s,t,r,n[o+14],15,-1416354905),r=gi(r,i,s,t,n[o+5],21,-57434055),t=gi(t,r,i,s,n[o+12],6,1700485571),s=gi(s,t,r,i,n[o+3],10,-1894986606),i=gi(i,s,t,r,n[o+10],15,-1051523),r=gi(r,i,s,t,n[o+1],21,-2054922799),t=gi(t,r,i,s,n[o+8],6,1873313359),s=gi(s,t,r,i,n[o+15],10,-30611744),i=gi(i,s,t,r,n[o+6],15,-1560198380),r=gi(r,i,s,t,n[o+13],21,1309151649),t=gi(t,r,i,s,n[o+4],6,-145523070),s=gi(s,t,r,i,n[o+11],10,-1120210379),i=gi(i,s,t,r,n[o+2],15,718787259),r=gi(r,i,s,t,n[o+9],21,-343485551),t=al(t,a),r=al(r,c),i=al(i,u),s=al(s,d)}return[t,r,i,s]}function Nye(n){if(n.length===0)return[];for(var e=n.length*8,t=new Uint32Array(k9(e)),r=0;r<e;r+=8)t[r>>5]|=(n[r/8]&255)<<r%32;return t}function al(n,e){var t=(n&65535)+(e&65535),r=(n>>16)+(e>>16)+(t>>16);return r<<16|t&65535}function Bye(n,e){return n<<e|n>>>32-e}function ov(n,e,t,r,i,s){return al(Bye(al(al(e,n),al(r,s)),i),t)}function hi(n,e,t,r,i,s,o){return ov(e&t|~e&r,n,e,i,s,o)}function fi(n,e,t,r,i,s,o){return ov(e&r|t&~r,n,e,i,s,o)}function pi(n,e,t,r,i,s,o){return ov(e^t^r,n,e,i,s,o)}function gi(n,e,t,r,i,s,o){return ov(t^(e|~r),n,e,i,s,o)}var Fye=T9("v3",48,Dye);function zye(n,e,t){n=n||{};var r=n.random||(n.rng||P9)();if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,e){t=t||0;for(var i=0;i<16;++i)e[t+i]=r[i];return e}return sv(r)}function Uye(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function u_(n,e){return n<<e|n>>>32-e}function $ye(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var s=n.length/4+2,o=Math.ceil(s/16),a=new Array(o),c=0;c<o;++c){for(var u=new Uint32Array(16),d=0;d<16;++d)u[d]=n[c*64+d*4]<<24|n[c*64+d*4+1]<<16|n[c*64+d*4+2]<<8|n[c*64+d*4+3];a[c]=u}a[o-1][14]=(n.length-1)*8/Math.pow(2,32),a[o-1][14]=Math.floor(a[o-1][14]),a[o-1][15]=(n.length-1)*8&4294967295;for(var f=0;f<o;++f){for(var g=new Uint32Array(80),m=0;m<16;++m)g[m]=a[f][m];for(var v=16;v<80;++v)g[v]=u_(g[v-3]^g[v-8]^g[v-14]^g[v-16],1);for(var w=t[0],S=t[1],b=t[2],x=t[3],E=t[4],M=0;M<80;++M){var j=Math.floor(M/20),D=u_(w,5)+Uye(j,S,b,x)+E+e[j]+g[M]>>>0;E=x,x=b,b=u_(S,30)>>>0,S=w,w=D}t[0]=t[0]+w>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+b>>>0,t[3]=t[3]+x>>>0,t[4]=t[4]+E>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Hye=T9("v5",80,$ye);const Wye="00000000-0000-0000-0000-000000000000";function Kye(n){if(!iv(n))throw TypeError("Invalid UUID");return parseInt(n.substr(14,1),16)}const qye=Object.freeze(Object.defineProperty({__proto__:null,NIL:Wye,parse:M9,stringify:sv,v1:kye,v3:Fye,v4:zye,v5:Hye,validate:iv,version:Kye},Symbol.toStringTag,{value:"Module"})),A9=lC(qye);var d_,gO;function Gye(){if(gO)return d_;gO=1;const n=A9.v4;return d_=function(t,r,i,s){if(typeof t!="string")throw new TypeError(t+" must be a string");s=s||{};const o=typeof s.version=="number"?s.version:2;if(o!==1&&o!==2)throw new TypeError(o+" must be 1 or 2");const a={method:t};if(o===2&&(a.jsonrpc="2.0"),r){if(typeof r!="object"&&!Array.isArray(r))throw new TypeError(r+" must be an object, array or omitted");a.params=r}if(typeof i>"u"){const c=typeof s.generator=="function"?s.generator:function(){return n()};a.id=c(a,s)}else o===2&&i===null?s.notificationIdNull&&(a.id=null):a.id=i;return a},d_}var h_,mO;function Vye(){if(mO)return h_;mO=1;const n=A9.v4,e=Gye(),t=function(r,i){if(!(this instanceof t))return new t(r,i);i||(i={}),this.options={reviver:typeof i.reviver<"u"?i.reviver:null,replacer:typeof i.replacer<"u"?i.replacer:null,generator:typeof i.generator<"u"?i.generator:function(){return n()},version:typeof i.version<"u"?i.version:2,notificationIdNull:typeof i.notificationIdNull=="boolean"?i.notificationIdNull:!1},this.callServer=r};return h_=t,t.prototype.request=function(r,i,s,o){const a=this;let c=null;const u=Array.isArray(r)&&typeof i=="function";if(this.options.version===1&&u)throw new TypeError("JSON-RPC 1.0 does not support batching");if(u||!u&&r&&typeof r=="object"&&typeof i=="function")o=i,c=r;else{typeof s=="function"&&(o=s,s=void 0);const g=typeof o=="function";try{c=e(r,i,s,{generator:this.options.generator,version:this.options.version,notificationIdNull:this.options.notificationIdNull})}catch(m){if(g)return o(m);throw m}if(!g)return c}let f;try{f=JSON.stringify(c,this.options.replacer)}catch(g){return o(g)}return this.callServer(f,function(g,m){a._parseResponse(g,m,o)}),c},t.prototype._parseResponse=function(r,i,s){if(r){s(r);return}if(!i)return s();let o;try{o=JSON.parse(i,this.options.reviver)}catch(a){return s(a)}if(s.length===3)if(Array.isArray(o)){const a=function(u){return typeof u.error<"u"},c=function(u){return!a(u)};return s(null,o.filter(a),o.filter(c))}else return s(null,o.error,o.result);s(null,o)},h_}var Yye=Vye();const Xye=fs(Yye);var f_={exports:{}},yO;function Zye(){return yO||(yO=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,u,d){this.fn=c,this.context=u,this.once=d||!1}function s(c,u,d,f,g){if(typeof d!="function")throw new TypeError("The listener must be a function");var m=new i(d,f||c,g),v=t?t+u:u;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],m]:c._events[v].push(m):(c._events[v]=m,c._eventsCount++),c}function o(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)e.call(d,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},a.prototype.listeners=function(u){var d=t?t+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,m=f.length,v=new Array(m);g<m;g++)v[g]=f[g].fn;return v},a.prototype.listenerCount=function(u){var d=t?t+u:u,f=this._events[d];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,d,f,g,m,v){var w=t?t+u:u;if(!this._events[w])return!1;var S=this._events[w],b=arguments.length,x,E;if(S.fn){switch(S.once&&this.removeListener(u,S.fn,void 0,!0),b){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,f),!0;case 4:return S.fn.call(S.context,d,f,g),!0;case 5:return S.fn.call(S.context,d,f,g,m),!0;case 6:return S.fn.call(S.context,d,f,g,m,v),!0}for(E=1,x=new Array(b-1);E<b;E++)x[E-1]=arguments[E];S.fn.apply(S.context,x)}else{var M=S.length,j;for(E=0;E<M;E++)switch(S[E].once&&this.removeListener(u,S[E].fn,void 0,!0),b){case 1:S[E].fn.call(S[E].context);break;case 2:S[E].fn.call(S[E].context,d);break;case 3:S[E].fn.call(S[E].context,d,f);break;case 4:S[E].fn.call(S[E].context,d,f,g);break;default:if(!x)for(j=1,x=new Array(b-1);j<b;j++)x[j-1]=arguments[j];S[E].fn.apply(S[E].context,x)}}return!0},a.prototype.on=function(u,d,f){return s(this,u,d,f,!1)},a.prototype.once=function(u,d,f){return s(this,u,d,f,!0)},a.prototype.removeListener=function(u,d,f,g){var m=t?t+u:u;if(!this._events[m])return this;if(!d)return o(this,m),this;var v=this._events[m];if(v.fn)v.fn===d&&(!g||v.once)&&(!f||v.context===f)&&o(this,m);else{for(var w=0,S=[],b=v.length;w<b;w++)(v[w].fn!==d||g&&!v[w].once||f&&v[w].context!==f)&&S.push(v[w]);S.length?this._events[m]=S.length===1?S[0]:S:o(this,m)}return this},a.prototype.removeAllListeners=function(u){var d;return u?(d=t?t+u:u,this._events[d]&&o(this,d)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(f_)),f_.exports}var Qye=Zye();const R9=fs(Qye);var Jye=class extends R9{constructor(e,t,r){super();G(this,"socket");this.socket=new window.WebSocket(e,r),this.socket.onopen=()=>this.emit("open"),this.socket.onmessage=i=>this.emit("message",i.data),this.socket.onerror=i=>this.emit("error",i),this.socket.onclose=i=>{this.emit("close",i.code,i.reason)}}send(e,t,r){const i=r||t;try{this.socket.send(e),i()}catch(s){i(s)}}close(e,t){this.socket.close(e,t)}addEventListener(e,t,r){this.socket.addEventListener(e,t,r)}};function e0e(n,e){return new Jye(n,e)}var t0e=class{encode(n){return JSON.stringify(n)}decode(n){return JSON.parse(n)}},n0e=class extends R9{constructor(e,t="ws://localhost:8080",{autoconnect:r=!0,reconnect:i=!0,reconnect_interval:s=1e3,max_reconnects:o=5,...a}={},c,u){super();G(this,"address");G(this,"rpc_id");G(this,"queue");G(this,"options");G(this,"autoconnect");G(this,"ready");G(this,"reconnect");G(this,"reconnect_timer_id");G(this,"reconnect_interval");G(this,"max_reconnects");G(this,"rest_options");G(this,"current_reconnects");G(this,"generate_request_id");G(this,"socket");G(this,"webSocketFactory");G(this,"dataPack");this.webSocketFactory=e,this.queue={},this.rpc_id=0,this.address=t,this.autoconnect=r,this.ready=!1,this.reconnect=i,this.reconnect_timer_id=void 0,this.reconnect_interval=s,this.max_reconnects=o,this.rest_options=a,this.current_reconnects=0,this.generate_request_id=c||(()=>++this.rpc_id),u?this.dataPack=u:this.dataPack=new t0e,this.autoconnect&&this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}connect(){this.socket||this._connect(this.address,{autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects,...this.rest_options})}call(e,t,r,i){return!i&&typeof r=="object"&&(i=r,r=null),new Promise((s,o)=>{if(!this.ready)return o(new Error("socket not ready"));const a=this.generate_request_id(e,t),c={jsonrpc:"2.0",method:e,params:t||void 0,id:a};this.socket.send(this.dataPack.encode(c),i,u=>{if(u)return o(u);this.queue[a]={promise:[s,o]},r&&(this.queue[a].timeout=setTimeout(()=>{delete this.queue[a],o(new Error("reply timeout"))},r))})})}async login(e){const t=await this.call("rpc.login",e);if(!t)throw new Error("authentication failed");return t}async listMethods(){return await this.call("__listMethods")}notify(e,t){return new Promise((r,i)=>{if(!this.ready)return i(new Error("socket not ready"));const s={jsonrpc:"2.0",method:e,params:t};this.socket.send(this.dataPack.encode(s),o=>{if(o)return i(o);r()})})}async subscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.on",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed subscribing to an event '"+e+"' with: "+t[e]);return t}async unsubscribe(e){typeof e=="string"&&(e=[e]);const t=await this.call("rpc.off",e);if(typeof e=="string"&&t[e]!=="ok")throw new Error("Failed unsubscribing from an event with: "+t);return t}close(e,t){this.socket.close(e||1e3,t)}setAutoReconnect(e){this.reconnect=e}setReconnectInterval(e){this.reconnect_interval=e}setMaxReconnects(e){this.max_reconnects=e}_connect(e,t){clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(e,t),this.socket.addEventListener("open",()=>{this.ready=!0,this.emit("open"),this.current_reconnects=0}),this.socket.addEventListener("message",({data:r})=>{r instanceof ArrayBuffer&&(r=Ct.Buffer.from(r).toString());try{r=this.dataPack.decode(r)}catch{return}if(r.notification&&this.listeners(r.notification).length){if(!Object.keys(r.params).length)return this.emit(r.notification);const i=[r.notification];if(r.params.constructor===Object)i.push(r.params);else for(let s=0;s<r.params.length;s++)i.push(r.params[s]);return Promise.resolve().then(()=>{this.emit.apply(this,i)})}if(!this.queue[r.id])return r.method?Promise.resolve().then(()=>{this.emit(r.method,r==null?void 0:r.params)}):void 0;"error"in r=="result"in r&&this.queue[r.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),this.queue[r.id].timeout&&clearTimeout(this.queue[r.id].timeout),r.error?this.queue[r.id].promise[1](r.error):this.queue[r.id].promise[0](r.result),delete this.queue[r.id]}),this.socket.addEventListener("error",r=>this.emit("error",r)),this.socket.addEventListener("close",({code:r,reason:i})=>{this.ready&&setTimeout(()=>this.emit("close",r,i),0),this.ready=!1,this.socket=void 0,r!==1e3&&(this.current_reconnects++,this.reconnect&&(this.max_reconnects>this.current_reconnects||this.max_reconnects===0)&&(this.reconnect_timer_id=setTimeout(()=>this._connect(e,t),this.reconnect_interval)))})}};class j9 extends u9{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Uge(e);const r=zP(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(r.length>i?e.create().update(r).digest():r);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),s.fill(0)}update(e){return R0(this),this.iHash.update(e),this}digestInto(e){R0(this),Qw(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:r,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const D9=(n,e,t)=>new j9(n,e).update(t).digest();D9.create=(n,e)=>new j9(n,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function wO(n){n.lowS!==void 0&&lc("lowS",n.lowS),n.prehash!==void 0&&lc("prehash",n.prehash)}function r0e(n){const e=HP(n);Nh(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:r,a:i}=e;if(t){if(!r.eql(i,r.ZERO))throw new Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:i0e,hexToBytes:s0e}=Mme,Va={Err:class extends Error{constructor(e=""){super(e)}},_tlv:{encode:(n,e)=>{const{Err:t}=Va;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const r=e.length/2,i=Vd(r);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=r>127?Vd(i.length/2|128):"";return Vd(n)+s+i+e},decode(n,e){const{Err:t}=Va;let r=0;if(n<0||n>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[r++]!==n)throw new t("tlv.decode: wrong tlv");const i=e[r++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const u=e.subarray(r,r+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const d of u)o=o<<8|d;if(r+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(r,r+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(n){const{Err:e}=Va;if(n<Za)throw new e("integer: negative integers are not allowed");let t=Vd(n);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(n){const{Err:e}=Va;if(n[0]&128)throw new e("invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return i0e(n)}},toSig(n){const{Err:e,_int:t,_tlv:r}=Va,i=typeof n=="string"?s0e(n):n;ug(i);const{v:s,l:o}=r.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=r.decode(2,s),{v:u,l:d}=r.decode(2,c);if(d.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(n){const{_tlv:e,_int:t}=Va,r=e.encode(2,t.encode(n.r)),i=e.encode(2,t.encode(n.s)),s=r+i;return e.encode(48,s)}},Za=BigInt(0),jr=BigInt(1);BigInt(2);const vO=BigInt(3);BigInt(4);function o0e(n){const e=r0e(n),{Fp:t}=e,r=nv(e.n,e.nBitLength),i=e.toBytes||((w,S,b)=>{const x=S.toAffine();return Lu(Uint8Array.from([4]),t.toBytes(x.x),t.toBytes(x.y))}),s=e.fromBytes||(w=>{const S=w.subarray(1),b=t.fromBytes(S.subarray(0,t.BYTES)),x=t.fromBytes(S.subarray(t.BYTES,2*t.BYTES));return{x:b,y:x}});function o(w){const{a:S,b}=e,x=t.sqr(w),E=t.mul(x,w);return t.add(t.add(E,t.mul(w,S)),b)}if(!t.eql(t.sqr(e.Gy),o(e.Gx)))throw new Error("bad generator point: equation left != right");function a(w){return tv(w,jr,e.n)}function c(w){const{allowedPrivateKeyLengths:S,nByteLength:b,wrapPrivateKey:x,n:E}=e;if(S&&typeof w!="bigint"){if(Du(w)&&(w=Ou(w)),typeof w!="string"||!S.includes(w.length))throw new Error("invalid private key");w=w.padStart(b*2,"0")}let M;try{M=typeof w=="bigint"?w:xu(_r("private key",w,b))}catch{throw new Error("invalid private key, expected hex or "+b+" bytes, got "+typeof w)}return x&&(M=Xn(M,E)),Xs("private key",M,jr,E),M}function u(w){if(!(w instanceof g))throw new Error("ProjectivePoint expected")}const d=Rp((w,S)=>{const{px:b,py:x,pz:E}=w;if(t.eql(E,t.ONE))return{x:b,y:x};const M=w.is0();S==null&&(S=M?t.ONE:t.inv(E));const j=t.mul(b,S),D=t.mul(x,S),H=t.mul(E,S);if(M)return{x:t.ZERO,y:t.ZERO};if(!t.eql(H,t.ONE))throw new Error("invZ was invalid");return{x:j,y:D}}),f=Rp(w=>{if(w.is0()){if(e.allowInfinityPoint&&!t.is0(w.py))return;throw new Error("bad point: ZERO")}const{x:S,y:b}=w.toAffine();if(!t.isValid(S)||!t.isValid(b))throw new Error("bad point: x or y not FE");const x=t.sqr(b),E=o(S);if(!t.eql(x,E))throw new Error("bad point: equation left != right");if(!w.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(S,b,x){if(this.px=S,this.py=b,this.pz=x,S==null||!t.isValid(S))throw new Error("x required");if(b==null||!t.isValid(b))throw new Error("y required");if(x==null||!t.isValid(x))throw new Error("z required");Object.freeze(this)}static fromAffine(S){const{x:b,y:x}=S||{};if(!S||!t.isValid(b)||!t.isValid(x))throw new Error("invalid affine point");if(S instanceof g)throw new Error("projective point not allowed");const E=M=>t.eql(M,t.ZERO);return E(b)&&E(x)?g.ZERO:new g(b,x,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(S){const b=t.invertBatch(S.map(x=>x.pz));return S.map((x,E)=>x.toAffine(b[E])).map(g.fromAffine)}static fromHex(S){const b=g.fromAffine(s(_r("pointHex",S)));return b.assertValidity(),b}static fromPrivateKey(S){return g.BASE.multiply(c(S))}static msm(S,b){return _9(g,r,S,b)}_setWindowSize(S){v.setWindowSize(this,S)}assertValidity(){f(this)}hasEvenY(){const{y:S}=this.toAffine();if(t.isOdd)return!t.isOdd(S);throw new Error("Field doesn't support isOdd")}equals(S){u(S);const{px:b,py:x,pz:E}=this,{px:M,py:j,pz:D}=S,H=t.eql(t.mul(b,D),t.mul(M,E)),L=t.eql(t.mul(x,D),t.mul(j,E));return H&&L}negate(){return new g(this.px,t.neg(this.py),this.pz)}double(){const{a:S,b}=e,x=t.mul(b,vO),{px:E,py:M,pz:j}=this;let D=t.ZERO,H=t.ZERO,L=t.ZERO,U=t.mul(E,E),z=t.mul(M,M),Y=t.mul(j,j),V=t.mul(E,M);return V=t.add(V,V),L=t.mul(E,j),L=t.add(L,L),D=t.mul(S,L),H=t.mul(x,Y),H=t.add(D,H),D=t.sub(z,H),H=t.add(z,H),H=t.mul(D,H),D=t.mul(V,D),L=t.mul(x,L),Y=t.mul(S,Y),V=t.sub(U,Y),V=t.mul(S,V),V=t.add(V,L),L=t.add(U,U),U=t.add(L,U),U=t.add(U,Y),U=t.mul(U,V),H=t.add(H,U),Y=t.mul(M,j),Y=t.add(Y,Y),U=t.mul(Y,V),D=t.sub(D,U),L=t.mul(Y,z),L=t.add(L,L),L=t.add(L,L),new g(D,H,L)}add(S){u(S);const{px:b,py:x,pz:E}=this,{px:M,py:j,pz:D}=S;let H=t.ZERO,L=t.ZERO,U=t.ZERO;const z=e.a,Y=t.mul(e.b,vO);let V=t.mul(b,M),N=t.mul(x,j),_=t.mul(E,D),k=t.add(b,x),O=t.add(M,j);k=t.mul(k,O),O=t.add(V,N),k=t.sub(k,O),O=t.add(b,E);let W=t.add(M,D);return O=t.mul(O,W),W=t.add(V,_),O=t.sub(O,W),W=t.add(x,E),H=t.add(j,D),W=t.mul(W,H),H=t.add(N,_),W=t.sub(W,H),U=t.mul(z,O),H=t.mul(Y,_),U=t.add(H,U),H=t.sub(N,U),U=t.add(N,U),L=t.mul(H,U),N=t.add(V,V),N=t.add(N,V),_=t.mul(z,_),O=t.mul(Y,O),N=t.add(N,_),_=t.sub(V,_),_=t.mul(z,_),O=t.add(O,_),V=t.mul(N,O),L=t.add(L,V),V=t.mul(W,O),H=t.mul(k,H),H=t.sub(H,V),V=t.mul(k,N),U=t.mul(W,U),U=t.add(U,V),new g(H,L,U)}subtract(S){return this.add(S.negate())}is0(){return this.equals(g.ZERO)}wNAF(S){return v.wNAFCached(this,S,g.normalizeZ)}multiplyUnsafe(S){const{endo:b,n:x}=e;Xs("scalar",S,Za,x);const E=g.ZERO;if(S===Za)return E;if(this.is0()||S===jr)return this;if(!b||v.hasPrecomputes(this))return v.wNAFCachedUnsafe(this,S,g.normalizeZ);let{k1neg:M,k1:j,k2neg:D,k2:H}=b.splitScalar(S),L=E,U=E,z=this;for(;j>Za||H>Za;)j&jr&&(L=L.add(z)),H&jr&&(U=U.add(z)),z=z.double(),j>>=jr,H>>=jr;return M&&(L=L.negate()),D&&(U=U.negate()),U=new g(t.mul(U.px,b.beta),U.py,U.pz),L.add(U)}multiply(S){const{endo:b,n:x}=e;Xs("scalar",S,jr,x);let E,M;if(b){const{k1neg:j,k1:D,k2neg:H,k2:L}=b.splitScalar(S);let{p:U,f:z}=this.wNAF(D),{p:Y,f:V}=this.wNAF(L);U=v.constTimeNegate(j,U),Y=v.constTimeNegate(H,Y),Y=new g(t.mul(Y.px,b.beta),Y.py,Y.pz),E=U.add(Y),M=z.add(V)}else{const{p:j,f:D}=this.wNAF(S);E=j,M=D}return g.normalizeZ([E,M])[0]}multiplyAndAddUnsafe(S,b,x){const E=g.BASE,M=(D,H)=>H===Za||H===jr||!D.equals(E)?D.multiplyUnsafe(H):D.multiply(H),j=M(this,b).add(M(S,x));return j.is0()?void 0:j}toAffine(S){return d(this,S)}isTorsionFree(){const{h:S,isTorsionFree:b}=e;if(S===jr)return!0;if(b)return b(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:S,clearCofactor:b}=e;return S===jr?this:b?b(g,this):this.multiplyUnsafe(e.h)}toRawBytes(S=!0){return lc("isCompressed",S),this.assertValidity(),i(g,this,S)}toHex(S=!0){return lc("isCompressed",S),Ou(this.toRawBytes(S))}}g.BASE=new g(e.Gx,e.Gy,t.ONE),g.ZERO=new g(t.ZERO,t.ONE,t.ZERO);const m=e.nBitLength,v=b9(g,e.endo?Math.ceil(m/2):m);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:c,weierstrassEquation:o,isWithinCurveOrder:a}}function a0e(n){const e=HP(n);return Nh(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function c0e(n){const e=a0e(n),{Fp:t,n:r}=e,i=t.BYTES+1,s=2*t.BYTES+1;function o(_){return Xn(_,r)}function a(_){return FE(_,r)}const{ProjectivePoint:c,normPrivateKeyToScalar:u,weierstrassEquation:d,isWithinCurveOrder:f}=o0e({...e,toBytes(_,k,O){const W=k.toAffine(),q=t.toBytes(W.x),X=Lu;return lc("isCompressed",O),O?X(Uint8Array.from([k.hasEvenY()?2:3]),q):X(Uint8Array.from([4]),q,t.toBytes(W.y))},fromBytes(_){const k=_.length,O=_[0],W=_.subarray(1);if(k===i&&(O===2||O===3)){const q=xu(W);if(!tv(q,jr,t.ORDER))throw new Error("Point is not on curve");const X=d(q);let ne;try{ne=t.sqrt(X)}catch(R){const Z=R instanceof Error?": "+R.message:"";throw new Error("Point is not on curve"+Z)}const $=(ne&jr)===jr;return(O&1)===1!==$&&(ne=t.neg(ne)),{x:q,y:ne}}else if(k===s&&O===4){const q=t.fromBytes(W.subarray(0,t.BYTES)),X=t.fromBytes(W.subarray(t.BYTES,2*t.BYTES));return{x:q,y:X}}else{const q=i,X=s;throw new Error("invalid Point, expected length of "+q+", or uncompressed "+X+", got "+k)}}}),g=_=>Ou(wh(_,e.nByteLength));function m(_){const k=r>>jr;return _>k}function v(_){return m(_)?o(-_):_}const w=(_,k,O)=>xu(_.slice(k,O));class S{constructor(k,O,W){this.r=k,this.s=O,this.recovery=W,this.assertValidity()}static fromCompact(k){const O=e.nByteLength;return k=_r("compactSignature",k,O*2),new S(w(k,0,O),w(k,O,2*O))}static fromDER(k){const{r:O,s:W}=Va.toSig(_r("DER",k));return new S(O,W)}assertValidity(){Xs("r",this.r,jr,r),Xs("s",this.s,jr,r)}addRecoveryBit(k){return new S(this.r,this.s,k)}recoverPublicKey(k){const{r:O,s:W,recovery:q}=this,X=D(_r("msgHash",k));if(q==null||![0,1,2,3].includes(q))throw new Error("recovery id invalid");const ne=q===2||q===3?O+e.n:O;if(ne>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const $=q&1?"03":"02",C=c.fromHex($+g(ne)),R=a(ne),Z=o(-X*R),J=o(W*R),oe=c.BASE.multiplyAndAddUnsafe(C,Z,J);if(!oe)throw new Error("point at infinify");return oe.assertValidity(),oe}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new S(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return yh(this.toDERHex())}toDERHex(){return Va.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return yh(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const b={isValidPrivateKey(_){try{return u(_),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const _=v9(e.n);return Bme(e.randomBytes(_),e.n)},precompute(_=8,k=c.BASE){return k._setWindowSize(_),k.multiply(BigInt(3)),k}};function x(_,k=!0){return c.fromPrivateKey(_).toRawBytes(k)}function E(_){const k=Du(_),O=typeof _=="string",W=(k||O)&&_.length;return k?W===i||W===s:O?W===2*i||W===2*s:_ instanceof c}function M(_,k,O=!0){if(E(_))throw new Error("first arg must be private key");if(!E(k))throw new Error("second arg must be public key");return c.fromHex(k).multiply(u(_)).toRawBytes(O)}const j=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");const k=xu(_),O=_.length*8-e.nBitLength;return O>0?k>>BigInt(O):k},D=e.bits2int_modN||function(_){return o(j(_))},H=$P(e.nBitLength);function L(_){return Xs("num < 2^"+e.nBitLength,_,Za,H),wh(_,e.nByteLength)}function U(_,k,O=z){if(["recovered","canonical"].some(fe=>fe in O))throw new Error("sign() legacy options not supported");const{hash:W,randomBytes:q}=e;let{lowS:X,prehash:ne,extraEntropy:$}=O;X==null&&(X=!0),_=_r("msgHash",_),wO(O),ne&&(_=_r("prehashed msgHash",W(_)));const C=D(_),R=u(k),Z=[L(R),L(C)];if($!=null&&$!==!1){const fe=$===!0?q(t.BYTES):$;Z.push(_r("extraEntropy",fe))}const J=Lu(...Z),oe=C;function ue(fe){const _e=j(fe);if(!f(_e))return;const Le=a(_e),Ne=c.BASE.multiply(_e).toAffine(),Ze=o(Ne.x);if(Ze===Za)return;const dt=o(Le*o(oe+Ze*R));if(dt===Za)return;let et=(Ne.x===Ze?0:2)|Number(Ne.y&jr),Xe=dt;return X&&m(dt)&&(Xe=v(dt),et^=1),new S(Ze,Xe,et)}return{seed:J,k2sig:ue}}const z={lowS:e.lowS,prehash:!1},Y={lowS:e.lowS,prehash:!1};function V(_,k,O=z){const{seed:W,k2sig:q}=U(_,k,O),X=e;return m9(X.hash.outputLen,X.nByteLength,X.hmac)(W,q)}c.BASE._setWindowSize(8);function N(_,k,O,W=Y){var et;const q=_;k=_r("msgHash",k),O=_r("publicKey",O);const{lowS:X,prehash:ne,format:$}=W;if(wO(W),"strict"in W)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");const C=typeof q=="string"||Du(q),R=!C&&!$&&typeof q=="object"&&q!==null&&typeof q.r=="bigint"&&typeof q.s=="bigint";if(!C&&!R)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let Z,J;try{if(R&&(Z=new S(q.r,q.s)),C){try{$!=="compact"&&(Z=S.fromDER(q))}catch(Xe){if(!(Xe instanceof Va.Err))throw Xe}!Z&&$!=="der"&&(Z=S.fromCompact(q))}J=c.fromHex(O)}catch{return!1}if(!Z||X&&Z.hasHighS())return!1;ne&&(k=e.hash(k));const{r:oe,s:ue}=Z,fe=D(k),_e=a(ue),Le=o(fe*_e),Ne=o(oe*_e),Ze=(et=c.BASE.multiplyAndAddUnsafe(J,Le,Ne))==null?void 0:et.toAffine();return Ze?o(Ze.x)===oe:!1}return{CURVE:e,getPublicKey:x,getSharedSecret:M,sign:V,verify:N,ProjectivePoint:c,Signature:S,utils:b}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function l0e(n){return{hash:n,hmac:(e,...t)=>D9(n,e,Wge(...t)),randomBytes:h9}}function u0e(n,e){const t=r=>c0e({...n,...l0e(r)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const O9=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),SO=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),d0e=BigInt(1),UE=BigInt(2),xO=(n,e)=>(n+e/UE)/e;function h0e(n){const e=O9,t=BigInt(3),r=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),u=n*n*n%e,d=u*u*n%e,f=or(d,t,e)*d%e,g=or(f,t,e)*d%e,m=or(g,UE,e)*u%e,v=or(m,i,e)*m%e,w=or(v,s,e)*v%e,S=or(w,a,e)*w%e,b=or(S,c,e)*S%e,x=or(b,a,e)*w%e,E=or(x,t,e)*d%e,M=or(E,o,e)*v%e,j=or(M,r,e)*u%e,D=or(j,UE,e);if(!$E.eql($E.sqr(D),n))throw new Error("Cannot find square root");return D}const $E=nv(O9,void 0,void 0,{sqrt:h0e}),ZP=u0e({a:BigInt(0),b:BigInt(7),Fp:$E,n:SO,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:n=>{const e=SO,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-d0e*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=xO(s*n,e),c=xO(-r*n,e);let u=Xn(n-a*t-c*i,e),d=Xn(-a*r-c*s,e);const f=u>o,g=d>o;if(f&&(u=e-u),g&&(d=e-d),u>o||d>o)throw new Error("splitScalar: Endomorphism failed, k="+n);return{k1neg:f,k1:u,k2neg:g,k2:d}}}},zE);BigInt(0);ZP.ProjectivePoint;function bO(n){try{return KP.ExtendedPoint.fromHex(n),!0}catch{return!1}}const L9=(n,e)=>KP.sign(n,e.slice(0,32)),f0e=KP.verify,Sh=n=>Ct.Buffer.isBuffer(n)?n:n instanceof Uint8Array?Ct.Buffer.from(n.buffer,n.byteOffset,n.byteLength):Ct.Buffer.from(n);class p0e{constructor(e){Object.assign(this,e)}encode(){return Ct.Buffer.from(s_.serialize($y,this))}static decode(e){return s_.deserialize($y,this,e)}static decodeUnchecked(e){return s_.deserializeUnchecked($y,this,e)}}const $y=new Map;var N9;const g0e=32,fl=32;function m0e(n){return n._bn!==void 0}let _O=1;class lt extends p0e{constructor(e){if(super({}),this._bn=void 0,m0e(e))this._bn=e._bn;else{if(typeof e=="string"){const t=Yr.decode(e);if(t.length!=fl)throw new Error("Invalid public key input");this._bn=new rO(t)}else this._bn=new rO(e);if(this._bn.byteLength()>fl)throw new Error("Invalid public key input")}}static unique(){const e=new lt(_O);return _O+=1,new lt(e.toBuffer())}equals(e){return this._bn.eq(e._bn)}toBase58(){return Yr.encode(this.toBytes())}toJSON(){return this.toBase58()}toBytes(){const e=this.toBuffer();return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}toBuffer(){const e=this._bn.toArrayLike(Ct.Buffer);if(e.length===fl)return e;const t=Ct.Buffer.alloc(32);return e.copy(t,32-e.length),t}get[Symbol.toStringTag](){return`PublicKey(${this.toString()})`}toString(){return this.toBase58()}static async createWithSeed(e,t,r){const i=Ct.Buffer.concat([e.toBuffer(),Ct.Buffer.from(t),r.toBuffer()]),s=zE(i);return new lt(s)}static createProgramAddressSync(e,t){let r=Ct.Buffer.alloc(0);e.forEach(function(s){if(s.length>g0e)throw new TypeError("Max seed length exceeded");r=Ct.Buffer.concat([r,Sh(s)])}),r=Ct.Buffer.concat([r,t.toBuffer(),Ct.Buffer.from("ProgramDerivedAddress")]);const i=zE(r);if(bO(i))throw new Error("Invalid seeds, address must fall off the curve");return new lt(i)}static async createProgramAddress(e,t){return this.createProgramAddressSync(e,t)}static findProgramAddressSync(e,t){let r=255,i;for(;r!=0;){try{const s=e.concat(Ct.Buffer.from([r]));i=this.createProgramAddressSync(s,t)}catch(s){if(s instanceof TypeError)throw s;r--;continue}return[i,r]}throw new Error("Unable to find a viable program address nonce")}static async findProgramAddress(e,t){return this.findProgramAddressSync(e,t)}static isOnCurve(e){const t=new lt(e);return bO(t.toBytes())}}N9=lt;lt.default=new N9("11111111111111111111111111111111");$y.set(lt,{kind:"struct",fields:[["_bn","u256"]]});new lt("BPFLoader1111111111111111111111111111111111");const oh=1232,QP=127,jp=64;class B9 extends Error{constructor(e){super(`Signature ${e} has expired: block height exceeded.`),this.signature=void 0,this.signature=e}}Object.defineProperty(B9.prototype,"name",{value:"TransactionExpiredBlockheightExceededError"});class F9 extends Error{constructor(e,t){super(`Transaction was not confirmed in ${t.toFixed(2)} seconds. It is unknown if it succeeded or failed. Check signature ${e} using the Solana Explorer or CLI tools.`),this.signature=void 0,this.signature=e}}Object.defineProperty(F9.prototype,"name",{value:"TransactionExpiredTimeoutError"});class Zf extends Error{constructor(e){super(`Signature ${e} has expired: the nonce is no longer valid.`),this.signature=void 0,this.signature=e}}Object.defineProperty(Zf.prototype,"name",{value:"TransactionExpiredNonceInvalidError"});class B0{constructor(e,t){this.staticAccountKeys=void 0,this.accountKeysFromLookups=void 0,this.staticAccountKeys=e,this.accountKeysFromLookups=t}keySegments(){const e=[this.staticAccountKeys];return this.accountKeysFromLookups&&(e.push(this.accountKeysFromLookups.writable),e.push(this.accountKeysFromLookups.readonly)),e}get(e){for(const t of this.keySegments()){if(e<t.length)return t[e];e-=t.length}}get length(){return this.keySegments().flat().length}compileInstructions(e){if(this.length>256)throw new Error("Account index overflow encountered during compilation");const r=new Map;this.keySegments().flat().forEach((s,o)=>{r.set(s.toBase58(),o)});const i=s=>{const o=r.get(s.toBase58());if(o===void 0)throw new Error("Encountered an unknown instruction account key during compilation");return o};return e.map(s=>({programIdIndex:i(s.programId),accountKeyIndexes:s.keys.map(o=>i(o.pubkey)),data:s.data}))}}const Ft=(n="publicKey")=>ae.blob(32,n),y0e=(n="signature")=>ae.blob(64,n),Yd=(n="string")=>{const e=ae.struct([ae.u32("length"),ae.u32("lengthPadding"),ae.blob(ae.offset(ae.u32(),-8),"chars")],n),t=e.decode.bind(e),r=e.encode.bind(e),i=e;return i.decode=(s,o)=>t(s,o).chars.toString(),i.encode=(s,o,a)=>{const c={chars:Ct.Buffer.from(s,"utf8")};return r(c,o,a)},i.alloc=s=>ae.u32().span+ae.u32().span+Ct.Buffer.from(s,"utf8").length,i},w0e=(n="authorized")=>ae.struct([Ft("staker"),Ft("withdrawer")],n),v0e=(n="lockup")=>ae.struct([ae.ns64("unixTimestamp"),ae.ns64("epoch"),Ft("custodian")],n),S0e=(n="voteInit")=>ae.struct([Ft("nodePubkey"),Ft("authorizedVoter"),Ft("authorizedWithdrawer"),ae.u8("commission")],n),x0e=(n="voteAuthorizeWithSeedArgs")=>ae.struct([ae.u32("voteAuthorizationType"),Ft("currentAuthorityDerivedKeyOwnerPubkey"),Yd("currentAuthorityDerivedKeySeed"),Ft("newAuthorized")],n);function _s(n){let e=0,t=0;for(;;){let r=n.shift();if(e|=(r&127)<<t*7,t+=1,!(r&128))break}return e}function Is(n,e){let t=e;for(;;){let r=t&127;if(t>>=7,t==0){n.push(r);break}else r|=128,n.push(r)}}function Yn(n,e){if(!n)throw new Error(e||"Assertion failed")}class av{constructor(e,t){this.payer=void 0,this.keyMetaMap=void 0,this.payer=e,this.keyMetaMap=t}static compile(e,t){const r=new Map,i=o=>{const a=o.toBase58();let c=r.get(a);return c===void 0&&(c={isSigner:!1,isWritable:!1,isInvoked:!1},r.set(a,c)),c},s=i(t);s.isSigner=!0,s.isWritable=!0;for(const o of e){i(o.programId).isInvoked=!0;for(const a of o.keys){const c=i(a.pubkey);c.isSigner||(c.isSigner=a.isSigner),c.isWritable||(c.isWritable=a.isWritable)}}return new av(t,r)}getMessageComponents(){const e=[...this.keyMetaMap.entries()];Yn(e.length<=256,"Max static account keys length exceeded");const t=e.filter(([,c])=>c.isSigner&&c.isWritable),r=e.filter(([,c])=>c.isSigner&&!c.isWritable),i=e.filter(([,c])=>!c.isSigner&&c.isWritable),s=e.filter(([,c])=>!c.isSigner&&!c.isWritable),o={numRequiredSignatures:t.length+r.length,numReadonlySignedAccounts:r.length,numReadonlyUnsignedAccounts:s.length};{Yn(t.length>0,"Expected at least one writable signer key");const[c]=t[0];Yn(c===this.payer.toBase58(),"Expected first writable signer key to be the fee payer")}const a=[...t.map(([c])=>new lt(c)),...r.map(([c])=>new lt(c)),...i.map(([c])=>new lt(c)),...s.map(([c])=>new lt(c))];return[o,a]}extractTableLookup(e){const[t,r]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&o.isWritable),[i,s]=this.drainKeysFoundInLookupTable(e.state.addresses,o=>!o.isSigner&&!o.isInvoked&&!o.isWritable);if(!(t.length===0&&i.length===0))return[{accountKey:e.key,writableIndexes:t,readonlyIndexes:i},{writable:r,readonly:s}]}drainKeysFoundInLookupTable(e,t){const r=new Array,i=new Array;for(const[s,o]of this.keyMetaMap.entries())if(t(o)){const a=new lt(s),c=e.findIndex(u=>u.equals(a));c>=0&&(Yn(c<256,"Max lookup table index exceeded"),r.push(c),i.push(a),this.keyMetaMap.delete(s))}return[r,i]}}const z9="Reached end of buffer unexpectedly";function Qa(n){if(n.length===0)throw new Error(z9);return n.shift()}function Es(n,...e){const[t]=e;if(e.length===2?t+(e[1]??0)>n.length:t>=n.length)throw new Error(z9);return n.splice(...e)}class fc{constructor(e){this.header=void 0,this.accountKeys=void 0,this.recentBlockhash=void 0,this.instructions=void 0,this.indexToProgramIds=new Map,this.header=e.header,this.accountKeys=e.accountKeys.map(t=>new lt(t)),this.recentBlockhash=e.recentBlockhash,this.instructions=e.instructions,this.instructions.forEach(t=>this.indexToProgramIds.set(t.programIdIndex,this.accountKeys[t.programIdIndex]))}get version(){return"legacy"}get staticAccountKeys(){return this.accountKeys}get compiledInstructions(){return this.instructions.map(e=>({programIdIndex:e.programIdIndex,accountKeyIndexes:e.accounts,data:Yr.decode(e.data)}))}get addressTableLookups(){return[]}getAccountKeys(){return new B0(this.staticAccountKeys)}static compile(e){const t=av.compile(e.instructions,e.payerKey),[r,i]=t.getMessageComponents(),o=new B0(i).compileInstructions(e.instructions).map(a=>({programIdIndex:a.programIdIndex,accounts:a.accountKeyIndexes,data:Yr.encode(a.data)}));return new fc({header:r,accountKeys:i,recentBlockhash:e.recentBlockhash,instructions:o})}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures;if(e>=this.header.numRequiredSignatures){const r=e-t,s=this.accountKeys.length-t-this.header.numReadonlyUnsignedAccounts;return r<s}else{const r=t-this.header.numReadonlySignedAccounts;return e<r}}isProgramId(e){return this.indexToProgramIds.has(e)}programIds(){return[...this.indexToProgramIds.values()]}nonProgramIds(){return this.accountKeys.filter((e,t)=>!this.isProgramId(t))}serialize(){const e=this.accountKeys.length;let t=[];Is(t,e);const r=this.instructions.map(f=>{const{accounts:g,programIdIndex:m}=f,v=Array.from(Yr.decode(f.data));let w=[];Is(w,g.length);let S=[];return Is(S,v.length),{programIdIndex:m,keyIndicesCount:Ct.Buffer.from(w),keyIndices:g,dataLength:Ct.Buffer.from(S),data:v}});let i=[];Is(i,r.length);let s=Ct.Buffer.alloc(oh);Ct.Buffer.from(i).copy(s);let o=i.length;r.forEach(f=>{const m=ae.struct([ae.u8("programIdIndex"),ae.blob(f.keyIndicesCount.length,"keyIndicesCount"),ae.seq(ae.u8("keyIndex"),f.keyIndices.length,"keyIndices"),ae.blob(f.dataLength.length,"dataLength"),ae.seq(ae.u8("userdatum"),f.data.length,"data")]).encode(f,s,o);o+=m}),s=s.slice(0,o);const a=ae.struct([ae.blob(1,"numRequiredSignatures"),ae.blob(1,"numReadonlySignedAccounts"),ae.blob(1,"numReadonlyUnsignedAccounts"),ae.blob(t.length,"keyCount"),ae.seq(Ft("key"),e,"keys"),Ft("recentBlockhash")]),c={numRequiredSignatures:Ct.Buffer.from([this.header.numRequiredSignatures]),numReadonlySignedAccounts:Ct.Buffer.from([this.header.numReadonlySignedAccounts]),numReadonlyUnsignedAccounts:Ct.Buffer.from([this.header.numReadonlyUnsignedAccounts]),keyCount:Ct.Buffer.from(t),keys:this.accountKeys.map(f=>Sh(f.toBytes())),recentBlockhash:Yr.decode(this.recentBlockhash)};let u=Ct.Buffer.alloc(2048);const d=a.encode(c,u);return s.copy(u,d),u.slice(0,d+s.length)}static from(e){let t=[...e];const r=Qa(t);if(r!==(r&QP))throw new Error("Versioned messages must be deserialized with VersionedMessage.deserialize()");const i=Qa(t),s=Qa(t),o=_s(t);let a=[];for(let g=0;g<o;g++){const m=Es(t,0,fl);a.push(new lt(Ct.Buffer.from(m)))}const c=Es(t,0,fl),u=_s(t);let d=[];for(let g=0;g<u;g++){const m=Qa(t),v=_s(t),w=Es(t,0,v),S=_s(t),b=Es(t,0,S),x=Yr.encode(Ct.Buffer.from(b));d.push({programIdIndex:m,accounts:w,data:x})}const f={header:{numRequiredSignatures:r,numReadonlySignedAccounts:i,numReadonlyUnsignedAccounts:s},recentBlockhash:Yr.encode(Ct.Buffer.from(c)),accountKeys:a,instructions:d};return new fc(f)}}class Dp{constructor(e){this.header=void 0,this.staticAccountKeys=void 0,this.recentBlockhash=void 0,this.compiledInstructions=void 0,this.addressTableLookups=void 0,this.header=e.header,this.staticAccountKeys=e.staticAccountKeys,this.recentBlockhash=e.recentBlockhash,this.compiledInstructions=e.compiledInstructions,this.addressTableLookups=e.addressTableLookups}get version(){return 0}get numAccountKeysFromLookups(){let e=0;for(const t of this.addressTableLookups)e+=t.readonlyIndexes.length+t.writableIndexes.length;return e}getAccountKeys(e){let t;if(e&&"accountKeysFromLookups"in e&&e.accountKeysFromLookups){if(this.numAccountKeysFromLookups!=e.accountKeysFromLookups.writable.length+e.accountKeysFromLookups.readonly.length)throw new Error("Failed to get account keys because of a mismatch in the number of account keys from lookups");t=e.accountKeysFromLookups}else if(e&&"addressLookupTableAccounts"in e&&e.addressLookupTableAccounts)t=this.resolveAddressTableLookups(e.addressLookupTableAccounts);else if(this.addressTableLookups.length>0)throw new Error("Failed to get account keys because address table lookups were not resolved");return new B0(this.staticAccountKeys,t)}isAccountSigner(e){return e<this.header.numRequiredSignatures}isAccountWritable(e){const t=this.header.numRequiredSignatures,r=this.staticAccountKeys.length;if(e>=r){const i=e-r,s=this.addressTableLookups.reduce((o,a)=>o+a.writableIndexes.length,0);return i<s}else if(e>=this.header.numRequiredSignatures){const i=e-t,o=r-t-this.header.numReadonlyUnsignedAccounts;return i<o}else{const i=t-this.header.numReadonlySignedAccounts;return e<i}}resolveAddressTableLookups(e){const t={writable:[],readonly:[]};for(const r of this.addressTableLookups){const i=e.find(s=>s.key.equals(r.accountKey));if(!i)throw new Error(`Failed to find address lookup table account for table key ${r.accountKey.toBase58()}`);for(const s of r.writableIndexes)if(s<i.state.addresses.length)t.writable.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${r.accountKey.toBase58()}`);for(const s of r.readonlyIndexes)if(s<i.state.addresses.length)t.readonly.push(i.state.addresses[s]);else throw new Error(`Failed to find address for index ${s} in address lookup table ${r.accountKey.toBase58()}`)}return t}static compile(e){const t=av.compile(e.instructions,e.payerKey),r=new Array,i={writable:new Array,readonly:new Array},s=e.addressLookupTableAccounts||[];for(const d of s){const f=t.extractTableLookup(d);if(f!==void 0){const[g,{writable:m,readonly:v}]=f;r.push(g),i.writable.push(...m),i.readonly.push(...v)}}const[o,a]=t.getMessageComponents(),u=new B0(a,i).compileInstructions(e.instructions);return new Dp({header:o,staticAccountKeys:a,recentBlockhash:e.recentBlockhash,compiledInstructions:u,addressTableLookups:r})}serialize(){const e=Array();Is(e,this.staticAccountKeys.length);const t=this.serializeInstructions(),r=Array();Is(r,this.compiledInstructions.length);const i=this.serializeAddressTableLookups(),s=Array();Is(s,this.addressTableLookups.length);const o=ae.struct([ae.u8("prefix"),ae.struct([ae.u8("numRequiredSignatures"),ae.u8("numReadonlySignedAccounts"),ae.u8("numReadonlyUnsignedAccounts")],"header"),ae.blob(e.length,"staticAccountKeysLength"),ae.seq(Ft(),this.staticAccountKeys.length,"staticAccountKeys"),Ft("recentBlockhash"),ae.blob(r.length,"instructionsLength"),ae.blob(t.length,"serializedInstructions"),ae.blob(s.length,"addressTableLookupsLength"),ae.blob(i.length,"serializedAddressTableLookups")]),a=new Uint8Array(oh),u=o.encode({prefix:128,header:this.header,staticAccountKeysLength:new Uint8Array(e),staticAccountKeys:this.staticAccountKeys.map(d=>d.toBytes()),recentBlockhash:Yr.decode(this.recentBlockhash),instructionsLength:new Uint8Array(r),serializedInstructions:t,addressTableLookupsLength:new Uint8Array(s),serializedAddressTableLookups:i},a);return a.slice(0,u)}serializeInstructions(){let e=0;const t=new Uint8Array(oh);for(const r of this.compiledInstructions){const i=Array();Is(i,r.accountKeyIndexes.length);const s=Array();Is(s,r.data.length);const o=ae.struct([ae.u8("programIdIndex"),ae.blob(i.length,"encodedAccountKeyIndexesLength"),ae.seq(ae.u8(),r.accountKeyIndexes.length,"accountKeyIndexes"),ae.blob(s.length,"encodedDataLength"),ae.blob(r.data.length,"data")]);e+=o.encode({programIdIndex:r.programIdIndex,encodedAccountKeyIndexesLength:new Uint8Array(i),accountKeyIndexes:r.accountKeyIndexes,encodedDataLength:new Uint8Array(s),data:r.data},t,e)}return t.slice(0,e)}serializeAddressTableLookups(){let e=0;const t=new Uint8Array(oh);for(const r of this.addressTableLookups){const i=Array();Is(i,r.writableIndexes.length);const s=Array();Is(s,r.readonlyIndexes.length);const o=ae.struct([Ft("accountKey"),ae.blob(i.length,"encodedWritableIndexesLength"),ae.seq(ae.u8(),r.writableIndexes.length,"writableIndexes"),ae.blob(s.length,"encodedReadonlyIndexesLength"),ae.seq(ae.u8(),r.readonlyIndexes.length,"readonlyIndexes")]);e+=o.encode({accountKey:r.accountKey.toBytes(),encodedWritableIndexesLength:new Uint8Array(i),writableIndexes:r.writableIndexes,encodedReadonlyIndexesLength:new Uint8Array(s),readonlyIndexes:r.readonlyIndexes},t,e)}return t.slice(0,e)}static deserialize(e){let t=[...e];const r=Qa(t),i=r&QP;Yn(r!==i,"Expected versioned message but received legacy message");const s=i;Yn(s===0,`Expected versioned message with version 0 but found version ${s}`);const o={numRequiredSignatures:Qa(t),numReadonlySignedAccounts:Qa(t),numReadonlyUnsignedAccounts:Qa(t)},a=[],c=_s(t);for(let v=0;v<c;v++)a.push(new lt(Es(t,0,fl)));const u=Yr.encode(Es(t,0,fl)),d=_s(t),f=[];for(let v=0;v<d;v++){const w=Qa(t),S=_s(t),b=Es(t,0,S),x=_s(t),E=new Uint8Array(Es(t,0,x));f.push({programIdIndex:w,accountKeyIndexes:b,data:E})}const g=_s(t),m=[];for(let v=0;v<g;v++){const w=new lt(Es(t,0,fl)),S=_s(t),b=Es(t,0,S),x=_s(t),E=Es(t,0,x);m.push({accountKey:w,writableIndexes:b,readonlyIndexes:E})}return new Dp({header:o,staticAccountKeys:a,recentBlockhash:u,compiledInstructions:f,addressTableLookups:m})}}const JP={deserializeMessageVersion(n){const e=n[0],t=e&QP;return t===e?"legacy":t},deserialize:n=>{const e=JP.deserializeMessageVersion(n);if(e==="legacy")return fc.from(n);if(e===0)return Dp.deserialize(n);throw new Error(`Transaction message version ${e} deserialization is not supported`)}};let Yc=function(n){return n[n.BLOCKHEIGHT_EXCEEDED=0]="BLOCKHEIGHT_EXCEEDED",n[n.PROCESSED=1]="PROCESSED",n[n.TIMED_OUT=2]="TIMED_OUT",n[n.NONCE_INVALID=3]="NONCE_INVALID",n}({});const b0e=Ct.Buffer.alloc(jp).fill(0);class IO{constructor(e){this.keys=void 0,this.programId=void 0,this.data=Ct.Buffer.alloc(0),this.programId=e.programId,this.keys=e.keys,e.data&&(this.data=e.data)}toJSON(){return{keys:this.keys.map(({pubkey:e,isSigner:t,isWritable:r})=>({pubkey:e.toJSON(),isSigner:t,isWritable:r})),programId:this.programId.toJSON(),data:[...this.data]}}}class _o{get signature(){return this.signatures.length>0?this.signatures[0].signature:null}constructor(e){if(this.signatures=[],this.feePayer=void 0,this.instructions=[],this.recentBlockhash=void 0,this.lastValidBlockHeight=void 0,this.nonceInfo=void 0,this.minNonceContextSlot=void 0,this._message=void 0,this._json=void 0,!!e)if(e.feePayer&&(this.feePayer=e.feePayer),e.signatures&&(this.signatures=e.signatures),Object.prototype.hasOwnProperty.call(e,"nonceInfo")){const{minContextSlot:t,nonceInfo:r}=e;this.minNonceContextSlot=t,this.nonceInfo=r}else if(Object.prototype.hasOwnProperty.call(e,"lastValidBlockHeight")){const{blockhash:t,lastValidBlockHeight:r}=e;this.recentBlockhash=t,this.lastValidBlockHeight=r}else{const{recentBlockhash:t,nonceInfo:r}=e;r&&(this.nonceInfo=r),this.recentBlockhash=t}}toJSON(){return{recentBlockhash:this.recentBlockhash||null,feePayer:this.feePayer?this.feePayer.toJSON():null,nonceInfo:this.nonceInfo?{nonce:this.nonceInfo.nonce,nonceInstruction:this.nonceInfo.nonceInstruction.toJSON()}:null,instructions:this.instructions.map(e=>e.toJSON()),signers:this.signatures.map(({publicKey:e})=>e.toJSON())}}add(...e){if(e.length===0)throw new Error("No instructions");return e.forEach(t=>{"instructions"in t?this.instructions=this.instructions.concat(t.instructions):"data"in t&&"programId"in t&&"keys"in t?this.instructions.push(t):this.instructions.push(new IO(t))}),this}compileMessage(){if(this._message&&JSON.stringify(this.toJSON())===JSON.stringify(this._json))return this._message;let e,t;if(this.nonceInfo?(e=this.nonceInfo.nonce,this.instructions[0]!=this.nonceInfo.nonceInstruction?t=[this.nonceInfo.nonceInstruction,...this.instructions]:t=this.instructions):(e=this.recentBlockhash,t=this.instructions),!e)throw new Error("Transaction recentBlockhash required");t.length<1&&console.warn("No instructions provided");let r;if(this.feePayer)r=this.feePayer;else if(this.signatures.length>0&&this.signatures[0].publicKey)r=this.signatures[0].publicKey;else throw new Error("Transaction fee payer required");for(let w=0;w<t.length;w++)if(t[w].programId===void 0)throw new Error(`Transaction instruction index ${w} has undefined program id`);const i=[],s=[];t.forEach(w=>{w.keys.forEach(b=>{s.push({...b})});const S=w.programId.toString();i.includes(S)||i.push(S)}),i.forEach(w=>{s.push({pubkey:new lt(w),isSigner:!1,isWritable:!1})});const o=[];s.forEach(w=>{const S=w.pubkey.toString(),b=o.findIndex(x=>x.pubkey.toString()===S);b>-1?(o[b].isWritable=o[b].isWritable||w.isWritable,o[b].isSigner=o[b].isSigner||w.isSigner):o.push(w)}),o.sort(function(w,S){if(w.isSigner!==S.isSigner)return w.isSigner?-1:1;if(w.isWritable!==S.isWritable)return w.isWritable?-1:1;const b={localeMatcher:"best fit",usage:"sort",sensitivity:"variant",ignorePunctuation:!1,numeric:!1,caseFirst:"lower"};return w.pubkey.toBase58().localeCompare(S.pubkey.toBase58(),"en",b)});const a=o.findIndex(w=>w.pubkey.equals(r));if(a>-1){const[w]=o.splice(a,1);w.isSigner=!0,w.isWritable=!0,o.unshift(w)}else o.unshift({pubkey:r,isSigner:!0,isWritable:!0});for(const w of this.signatures){const S=o.findIndex(b=>b.pubkey.equals(w.publicKey));if(S>-1)o[S].isSigner||(o[S].isSigner=!0,console.warn("Transaction references a signature that is unnecessary, only the fee payer and instruction signer accounts should sign a transaction. This behavior is deprecated and will throw an error in the next major version release."));else throw new Error(`unknown signer: ${w.publicKey.toString()}`)}let c=0,u=0,d=0;const f=[],g=[];o.forEach(({pubkey:w,isSigner:S,isWritable:b})=>{S?(f.push(w.toString()),c+=1,b||(u+=1)):(g.push(w.toString()),b||(d+=1))});const m=f.concat(g),v=t.map(w=>{const{data:S,programId:b}=w;return{programIdIndex:m.indexOf(b.toString()),accounts:w.keys.map(x=>m.indexOf(x.pubkey.toString())),data:Yr.encode(S)}});return v.forEach(w=>{Yn(w.programIdIndex>=0),w.accounts.forEach(S=>Yn(S>=0))}),new fc({header:{numRequiredSignatures:c,numReadonlySignedAccounts:u,numReadonlyUnsignedAccounts:d},accountKeys:m,recentBlockhash:e,instructions:v})}_compile(){const e=this.compileMessage(),t=e.accountKeys.slice(0,e.header.numRequiredSignatures);return this.signatures.length===t.length&&this.signatures.every((i,s)=>t[s].equals(i.publicKey))||(this.signatures=t.map(r=>({signature:null,publicKey:r}))),e}serializeMessage(){return this._compile().serialize()}async getEstimatedFee(e){return(await e.getFeeForMessage(this.compileMessage())).value}setSigners(...e){if(e.length===0)throw new Error("No signers");const t=new Set;this.signatures=e.filter(r=>{const i=r.toString();return t.has(i)?!1:(t.add(i),!0)}).map(r=>({signature:null,publicKey:r}))}sign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),r.push(s))}this.signatures=r.map(s=>({signature:null,publicKey:s.publicKey}));const i=this._compile();this._partialSign(i,...r)}partialSign(...e){if(e.length===0)throw new Error("No signers");const t=new Set,r=[];for(const s of e){const o=s.publicKey.toString();t.has(o)||(t.add(o),r.push(s))}const i=this._compile();this._partialSign(i,...r)}_partialSign(e,...t){const r=e.serialize();t.forEach(i=>{const s=L9(r,i.secretKey);this._addSignature(i.publicKey,Sh(s))})}addSignature(e,t){this._compile(),this._addSignature(e,t)}_addSignature(e,t){Yn(t.length===64);const r=this.signatures.findIndex(i=>e.equals(i.publicKey));if(r<0)throw new Error(`unknown signer: ${e.toString()}`);this.signatures[r].signature=Ct.Buffer.from(t)}verifySignatures(e=!0){return!this._getMessageSignednessErrors(this.serializeMessage(),e)}_getMessageSignednessErrors(e,t){const r={};for(const{signature:i,publicKey:s}of this.signatures)i===null?t&&(r.missing||(r.missing=[])).push(s):f0e(i,e,s.toBytes())||(r.invalid||(r.invalid=[])).push(s);return r.invalid||r.missing?r:void 0}serialize(e){const{requireAllSignatures:t,verifySignatures:r}=Object.assign({requireAllSignatures:!0,verifySignatures:!0},e),i=this.serializeMessage();if(r){const s=this._getMessageSignednessErrors(i,t);if(s){let o="Signature verification failed.";throw s.invalid&&(o+=`
Invalid signature for public key${s.invalid.length===1?"":"(s)"} [\`${s.invalid.map(a=>a.toBase58()).join("`, `")}\`].`),s.missing&&(o+=`
Missing signature for public key${s.missing.length===1?"":"(s)"} [\`${s.missing.map(a=>a.toBase58()).join("`, `")}\`].`),new Error(o)}}return this._serialize(i)}_serialize(e){const{signatures:t}=this,r=[];Is(r,t.length);const i=r.length+t.length*64+e.length,s=Ct.Buffer.alloc(i);return Yn(t.length<256),Ct.Buffer.from(r).copy(s,0),t.forEach(({signature:o},a)=>{o!==null&&(Yn(o.length===64,"signature has invalid length"),Ct.Buffer.from(o).copy(s,r.length+a*64))}),e.copy(s,r.length+t.length*64),Yn(s.length<=oh,`Transaction too large: ${s.length} > ${oh}`),s}get keys(){return Yn(this.instructions.length===1),this.instructions[0].keys.map(e=>e.pubkey)}get programId(){return Yn(this.instructions.length===1),this.instructions[0].programId}get data(){return Yn(this.instructions.length===1),this.instructions[0].data}static from(e){let t=[...e];const r=_s(t);let i=[];for(let s=0;s<r;s++){const o=Es(t,0,jp);i.push(Yr.encode(Ct.Buffer.from(o)))}return _o.populate(fc.from(t),i)}static populate(e,t=[]){const r=new _o;return r.recentBlockhash=e.recentBlockhash,e.header.numRequiredSignatures>0&&(r.feePayer=e.accountKeys[0]),t.forEach((i,s)=>{const o={signature:i==Yr.encode(b0e)?null:Yr.decode(i),publicKey:e.accountKeys[s]};r.signatures.push(o)}),e.instructions.forEach(i=>{const s=i.accounts.map(o=>{const a=e.accountKeys[o];return{pubkey:a,isSigner:r.signatures.some(c=>c.publicKey.toString()===a.toString())||e.isAccountSigner(o),isWritable:e.isAccountWritable(o)}});r.instructions.push(new IO({keys:s,programId:e.accountKeys[i.programIdIndex],data:Yr.decode(i.data)}))}),r._message=e,r._json=r.toJSON(),r}}class Op{get version(){return this.message.version}constructor(e,t){if(this.signatures=void 0,this.message=void 0,t!==void 0)Yn(t.length===e.header.numRequiredSignatures,"Expected signatures length to be equal to the number of required signatures"),this.signatures=t;else{const r=[];for(let i=0;i<e.header.numRequiredSignatures;i++)r.push(new Uint8Array(jp));this.signatures=r}this.message=e}serialize(){const e=this.message.serialize(),t=Array();Is(t,this.signatures.length);const r=ae.struct([ae.blob(t.length,"encodedSignaturesLength"),ae.seq(y0e(),this.signatures.length,"signatures"),ae.blob(e.length,"serializedMessage")]),i=new Uint8Array(2048),s=r.encode({encodedSignaturesLength:new Uint8Array(t),signatures:this.signatures,serializedMessage:e},i);return i.slice(0,s)}static deserialize(e){let t=[...e];const r=[],i=_s(t);for(let o=0;o<i;o++)r.push(new Uint8Array(Es(t,0,jp)));const s=JP.deserialize(new Uint8Array(t));return new Op(s,r)}sign(e){const t=this.message.serialize(),r=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures);for(const i of e){const s=r.findIndex(o=>o.equals(i.publicKey));Yn(s>=0,`Cannot sign with non signer key ${i.publicKey.toBase58()}`),this.signatures[s]=L9(t,i.secretKey)}}addSignature(e,t){Yn(t.byteLength===64,"Signature must be 64 bytes long");const i=this.message.staticAccountKeys.slice(0,this.message.header.numRequiredSignatures).findIndex(s=>s.equals(e));Yn(i>=0,`Can not add signature; \`${e.toBase58()}\` is not required to sign this transaction`),this.signatures[i]=t}}const _0e=160,I0e=64,E0e=_0e/I0e,C0e=1e3/E0e;new lt("SysvarC1ock11111111111111111111111111111111");new lt("SysvarEpochSchedu1e111111111111111111111111");new lt("Sysvar1nstructions1111111111111111111111111");new lt("SysvarRecentB1ockHashes11111111111111111111");new lt("SysvarRent111111111111111111111111111111111");new lt("SysvarRewards111111111111111111111111111111");new lt("SysvarS1otHashes111111111111111111111111111");new lt("SysvarS1otHistory11111111111111111111111111");new lt("SysvarStakeHistory1111111111111111111111111");class EO extends Error{constructor({action:e,signature:t,transactionMessage:r,logs:i}){const s=i?`Logs: 
${JSON.stringify(i.slice(-10),null,2)}. `:"",o="\nCatch the `SendTransactionError` and call `getLogs()` on it for full details.";let a;switch(e){case"send":a=`Transaction ${t} resulted in an error. 
${r}. `+s+o;break;case"simulate":a=`Simulation failed. 
Message: ${r}. 
`+s+o;break;default:a=`Unknown action '${(c=>c)(e)}'`}super(a),this.signature=void 0,this.transactionMessage=void 0,this.transactionLogs=void 0,this.signature=t,this.transactionMessage=r,this.transactionLogs=i||void 0}get transactionError(){return{message:this.transactionMessage,logs:Array.isArray(this.transactionLogs)?this.transactionLogs:void 0}}get logs(){const e=this.transactionLogs;if(!(e!=null&&typeof e=="object"&&"then"in e))return e}async getLogs(e){return Array.isArray(this.transactionLogs)||(this.transactionLogs=new Promise((t,r)=>{e.getTransaction(this.signature).then(i=>{if(i&&i.meta&&i.meta.logMessages){const s=i.meta.logMessages;this.transactionLogs=s,t(s)}else r(new Error("Log messages not found"))}).catch(r)})),await this.transactionLogs}}class it extends Error{constructor({code:e,message:t,data:r},i){super(i!=null?`${i}: ${t}`:t),this.code=void 0,this.data=void 0,this.code=e,this.data=r,this.name="SolanaJSONRPCError"}}function Fd(n){return new Promise(e=>setTimeout(e,n))}const P0e=ae.nu64("lamportsPerSignature"),U9=ae.struct([ae.u32("version"),ae.u32("state"),Ft("authorizedPubkey"),Ft("nonce"),ae.struct([P0e],"feeCalculator")]);U9.span;class eM{constructor(e){this.authorizedPubkey=void 0,this.nonce=void 0,this.feeCalculator=void 0,this.authorizedPubkey=e.authorizedPubkey,this.nonce=e.nonce,this.feeCalculator=e.feeCalculator}static fromAccountData(e){const t=U9.decode(Sh(e),0);return new eM({authorizedPubkey:new lt(t.authorizedPubkey),nonce:new lt(t.nonce).toString(),feeCalculator:t.feeCalculator})}}const M0e=n=>{const e=n.decode.bind(n),t=n.encode.bind(n);return{decode:e,encode:t}},T0e=n=>e=>{const t=ae.blob(n,e),{encode:r,decode:i}=M0e(t),s=t;return s.decode=(o,a)=>{const c=i(o,a);return hO.toBigIntLE(Ct.Buffer.from(c))},s.encode=(o,a,c)=>{const u=hO.toBufferLE(o,n);return r(u,a,c)},s},xh=T0e(8);Object.freeze({Create:{index:0,layout:ae.struct([ae.u32("instruction"),ae.ns64("lamports"),ae.ns64("space"),Ft("programId")])},Assign:{index:1,layout:ae.struct([ae.u32("instruction"),Ft("programId")])},Transfer:{index:2,layout:ae.struct([ae.u32("instruction"),xh("lamports")])},CreateWithSeed:{index:3,layout:ae.struct([ae.u32("instruction"),Ft("base"),Yd("seed"),ae.ns64("lamports"),ae.ns64("space"),Ft("programId")])},AdvanceNonceAccount:{index:4,layout:ae.struct([ae.u32("instruction")])},WithdrawNonceAccount:{index:5,layout:ae.struct([ae.u32("instruction"),ae.ns64("lamports")])},InitializeNonceAccount:{index:6,layout:ae.struct([ae.u32("instruction"),Ft("authorized")])},AuthorizeNonceAccount:{index:7,layout:ae.struct([ae.u32("instruction"),Ft("authorized")])},Allocate:{index:8,layout:ae.struct([ae.u32("instruction"),ae.ns64("space")])},AllocateWithSeed:{index:9,layout:ae.struct([ae.u32("instruction"),Ft("base"),Yd("seed"),ae.ns64("space"),Ft("programId")])},AssignWithSeed:{index:10,layout:ae.struct([ae.u32("instruction"),Ft("base"),Yd("seed"),Ft("programId")])},TransferWithSeed:{index:11,layout:ae.struct([ae.u32("instruction"),xh("lamports"),Yd("seed"),Ft("programId")])},UpgradeNonceAccount:{index:12,layout:ae.struct([ae.u32("instruction")])}});new lt("11111111111111111111111111111111");new lt("BPFLoader2111111111111111111111111111111111");function k0e(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var p_,CO;function A0e(){if(CO)return p_;CO=1;var n=Object.prototype.toString,e=Object.keys||function(r){var i=[];for(var s in r)i.push(s);return i};function t(r,i){var s,o,a,c,u,d,f;if(r===!0)return"true";if(r===!1)return"false";switch(typeof r){case"object":if(r===null)return null;if(r.toJSON&&typeof r.toJSON=="function")return t(r.toJSON(),i);if(f=n.call(r),f==="[object Array]"){for(a="[",o=r.length-1,s=0;s<o;s++)a+=t(r[s],!0)+",";return o>-1&&(a+=t(r[s],!0)),a+"]"}else if(f==="[object Object]"){for(c=e(r).sort(),o=c.length,a="",s=0;s<o;)u=c[s],d=t(r[u],!1),d!==void 0&&(a&&(a+=","),a+=JSON.stringify(u)+":"+d),s++;return"{"+a+"}"}else return JSON.stringify(r);case"function":case"undefined":return i?null:void 0;case"string":return JSON.stringify(r);default:return isFinite(r)?r:null}}return p_=function(r){var i=t(r,!1);if(i!==void 0)return""+i},p_}var R0e=A0e(),PO=k0e(R0e);const Lf=32;function g_(n){let e=0;for(;n>1;)n/=2,e++;return e}function j0e(n){return n===0?1:(n--,n|=n>>1,n|=n>>2,n|=n>>4,n|=n>>8,n|=n>>16,n|=n>>32,n+1)}class D0e{constructor(e,t,r,i,s){this.slotsPerEpoch=void 0,this.leaderScheduleSlotOffset=void 0,this.warmup=void 0,this.firstNormalEpoch=void 0,this.firstNormalSlot=void 0,this.slotsPerEpoch=e,this.leaderScheduleSlotOffset=t,this.warmup=r,this.firstNormalEpoch=i,this.firstNormalSlot=s}getEpoch(e){return this.getEpochAndSlotIndex(e)[0]}getEpochAndSlotIndex(e){if(e<this.firstNormalSlot){const t=g_(j0e(e+Lf+1))-g_(Lf)-1,r=this.getSlotsInEpoch(t),i=e-(r-Lf);return[t,i]}else{const t=e-this.firstNormalSlot,r=Math.floor(t/this.slotsPerEpoch),i=this.firstNormalEpoch+r,s=t%this.slotsPerEpoch;return[i,s]}}getFirstSlotInEpoch(e){return e<=this.firstNormalEpoch?(Math.pow(2,e)-1)*Lf:(e-this.firstNormalEpoch)*this.slotsPerEpoch+this.firstNormalSlot}getLastSlotInEpoch(e){return this.getFirstSlotInEpoch(e)+this.getSlotsInEpoch(e)-1}getSlotsInEpoch(e){return e<this.firstNormalEpoch?Math.pow(2,e+g_(Lf)):this.slotsPerEpoch}}var O0e=globalThis.fetch;class L0e extends n0e{constructor(e,t,r){const i=s=>{const o=e0e(s,{autoconnect:!0,max_reconnects:5,reconnect:!0,reconnect_interval:1e3,...t});return"socket"in o?this.underlyingSocket=o.socket:this.underlyingSocket=o,o};super(i,e,t,r),this.underlyingSocket=void 0}call(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.call(...e):Promise.reject(new Error("Tried to call a JSON-RPC method `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}notify(...e){var r;const t=(r=this.underlyingSocket)==null?void 0:r.readyState;return t===1?super.notify(...e):Promise.reject(new Error("Tried to send a JSON-RPC notification `"+e[0]+"` but the socket was not `CONNECTING` or `OPEN` (`readyState` was "+t+")"))}}function N0e(n,e){let t;try{t=n.layout.decode(e)}catch(r){throw new Error("invalid instruction; "+r)}if(t.typeIndex!==n.index)throw new Error(`invalid account data; account type mismatch ${t.typeIndex} != ${n.index}`);return t}const MO=56;class TO{constructor(e){this.key=void 0,this.state=void 0,this.key=e.key,this.state=e.state}isActive(){const e=BigInt("0xffffffffffffffff");return this.state.deactivationSlot===e}static deserialize(e){const t=N0e(B0e,e),r=e.length-MO;Yn(r>=0,"lookup table is invalid"),Yn(r%32===0,"lookup table is invalid");const i=r/32,{addresses:s}=ae.struct([ae.seq(Ft(),i,"addresses")]).decode(e.slice(MO));return{deactivationSlot:t.deactivationSlot,lastExtendedSlot:t.lastExtendedSlot,lastExtendedSlotStartIndex:t.lastExtendedStartIndex,authority:t.authority.length!==0?new lt(t.authority[0]):void 0,addresses:s.map(o=>new lt(o))}}}const B0e={index:1,layout:ae.struct([ae.u32("typeIndex"),xh("deactivationSlot"),ae.nu64("lastExtendedSlot"),ae.u8("lastExtendedStartIndex"),ae.u8(),ae.seq(Ft(),ae.offset(ae.u8(),-1),"authority")])},F0e=/^[^:]+:\/\/([^:[]+|\[[^\]]+\])(:\d+)?(.*)/i;function z0e(n){const e=n.match(F0e);if(e==null)throw TypeError(`Failed to validate endpoint URL \`${n}\``);const[t,r,i,s]=e,o=n.startsWith("https:")?"wss:":"ws:",a=i==null?null:parseInt(i.slice(1),10),c=a==null?"":`:${a+1}`;return`${o}//${r}${c}${s}`}const rr=fg(YP(lt),Oe(),n=>new lt(n)),$9=XP([Oe(),Jn("base64")]),tM=fg(YP(Ct.Buffer),$9,n=>Ct.Buffer.from(n[0],"base64")),U0e=30*1e3;function $0e(n){if(/^https?:/.test(n)===!1)throw new TypeError("Endpoint URL must start with `http:` or `https:`.");return n}function kn(n){let e,t;if(typeof n=="string")e=n;else if(n){const{commitment:r,...i}=n;e=r,t=i}return{commitment:e,config:t}}function kO(n){return n.map(e=>"memcmp"in e?{...e,memcmp:{...e.memcmp,encoding:e.memcmp.encoding??"base58"}}:e)}function H9(n){return Li([Te({jsonrpc:Jn("2.0"),id:Oe(),result:n}),Te({jsonrpc:Jn("2.0"),id:Oe(),error:Te({code:Bh(),message:Oe(),data:gt(Cye())})})])}const H0e=H9(Bh());function Tt(n){return fg(H9(n),H0e,e=>"error"in e?e:{...e,result:Be(e.result,n)})}function ar(n){return Tt(Te({context:Te({slot:we()}),value:n}))}function cv(n){return Te({context:Te({slot:we()}),value:n})}function m_(n,e){return n===0?new Dp({header:e.header,staticAccountKeys:e.accountKeys.map(t=>new lt(t)),recentBlockhash:e.recentBlockhash,compiledInstructions:e.instructions.map(t=>({programIdIndex:t.programIdIndex,accountKeyIndexes:t.accounts,data:Yr.decode(t.data)})),addressTableLookups:e.addressTableLookups}):new fc(e)}const W0e=Te({foundation:we(),foundationTerm:we(),initial:we(),taper:we(),terminal:we()}),K0e=Tt(ze($e(Te({epoch:we(),effectiveSlot:we(),amount:we(),postBalance:we(),commission:gt($e(we()))})))),q0e=ze(Te({slot:we(),prioritizationFee:we()})),G0e=Te({total:we(),validator:we(),foundation:we(),epoch:we()}),V0e=Te({epoch:we(),slotIndex:we(),slotsInEpoch:we(),absoluteSlot:we(),blockHeight:gt(we()),transactionCount:gt(we())}),Y0e=Te({slotsPerEpoch:we(),leaderScheduleSlotOffset:we(),warmup:Sa(),firstNormalEpoch:we(),firstNormalSlot:we()}),X0e=C9(Oe(),ze(we())),Gu=$e(Li([Te({}),Oe()])),Z0e=Te({err:Gu}),Q0e=Jn("receivedSignature"),J0e=Te({"solana-core":Oe(),"feature-set":gt(we())}),ewe=Te({program:Oe(),programId:rr,parsed:Bh()}),twe=Te({programId:rr,accounts:ze(rr),data:Oe()}),AO=ar(Te({err:$e(Li([Te({}),Oe()])),logs:$e(ze(Oe())),accounts:gt($e(ze($e(Te({executable:Sa(),owner:Oe(),lamports:we(),data:ze(Oe()),rentEpoch:gt(we())}))))),unitsConsumed:gt(we()),returnData:gt($e(Te({programId:Oe(),data:XP([Oe(),Jn("base64")])}))),innerInstructions:gt($e(ze(Te({index:we(),instructions:ze(Li([ewe,twe]))}))))})),nwe=ar(Te({byIdentity:C9(Oe(),ze(we())),range:Te({firstSlot:we(),lastSlot:we()})}));function rwe(n,e,t,r,i,s){const o=t||O0e;let a;s!=null&&console.warn("You have supplied an `httpAgent` when creating a `Connection` in a browser environment.It has been ignored; `httpAgent` is only used in Node environments.");let c;return r&&(c=async(d,f)=>{const g=await new Promise((m,v)=>{try{r(d,f,(w,S)=>m([w,S]))}catch(w){v(w)}});return await o(...g)}),new Xye(async(d,f)=>{const g={method:"POST",body:d,agent:a,headers:Object.assign({"Content-Type":"application/json"},e||{},ive)};try{let m=5,v,w=500;for(;c?v=await c(n,g):v=await o(n,g),!(v.status!==429||i===!0||(m-=1,m===0));)console.error(`Server responded with ${v.status} ${v.statusText}.  Retrying after ${w}ms delay...`),await Fd(w),w*=2;const S=await v.text();v.ok?f(null,S):f(new Error(`${v.status} ${v.statusText}: ${S}`))}catch(m){m instanceof Error&&f(m)}},{})}function iwe(n){return(e,t)=>new Promise((r,i)=>{n.request(e,t,(s,o)=>{if(s){i(s);return}r(o)})})}function swe(n){return e=>new Promise((t,r)=>{e.length===0&&t([]);const i=e.map(s=>n.request(s.methodName,s.args));n.request(i,(s,o)=>{if(s){r(s);return}t(o)})})}const owe=Tt(W0e),awe=Tt(G0e),cwe=Tt(q0e),lwe=Tt(V0e),uwe=Tt(Y0e),dwe=Tt(X0e),hwe=Tt(we()),fwe=ar(Te({total:we(),circulating:we(),nonCirculating:we(),nonCirculatingAccounts:ze(rr)})),HE=Te({amount:Oe(),uiAmount:$e(we()),decimals:we(),uiAmountString:gt(Oe())}),pwe=ar(ze(Te({address:rr,amount:Oe(),uiAmount:$e(we()),decimals:we(),uiAmountString:gt(Oe())}))),gwe=ar(ze(Te({pubkey:rr,account:Te({executable:Sa(),owner:rr,lamports:we(),data:tM,rentEpoch:we()})}))),WE=Te({program:Oe(),parsed:Bh(),space:we()}),mwe=ar(ze(Te({pubkey:rr,account:Te({executable:Sa(),owner:rr,lamports:we(),data:WE,rentEpoch:we()})}))),ywe=ar(ze(Te({lamports:we(),address:rr}))),Lp=Te({executable:Sa(),owner:rr,lamports:we(),data:tM,rentEpoch:we()}),wwe=Te({pubkey:rr,account:Lp}),vwe=fg(Li([YP(Ct.Buffer),WE]),Li([$9,WE]),n=>Array.isArray(n)?Be(n,tM):n),KE=Te({executable:Sa(),owner:rr,lamports:we(),data:vwe,rentEpoch:we()}),Swe=Te({pubkey:rr,account:KE}),xwe=Te({state:Li([Jn("active"),Jn("inactive"),Jn("activating"),Jn("deactivating")]),active:we(),inactive:we()}),bwe=Tt(ze(Te({signature:Oe(),slot:we(),err:Gu,memo:$e(Oe()),blockTime:gt($e(we()))}))),_we=Tt(ze(Te({signature:Oe(),slot:we(),err:Gu,memo:$e(Oe()),blockTime:gt($e(we()))}))),Iwe=Te({subscription:we(),result:cv(Lp)}),Ewe=Te({pubkey:rr,account:Lp}),Cwe=Te({subscription:we(),result:cv(Ewe)}),Pwe=Te({parent:we(),slot:we(),root:we()}),Mwe=Te({subscription:we(),result:Pwe}),Twe=Li([Te({type:Li([Jn("firstShredReceived"),Jn("completed"),Jn("optimisticConfirmation"),Jn("root")]),slot:we(),timestamp:we()}),Te({type:Jn("createdBank"),parent:we(),slot:we(),timestamp:we()}),Te({type:Jn("frozen"),slot:we(),timestamp:we(),stats:Te({numTransactionEntries:we(),numSuccessfulTransactions:we(),numFailedTransactions:we(),maxTransactionsPerEntry:we()})}),Te({type:Jn("dead"),slot:we(),timestamp:we(),err:Oe()})]),kwe=Te({subscription:we(),result:Twe}),Awe=Te({subscription:we(),result:cv(Li([Z0e,Q0e]))}),Rwe=Te({subscription:we(),result:we()}),jwe=Te({pubkey:Oe(),gossip:$e(Oe()),tpu:$e(Oe()),rpc:$e(Oe()),version:$e(Oe())}),RO=Te({votePubkey:Oe(),nodePubkey:Oe(),activatedStake:we(),epochVoteAccount:Sa(),epochCredits:ze(XP([we(),we(),we()])),commission:we(),lastVote:we(),rootSlot:$e(we())}),Dwe=Tt(Te({current:ze(RO),delinquent:ze(RO)})),Owe=Li([Jn("processed"),Jn("confirmed"),Jn("finalized")]),Lwe=Te({slot:we(),confirmations:$e(we()),err:Gu,confirmationStatus:gt(Owe)}),Nwe=ar(ze($e(Lwe))),Bwe=Tt(we()),W9=Te({accountKey:rr,writableIndexes:ze(we()),readonlyIndexes:ze(we())}),nM=Te({signatures:ze(Oe()),message:Te({accountKeys:ze(Oe()),header:Te({numRequiredSignatures:we(),numReadonlySignedAccounts:we(),numReadonlyUnsignedAccounts:we()}),instructions:ze(Te({accounts:ze(we()),data:Oe(),programIdIndex:we()})),recentBlockhash:Oe(),addressTableLookups:gt(ze(W9))})}),K9=Te({pubkey:rr,signer:Sa(),writable:Sa(),source:gt(Li([Jn("transaction"),Jn("lookupTable")]))}),q9=Te({accountKeys:ze(K9),signatures:ze(Oe())}),G9=Te({parsed:Bh(),program:Oe(),programId:rr}),V9=Te({accounts:ze(rr),data:Oe(),programId:rr}),Fwe=Li([V9,G9]),zwe=Li([Te({parsed:Bh(),program:Oe(),programId:Oe()}),Te({accounts:ze(Oe()),data:Oe(),programId:Oe()})]),Y9=fg(Fwe,zwe,n=>"accounts"in n?Be(n,V9):Be(n,G9)),X9=Te({signatures:ze(Oe()),message:Te({accountKeys:ze(K9),instructions:ze(Y9),recentBlockhash:Oe(),addressTableLookups:gt($e(ze(W9)))})}),F0=Te({accountIndex:we(),mint:Oe(),owner:gt(Oe()),programId:gt(Oe()),uiTokenAmount:HE}),Z9=Te({writable:ze(rr),readonly:ze(rr)}),lv=Te({err:Gu,fee:we(),innerInstructions:gt($e(ze(Te({index:we(),instructions:ze(Te({accounts:ze(we()),data:Oe(),programIdIndex:we()}))})))),preBalances:ze(we()),postBalances:ze(we()),logMessages:gt($e(ze(Oe()))),preTokenBalances:gt($e(ze(F0))),postTokenBalances:gt($e(ze(F0))),loadedAddresses:gt(Z9),computeUnitsConsumed:gt(we())}),rM=Te({err:Gu,fee:we(),innerInstructions:gt($e(ze(Te({index:we(),instructions:ze(Y9)})))),preBalances:ze(we()),postBalances:ze(we()),logMessages:gt($e(ze(Oe()))),preTokenBalances:gt($e(ze(F0))),postTokenBalances:gt($e(ze(F0))),loadedAddresses:gt(Z9),computeUnitsConsumed:gt(we())}),Fh=Li([Jn(0),Jn("legacy")]),Vu=Te({pubkey:Oe(),lamports:we(),postBalance:$e(we()),rewardType:$e(Oe()),commission:gt($e(we()))}),Uwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),transactions:ze(Te({transaction:nM,meta:$e(lv),version:gt(Fh)})),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),$we=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),Hwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),transactions:ze(Te({transaction:q9,meta:$e(lv),version:gt(Fh)})),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),Wwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),transactions:ze(Te({transaction:X9,meta:$e(rM),version:gt(Fh)})),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),Kwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),transactions:ze(Te({transaction:q9,meta:$e(rM),version:gt(Fh)})),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),qwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),rewards:gt(ze(Vu)),blockTime:$e(we()),blockHeight:$e(we())}))),Gwe=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),transactions:ze(Te({transaction:nM,meta:$e(lv)})),rewards:gt(ze(Vu)),blockTime:$e(we())}))),jO=Tt($e(Te({blockhash:Oe(),previousBlockhash:Oe(),parentSlot:we(),signatures:ze(Oe()),blockTime:$e(we())}))),y_=Tt($e(Te({slot:we(),meta:$e(lv),blockTime:gt($e(we())),transaction:nM,version:gt(Fh)}))),ry=Tt($e(Te({slot:we(),transaction:X9,meta:$e(rM),blockTime:gt($e(we())),version:gt(Fh)}))),Vwe=ar(Te({blockhash:Oe(),feeCalculator:Te({lamportsPerSignature:we()})})),Ywe=ar(Te({blockhash:Oe(),lastValidBlockHeight:we()})),Xwe=ar(Sa()),Zwe=Te({slot:we(),numTransactions:we(),numSlots:we(),samplePeriodSecs:we()}),Qwe=Tt(ze(Zwe)),Jwe=ar($e(Te({feeCalculator:Te({lamportsPerSignature:we()})}))),eve=Tt(Oe()),tve=Tt(Oe()),nve=Te({err:Gu,logs:ze(Oe()),signature:Oe()}),rve=Te({result:cv(nve),subscription:we()}),ive={"solana-client":"js/1.95.8"};class sve{constructor(e,t){this._commitment=void 0,this._confirmTransactionInitialTimeout=void 0,this._rpcEndpoint=void 0,this._rpcWsEndpoint=void 0,this._rpcClient=void 0,this._rpcRequest=void 0,this._rpcBatchRequest=void 0,this._rpcWebSocket=void 0,this._rpcWebSocketConnected=!1,this._rpcWebSocketHeartbeat=null,this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketGeneration=0,this._disableBlockhashCaching=!1,this._pollingBlockhash=!1,this._blockhashInfo={latestBlockhash:null,lastFetch:0,transactionSignatures:[],simulatedSignatures:[]},this._nextClientSubscriptionId=0,this._subscriptionDisposeFunctionsByClientSubscriptionId={},this._subscriptionHashByClientSubscriptionId={},this._subscriptionStateChangeCallbacksByHash={},this._subscriptionCallbacksByServerSubscriptionId={},this._subscriptionsByHash={},this._subscriptionsAutoDisposedByRpc=new Set,this.getBlockHeight=(()=>{const u={};return async d=>{const{commitment:f,config:g}=kn(d),m=this._buildArgs([],f,void 0,g),v=PO(m);return u[v]=u[v]??(async()=>{try{const w=await this._rpcRequest("getBlockHeight",m),S=Be(w,Tt(we()));if("error"in S)throw new it(S.error,"failed to get block height information");return S.result}finally{delete u[v]}})(),await u[v]}})();let r,i,s,o,a,c;t&&typeof t=="string"?this._commitment=t:t&&(this._commitment=t.commitment,this._confirmTransactionInitialTimeout=t.confirmTransactionInitialTimeout,r=t.wsEndpoint,i=t.httpHeaders,s=t.fetch,o=t.fetchMiddleware,a=t.disableRetryOnRateLimit,c=t.httpAgent),this._rpcEndpoint=$0e(e),this._rpcWsEndpoint=r||z0e(e),this._rpcClient=rwe(e,i,s,o,a,c),this._rpcRequest=iwe(this._rpcClient),this._rpcBatchRequest=swe(this._rpcClient),this._rpcWebSocket=new L0e(this._rpcWsEndpoint,{autoconnect:!1,max_reconnects:1/0}),this._rpcWebSocket.on("open",this._wsOnOpen.bind(this)),this._rpcWebSocket.on("error",this._wsOnError.bind(this)),this._rpcWebSocket.on("close",this._wsOnClose.bind(this)),this._rpcWebSocket.on("accountNotification",this._wsOnAccountNotification.bind(this)),this._rpcWebSocket.on("programNotification",this._wsOnProgramAccountNotification.bind(this)),this._rpcWebSocket.on("slotNotification",this._wsOnSlotNotification.bind(this)),this._rpcWebSocket.on("slotsUpdatesNotification",this._wsOnSlotUpdatesNotification.bind(this)),this._rpcWebSocket.on("signatureNotification",this._wsOnSignatureNotification.bind(this)),this._rpcWebSocket.on("rootNotification",this._wsOnRootNotification.bind(this)),this._rpcWebSocket.on("logsNotification",this._wsOnLogsNotification.bind(this))}get commitment(){return this._commitment}get rpcEndpoint(){return this._rpcEndpoint}async getBalanceAndContext(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgs([e.toBase58()],r,void 0,i),o=await this._rpcRequest("getBalance",s),a=Be(o,ar(we()));if("error"in a)throw new it(a.error,`failed to get balance for ${e.toBase58()}`);return a.result}async getBalance(e,t){return await this.getBalanceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get balance of account "+e.toBase58()+": "+r)})}async getBlockTime(e){const t=await this._rpcRequest("getBlockTime",[e]),r=Be(t,Tt($e(we())));if("error"in r)throw new it(r.error,`failed to get block time for slot ${e}`);return r.result}async getMinimumLedgerSlot(){const e=await this._rpcRequest("minimumLedgerSlot",[]),t=Be(e,Tt(we()));if("error"in t)throw new it(t.error,"failed to get minimum ledger slot");return t.result}async getFirstAvailableBlock(){const e=await this._rpcRequest("getFirstAvailableBlock",[]),t=Be(e,hwe);if("error"in t)throw new it(t.error,"failed to get first available block");return t.result}async getSupply(e){let t={};typeof e=="string"?t={commitment:e}:e?t={...e,commitment:e&&e.commitment||this.commitment}:t={commitment:this.commitment};const r=await this._rpcRequest("getSupply",[t]),i=Be(r,fwe);if("error"in i)throw new it(i.error,"failed to get supply");return i.result}async getTokenSupply(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenSupply",r),s=Be(i,ar(HE));if("error"in s)throw new it(s.error,"failed to get token supply");return s.result}async getTokenAccountBalance(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenAccountBalance",r),s=Be(i,ar(HE));if("error"in s)throw new it(s.error,"failed to get token account balance");return s.result}async getTokenAccountsByOwner(e,t,r){const{commitment:i,config:s}=kn(r);let o=[e.toBase58()];"mint"in t?o.push({mint:t.mint.toBase58()}):o.push({programId:t.programId.toBase58()});const a=this._buildArgs(o,i,"base64",s),c=await this._rpcRequest("getTokenAccountsByOwner",a),u=Be(c,gwe);if("error"in u)throw new it(u.error,`failed to get token accounts owned by account ${e.toBase58()}`);return u.result}async getParsedTokenAccountsByOwner(e,t,r){let i=[e.toBase58()];"mint"in t?i.push({mint:t.mint.toBase58()}):i.push({programId:t.programId.toBase58()});const s=this._buildArgs(i,r,"jsonParsed"),o=await this._rpcRequest("getTokenAccountsByOwner",s),a=Be(o,mwe);if("error"in a)throw new it(a.error,`failed to get token accounts owned by account ${e.toBase58()}`);return a.result}async getLargestAccounts(e){const t={...e,commitment:e&&e.commitment||this.commitment},r=t.filter||t.commitment?[t]:[],i=await this._rpcRequest("getLargestAccounts",r),s=Be(i,ywe);if("error"in s)throw new it(s.error,"failed to get largest accounts");return s.result}async getTokenLargestAccounts(e,t){const r=this._buildArgs([e.toBase58()],t),i=await this._rpcRequest("getTokenLargestAccounts",r),s=Be(i,pwe);if("error"in s)throw new it(s.error,"failed to get token largest accounts");return s.result}async getAccountInfoAndContext(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgs([e.toBase58()],r,"base64",i),o=await this._rpcRequest("getAccountInfo",s),a=Be(o,ar($e(Lp)));if("error"in a)throw new it(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getParsedAccountInfo(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgs([e.toBase58()],r,"jsonParsed",i),o=await this._rpcRequest("getAccountInfo",s),a=Be(o,ar($e(KE)));if("error"in a)throw new it(a.error,`failed to get info about account ${e.toBase58()}`);return a.result}async getAccountInfo(e,t){try{return(await this.getAccountInfoAndContext(e,t)).value}catch(r){throw new Error("failed to get info about account "+e.toBase58()+": "+r)}}async getMultipleParsedAccounts(e,t){const{commitment:r,config:i}=kn(t),s=e.map(u=>u.toBase58()),o=this._buildArgs([s],r,"jsonParsed",i),a=await this._rpcRequest("getMultipleAccounts",o),c=Be(a,ar(ze($e(KE))));if("error"in c)throw new it(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfoAndContext(e,t){const{commitment:r,config:i}=kn(t),s=e.map(u=>u.toBase58()),o=this._buildArgs([s],r,"base64",i),a=await this._rpcRequest("getMultipleAccounts",o),c=Be(a,ar(ze($e(Lp))));if("error"in c)throw new it(c.error,`failed to get info for accounts ${s}`);return c.result}async getMultipleAccountsInfo(e,t){return(await this.getMultipleAccountsInfoAndContext(e,t)).value}async getStakeActivation(e,t,r){const{commitment:i,config:s}=kn(t),o=this._buildArgs([e.toBase58()],i,void 0,{...s,epoch:r??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getStakeActivation",o),c=Be(a,Tt(xwe));if("error"in c)throw new it(c.error,`failed to get Stake Activation ${e.toBase58()}`);return c.result}async getProgramAccounts(e,t){const{commitment:r,config:i}=kn(t),{encoding:s,...o}=i||{},a=this._buildArgs([e.toBase58()],r,s||"base64",{...o,...o.filters?{filters:kO(o.filters)}:null}),c=await this._rpcRequest("getProgramAccounts",a),u=ze(wwe),d=o.withContext===!0?Be(c,ar(u)):Be(c,Tt(u));if("error"in d)throw new it(d.error,`failed to get accounts owned by program ${e.toBase58()}`);return d.result}async getParsedProgramAccounts(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgs([e.toBase58()],r,"jsonParsed",i),o=await this._rpcRequest("getProgramAccounts",s),a=Be(o,Tt(ze(Swe)));if("error"in a)throw new it(a.error,`failed to get accounts owned by program ${e.toBase58()}`);return a.result}async confirmTransaction(e,t){var s;let r;if(typeof e=="string")r=e;else{const o=e;if((s=o.abortSignal)!=null&&s.aborted)return Promise.reject(o.abortSignal.reason);r=o.signature}let i;try{i=Yr.decode(r)}catch{throw new Error("signature must be base58 encoded: "+r)}return Yn(i.length===64,"signature has invalid length"),typeof e=="string"?await this.confirmTransactionUsingLegacyTimeoutStrategy({commitment:t||this.commitment,signature:r}):"lastValidBlockHeight"in e?await this.confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:t||this.commitment,strategy:e}):await this.confirmTransactionUsingDurableNonceStrategy({commitment:t||this.commitment,strategy:e})}getCancellationPromise(e){return new Promise((t,r)=>{e!=null&&(e.aborted?r(e.reason):e.addEventListener("abort",()=>{r(e.reason)}))})}getTransactionConfirmationPromise({commitment:e,signature:t}){let r,i,s=!1;const o=new Promise((c,u)=>{try{r=this.onSignature(t,(f,g)=>{r=void 0;const m={context:g,value:f};c({__type:Yc.PROCESSED,response:m})},e);const d=new Promise(f=>{r==null?f():i=this._onSubscriptionStateChange(r,g=>{g==="subscribed"&&f()})});(async()=>{if(await d,s)return;const f=await this.getSignatureStatus(t);if(s||f==null)return;const{context:g,value:m}=f;if(m!=null)if(m!=null&&m.err)u(m.err);else{switch(e){case"confirmed":case"single":case"singleGossip":{if(m.confirmationStatus==="processed")return;break}case"finalized":case"max":case"root":{if(m.confirmationStatus==="processed"||m.confirmationStatus==="confirmed")return;break}case"processed":case"recent":}s=!0,c({__type:Yc.PROCESSED,response:{context:g,value:m}})}})()}catch(d){u(d)}});return{abortConfirmation:()=>{i&&(i(),i=void 0),r!=null&&(this.removeSignatureListener(r),r=void 0)},confirmationPromise:o}}async confirmTransactionUsingBlockHeightExceedanceStrategy({commitment:e,strategy:{abortSignal:t,lastValidBlockHeight:r,signature:i}}){let s=!1;const o=new Promise(f=>{const g=async()=>{try{return await this.getBlockHeight(e)}catch{return-1}};(async()=>{let m=await g();if(!s){for(;m<=r;)if(await Fd(1e3),s||(m=await g(),s))return;f({__type:Yc.BLOCKHEIGHT_EXCEEDED})}})()}),{abortConfirmation:a,confirmationPromise:c}=this.getTransactionConfirmationPromise({commitment:e,signature:i}),u=this.getCancellationPromise(t);let d;try{const f=await Promise.race([u,c,o]);if(f.__type===Yc.PROCESSED)d=f.response;else throw new B9(i)}finally{s=!0,a()}return d}async confirmTransactionUsingDurableNonceStrategy({commitment:e,strategy:{abortSignal:t,minContextSlot:r,nonceAccountPubkey:i,nonceValue:s,signature:o}}){let a=!1;const c=new Promise(m=>{let v=s,w=null;const S=async()=>{try{const{context:b,value:x}=await this.getNonceAndContext(i,{commitment:e,minContextSlot:r});return w=b.slot,x==null?void 0:x.nonce}catch{return v}};(async()=>{if(v=await S(),!a)for(;;){if(s!==v){m({__type:Yc.NONCE_INVALID,slotInWhichNonceDidAdvance:w});return}if(await Fd(2e3),a||(v=await S(),a))return}})()}),{abortConfirmation:u,confirmationPromise:d}=this.getTransactionConfirmationPromise({commitment:e,signature:o}),f=this.getCancellationPromise(t);let g;try{const m=await Promise.race([f,d,c]);if(m.__type===Yc.PROCESSED)g=m.response;else{let v;for(;;){const w=await this.getSignatureStatus(o);if(w==null)break;if(w.context.slot<(m.slotInWhichNonceDidAdvance??r)){await Fd(400);continue}v=w;break}if(v!=null&&v.value){const w=e||"finalized",{confirmationStatus:S}=v.value;switch(w){case"processed":case"recent":if(S!=="processed"&&S!=="confirmed"&&S!=="finalized")throw new Zf(o);break;case"confirmed":case"single":case"singleGossip":if(S!=="confirmed"&&S!=="finalized")throw new Zf(o);break;case"finalized":case"max":case"root":if(S!=="finalized")throw new Zf(o);break;default:}g={context:v.context,value:{err:v.value.err}}}else throw new Zf(o)}}finally{a=!0,u()}return g}async confirmTransactionUsingLegacyTimeoutStrategy({commitment:e,signature:t}){let r;const i=new Promise(c=>{let u=this._confirmTransactionInitialTimeout||6e4;switch(e){case"processed":case"recent":case"single":case"confirmed":case"singleGossip":{u=this._confirmTransactionInitialTimeout||3e4;break}}r=setTimeout(()=>c({__type:Yc.TIMED_OUT,timeoutMs:u}),u)}),{abortConfirmation:s,confirmationPromise:o}=this.getTransactionConfirmationPromise({commitment:e,signature:t});let a;try{const c=await Promise.race([o,i]);if(c.__type===Yc.PROCESSED)a=c.response;else throw new F9(t,c.timeoutMs/1e3)}finally{clearTimeout(r),s()}return a}async getClusterNodes(){const e=await this._rpcRequest("getClusterNodes",[]),t=Be(e,Tt(ze(jwe)));if("error"in t)throw new it(t.error,"failed to get cluster nodes");return t.result}async getVoteAccounts(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getVoteAccounts",t),i=Be(r,Dwe);if("error"in i)throw new it(i.error,"failed to get vote accounts");return i.result}async getSlot(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getSlot",i),o=Be(s,Tt(we()));if("error"in o)throw new it(o.error,"failed to get slot");return o.result}async getSlotLeader(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getSlotLeader",i),o=Be(s,Tt(Oe()));if("error"in o)throw new it(o.error,"failed to get slot leader");return o.result}async getSlotLeaders(e,t){const r=[e,t],i=await this._rpcRequest("getSlotLeaders",r),s=Be(i,Tt(ze(rr)));if("error"in s)throw new it(s.error,"failed to get slot leaders");return s.result}async getSignatureStatus(e,t){const{context:r,value:i}=await this.getSignatureStatuses([e],t);Yn(i.length===1);const s=i[0];return{context:r,value:s}}async getSignatureStatuses(e,t){const r=[e];t&&r.push(t);const i=await this._rpcRequest("getSignatureStatuses",r),s=Be(i,Nwe);if("error"in s)throw new it(s.error,"failed to get signature status");return s.result}async getTransactionCount(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getTransactionCount",i),o=Be(s,Tt(we()));if("error"in o)throw new it(o.error,"failed to get transaction count");return o.result}async getTotalSupply(e){return(await this.getSupply({commitment:e,excludeNonCirculatingAccountsList:!0})).value.total}async getInflationGovernor(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getInflationGovernor",t),i=Be(r,owe);if("error"in i)throw new it(i.error,"failed to get inflation");return i.result}async getInflationReward(e,t,r){const{commitment:i,config:s}=kn(r),o=this._buildArgs([e.map(u=>u.toBase58())],i,void 0,{...s,epoch:t??(s==null?void 0:s.epoch)}),a=await this._rpcRequest("getInflationReward",o),c=Be(a,K0e);if("error"in c)throw new it(c.error,"failed to get inflation reward");return c.result}async getInflationRate(){const e=await this._rpcRequest("getInflationRate",[]),t=Be(e,awe);if("error"in t)throw new it(t.error,"failed to get inflation rate");return t.result}async getEpochInfo(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getEpochInfo",i),o=Be(s,lwe);if("error"in o)throw new it(o.error,"failed to get epoch info");return o.result}async getEpochSchedule(){const e=await this._rpcRequest("getEpochSchedule",[]),t=Be(e,uwe);if("error"in t)throw new it(t.error,"failed to get epoch schedule");const r=t.result;return new D0e(r.slotsPerEpoch,r.leaderScheduleSlotOffset,r.warmup,r.firstNormalEpoch,r.firstNormalSlot)}async getLeaderSchedule(){const e=await this._rpcRequest("getLeaderSchedule",[]),t=Be(e,dwe);if("error"in t)throw new it(t.error,"failed to get leader schedule");return t.result}async getMinimumBalanceForRentExemption(e,t){const r=this._buildArgs([e],t),i=await this._rpcRequest("getMinimumBalanceForRentExemption",r),s=Be(i,Bwe);return"error"in s?(console.warn("Unable to fetch minimum balance for rent exemption"),0):s.result}async getRecentBlockhashAndContext(e){const t=this._buildArgs([],e),r=await this._rpcRequest("getRecentBlockhash",t),i=Be(r,Vwe);if("error"in i)throw new it(i.error,"failed to get recent blockhash");return i.result}async getRecentPerformanceSamples(e){const t=await this._rpcRequest("getRecentPerformanceSamples",e?[e]:[]),r=Be(t,Qwe);if("error"in r)throw new it(r.error,"failed to get recent performance samples");return r.result}async getFeeCalculatorForBlockhash(e,t){const r=this._buildArgs([e],t),i=await this._rpcRequest("getFeeCalculatorForBlockhash",r),s=Be(i,Jwe);if("error"in s)throw new it(s.error,"failed to get fee calculator");const{context:o,value:a}=s.result;return{context:o,value:a!==null?a.feeCalculator:null}}async getFeeForMessage(e,t){const r=Sh(e.serialize()).toString("base64"),i=this._buildArgs([r],t),s=await this._rpcRequest("getFeeForMessage",i),o=Be(s,ar($e(we())));if("error"in o)throw new it(o.error,"failed to get fee for message");if(o.result===null)throw new Error("invalid blockhash");return o.result}async getRecentPrioritizationFees(e){var o;const t=(o=e==null?void 0:e.lockedWritableAccounts)==null?void 0:o.map(a=>a.toBase58()),r=t!=null&&t.length?[t]:[],i=await this._rpcRequest("getRecentPrioritizationFees",r),s=Be(i,cwe);if("error"in s)throw new it(s.error,"failed to get recent prioritization fees");return s.result}async getRecentBlockhash(e){try{return(await this.getRecentBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhash(e){try{return(await this.getLatestBlockhashAndContext(e)).value}catch(t){throw new Error("failed to get recent blockhash: "+t)}}async getLatestBlockhashAndContext(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,void 0,r),s=await this._rpcRequest("getLatestBlockhash",i),o=Be(s,Ywe);if("error"in o)throw new it(o.error,"failed to get latest blockhash");return o.result}async isBlockhashValid(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgs([e],r,void 0,i),o=await this._rpcRequest("isBlockhashValid",s),a=Be(o,Xwe);if("error"in a)throw new it(a.error,"failed to determine if the blockhash `"+e+"`is valid");return a.result}async getVersion(){const e=await this._rpcRequest("getVersion",[]),t=Be(e,Tt(J0e));if("error"in t)throw new it(t.error,"failed to get version");return t.result}async getGenesisHash(){const e=await this._rpcRequest("getGenesisHash",[]),t=Be(e,Tt(Oe()));if("error"in t)throw new it(t.error,"failed to get genesis hash");return t.result}async getBlock(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgsAtLeastConfirmed([e],r,void 0,i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=Be(o,Hwe);if("error"in a)throw a.error;return a.result}case"none":{const a=Be(o,$we);if("error"in a)throw a.error;return a.result}default:{const a=Be(o,Uwe);if("error"in a)throw a.error;const{result:c}=a;return c?{...c,transactions:c.transactions.map(({transaction:u,meta:d,version:f})=>({meta:d,transaction:{...u,message:m_(f,u.message)},version:f}))}:null}}}catch(a){throw new it(a,"failed to get confirmed block")}}async getParsedBlock(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",i),o=await this._rpcRequest("getBlock",s);try{switch(i==null?void 0:i.transactionDetails){case"accounts":{const a=Be(o,Kwe);if("error"in a)throw a.error;return a.result}case"none":{const a=Be(o,qwe);if("error"in a)throw a.error;return a.result}default:{const a=Be(o,Wwe);if("error"in a)throw a.error;return a.result}}}catch(a){throw new it(a,"failed to get block")}}async getBlockProduction(e){let t,r;if(typeof e=="string")r=e;else if(e){const{commitment:a,...c}=e;r=a,t=c}const i=this._buildArgs([],r,"base64",t),s=await this._rpcRequest("getBlockProduction",i),o=Be(s,nwe);if("error"in o)throw new it(o.error,"failed to get block production information");return o.result}async getTransaction(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgsAtLeastConfirmed([e],r,void 0,i),o=await this._rpcRequest("getTransaction",s),a=Be(o,y_);if("error"in a)throw new it(a.error,"failed to get transaction");const c=a.result;return c&&{...c,transaction:{...c.transaction,message:m_(c.version,c.transaction.message)}}}async getParsedTransaction(e,t){const{commitment:r,config:i}=kn(t),s=this._buildArgsAtLeastConfirmed([e],r,"jsonParsed",i),o=await this._rpcRequest("getTransaction",s),a=Be(o,ry);if("error"in a)throw new it(a.error,"failed to get transaction");return a.result}async getParsedTransactions(e,t){const{commitment:r,config:i}=kn(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,"jsonParsed",i)}));return(await this._rpcBatchRequest(s)).map(c=>{const u=Be(c,ry);if("error"in u)throw new it(u.error,"failed to get transactions");return u.result})}async getTransactions(e,t){const{commitment:r,config:i}=kn(t),s=e.map(c=>({methodName:"getTransaction",args:this._buildArgsAtLeastConfirmed([c],r,void 0,i)}));return(await this._rpcBatchRequest(s)).map(c=>{const u=Be(c,y_);if("error"in u)throw new it(u.error,"failed to get transactions");const d=u.result;return d&&{...d,transaction:{...d.transaction,message:m_(d.version,d.transaction.message)}}})}async getConfirmedBlock(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getConfirmedBlock",r),s=Be(i,Gwe);if("error"in s)throw new it(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");const a={...o,transactions:o.transactions.map(({transaction:c,meta:u})=>{const d=new fc(c.message);return{meta:u,transaction:{...c,message:d}}})};return{...a,transactions:a.transactions.map(({transaction:c,meta:u})=>({meta:u,transaction:_o.populate(c.message,c.signatures)}))}}async getBlocks(e,t,r){const i=this._buildArgsAtLeastConfirmed(t!==void 0?[e,t]:[e],r),s=await this._rpcRequest("getBlocks",i),o=Be(s,Tt(ze(we())));if("error"in o)throw new it(o.error,"failed to get blocks");return o.result}async getBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getBlock",r),s=Be(i,jO);if("error"in s)throw new it(s.error,"failed to get block");const o=s.result;if(!o)throw new Error("Block "+e+" not found");return o}async getConfirmedBlockSignatures(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,void 0,{transactionDetails:"signatures",rewards:!1}),i=await this._rpcRequest("getConfirmedBlock",r),s=Be(i,jO);if("error"in s)throw new it(s.error,"failed to get confirmed block");const o=s.result;if(!o)throw new Error("Confirmed block "+e+" not found");return o}async getConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t),i=await this._rpcRequest("getConfirmedTransaction",r),s=Be(i,y_);if("error"in s)throw new it(s.error,"failed to get transaction");const o=s.result;if(!o)return o;const a=new fc(o.transaction.message),c=o.transaction.signatures;return{...o,transaction:_o.populate(a,c)}}async getParsedConfirmedTransaction(e,t){const r=this._buildArgsAtLeastConfirmed([e],t,"jsonParsed"),i=await this._rpcRequest("getConfirmedTransaction",r),s=Be(i,ry);if("error"in s)throw new it(s.error,"failed to get confirmed transaction");return s.result}async getParsedConfirmedTransactions(e,t){const r=e.map(o=>({methodName:"getConfirmedTransaction",args:this._buildArgsAtLeastConfirmed([o],t,"jsonParsed")}));return(await this._rpcBatchRequest(r)).map(o=>{const a=Be(o,ry);if("error"in a)throw new it(a.error,"failed to get confirmed transactions");return a.result})}async getConfirmedSignaturesForAddress(e,t,r){let i={},s=await this.getFirstAvailableBlock();for(;!("until"in i)&&(t--,!(t<=0||t<s));)try{const c=await this.getConfirmedBlockSignatures(t,"finalized");c.signatures.length>0&&(i.until=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}let o=await this.getSlot("finalized");for(;!("before"in i)&&(r++,!(r>o));)try{const c=await this.getConfirmedBlockSignatures(r);c.signatures.length>0&&(i.before=c.signatures[c.signatures.length-1].toString())}catch(c){if(c instanceof Error&&c.message.includes("skipped"))continue;throw c}return(await this.getConfirmedSignaturesForAddress2(e,i)).map(c=>c.signature)}async getConfirmedSignaturesForAddress2(e,t,r){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),s=await this._rpcRequest("getConfirmedSignaturesForAddress2",i),o=Be(s,bwe);if("error"in o)throw new it(o.error,"failed to get confirmed signatures for address");return o.result}async getSignaturesForAddress(e,t,r){const i=this._buildArgsAtLeastConfirmed([e.toBase58()],r,void 0,t),s=await this._rpcRequest("getSignaturesForAddress",i),o=Be(s,_we);if("error"in o)throw new it(o.error,"failed to get signatures for address");return o.result}async getAddressLookupTable(e,t){const{context:r,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=new TO({key:e,state:TO.deserialize(i.data)})),{context:r,value:s}}async getNonceAndContext(e,t){const{context:r,value:i}=await this.getAccountInfoAndContext(e,t);let s=null;return i!==null&&(s=eM.fromAccountData(i.data)),{context:r,value:s}}async getNonce(e,t){return await this.getNonceAndContext(e,t).then(r=>r.value).catch(r=>{throw new Error("failed to get nonce for account "+e.toBase58()+": "+r)})}async requestAirdrop(e,t){const r=await this._rpcRequest("requestAirdrop",[e.toBase58(),t]),i=Be(r,eve);if("error"in i)throw new it(i.error,`airdrop to ${e.toBase58()} failed`);return i.result}async _blockhashWithExpiryBlockHeight(e){if(!e){for(;this._pollingBlockhash;)await Fd(100);const r=Date.now()-this._blockhashInfo.lastFetch>=U0e;if(this._blockhashInfo.latestBlockhash!==null&&!r)return this._blockhashInfo.latestBlockhash}return await this._pollNewBlockhash()}async _pollNewBlockhash(){this._pollingBlockhash=!0;try{const e=Date.now(),t=this._blockhashInfo.latestBlockhash,r=t?t.blockhash:null;for(let i=0;i<50;i++){const s=await this.getLatestBlockhash("finalized");if(r!==s.blockhash)return this._blockhashInfo={latestBlockhash:s,lastFetch:Date.now(),transactionSignatures:[],simulatedSignatures:[]},s;await Fd(C0e/2)}throw new Error(`Unable to obtain a new blockhash after ${Date.now()-e}ms`)}finally{this._pollingBlockhash=!1}}async getStakeMinimumDelegation(e){const{commitment:t,config:r}=kn(e),i=this._buildArgs([],t,"base64",r),s=await this._rpcRequest("getStakeMinimumDelegation",i),o=Be(s,ar(we()));if("error"in o)throw new it(o.error,"failed to get stake minimum delegation");return o.result}async simulateTransaction(e,t,r){if("message"in e){const w=e.serialize(),S=Ct.Buffer.from(w).toString("base64");if(Array.isArray(t)||r!==void 0)throw new Error("Invalid arguments");const b=t||{};b.encoding="base64","commitment"in b||(b.commitment=this.commitment),t&&typeof t=="object"&&"innerInstructions"in t&&(b.innerInstructions=t.innerInstructions);const x=[S,b],E=await this._rpcRequest("simulateTransaction",x),M=Be(E,AO);if("error"in M)throw new Error("failed to simulate transaction: "+M.error.message);return M.result}let i;if(e instanceof _o){let v=e;i=new _o,i.feePayer=v.feePayer,i.instructions=e.instructions,i.nonceInfo=v.nonceInfo,i.signatures=v.signatures}else i=_o.populate(e),i._message=i._json=void 0;if(t!==void 0&&!Array.isArray(t))throw new Error("Invalid arguments");const s=t;if(i.nonceInfo&&s)i.sign(...s);else{let v=this._disableBlockhashCaching;for(;;){const w=await this._blockhashWithExpiryBlockHeight(v);if(i.lastValidBlockHeight=w.lastValidBlockHeight,i.recentBlockhash=w.blockhash,!s)break;if(i.sign(...s),!i.signature)throw new Error("!signature");const S=i.signature.toString("base64");if(!this._blockhashInfo.simulatedSignatures.includes(S)&&!this._blockhashInfo.transactionSignatures.includes(S)){this._blockhashInfo.simulatedSignatures.push(S);break}else v=!0}}const o=i._compile(),a=o.serialize(),u=i._serialize(a).toString("base64"),d={encoding:"base64",commitment:this.commitment};if(r){const v=(Array.isArray(r)?r:o.nonProgramIds()).map(w=>w.toBase58());d.accounts={encoding:"base64",addresses:v}}s&&(d.sigVerify=!0),t&&typeof t=="object"&&"innerInstructions"in t&&(d.innerInstructions=t.innerInstructions);const f=[u,d],g=await this._rpcRequest("simulateTransaction",f),m=Be(g,AO);if("error"in m){let v;if("data"in m.error&&(v=m.error.data.logs,v&&Array.isArray(v))){const w=`
    `,S=w+v.join(w);console.error(m.error.message,S)}throw new EO({action:"simulate",signature:"",transactionMessage:m.error.message,logs:v})}return m.result}async sendTransaction(e,t,r){if("version"in e){if(t&&Array.isArray(t))throw new Error("Invalid arguments");const o=e.serialize();return await this.sendRawTransaction(o,t)}if(t===void 0||!Array.isArray(t))throw new Error("Invalid arguments");const i=t;if(e.nonceInfo)e.sign(...i);else{let o=this._disableBlockhashCaching;for(;;){const a=await this._blockhashWithExpiryBlockHeight(o);if(e.lastValidBlockHeight=a.lastValidBlockHeight,e.recentBlockhash=a.blockhash,e.sign(...i),!e.signature)throw new Error("!signature");const c=e.signature.toString("base64");if(this._blockhashInfo.transactionSignatures.includes(c))o=!0;else{this._blockhashInfo.transactionSignatures.push(c);break}}}const s=e.serialize();return await this.sendRawTransaction(s,r)}async sendRawTransaction(e,t){const r=Sh(e).toString("base64");return await this.sendEncodedTransaction(r,t)}async sendEncodedTransaction(e,t){const r={encoding:"base64"},i=t&&t.skipPreflight,s=i===!0?"processed":t&&t.preflightCommitment||this.commitment;t&&t.maxRetries!=null&&(r.maxRetries=t.maxRetries),t&&t.minContextSlot!=null&&(r.minContextSlot=t.minContextSlot),i&&(r.skipPreflight=i),s&&(r.preflightCommitment=s);const o=[e,r],a=await this._rpcRequest("sendTransaction",o),c=Be(a,tve);if("error"in c){let u;throw"data"in c.error&&(u=c.error.data.logs),new EO({action:i?"send":"simulate",signature:"",transactionMessage:c.error.message,logs:u})}return c.result}_wsOnOpen(){this._rpcWebSocketConnected=!0,this._rpcWebSocketHeartbeat=setInterval(()=>{(async()=>{try{await this._rpcWebSocket.notify("ping")}catch{}})()},5e3),this._updateSubscriptions()}_wsOnError(e){this._rpcWebSocketConnected=!1,console.error("ws error:",e.message)}_wsOnClose(e){if(this._rpcWebSocketConnected=!1,this._rpcWebSocketGeneration=(this._rpcWebSocketGeneration+1)%Number.MAX_SAFE_INTEGER,this._rpcWebSocketIdleTimeout&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null),this._rpcWebSocketHeartbeat&&(clearInterval(this._rpcWebSocketHeartbeat),this._rpcWebSocketHeartbeat=null),e===1e3){this._updateSubscriptions();return}this._subscriptionCallbacksByServerSubscriptionId={},Object.entries(this._subscriptionsByHash).forEach(([t,r])=>{this._setSubscription(t,{...r,state:"pending"})})}_setSubscription(e,t){var i;const r=(i=this._subscriptionsByHash[e])==null?void 0:i.state;if(this._subscriptionsByHash[e]=t,r!==t.state){const s=this._subscriptionStateChangeCallbacksByHash[e];s&&s.forEach(o=>{try{o(t.state)}catch{}})}}_onSubscriptionStateChange(e,t){var s;const r=this._subscriptionHashByClientSubscriptionId[e];if(r==null)return()=>{};const i=(s=this._subscriptionStateChangeCallbacksByHash)[r]||(s[r]=new Set);return i.add(t),()=>{i.delete(t),i.size===0&&delete this._subscriptionStateChangeCallbacksByHash[r]}}async _updateSubscriptions(){if(Object.keys(this._subscriptionsByHash).length===0){this._rpcWebSocketConnected&&(this._rpcWebSocketConnected=!1,this._rpcWebSocketIdleTimeout=setTimeout(()=>{this._rpcWebSocketIdleTimeout=null;try{this._rpcWebSocket.close()}catch(r){r instanceof Error&&console.log(`Error when closing socket connection: ${r.message}`)}},500));return}if(this._rpcWebSocketIdleTimeout!==null&&(clearTimeout(this._rpcWebSocketIdleTimeout),this._rpcWebSocketIdleTimeout=null,this._rpcWebSocketConnected=!0),!this._rpcWebSocketConnected){this._rpcWebSocket.connect();return}const e=this._rpcWebSocketGeneration,t=()=>e===this._rpcWebSocketGeneration;await Promise.all(Object.keys(this._subscriptionsByHash).map(async r=>{const i=this._subscriptionsByHash[r];if(i!==void 0)switch(i.state){case"pending":case"unsubscribed":if(i.callbacks.size===0){delete this._subscriptionsByHash[r],i.state==="unsubscribed"&&delete this._subscriptionCallbacksByServerSubscriptionId[i.serverSubscriptionId],await this._updateSubscriptions();return}await(async()=>{const{args:s,method:o}=i;try{this._setSubscription(r,{...i,state:"subscribing"});const a=await this._rpcWebSocket.call(o,s);this._setSubscription(r,{...i,serverSubscriptionId:a,state:"subscribed"}),this._subscriptionCallbacksByServerSubscriptionId[a]=i.callbacks,await this._updateSubscriptions()}catch(a){if(console.error(`Received ${a instanceof Error?"":"JSON-RPC "}error calling \`${o}\``,{args:s,error:a}),!t())return;this._setSubscription(r,{...i,state:"pending"}),await this._updateSubscriptions()}})();break;case"subscribed":i.callbacks.size===0&&await(async()=>{const{serverSubscriptionId:s,unsubscribeMethod:o}=i;if(this._subscriptionsAutoDisposedByRpc.has(s))this._subscriptionsAutoDisposedByRpc.delete(s);else{this._setSubscription(r,{...i,state:"unsubscribing"}),this._setSubscription(r,{...i,state:"unsubscribing"});try{await this._rpcWebSocket.call(o,[s])}catch(a){if(a instanceof Error&&console.error(`${o} error:`,a.message),!t())return;this._setSubscription(r,{...i,state:"subscribed"}),await this._updateSubscriptions();return}}this._setSubscription(r,{...i,state:"unsubscribed"}),await this._updateSubscriptions()})();break}}))}_handleServerNotification(e,t){const r=this._subscriptionCallbacksByServerSubscriptionId[e];r!==void 0&&r.forEach(i=>{try{i(...t)}catch(s){console.error(s)}})}_wsOnAccountNotification(e){const{result:t,subscription:r}=Be(e,Iwe);this._handleServerNotification(r,[t.value,t.context])}_makeSubscription(e,t){const r=this._nextClientSubscriptionId++,i=PO([e.method,t]),s=this._subscriptionsByHash[i];return s===void 0?this._subscriptionsByHash[i]={...e,args:t,callbacks:new Set([e.callback]),state:"pending"}:s.callbacks.add(e.callback),this._subscriptionHashByClientSubscriptionId[r]=i,this._subscriptionDisposeFunctionsByClientSubscriptionId[r]=async()=>{delete this._subscriptionDisposeFunctionsByClientSubscriptionId[r],delete this._subscriptionHashByClientSubscriptionId[r];const o=this._subscriptionsByHash[i];Yn(o!==void 0,`Could not find a \`Subscription\` when tearing down client subscription #${r}`),o.callbacks.delete(e.callback),await this._updateSubscriptions()},this._updateSubscriptions(),r}onAccountChange(e,t,r){const{commitment:i,config:s}=kn(r),o=this._buildArgs([e.toBase58()],i||this._commitment||"finalized","base64",s);return this._makeSubscription({callback:t,method:"accountSubscribe",unsubscribeMethod:"accountUnsubscribe"},o)}async removeAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"account change")}_wsOnProgramAccountNotification(e){const{result:t,subscription:r}=Be(e,Cwe);this._handleServerNotification(r,[{accountId:t.value.pubkey,accountInfo:t.value.account},t.context])}onProgramAccountChange(e,t,r,i){const{commitment:s,config:o}=kn(r),a=this._buildArgs([e.toBase58()],s||this._commitment||"finalized","base64",o||(i?{filters:kO(i)}:void 0));return this._makeSubscription({callback:t,method:"programSubscribe",unsubscribeMethod:"programUnsubscribe"},a)}async removeProgramAccountChangeListener(e){await this._unsubscribeClientSubscription(e,"program account change")}onLogs(e,t,r){const i=this._buildArgs([typeof e=="object"?{mentions:[e.toString()]}:e],r||this._commitment||"finalized");return this._makeSubscription({callback:t,method:"logsSubscribe",unsubscribeMethod:"logsUnsubscribe"},i)}async removeOnLogsListener(e){await this._unsubscribeClientSubscription(e,"logs")}_wsOnLogsNotification(e){const{result:t,subscription:r}=Be(e,rve);this._handleServerNotification(r,[t.value,t.context])}_wsOnSlotNotification(e){const{result:t,subscription:r}=Be(e,Mwe);this._handleServerNotification(r,[t])}onSlotChange(e){return this._makeSubscription({callback:e,method:"slotSubscribe",unsubscribeMethod:"slotUnsubscribe"},[])}async removeSlotChangeListener(e){await this._unsubscribeClientSubscription(e,"slot change")}_wsOnSlotUpdatesNotification(e){const{result:t,subscription:r}=Be(e,kwe);this._handleServerNotification(r,[t])}onSlotUpdate(e){return this._makeSubscription({callback:e,method:"slotsUpdatesSubscribe",unsubscribeMethod:"slotsUpdatesUnsubscribe"},[])}async removeSlotUpdateListener(e){await this._unsubscribeClientSubscription(e,"slot update")}async _unsubscribeClientSubscription(e,t){const r=this._subscriptionDisposeFunctionsByClientSubscriptionId[e];r?await r():console.warn(`Ignored unsubscribe request because an active subscription with id \`${e}\` for '${t}' events could not be found.`)}_buildArgs(e,t,r,i){const s=t||this._commitment;if(s||r||i){let o={};r&&(o.encoding=r),s&&(o.commitment=s),i&&(o=Object.assign(o,i)),e.push(o)}return e}_buildArgsAtLeastConfirmed(e,t,r,i){const s=t||this._commitment;if(s&&!["confirmed","finalized"].includes(s))throw new Error("Using Connection with default commitment: `"+this._commitment+"`, but method requires at least `confirmed`");return this._buildArgs(e,t,r,i)}_wsOnSignatureNotification(e){const{result:t,subscription:r}=Be(e,Awe);t.value!=="receivedSignature"&&this._subscriptionsAutoDisposedByRpc.add(r),this._handleServerNotification(r,t.value==="receivedSignature"?[{type:"received"},t.context]:[{type:"status",result:t.value},t.context])}onSignature(e,t,r){const i=this._buildArgs([e],r||this._commitment||"finalized"),s=this._makeSubscription({callback:(o,a)=>{if(o.type==="status"){t(o.result,a);try{this.removeSignatureListener(s)}catch{}}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},i);return s}onSignatureWithOptions(e,t,r){const{commitment:i,...s}={...r,commitment:r&&r.commitment||this._commitment||"finalized"},o=this._buildArgs([e],i,void 0,s),a=this._makeSubscription({callback:(c,u)=>{t(c,u);try{this.removeSignatureListener(a)}catch{}},method:"signatureSubscribe",unsubscribeMethod:"signatureUnsubscribe"},o);return a}async removeSignatureListener(e){await this._unsubscribeClientSubscription(e,"signature result")}_wsOnRootNotification(e){const{result:t,subscription:r}=Be(e,Rwe);this._handleServerNotification(r,[t])}onRootChange(e){return this._makeSubscription({callback:e,method:"rootSubscribe",unsubscribeMethod:"rootUnsubscribe"},[])}async removeRootChangeListener(e){await this._unsubscribeClientSubscription(e,"root change")}}Object.freeze({CreateLookupTable:{index:0,layout:ae.struct([ae.u32("instruction"),xh("recentSlot"),ae.u8("bumpSeed")])},FreezeLookupTable:{index:1,layout:ae.struct([ae.u32("instruction")])},ExtendLookupTable:{index:2,layout:ae.struct([ae.u32("instruction"),xh(),ae.seq(Ft(),ae.offset(ae.u32(),-8),"addresses")])},DeactivateLookupTable:{index:3,layout:ae.struct([ae.u32("instruction")])},CloseLookupTable:{index:4,layout:ae.struct([ae.u32("instruction")])}});new lt("AddressLookupTab1e1111111111111111111111111");Object.freeze({RequestUnits:{index:0,layout:ae.struct([ae.u8("instruction"),ae.u32("units"),ae.u32("additionalFee")])},RequestHeapFrame:{index:1,layout:ae.struct([ae.u8("instruction"),ae.u32("bytes")])},SetComputeUnitLimit:{index:2,layout:ae.struct([ae.u8("instruction"),ae.u32("units")])},SetComputeUnitPrice:{index:3,layout:ae.struct([ae.u8("instruction"),xh("microLamports")])}});new lt("ComputeBudget111111111111111111111111111111");ae.struct([ae.u8("numSignatures"),ae.u8("padding"),ae.u16("signatureOffset"),ae.u16("signatureInstructionIndex"),ae.u16("publicKeyOffset"),ae.u16("publicKeyInstructionIndex"),ae.u16("messageDataOffset"),ae.u16("messageDataSize"),ae.u16("messageInstructionIndex")]);new lt("Ed25519SigVerify111111111111111111111111111");ZP.utils.isValidPrivateKey;ZP.getPublicKey;ae.struct([ae.u8("numSignatures"),ae.u16("signatureOffset"),ae.u8("signatureInstructionIndex"),ae.u16("ethAddressOffset"),ae.u8("ethAddressInstructionIndex"),ae.u16("messageDataOffset"),ae.u16("messageDataSize"),ae.u8("messageInstructionIndex"),ae.blob(20,"ethAddress"),ae.blob(64,"signature"),ae.u8("recoveryId")]);new lt("KeccakSecp256k11111111111111111111111111111");var Q9;new lt("StakeConfig11111111111111111111111111111111");class J9{constructor(e,t,r){this.unixTimestamp=void 0,this.epoch=void 0,this.custodian=void 0,this.unixTimestamp=e,this.epoch=t,this.custodian=r}}Q9=J9;J9.default=new Q9(0,0,lt.default);Object.freeze({Initialize:{index:0,layout:ae.struct([ae.u32("instruction"),w0e(),v0e()])},Authorize:{index:1,layout:ae.struct([ae.u32("instruction"),Ft("newAuthorized"),ae.u32("stakeAuthorizationType")])},Delegate:{index:2,layout:ae.struct([ae.u32("instruction")])},Split:{index:3,layout:ae.struct([ae.u32("instruction"),ae.ns64("lamports")])},Withdraw:{index:4,layout:ae.struct([ae.u32("instruction"),ae.ns64("lamports")])},Deactivate:{index:5,layout:ae.struct([ae.u32("instruction")])},Merge:{index:7,layout:ae.struct([ae.u32("instruction")])},AuthorizeWithSeed:{index:8,layout:ae.struct([ae.u32("instruction"),Ft("newAuthorized"),ae.u32("stakeAuthorizationType"),Yd("authoritySeed"),Ft("authorityOwner")])}});new lt("Stake11111111111111111111111111111111111111");Object.freeze({InitializeAccount:{index:0,layout:ae.struct([ae.u32("instruction"),S0e()])},Authorize:{index:1,layout:ae.struct([ae.u32("instruction"),Ft("newAuthorized"),ae.u32("voteAuthorizationType")])},Withdraw:{index:3,layout:ae.struct([ae.u32("instruction"),ae.ns64("lamports")])},UpdateValidatorIdentity:{index:4,layout:ae.struct([ae.u32("instruction")])},AuthorizeWithSeed:{index:10,layout:ae.struct([ae.u32("instruction"),x0e()])}});new lt("Vote111111111111111111111111111111111111111");new lt("Va1idator1nfo111111111111111111111111111111");Te({name:Oe(),website:gt(Oe()),details:gt(Oe()),iconUrl:gt(Oe()),keybaseUsername:gt(Oe())});new lt("Vote111111111111111111111111111111111111111");ae.struct([Ft("nodePubkey"),Ft("authorizedWithdrawer"),ae.u8("commission"),ae.nu64(),ae.seq(ae.struct([ae.nu64("slot"),ae.u32("confirmationCount")]),ae.offset(ae.u32(),-8),"votes"),ae.u8("rootSlotValid"),ae.nu64("rootSlot"),ae.nu64(),ae.seq(ae.struct([ae.nu64("epoch"),Ft("authorizedVoter")]),ae.offset(ae.u32(),-8),"authorizedVoters"),ae.struct([ae.seq(ae.struct([Ft("authorizedPubkey"),ae.nu64("epochOfLastAuthorizedSwitch"),ae.nu64("targetEpoch")]),32,"buf"),ae.nu64("idx"),ae.u8("isEmpty")],"priorVoters"),ae.nu64(),ae.seq(ae.struct([ae.nu64("epoch"),ae.nu64("credits"),ae.nu64("prevCredits")]),ae.offset(ae.u32(),-8),"epochCredits"),ae.struct([ae.nu64("slot"),ae.nu64("timestamp")],"lastTimestamp")]);const eH=P.createContext({});function ove(){return P.useContext(eH)}const ave=({children:n,endpoint:e,config:t={commitment:"confirmed"}})=>{const r=P.useMemo(()=>new sve(e,t),[e,t]);return Ce.createElement(eH.Provider,{value:{connection:r}},n)};class Br extends Error{constructor(e,t){super(e),this.error=t}}class pl extends Br{constructor(){super(...arguments),this.name="WalletNotReadyError"}}class cve extends Br{constructor(){super(...arguments),this.name="WalletLoadError"}}class Xd extends Br{constructor(){super(...arguments),this.name="WalletConfigError"}}class cl extends Br{constructor(){super(...arguments),this.name="WalletConnectionError"}}class uv extends Br{constructor(){super(...arguments),this.name="WalletDisconnectedError"}}class iM extends Br{constructor(){super(...arguments),this.name="WalletDisconnectionError"}}class hu extends Br{constructor(){super(...arguments),this.name="WalletAccountError"}}class bh extends Br{constructor(){super(...arguments),this.name="WalletPublicKeyError"}}class wr extends Br{constructor(){super(...arguments),this.name="WalletNotConnectedError"}}class nc extends Br{constructor(){super(...arguments),this.name="WalletSendTransactionError"}}class Po extends Br{constructor(){super(...arguments),this.name="WalletSignTransactionError"}}class dv extends Br{constructor(){super(...arguments),this.name="WalletSignMessageError"}}class DO extends Br{constructor(){super(...arguments),this.name="WalletSignInError"}}var It;(function(n){n.Installed="Installed",n.NotDetected="NotDetected",n.Loadable="Loadable",n.Unsupported="Unsupported"})(It||(It={}));class tH extends l5{get connected(){return!!this.publicKey}async autoConnect(){await this.connect()}async prepareTransaction(e,t,r={}){const i=this.publicKey;if(!i)throw new wr;return e.feePayer=e.feePayer||i,e.recentBlockhash=e.recentBlockhash||(await t.getLatestBlockhash({commitment:r.preflightCommitment,minContextSlot:r.minContextSlot})).blockhash,e}}function nH(n){if(typeof window>"u"||typeof document>"u")return;const e=[];function t(){if(n())for(const s of e)s()}const r=setInterval(t,1e3);e.push(()=>clearInterval(r)),document.readyState==="loading"&&(document.addEventListener("DOMContentLoaded",t,{once:!0}),e.push(()=>document.removeEventListener("DOMContentLoaded",t))),document.readyState!=="complete"&&(window.addEventListener("load",t,{once:!0}),e.push(()=>window.removeEventListener("load",t))),t()}function qE(){if(!navigator)return!1;const n=navigator.userAgent.toLowerCase(),e=n.includes("iphone")||n.includes("ipad"),t=n.includes("safari");return e&&t}function rc(n){return"version"in n}class lve extends tH{async sendTransaction(e,t,r={}){let i=!0;try{if(rc(e)){if(!this.supportedTransactionVersions)throw new nc("Sending versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(e.version))throw new nc(`Sending transaction version ${e.version} isn't supported by this wallet`);try{e=await this.signTransaction(e);const s=e.serialize();return await t.sendRawTransaction(s,r)}catch(s){throw s instanceof Po?(i=!1,s):new nc(s==null?void 0:s.message,s)}}else try{const{signers:s,...o}=r;e=await this.prepareTransaction(e,t,o),s!=null&&s.length&&e.partialSign(...s),e=await this.signTransaction(e);const a=e.serialize();return await t.sendRawTransaction(a,o)}catch(s){throw s instanceof Po?(i=!1,s):new nc(s==null?void 0:s.message,s)}}catch(s){throw i&&this.emit("error",s),s}}async signAllTransactions(e){for(const r of e)if(rc(r)){if(!this.supportedTransactionVersions)throw new Po("Signing versioned transactions isn't supported by this wallet");if(!this.supportedTransactionVersions.has(r.version))throw new Po(`Signing transaction version ${r.version} isn't supported by this wallet`)}const t=[];for(const r of e)t.push(await this.signTransaction(r));return t}}class sM extends lve{}class uve extends sM{}const Ja="solana:signAndSendTransaction",w_="solana:signIn",zd="solana:signMessage",Dr="solana:signTransaction",oM="standard:connect",GE="standard:disconnect",aM="standard:events";function dve(n){return oM in n.features&&aM in n.features&&(Ja in n.features||Dr in n.features)}class OO extends Br{constructor(){super(...arguments),this.name="WalletNotSelectedError"}}const hve=[],hv={autoConnect:!1,connecting:!1,connected:!1,disconnecting:!1,select(){vo("call","select")},connect(){return Promise.reject(vo("call","connect"))},disconnect(){return Promise.reject(vo("call","disconnect"))},sendTransaction(){return Promise.reject(vo("call","sendTransaction"))},signTransaction(){return Promise.reject(vo("call","signTransaction"))},signAllTransactions(){return Promise.reject(vo("call","signAllTransactions"))},signMessage(){return Promise.reject(vo("call","signMessage"))},signIn(){return Promise.reject(vo("call","signIn"))}};Object.defineProperty(hv,"wallets",{get(){return vo("read","wallets"),hve}});Object.defineProperty(hv,"wallet",{get(){return vo("read","wallet"),null}});Object.defineProperty(hv,"publicKey",{get(){return vo("read","publicKey"),null}});function vo(n,e){const t=new Error(`You have tried to ${n} "${e}" on a WalletContext without providing one. Make sure to render a WalletProvider as an ancestor of the component that uses WalletContext.`);return console.error(t),t}const rH=P.createContext(hv);function fve(){return P.useContext(rH)}function pve(n,e){const t=P.useState(()=>{try{const s=localStorage.getItem(n);if(s)return JSON.parse(s)}catch(s){typeof window<"u"&&console.error(s)}return e}),r=t[0],i=P.useRef(!0);return P.useEffect(()=>{if(i.current){i.current=!1;return}try{r===null?localStorage.removeItem(n):localStorage.setItem(n,JSON.stringify(r))}catch(s){typeof window<"u"&&console.error(s)}},[r,n]),t}function v_(n){switch(n){case"processed":case"confirmed":case"finalized":case void 0:return n;case"recent":return"processed";case"single":case"singleGossip":return"confirmed";case"max":case"root":return"finalized";default:return}}const VE="solana:mainnet",iH="solana:devnet",sH="solana:testnet",gve="solana:localnet",mve="https://api.mainnet-beta.solana.com";function yve(n){return n.includes(mve)?VE:/\bdevnet\b/i.test(n)?iH:/\btestnet\b/i.test(n)?sH:/\blocalhost\b/i.test(n)||/\b127\.0\.0\.1\b/.test(n)?gve:VE}function wve(n){let e=`${n.domain} wants you to sign in with your Solana account:
`;e+=`${n.address}`,n.statement&&(e+=`

${n.statement}`);const t=[];if(n.uri&&t.push(`URI: ${n.uri}`),n.version&&t.push(`Version: ${n.version}`),n.chainId&&t.push(`Chain ID: ${n.chainId}`),n.nonce&&t.push(`Nonce: ${n.nonce}`),n.issuedAt&&t.push(`Issued At: ${n.issuedAt}`),n.expirationTime&&t.push(`Expiration Time: ${n.expirationTime}`),n.notBefore&&t.push(`Not Before: ${n.notBefore}`),n.requestId&&t.push(`Request ID: ${n.requestId}`),n.resources){t.push("Resources:");for(const r of n.resources)t.push(`- ${r}`)}return t.length&&(e+=`

${t.join(`
`)}`),e}const pc={ERROR_ASSOCIATION_PORT_OUT_OF_RANGE:"ERROR_ASSOCIATION_PORT_OUT_OF_RANGE",ERROR_REFLECTOR_ID_OUT_OF_RANGE:"ERROR_REFLECTOR_ID_OUT_OF_RANGE",ERROR_FORBIDDEN_WALLET_BASE_URL:"ERROR_FORBIDDEN_WALLET_BASE_URL",ERROR_SECURE_CONTEXT_REQUIRED:"ERROR_SECURE_CONTEXT_REQUIRED",ERROR_SESSION_CLOSED:"ERROR_SESSION_CLOSED",ERROR_SESSION_TIMEOUT:"ERROR_SESSION_TIMEOUT",ERROR_WALLET_NOT_FOUND:"ERROR_WALLET_NOT_FOUND",ERROR_INVALID_PROTOCOL_VERSION:"ERROR_INVALID_PROTOCOL_VERSION"};class gc extends Error{constructor(...e){const[t,r,i]=e;super(r),this.code=t,this.data=i,this.name="SolanaMobileWalletAdapterError"}}class oH extends Error{constructor(...e){const[t,r,i,s]=e;super(i),this.code=r,this.data=s,this.jsonRpcMessageId=t,this.name="SolanaMobileWalletAdapterProtocolError"}}function Ir(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function c(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(n,[])).next())})}function S_(n,e){return Ir(this,void 0,void 0,function*(){const t=yield crypto.subtle.exportKey("raw",n),r=yield crypto.subtle.sign({hash:"SHA-256",name:"ECDSA"},e,t),i=new Uint8Array(t.byteLength+r.byteLength);return i.set(new Uint8Array(t),0),i.set(new Uint8Array(r),t.byteLength),i})}function vve(n){return window.btoa(n)}function Sve(n){return wve(n)}function xve(n){return vve(Sve(n))}const bve="solana:signTransactions",LO="solana:cloneAuthorization";function _ve(n,e){return new Proxy({},{get(t,r){return t[r]==null&&(t[r]=function(i){return Ir(this,void 0,void 0,function*(){const{method:s,params:o}=Ive(r,i,n),a=yield e(s,o);return s==="authorize"&&o.sign_in_payload&&!a.sign_in_result&&(a.sign_in_result=yield Cve(o.sign_in_payload,a,e)),Eve(r,a,n)})}),t[r]},defineProperty(){return!1},deleteProperty(){return!1}})}function Ive(n,e,t){let r=e,i=n.toString().replace(/[A-Z]/g,s=>`_${s.toLowerCase()}`).toLowerCase();switch(n){case"authorize":{let{chain:s}=r;if(t==="legacy"){switch(s){case"solana:testnet":{s="testnet";break}case"solana:devnet":{s="devnet";break}case"solana:mainnet":{s="mainnet-beta";break}default:s=r.cluster}r.cluster=s}else{switch(s){case"testnet":case"devnet":{s=`solana:${s}`;break}case"mainnet-beta":{s="solana:mainnet";break}}r.chain=s}}case"reauthorize":{const{auth_token:s,identity:o}=r;if(s)switch(t){case"legacy":{i="reauthorize",r={auth_token:s,identity:o};break}default:{i="authorize";break}}break}}return{method:i,params:r}}function Eve(n,e,t){switch(n){case"getCapabilities":{const r=e;switch(t){case"legacy":{const i=[bve];return r.supports_clone_authorization===!0&&i.push(LO),Object.assign(Object.assign({},r),{features:i})}case"v1":return Object.assign(Object.assign({},r),{supports_sign_and_send_transactions:!0,supports_clone_authorization:r.features.includes(LO)})}}}return e}function Cve(n,e,t){var r;return Ir(this,void 0,void 0,function*(){const i=(r=n.domain)!==null&&r!==void 0?r:window.location.host,s=e.accounts[0].address,o=xve(Object.assign(Object.assign({},n),{domain:i,address:s})),a=yield t("sign_messages",{addresses:[s],payloads:[o]});return{address:s,signed_message:o,signature:a.signed_payloads[0].slice(o.length)}})}const fu=4;function Pve(n){if(n>=4294967296)throw new Error("Outbound sequence number overflow. The maximum sequence number is 32-bytes.");const e=new ArrayBuffer(fu);return new DataView(e).setUint32(0,n,!1),new Uint8Array(e)}const YE=12,aH=65;function Mve(n,e,t){return Ir(this,void 0,void 0,function*(){const r=Pve(e),i=new Uint8Array(YE);crypto.getRandomValues(i);const s=yield crypto.subtle.encrypt(lH(r,i),t,new TextEncoder().encode(n)),o=new Uint8Array(r.byteLength+i.byteLength+s.byteLength);return o.set(new Uint8Array(r),0),o.set(new Uint8Array(i),r.byteLength),o.set(new Uint8Array(s),r.byteLength+i.byteLength),o})}function cH(n,e){return Ir(this,void 0,void 0,function*(){const t=n.slice(0,fu),r=n.slice(fu,fu+YE),i=n.slice(fu+YE),s=yield crypto.subtle.decrypt(lH(t,r),e,i);return Tve().decode(s)})}function lH(n,e){return{additionalData:n,iv:e,name:"AES-GCM",tagLength:128}}let x_;function Tve(){return x_===void 0&&(x_=new TextDecoder("utf-8")),x_}function kve(){return Ir(this,void 0,void 0,function*(){return yield crypto.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!1,["sign"])})}function b_(){return Ir(this,void 0,void 0,function*(){return yield crypto.subtle.generateKey({name:"ECDH",namedCurve:"P-256"},!1,["deriveKey","deriveBits"])})}function Ave(n,e){return Ir(this,void 0,void 0,function*(){const t=JSON.stringify(n),r=n.id;return Mve(t,r,e)})}function Rve(n,e){return Ir(this,void 0,void 0,function*(){const t=yield cH(n,e),r=JSON.parse(t);if(Object.hasOwnProperty.call(r,"error"))throw new oH(r.id,r.error.code,r.error.message);return r})}function jve(n,e,t){return Ir(this,void 0,void 0,function*(){const[r,i]=yield Promise.all([crypto.subtle.exportKey("raw",e),crypto.subtle.importKey("raw",n.slice(0,aH),{name:"ECDH",namedCurve:"P-256"},!1,[])]),s=yield crypto.subtle.deriveBits({name:"ECDH",public:i},t,256),o=yield crypto.subtle.importKey("raw",s,"HKDF",!1,["deriveKey"]);return yield crypto.subtle.deriveKey({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(r),info:new Uint8Array},o,{name:"AES-GCM",length:128},!1,["encrypt","decrypt"])})}function Dve(n,e){return Ir(this,void 0,void 0,function*(){const t=yield cH(n,e),r=JSON.parse(t);let i="legacy";if(Object.hasOwnProperty.call(r,"v"))switch(r.v){case 1:case"1":case"v1":i="v1";break;case"legacy":i="legacy";break;default:throw new gc(pc.ERROR_INVALID_PROTOCOL_VERSION,`Unknown/unsupported protocol version: ${r.v}`)}return{protocol_version:i}})}function Ove(){return uH(49152+Math.floor(Math.random()*16384))}function uH(n){if(n<49152||n>65535)throw new gc(pc.ERROR_ASSOCIATION_PORT_OUT_OF_RANGE,`Association port number must be between 49152 and 65535. ${n} given.`,{port:n});return n}function Lve(n){let e="";const t=new Uint8Array(n),r=t.byteLength;for(let i=0;i<r;i++)e+=String.fromCharCode(t[i]);return window.btoa(e)}function Nve(n){return n.replace(/[/+=]/g,e=>({"/":"_","+":"-","=":"."})[e])}const Bve="solana-wallet";function NO(n){return n.replace(/(^\/+|\/+$)/g,"").split("/")}function Fve(n,e){let t=null;if(e){try{t=new URL(e)}catch{}if((t==null?void 0:t.protocol)!=="https:")throw new gc(pc.ERROR_FORBIDDEN_WALLET_BASE_URL,"Base URLs supplied by wallets must be valid `https` URLs")}t||(t=new URL(`${Bve}:/`));const r=n.startsWith("/")?n:[...NO(t.pathname),...NO(n)].join("/");return new URL(r,t)}function zve(n,e,t,r=["v1"]){return Ir(this,void 0,void 0,function*(){const i=uH(e),s=yield crypto.subtle.exportKey("raw",n),o=Lve(s),a=Fve("v1/associate/local",t);return a.searchParams.set("association",Nve(o)),a.searchParams.set("port",`${i}`),r.forEach(c=>{a.searchParams.set("v",c)}),a})}const z0={Firefox:0,Other:1};function Uve(){return navigator.userAgent.indexOf("Firefox/")!==-1?z0.Firefox:z0.Other}function $ve(){return new Promise((n,e)=>{function t(){clearTimeout(i),window.removeEventListener("blur",r)}function r(){t(),n()}window.addEventListener("blur",r);const i=setTimeout(()=>{t(),e()},2e3)})}let Nf=null;function Hve(n){Nf==null&&(Nf=document.createElement("iframe"),Nf.style.display="none",document.body.appendChild(Nf)),Nf.contentWindow.location.href=n.toString()}function Wve(n){return Ir(this,void 0,void 0,function*(){if(n.protocol==="https:")window.location.assign(n);else try{const e=Uve();switch(e){case z0.Firefox:Hve(n);break;case z0.Other:{const t=$ve();window.location.assign(n),yield t;break}default:}}catch{throw new gc(pc.ERROR_WALLET_NOT_FOUND,"Found no installed wallet that supports the mobile wallet protocol.")}})}function Kve(n,e){return Ir(this,void 0,void 0,function*(){const t=Ove(),r=yield zve(n,t,e);return yield Wve(r),t})}const BO={retryDelayScheduleMs:[150,150,200,500,500,750,750,1e3],timeoutMs:3e4},qve="com.solana.mobilewalletadapter.v1";function Gve(){if(typeof window>"u"||window.isSecureContext!==!0)throw new gc(pc.ERROR_SECURE_CONTEXT_REQUIRED,"The mobile wallet adapter protocol must be used in a secure context (`https`).")}function Vve(n){let e;try{e=new URL(n)}catch{throw new gc(pc.ERROR_FORBIDDEN_WALLET_BASE_URL,"Invalid base URL supplied by wallet")}if(e.protocol!=="https:")throw new gc(pc.ERROR_FORBIDDEN_WALLET_BASE_URL,"Base URLs supplied by wallets must be valid `https` URLs")}function FO(n){return new DataView(n).getUint32(0,!1)}function Yve(n,e){return Ir(this,void 0,void 0,function*(){Gve();const t=yield kve(),i=`ws://localhost:${yield Kve(t.publicKey,e==null?void 0:e.baseUri)}/solana-wallet`;let s;const o=(()=>{const d=[...BO.retryDelayScheduleMs];return()=>d.length>1?d.shift():d[0]})();let a=1,c=0,u={__type:"disconnected"};return new Promise((d,f)=>{let g;const m={},v=()=>Ir(this,void 0,void 0,function*(){if(u.__type!=="connecting"){console.warn(`Expected adapter state to be \`connecting\` at the moment the websocket opens. Got \`${u.__type}\`.`);return}g.removeEventListener("open",v);const{associationKeypair:j}=u,D=yield b_();g.send(yield S_(D.publicKey,j.privateKey)),u={__type:"hello_req_sent",associationPublicKey:j.publicKey,ecdhPrivateKey:D.privateKey}}),w=j=>{j.wasClean?u={__type:"disconnected"}:f(new gc(pc.ERROR_SESSION_CLOSED,`The wallet session dropped unexpectedly (${j.code}: ${j.reason}).`,{closeEvent:j})),x()},S=j=>Ir(this,void 0,void 0,function*(){x(),Date.now()-s>=BO.timeoutMs?f(new gc(pc.ERROR_SESSION_TIMEOUT,`Failed to connect to the wallet websocket at ${i}.`)):(yield new Promise(D=>{const H=o();E=window.setTimeout(D,H)}),M())}),b=j=>Ir(this,void 0,void 0,function*(){const D=yield j.data.arrayBuffer();switch(u.__type){case"connecting":if(D.byteLength!==0)throw new Error("Encountered unexpected message while connecting");const H=yield b_();g.send(yield S_(H.publicKey,t.privateKey)),u={__type:"hello_req_sent",associationPublicKey:t.publicKey,ecdhPrivateKey:H.privateKey};break;case"connected":try{const L=D.slice(0,fu),U=FO(L);if(U!==c+1)throw new Error("Encrypted message has invalid sequence number");c=U;const z=yield Rve(D,u.sharedSecret),Y=m[z.id];delete m[z.id],Y.resolve(z.result)}catch(L){if(L instanceof oH){const U=m[L.jsonRpcMessageId];delete m[L.jsonRpcMessageId],U.reject(L)}else throw L}break;case"hello_req_sent":{if(D.byteLength===0){const V=yield b_();g.send(yield S_(V.publicKey,t.privateKey)),u={__type:"hello_req_sent",associationPublicKey:t.publicKey,ecdhPrivateKey:V.privateKey};break}const L=yield jve(D,u.associationPublicKey,u.ecdhPrivateKey),U=D.slice(aH),z=U.byteLength!==0?yield Ir(this,void 0,void 0,function*(){const V=U.slice(0,fu),N=FO(V);if(N!==c+1)throw new Error("Encrypted message has invalid sequence number");return c=N,Dve(U,L)}):{protocol_version:"legacy"};u={__type:"connected",sharedSecret:L,sessionProperties:z};const Y=_ve(z.protocol_version,(V,N)=>Ir(this,void 0,void 0,function*(){const _=a++;return g.send(yield Ave({id:_,jsonrpc:"2.0",method:V,params:N??{}},L)),new Promise((k,O)=>{m[_]={resolve(W){switch(V){case"authorize":case"reauthorize":{const{wallet_uri_base:q}=W;if(q!=null)try{Vve(q)}catch(X){O(X);return}break}}k(W)},reject:O}})}));try{d(yield n(Y))}catch(V){f(V)}finally{x(),g.close()}break}}});let x,E;const M=()=>{x&&x(),u={__type:"connecting",associationKeypair:t},s===void 0&&(s=Date.now()),g=new WebSocket(i,[qve]),g.addEventListener("open",v),g.addEventListener("close",w),g.addEventListener("error",S),g.addEventListener("message",b),x=()=>{window.clearTimeout(E),g.removeEventListener("open",v),g.removeEventListener("close",w),g.removeEventListener("error",S),g.removeEventListener("message",b)}};M()})})}var __,zO;function Xve(){if(zO)return __;zO=1;function n(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var i=0;i<e.length;i++){var s=e.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=e.length,c=e.charAt(0),u=Math.log(a)/Math.log(256),d=Math.log(256)/Math.log(a);function f(v){if(v instanceof Uint8Array||(ArrayBuffer.isView(v)?v=new Uint8Array(v.buffer,v.byteOffset,v.byteLength):Array.isArray(v)&&(v=Uint8Array.from(v))),!(v instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(v.length===0)return"";for(var w=0,S=0,b=0,x=v.length;b!==x&&v[b]===0;)b++,w++;for(var E=(x-b)*d+1>>>0,M=new Uint8Array(E);b!==x;){for(var j=v[b],D=0,H=E-1;(j!==0||D<S)&&H!==-1;H--,D++)j+=256*M[H]>>>0,M[H]=j%a>>>0,j=j/a>>>0;if(j!==0)throw new Error("Non-zero carry");S=D,b++}for(var L=E-S;L!==E&&M[L]===0;)L++;for(var U=c.repeat(w);L<E;++L)U+=e.charAt(M[L]);return U}function g(v){if(typeof v!="string")throw new TypeError("Expected String");if(v.length===0)return new Uint8Array;for(var w=0,S=0,b=0;v[w]===c;)S++,w++;for(var x=(v.length-w)*u+1>>>0,E=new Uint8Array(x);v[w];){var M=t[v.charCodeAt(w)];if(M===255)return;for(var j=0,D=x-1;(M!==0||j<b)&&D!==-1;D--,j++)M+=a*E[D]>>>0,E[D]=M%256>>>0,M=M/256>>>0;if(M!==0)throw new Error("Non-zero carry");b=j,w++}for(var H=x-b;H!==x&&E[H]===0;)H++;for(var L=new Uint8Array(S+(x-H)),U=S;H!==x;)L[U++]=E[H++];return L}function m(v){var w=g(v);if(w)return w;throw new Error("Non-base"+a+" character")}return{encode:f,decodeUnsafe:g,decode:m}}return __=n,__}var I_,UO;function Zve(){return UO||(UO=1,I_=Xve()("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")),I_}var Qve=Zve();const Jve=fs(Qve);function E_(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}function iy(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function c(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(n,[])).next())})}function dH(n){return window.btoa(String.fromCharCode.call(null,...n))}function C_(n){return new Uint8Array(window.atob(n).split("").map(e=>e.charCodeAt(0)))}function $O(n){const e="version"in n?n.serialize():n.serialize({requireAllSignatures:!1,verifySignatures:!1});return dH(e)}function eSe(n){const t=n[0]*jp+1;return JP.deserializeMessageVersion(n.slice(t,n.length))==="legacy"?_o.from(n):Op.deserialize(n)}function tSe(n,e){return iy(this,void 0,void 0,function*(){return yield Yve(r=>{const i=new Proxy({},{get(s,o){if(s[o]==null)switch(o){case"signAndSendTransactions":s[o]=function(a){var{minContextSlot:c,commitment:u,skipPreflight:d,maxRetries:f,waitForCommitmentToSendNextTransaction:g,transactions:m}=a,v=E_(a,["minContextSlot","commitment","skipPreflight","maxRetries","waitForCommitmentToSendNextTransaction","transactions"]);return iy(this,void 0,void 0,function*(){const w=m.map($O),S={min_context_slot:c,commitment:u,skip_preflight:d,max_retries:f,wait_for_commitment_to_send_next_transaction:g},{signatures:b}=yield r.signAndSendTransactions(Object.assign(Object.assign(Object.assign({},v),Object.values(S).some(E=>E!=null)?{options:S}:null),{payloads:w}));return b.map(C_).map(Jve.encode)})};break;case"signMessages":s[o]=function(a){var{payloads:c}=a,u=E_(a,["payloads"]);return iy(this,void 0,void 0,function*(){const d=c.map(dH),{signed_payloads:f}=yield r.signMessages(Object.assign(Object.assign({},u),{payloads:d}));return f.map(C_)})};break;case"signTransactions":s[o]=function(a){var{transactions:c}=a,u=E_(a,["transactions"]);return iy(this,void 0,void 0,function*(){const d=c.map($O),{signed_payloads:f}=yield r.signTransactions(Object.assign(Object.assign({},u),{payloads:d}));return f.map(C_).map(eSe)})};break;default:{s[o]=r[o];break}}return s[o]},defineProperty(){return!1},deleteProperty(){return!1}});return n(i)},e)})}var Od={},P_,HO;function nSe(){return HO||(HO=1,P_=function(){return typeof Promise=="function"&&Promise.prototype&&Promise.prototype.then}),P_}var M_={},Xc={},WO;function Yu(){if(WO)return Xc;WO=1;let n;const e=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];return Xc.getSymbolSize=function(r){if(!r)throw new Error('"version" cannot be null or undefined');if(r<1||r>40)throw new Error('"version" should be in range from 1 to 40');return r*4+17},Xc.getSymbolTotalCodewords=function(r){return e[r]},Xc.getBCHDigit=function(t){let r=0;for(;t!==0;)r++,t>>>=1;return r},Xc.setToSJISFunction=function(r){if(typeof r!="function")throw new Error('"toSJISFunc" is not a valid function.');n=r},Xc.isKanjiModeEnabled=function(){return typeof n<"u"},Xc.toSJIS=function(r){return n(r)},Xc}var T_={},KO;function cM(){return KO||(KO=1,function(n){n.L={bit:1},n.M={bit:0},n.Q={bit:3},n.H={bit:2};function e(t){if(typeof t!="string")throw new Error("Param is not a string");switch(t.toLowerCase()){case"l":case"low":return n.L;case"m":case"medium":return n.M;case"q":case"quartile":return n.Q;case"h":case"high":return n.H;default:throw new Error("Unknown EC Level: "+t)}}n.isValid=function(r){return r&&typeof r.bit<"u"&&r.bit>=0&&r.bit<4},n.from=function(r,i){if(n.isValid(r))return r;try{return e(r)}catch{return i}}}(T_)),T_}var k_,qO;function rSe(){if(qO)return k_;qO=1;function n(){this.buffer=[],this.length=0}return n.prototype={get:function(e){const t=Math.floor(e/8);return(this.buffer[t]>>>7-e%8&1)===1},put:function(e,t){for(let r=0;r<t;r++)this.putBit((e>>>t-r-1&1)===1)},getLengthInBits:function(){return this.length},putBit:function(e){const t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}},k_=n,k_}var A_,GO;function iSe(){if(GO)return A_;GO=1;function n(e){if(!e||e<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=e,this.data=new Uint8Array(e*e),this.reservedBit=new Uint8Array(e*e)}return n.prototype.set=function(e,t,r,i){const s=e*this.size+t;this.data[s]=r,i&&(this.reservedBit[s]=!0)},n.prototype.get=function(e,t){return this.data[e*this.size+t]},n.prototype.xor=function(e,t,r){this.data[e*this.size+t]^=r},n.prototype.isReserved=function(e,t){return this.reservedBit[e*this.size+t]},A_=n,A_}var R_={},VO;function sSe(){return VO||(VO=1,function(n){const e=Yu().getSymbolSize;n.getRowColCoords=function(r){if(r===1)return[];const i=Math.floor(r/7)+2,s=e(r),o=s===145?26:Math.ceil((s-13)/(2*i-2))*2,a=[s-7];for(let c=1;c<i-1;c++)a[c]=a[c-1]-o;return a.push(6),a.reverse()},n.getPositions=function(r){const i=[],s=n.getRowColCoords(r),o=s.length;for(let a=0;a<o;a++)for(let c=0;c<o;c++)a===0&&c===0||a===0&&c===o-1||a===o-1&&c===0||i.push([s[a],s[c]]);return i}}(R_)),R_}var j_={},YO;function oSe(){if(YO)return j_;YO=1;const n=Yu().getSymbolSize,e=7;return j_.getPositions=function(r){const i=n(r);return[[0,0],[i-e,0],[0,i-e]]},j_}var D_={},XO;function aSe(){return XO||(XO=1,function(n){n.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const e={N1:3,N2:3,N3:40,N4:10};n.isValid=function(i){return i!=null&&i!==""&&!isNaN(i)&&i>=0&&i<=7},n.from=function(i){return n.isValid(i)?parseInt(i,10):void 0},n.getPenaltyN1=function(i){const s=i.size;let o=0,a=0,c=0,u=null,d=null;for(let f=0;f<s;f++){a=c=0,u=d=null;for(let g=0;g<s;g++){let m=i.get(f,g);m===u?a++:(a>=5&&(o+=e.N1+(a-5)),u=m,a=1),m=i.get(g,f),m===d?c++:(c>=5&&(o+=e.N1+(c-5)),d=m,c=1)}a>=5&&(o+=e.N1+(a-5)),c>=5&&(o+=e.N1+(c-5))}return o},n.getPenaltyN2=function(i){const s=i.size;let o=0;for(let a=0;a<s-1;a++)for(let c=0;c<s-1;c++){const u=i.get(a,c)+i.get(a,c+1)+i.get(a+1,c)+i.get(a+1,c+1);(u===4||u===0)&&o++}return o*e.N2},n.getPenaltyN3=function(i){const s=i.size;let o=0,a=0,c=0;for(let u=0;u<s;u++){a=c=0;for(let d=0;d<s;d++)a=a<<1&2047|i.get(u,d),d>=10&&(a===1488||a===93)&&o++,c=c<<1&2047|i.get(d,u),d>=10&&(c===1488||c===93)&&o++}return o*e.N3},n.getPenaltyN4=function(i){let s=0;const o=i.data.length;for(let c=0;c<o;c++)s+=i.data[c];return Math.abs(Math.ceil(s*100/o/5)-10)*e.N4};function t(r,i,s){switch(r){case n.Patterns.PATTERN000:return(i+s)%2===0;case n.Patterns.PATTERN001:return i%2===0;case n.Patterns.PATTERN010:return s%3===0;case n.Patterns.PATTERN011:return(i+s)%3===0;case n.Patterns.PATTERN100:return(Math.floor(i/2)+Math.floor(s/3))%2===0;case n.Patterns.PATTERN101:return i*s%2+i*s%3===0;case n.Patterns.PATTERN110:return(i*s%2+i*s%3)%2===0;case n.Patterns.PATTERN111:return(i*s%3+(i+s)%2)%2===0;default:throw new Error("bad maskPattern:"+r)}}n.applyMask=function(i,s){const o=s.size;for(let a=0;a<o;a++)for(let c=0;c<o;c++)s.isReserved(c,a)||s.xor(c,a,t(i,c,a))},n.getBestMask=function(i,s){const o=Object.keys(n.Patterns).length;let a=0,c=1/0;for(let u=0;u<o;u++){s(u),n.applyMask(u,i);const d=n.getPenaltyN1(i)+n.getPenaltyN2(i)+n.getPenaltyN3(i)+n.getPenaltyN4(i);n.applyMask(u,i),d<c&&(c=d,a=u)}return a}}(D_)),D_}var sy={},ZO;function hH(){if(ZO)return sy;ZO=1;const n=cM(),e=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],t=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];return sy.getBlocksCount=function(i,s){switch(s){case n.L:return e[(i-1)*4+0];case n.M:return e[(i-1)*4+1];case n.Q:return e[(i-1)*4+2];case n.H:return e[(i-1)*4+3];default:return}},sy.getTotalCodewordsCount=function(i,s){switch(s){case n.L:return t[(i-1)*4+0];case n.M:return t[(i-1)*4+1];case n.Q:return t[(i-1)*4+2];case n.H:return t[(i-1)*4+3];default:return}},sy}var O_={},Bf={},QO;function cSe(){if(QO)return Bf;QO=1;const n=new Uint8Array(512),e=new Uint8Array(256);return function(){let r=1;for(let i=0;i<255;i++)n[i]=r,e[r]=i,r<<=1,r&256&&(r^=285);for(let i=255;i<512;i++)n[i]=n[i-255]}(),Bf.log=function(r){if(r<1)throw new Error("log("+r+")");return e[r]},Bf.exp=function(r){return n[r]},Bf.mul=function(r,i){return r===0||i===0?0:n[e[r]+e[i]]},Bf}var JO;function lSe(){return JO||(JO=1,function(n){const e=cSe();n.mul=function(r,i){const s=new Uint8Array(r.length+i.length-1);for(let o=0;o<r.length;o++)for(let a=0;a<i.length;a++)s[o+a]^=e.mul(r[o],i[a]);return s},n.mod=function(r,i){let s=new Uint8Array(r);for(;s.length-i.length>=0;){const o=s[0];for(let c=0;c<i.length;c++)s[c]^=e.mul(i[c],o);let a=0;for(;a<s.length&&s[a]===0;)a++;s=s.slice(a)}return s},n.generateECPolynomial=function(r){let i=new Uint8Array([1]);for(let s=0;s<r;s++)i=n.mul(i,new Uint8Array([1,e.exp(s)]));return i}}(O_)),O_}var L_,e4;function uSe(){if(e4)return L_;e4=1;const n=lSe();function e(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}return e.prototype.initialize=function(r){this.degree=r,this.genPoly=n.generateECPolynomial(this.degree)},e.prototype.encode=function(r){if(!this.genPoly)throw new Error("Encoder not initialized");const i=new Uint8Array(r.length+this.degree);i.set(r);const s=n.mod(i,this.genPoly),o=this.degree-s.length;if(o>0){const a=new Uint8Array(this.degree);return a.set(s,o),a}return s},L_=e,L_}var N_={},B_={},F_={},t4;function fH(){return t4||(t4=1,F_.isValid=function(e){return!isNaN(e)&&e>=1&&e<=40}),F_}var ra={},n4;function pH(){if(n4)return ra;n4=1;const n="[0-9]+",e="[A-Z $%*+\\-./:]+";let t="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";t=t.replace(/u/g,"\\u");const r="(?:(?![A-Z0-9 $%*+\\-./:]|"+t+`)(?:.|[\r
]))+`;ra.KANJI=new RegExp(t,"g"),ra.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),ra.BYTE=new RegExp(r,"g"),ra.NUMERIC=new RegExp(n,"g"),ra.ALPHANUMERIC=new RegExp(e,"g");const i=new RegExp("^"+t+"$"),s=new RegExp("^"+n+"$"),o=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");return ra.testKanji=function(c){return i.test(c)},ra.testNumeric=function(c){return s.test(c)},ra.testAlphanumeric=function(c){return o.test(c)},ra}var r4;function Xu(){return r4||(r4=1,function(n){const e=fH(),t=pH();n.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},n.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},n.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},n.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},n.MIXED={bit:-1},n.getCharCountIndicator=function(s,o){if(!s.ccBits)throw new Error("Invalid mode: "+s);if(!e.isValid(o))throw new Error("Invalid version: "+o);return o>=1&&o<10?s.ccBits[0]:o<27?s.ccBits[1]:s.ccBits[2]},n.getBestModeForData=function(s){return t.testNumeric(s)?n.NUMERIC:t.testAlphanumeric(s)?n.ALPHANUMERIC:t.testKanji(s)?n.KANJI:n.BYTE},n.toString=function(s){if(s&&s.id)return s.id;throw new Error("Invalid mode")},n.isValid=function(s){return s&&s.bit&&s.ccBits};function r(i){if(typeof i!="string")throw new Error("Param is not a string");switch(i.toLowerCase()){case"numeric":return n.NUMERIC;case"alphanumeric":return n.ALPHANUMERIC;case"kanji":return n.KANJI;case"byte":return n.BYTE;default:throw new Error("Unknown mode: "+i)}}n.from=function(s,o){if(n.isValid(s))return s;try{return r(s)}catch{return o}}}(B_)),B_}var i4;function dSe(){return i4||(i4=1,function(n){const e=Yu(),t=hH(),r=cM(),i=Xu(),s=fH(),o=7973,a=e.getBCHDigit(o);function c(g,m,v){for(let w=1;w<=40;w++)if(m<=n.getCapacity(w,v,g))return w}function u(g,m){return i.getCharCountIndicator(g,m)+4}function d(g,m){let v=0;return g.forEach(function(w){const S=u(w.mode,m);v+=S+w.getBitsLength()}),v}function f(g,m){for(let v=1;v<=40;v++)if(d(g,v)<=n.getCapacity(v,m,i.MIXED))return v}n.from=function(m,v){return s.isValid(m)?parseInt(m,10):v},n.getCapacity=function(m,v,w){if(!s.isValid(m))throw new Error("Invalid QR Code version");typeof w>"u"&&(w=i.BYTE);const S=e.getSymbolTotalCodewords(m),b=t.getTotalCodewordsCount(m,v),x=(S-b)*8;if(w===i.MIXED)return x;const E=x-u(w,m);switch(w){case i.NUMERIC:return Math.floor(E/10*3);case i.ALPHANUMERIC:return Math.floor(E/11*2);case i.KANJI:return Math.floor(E/13);case i.BYTE:default:return Math.floor(E/8)}},n.getBestVersionForData=function(m,v){let w;const S=r.from(v,r.M);if(Array.isArray(m)){if(m.length>1)return f(m,S);if(m.length===0)return 1;w=m[0]}else w=m;return c(w.mode,w.getLength(),S)},n.getEncodedBits=function(m){if(!s.isValid(m)||m<7)throw new Error("Invalid QR Code version");let v=m<<12;for(;e.getBCHDigit(v)-a>=0;)v^=o<<e.getBCHDigit(v)-a;return m<<12|v}}(N_)),N_}var z_={},s4;function hSe(){if(s4)return z_;s4=1;const n=Yu(),e=1335,t=21522,r=n.getBCHDigit(e);return z_.getEncodedBits=function(s,o){const a=s.bit<<3|o;let c=a<<10;for(;n.getBCHDigit(c)-r>=0;)c^=e<<n.getBCHDigit(c)-r;return(a<<10|c)^t},z_}var U_={},$_,o4;function fSe(){if(o4)return $_;o4=1;const n=Xu();function e(t){this.mode=n.NUMERIC,this.data=t.toString()}return e.getBitsLength=function(r){return 10*Math.floor(r/3)+(r%3?r%3*3+1:0)},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(r){let i,s,o;for(i=0;i+3<=this.data.length;i+=3)s=this.data.substr(i,3),o=parseInt(s,10),r.put(o,10);const a=this.data.length-i;a>0&&(s=this.data.substr(i),o=parseInt(s,10),r.put(o,a*3+1))},$_=e,$_}var H_,a4;function pSe(){if(a4)return H_;a4=1;const n=Xu(),e=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function t(r){this.mode=n.ALPHANUMERIC,this.data=r}return t.getBitsLength=function(i){return 11*Math.floor(i/2)+6*(i%2)},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(i){let s;for(s=0;s+2<=this.data.length;s+=2){let o=e.indexOf(this.data[s])*45;o+=e.indexOf(this.data[s+1]),i.put(o,11)}this.data.length%2&&i.put(e.indexOf(this.data[s]),6)},H_=t,H_}var W_,c4;function gSe(){if(c4)return W_;c4=1;const n=Xu();function e(t){this.mode=n.BYTE,typeof t=="string"?this.data=new TextEncoder().encode(t):this.data=new Uint8Array(t)}return e.getBitsLength=function(r){return r*8},e.prototype.getLength=function(){return this.data.length},e.prototype.getBitsLength=function(){return e.getBitsLength(this.data.length)},e.prototype.write=function(t){for(let r=0,i=this.data.length;r<i;r++)t.put(this.data[r],8)},W_=e,W_}var K_,l4;function mSe(){if(l4)return K_;l4=1;const n=Xu(),e=Yu();function t(r){this.mode=n.KANJI,this.data=r}return t.getBitsLength=function(i){return i*13},t.prototype.getLength=function(){return this.data.length},t.prototype.getBitsLength=function(){return t.getBitsLength(this.data.length)},t.prototype.write=function(r){let i;for(i=0;i<this.data.length;i++){let s=e.toSJIS(this.data[i]);if(s>=33088&&s<=40956)s-=33088;else if(s>=57408&&s<=60351)s-=49472;else throw new Error("Invalid SJIS character: "+this.data[i]+`
Make sure your charset is UTF-8`);s=(s>>>8&255)*192+(s&255),r.put(s,13)}},K_=t,K_}var q_={exports:{}},u4;function ySe(){return u4||(u4=1,function(n){var e={single_source_shortest_paths:function(t,r,i){var s={},o={};o[r]=0;var a=e.PriorityQueue.make();a.push(r,0);for(var c,u,d,f,g,m,v,w,S;!a.empty();){c=a.pop(),u=c.value,f=c.cost,g=t[u]||{};for(d in g)g.hasOwnProperty(d)&&(m=g[d],v=f+m,w=o[d],S=typeof o[d]>"u",(S||w>v)&&(o[d]=v,a.push(d,v),s[d]=u))}if(typeof i<"u"&&typeof o[i]>"u"){var b=["Could not find a path from ",r," to ",i,"."].join("");throw new Error(b)}return s},extract_shortest_path_from_predecessor_list:function(t,r){for(var i=[],s=r;s;)i.push(s),t[s],s=t[s];return i.reverse(),i},find_path:function(t,r,i){var s=e.single_source_shortest_paths(t,r,i);return e.extract_shortest_path_from_predecessor_list(s,i)},PriorityQueue:{make:function(t){var r=e.PriorityQueue,i={},s;t=t||{};for(s in r)r.hasOwnProperty(s)&&(i[s]=r[s]);return i.queue=[],i.sorter=t.sorter||r.default_sorter,i},default_sorter:function(t,r){return t.cost-r.cost},push:function(t,r){var i={value:t,cost:r};this.queue.push(i),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return this.queue.length===0}}};n.exports=e}(q_)),q_.exports}var d4;function wSe(){return d4||(d4=1,function(n){const e=Xu(),t=fSe(),r=pSe(),i=gSe(),s=mSe(),o=pH(),a=Yu(),c=ySe();function u(b){return unescape(encodeURIComponent(b)).length}function d(b,x,E){const M=[];let j;for(;(j=b.exec(E))!==null;)M.push({data:j[0],index:j.index,mode:x,length:j[0].length});return M}function f(b){const x=d(o.NUMERIC,e.NUMERIC,b),E=d(o.ALPHANUMERIC,e.ALPHANUMERIC,b);let M,j;return a.isKanjiModeEnabled()?(M=d(o.BYTE,e.BYTE,b),j=d(o.KANJI,e.KANJI,b)):(M=d(o.BYTE_KANJI,e.BYTE,b),j=[]),x.concat(E,M,j).sort(function(H,L){return H.index-L.index}).map(function(H){return{data:H.data,mode:H.mode,length:H.length}})}function g(b,x){switch(x){case e.NUMERIC:return t.getBitsLength(b);case e.ALPHANUMERIC:return r.getBitsLength(b);case e.KANJI:return s.getBitsLength(b);case e.BYTE:return i.getBitsLength(b)}}function m(b){return b.reduce(function(x,E){const M=x.length-1>=0?x[x.length-1]:null;return M&&M.mode===E.mode?(x[x.length-1].data+=E.data,x):(x.push(E),x)},[])}function v(b){const x=[];for(let E=0;E<b.length;E++){const M=b[E];switch(M.mode){case e.NUMERIC:x.push([M,{data:M.data,mode:e.ALPHANUMERIC,length:M.length},{data:M.data,mode:e.BYTE,length:M.length}]);break;case e.ALPHANUMERIC:x.push([M,{data:M.data,mode:e.BYTE,length:M.length}]);break;case e.KANJI:x.push([M,{data:M.data,mode:e.BYTE,length:u(M.data)}]);break;case e.BYTE:x.push([{data:M.data,mode:e.BYTE,length:u(M.data)}])}}return x}function w(b,x){const E={},M={start:{}};let j=["start"];for(let D=0;D<b.length;D++){const H=b[D],L=[];for(let U=0;U<H.length;U++){const z=H[U],Y=""+D+U;L.push(Y),E[Y]={node:z,lastCount:0},M[Y]={};for(let V=0;V<j.length;V++){const N=j[V];E[N]&&E[N].node.mode===z.mode?(M[N][Y]=g(E[N].lastCount+z.length,z.mode)-g(E[N].lastCount,z.mode),E[N].lastCount+=z.length):(E[N]&&(E[N].lastCount=z.length),M[N][Y]=g(z.length,z.mode)+4+e.getCharCountIndicator(z.mode,x))}}j=L}for(let D=0;D<j.length;D++)M[j[D]].end=0;return{map:M,table:E}}function S(b,x){let E;const M=e.getBestModeForData(b);if(E=e.from(x,M),E!==e.BYTE&&E.bit<M.bit)throw new Error('"'+b+'" cannot be encoded with mode '+e.toString(E)+`.
 Suggested mode is: `+e.toString(M));switch(E===e.KANJI&&!a.isKanjiModeEnabled()&&(E=e.BYTE),E){case e.NUMERIC:return new t(b);case e.ALPHANUMERIC:return new r(b);case e.KANJI:return new s(b);case e.BYTE:return new i(b)}}n.fromArray=function(x){return x.reduce(function(E,M){return typeof M=="string"?E.push(S(M,null)):M.data&&E.push(S(M.data,M.mode)),E},[])},n.fromString=function(x,E){const M=f(x,a.isKanjiModeEnabled()),j=v(M),D=w(j,E),H=c.find_path(D.map,"start","end"),L=[];for(let U=1;U<H.length-1;U++)L.push(D.table[H[U]].node);return n.fromArray(m(L))},n.rawSplit=function(x){return n.fromArray(f(x,a.isKanjiModeEnabled()))}}(U_)),U_}var h4;function vSe(){if(h4)return M_;h4=1;const n=Yu(),e=cM(),t=rSe(),r=iSe(),i=sSe(),s=oSe(),o=aSe(),a=hH(),c=uSe(),u=dSe(),d=hSe(),f=Xu(),g=wSe();function m(D,H){const L=D.size,U=s.getPositions(H);for(let z=0;z<U.length;z++){const Y=U[z][0],V=U[z][1];for(let N=-1;N<=7;N++)if(!(Y+N<=-1||L<=Y+N))for(let _=-1;_<=7;_++)V+_<=-1||L<=V+_||(N>=0&&N<=6&&(_===0||_===6)||_>=0&&_<=6&&(N===0||N===6)||N>=2&&N<=4&&_>=2&&_<=4?D.set(Y+N,V+_,!0,!0):D.set(Y+N,V+_,!1,!0))}}function v(D){const H=D.size;for(let L=8;L<H-8;L++){const U=L%2===0;D.set(L,6,U,!0),D.set(6,L,U,!0)}}function w(D,H){const L=i.getPositions(H);for(let U=0;U<L.length;U++){const z=L[U][0],Y=L[U][1];for(let V=-2;V<=2;V++)for(let N=-2;N<=2;N++)V===-2||V===2||N===-2||N===2||V===0&&N===0?D.set(z+V,Y+N,!0,!0):D.set(z+V,Y+N,!1,!0)}}function S(D,H){const L=D.size,U=u.getEncodedBits(H);let z,Y,V;for(let N=0;N<18;N++)z=Math.floor(N/3),Y=N%3+L-8-3,V=(U>>N&1)===1,D.set(z,Y,V,!0),D.set(Y,z,V,!0)}function b(D,H,L){const U=D.size,z=d.getEncodedBits(H,L);let Y,V;for(Y=0;Y<15;Y++)V=(z>>Y&1)===1,Y<6?D.set(Y,8,V,!0):Y<8?D.set(Y+1,8,V,!0):D.set(U-15+Y,8,V,!0),Y<8?D.set(8,U-Y-1,V,!0):Y<9?D.set(8,15-Y-1+1,V,!0):D.set(8,15-Y-1,V,!0);D.set(U-8,8,1,!0)}function x(D,H){const L=D.size;let U=-1,z=L-1,Y=7,V=0;for(let N=L-1;N>0;N-=2)for(N===6&&N--;;){for(let _=0;_<2;_++)if(!D.isReserved(z,N-_)){let k=!1;V<H.length&&(k=(H[V]>>>Y&1)===1),D.set(z,N-_,k),Y--,Y===-1&&(V++,Y=7)}if(z+=U,z<0||L<=z){z-=U,U=-U;break}}}function E(D,H,L){const U=new t;L.forEach(function(_){U.put(_.mode.bit,4),U.put(_.getLength(),f.getCharCountIndicator(_.mode,D)),_.write(U)});const z=n.getSymbolTotalCodewords(D),Y=a.getTotalCodewordsCount(D,H),V=(z-Y)*8;for(U.getLengthInBits()+4<=V&&U.put(0,4);U.getLengthInBits()%8!==0;)U.putBit(0);const N=(V-U.getLengthInBits())/8;for(let _=0;_<N;_++)U.put(_%2?17:236,8);return M(U,D,H)}function M(D,H,L){const U=n.getSymbolTotalCodewords(H),z=a.getTotalCodewordsCount(H,L),Y=U-z,V=a.getBlocksCount(H,L),N=U%V,_=V-N,k=Math.floor(U/V),O=Math.floor(Y/V),W=O+1,q=k-O,X=new c(q);let ne=0;const $=new Array(V),C=new Array(V);let R=0;const Z=new Uint8Array(D.buffer);for(let _e=0;_e<V;_e++){const Le=_e<_?O:W;$[_e]=Z.slice(ne,ne+Le),C[_e]=X.encode($[_e]),ne+=Le,R=Math.max(R,Le)}const J=new Uint8Array(U);let oe=0,ue,fe;for(ue=0;ue<R;ue++)for(fe=0;fe<V;fe++)ue<$[fe].length&&(J[oe++]=$[fe][ue]);for(ue=0;ue<q;ue++)for(fe=0;fe<V;fe++)J[oe++]=C[fe][ue];return J}function j(D,H,L,U){let z;if(Array.isArray(D))z=g.fromArray(D);else if(typeof D=="string"){let k=H;if(!k){const O=g.rawSplit(D);k=u.getBestVersionForData(O,L)}z=g.fromString(D,k||40)}else throw new Error("Invalid data");const Y=u.getBestVersionForData(z,L);if(!Y)throw new Error("The amount of data is too big to be stored in a QR Code");if(!H)H=Y;else if(H<Y)throw new Error(`
The chosen QR Code version cannot contain this amount of data.
Minimum version required to store current data is: `+Y+`.
`);const V=E(H,L,z),N=n.getSymbolSize(H),_=new r(N);return m(_,H),v(_),w(_,H),b(_,L,0),H>=7&&S(_,H),x(_,V),isNaN(U)&&(U=o.getBestMask(_,b.bind(null,_,L))),o.applyMask(U,_),b(_,L,U),{modules:_,version:H,errorCorrectionLevel:L,maskPattern:U,segments:z}}return M_.create=function(H,L){if(typeof H>"u"||H==="")throw new Error("No input text");let U=e.M,z,Y;return typeof L<"u"&&(U=e.from(L.errorCorrectionLevel,e.M),z=u.from(L.version),Y=o.from(L.maskPattern),L.toSJISFunc&&n.setToSJISFunction(L.toSJISFunc)),j(H,z,U,Y)},M_}var G_={},V_={},f4;function gH(){return f4||(f4=1,function(n){function e(t){if(typeof t=="number"&&(t=t.toString()),typeof t!="string")throw new Error("Color should be defined as hex string");let r=t.slice().replace("#","").split("");if(r.length<3||r.length===5||r.length>8)throw new Error("Invalid hex color: "+t);(r.length===3||r.length===4)&&(r=Array.prototype.concat.apply([],r.map(function(s){return[s,s]}))),r.length===6&&r.push("F","F");const i=parseInt(r.join(""),16);return{r:i>>24&255,g:i>>16&255,b:i>>8&255,a:i&255,hex:"#"+r.slice(0,6).join("")}}n.getOptions=function(r){r||(r={}),r.color||(r.color={});const i=typeof r.margin>"u"||r.margin===null||r.margin<0?4:r.margin,s=r.width&&r.width>=21?r.width:void 0,o=r.scale||4;return{width:s,scale:s?4:o,margin:i,color:{dark:e(r.color.dark||"#000000ff"),light:e(r.color.light||"#ffffffff")},type:r.type,rendererOpts:r.rendererOpts||{}}},n.getScale=function(r,i){return i.width&&i.width>=r+i.margin*2?i.width/(r+i.margin*2):i.scale},n.getImageWidth=function(r,i){const s=n.getScale(r,i);return Math.floor((r+i.margin*2)*s)},n.qrToImageData=function(r,i,s){const o=i.modules.size,a=i.modules.data,c=n.getScale(o,s),u=Math.floor((o+s.margin*2)*c),d=s.margin*c,f=[s.color.light,s.color.dark];for(let g=0;g<u;g++)for(let m=0;m<u;m++){let v=(g*u+m)*4,w=s.color.light;if(g>=d&&m>=d&&g<u-d&&m<u-d){const S=Math.floor((g-d)/c),b=Math.floor((m-d)/c);w=f[a[S*o+b]?1:0]}r[v++]=w.r,r[v++]=w.g,r[v++]=w.b,r[v]=w.a}}}(V_)),V_}var p4;function SSe(){return p4||(p4=1,function(n){const e=gH();function t(i,s,o){i.clearRect(0,0,s.width,s.height),s.style||(s.style={}),s.height=o,s.width=o,s.style.height=o+"px",s.style.width=o+"px"}function r(){try{return document.createElement("canvas")}catch{throw new Error("You need to specify a canvas element")}}n.render=function(s,o,a){let c=a,u=o;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),o||(u=r()),c=e.getOptions(c);const d=e.getImageWidth(s.modules.size,c),f=u.getContext("2d"),g=f.createImageData(d,d);return e.qrToImageData(g.data,s,c),t(f,u,d),f.putImageData(g,0,0),u},n.renderToDataURL=function(s,o,a){let c=a;typeof c>"u"&&(!o||!o.getContext)&&(c=o,o=void 0),c||(c={});const u=n.render(s,o,c),d=c.type||"image/png",f=c.rendererOpts||{};return u.toDataURL(d,f.quality)}}(G_)),G_}var Y_={},g4;function xSe(){if(g4)return Y_;g4=1;const n=gH();function e(i,s){const o=i.a/255,a=s+'="'+i.hex+'"';return o<1?a+" "+s+'-opacity="'+o.toFixed(2).slice(1)+'"':a}function t(i,s,o){let a=i+s;return typeof o<"u"&&(a+=" "+o),a}function r(i,s,o){let a="",c=0,u=!1,d=0;for(let f=0;f<i.length;f++){const g=Math.floor(f%s),m=Math.floor(f/s);!g&&!u&&(u=!0),i[f]?(d++,f>0&&g>0&&i[f-1]||(a+=u?t("M",g+o,.5+m+o):t("m",c,0),c=0,u=!1),g+1<s&&i[f+1]||(a+=t("h",d),d=0)):c++}return a}return Y_.render=function(s,o,a){const c=n.getOptions(o),u=s.modules.size,d=s.modules.data,f=u+c.margin*2,g=c.color.light.a?"<path "+e(c.color.light,"fill")+' d="M0 0h'+f+"v"+f+'H0z"/>':"",m="<path "+e(c.color.dark,"stroke")+' d="'+r(d,u,c.margin)+'"/>',v='viewBox="0 0 '+f+" "+f+'"',S='<svg xmlns="http://www.w3.org/2000/svg" '+(c.width?'width="'+c.width+'" height="'+c.width+'" ':"")+v+' shape-rendering="crispEdges">'+g+m+`</svg>
`;return typeof a=="function"&&a(null,S),S},Y_}var m4;function bSe(){if(m4)return Od;m4=1;const n=nSe(),e=vSe(),t=SSe(),r=xSe();function i(s,o,a,c,u){const d=[].slice.call(arguments,1),f=d.length,g=typeof d[f-1]=="function";if(!g&&!n())throw new Error("Callback required as last argument");if(g){if(f<2)throw new Error("Too few arguments provided");f===2?(u=a,a=o,o=c=void 0):f===3&&(o.getContext&&typeof u>"u"?(u=c,c=void 0):(u=c,c=a,a=o,o=void 0))}else{if(f<1)throw new Error("Too few arguments provided");return f===1?(a=o,o=c=void 0):f===2&&!o.getContext&&(c=a,a=o,o=void 0),new Promise(function(m,v){try{const w=e.create(a,c);m(s(w,o,c))}catch(w){v(w)}})}try{const m=e.create(a,c);u(null,s(m,o,c))}catch(m){u(m)}}return Od.create=e.create,Od.toCanvas=i.bind(null,t.render),Od.toDataURL=i.bind(null,t.renderToDataURL),Od.toString=i.bind(null,function(s,o,a){return r.render(s,a)}),Od}bSe();function on(n,e,t,r){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(d){try{u(r.next(d))}catch(f){o(f)}}function c(d){try{u(r.throw(d))}catch(f){o(f)}}function u(d){d.done?s(d.value):i(d.value).then(a,c)}u((r=r.apply(n,[])).next())})}function Hy(n){return new Uint8Array(window.atob(n).split("").map(e=>e.charCodeAt(0)))}function _Se(){return typeof window<"u"&&window.isSecureContext&&typeof document<"u"&&/android/i.test(navigator.userAgent)}const el="Mobile Wallet Adapter",ISe=64;function ESe(n){const e=Hy(n);return new lt(e)}function y4(n){return"version"in n}function CSe(n){switch(n){case"mainnet-beta":return"solana:mainnet";case"testnet":return"solana:testnet";case"devnet":return"solana:devnet"}}class PSe extends uve{constructor(e){var t;super(),this.supportedTransactionVersions=new Set(["legacy",0]),this.name=el,this.url="https://solanamobile.com/wallets",this.icon="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjI4IiB3aWR0aD0iMjgiIHZpZXdCb3g9Ii0zIDAgMjggMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI0RDQjhGRiI+PHBhdGggZD0iTTE3LjQgMTcuNEgxNXYyLjRoMi40di0yLjRabTEuMi05LjZoLTIuNHYyLjRoMi40VjcuOFoiLz48cGF0aCBkPSJNMjEuNiAzVjBoLTIuNHYzaC0zLjZWMGgtMi40djNoLTIuNHY2LjZINC41YTIuMSAyLjEgMCAxIDEgMC00LjJoMi43VjNINC41QTQuNSA0LjUgMCAwIDAgMCA3LjVWMjRoMjEuNnYtNi42aC0yLjR2NC4ySDIuNFYxMS41Yy41LjMgMS4yLjQgMS44LjVoNy41QTYuNiA2LjYgMCAwIDAgMjQgOVYzaC0yLjRabTAgNS43YTQuMiA0LjIgMCAxIDEtOC40IDBWNS40aDguNHYzLjNaIi8+PC9nPjwvc3ZnPg==",this._connecting=!1,this._connectionGeneration=0,this._readyState=_Se()?It.Loadable:It.Unsupported,this._authorizationResultCache=e.authorizationResultCache,this._addressSelector=e.addressSelector,this._appIdentity=e.appIdentity,this._chain=(t=e.chain)!==null&&t!==void 0?t:CSe(e.cluster),this._hostAuthority=e.remoteHostAuthority,this._onWalletNotFound=e.onWalletNotFound,this._readyState!==It.Unsupported&&this._authorizationResultCache.get().then(r=>{r&&this.declareWalletAsInstalled()})}get publicKey(){if(this._publicKey==null&&this._selectedAddress!=null)try{this._publicKey=ESe(this._selectedAddress)}catch(e){throw new bh(e instanceof Error&&(e==null?void 0:e.message)||"Unknown error",e)}return this._publicKey?this._publicKey:null}get connected(){return!!this._authorizationResult}get connecting(){return this._connecting}get readyState(){return this._readyState}declareWalletAsInstalled(){this._readyState!==It.Installed&&this.emit("readyStateChange",this._readyState=It.Installed)}runWithGuard(e){return on(this,void 0,void 0,function*(){try{return yield e()}catch(t){throw this.emit("error",t),t}})}autoConnect_DO_NOT_USE_OR_YOU_WILL_BE_FIRED(){return on(this,void 0,void 0,function*(){return yield this.autoConnect()})}autoConnect(){return on(this,void 0,void 0,function*(){if(!(this.connecting||this.connected))return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){if(this._readyState!==It.Installed&&this._readyState!==It.Loadable)throw new pl;this._connecting=!0;try{const e=yield this._authorizationResultCache.get();e&&this.handleAuthorizationResult(e)}catch(e){throw new cl(e instanceof Error&&e.message||"Unknown error",e)}finally{this._connecting=!1}}))})}connect(){return on(this,void 0,void 0,function*(){if(!(this.connecting||this.connected))return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){if(this._readyState!==It.Installed&&this._readyState!==It.Loadable)throw new pl;this._connecting=!0;try{yield this.performAuthorization()}catch(e){throw new cl(e instanceof Error&&e.message||"Unknown error",e)}finally{this._connecting=!1}}))})}performAuthorization(e){return on(this,void 0,void 0,function*(){try{const t=yield this._authorizationResultCache.get();return t?(this.handleAuthorizationResult(t),t):yield this.transact(r=>on(this,void 0,void 0,function*(){const i=yield r.authorize({chain:this._chain,identity:this._appIdentity,sign_in_payload:e});return Promise.all([this._authorizationResultCache.set(i),this.handleAuthorizationResult(i)]),i}))}catch(t){throw new cl(t instanceof Error&&t.message||"Unknown error",t)}})}handleAuthorizationResult(e){var t;return on(this,void 0,void 0,function*(){const r=this._authorizationResult==null||((t=this._authorizationResult)===null||t===void 0?void 0:t.accounts.length)!==e.accounts.length||this._authorizationResult.accounts.some((i,s)=>i.address!==e.accounts[s].address);if(this._authorizationResult=e,this.declareWalletAsInstalled(),r){const i=yield this._addressSelector.select(e.accounts.map(({address:s})=>s));i!==this._selectedAddress&&(this._selectedAddress=i,delete this._publicKey,this.emit("connect",this.publicKey))}})}performReauthorization(e,t){return on(this,void 0,void 0,function*(){try{const r=yield e.authorize({auth_token:t,identity:this._appIdentity});Promise.all([this._authorizationResultCache.set(r),this.handleAuthorizationResult(r)])}catch(r){throw this.disconnect(),new uv(r instanceof Error&&(r==null?void 0:r.message)||"Unknown error",r)}})}disconnect(){return on(this,void 0,void 0,function*(){this._authorizationResultCache.clear(),this._connecting=!1,this._connectionGeneration++,delete this._authorizationResult,delete this._publicKey,delete this._selectedAddress,this.emit("disconnect")})}transact(e){var t;return on(this,void 0,void 0,function*(){const r=(t=this._authorizationResult)===null||t===void 0?void 0:t.wallet_uri_base,i=r?{baseUri:r}:void 0,s=this._hostAuthority?{remoteHostAuthority:this._hostAuthority}:void 0,o=this._connectionGeneration;try{return yield tSe(e,Object.assign(Object.assign({},i),s))}catch(a){throw this._connectionGeneration!==o&&(yield new Promise(()=>{})),a instanceof Error&&a.name==="SolanaMobileWalletAdapterError"&&a.code==="ERROR_WALLET_NOT_FOUND"&&(yield this._onWalletNotFound(this)),a}})}assertIsAuthorized(){if(!this._authorizationResult||!this._selectedAddress)throw new wr;return{authToken:this._authorizationResult.auth_token,selectedAddress:this._selectedAddress}}performSignTransactions(e){return on(this,void 0,void 0,function*(){const{authToken:t}=this.assertIsAuthorized();try{return yield this.transact(r=>on(this,void 0,void 0,function*(){return yield this.performReauthorization(r,t),yield r.signTransactions({transactions:e})}))}catch(r){throw new Po(r==null?void 0:r.message,r)}})}sendTransaction(e,t,r){return on(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){const{authToken:i}=this.assertIsAuthorized(),s=r==null?void 0:r.minContextSlot;try{return yield this.transact(o=>on(this,void 0,void 0,function*(){function a(){let f;switch(t.commitment){case"confirmed":case"finalized":case"processed":f=t.commitment;break;default:f="finalized"}let g;switch(r==null?void 0:r.preflightCommitment){case"confirmed":case"finalized":case"processed":g=r.preflightCommitment;break;case void 0:g=f;break;default:g="finalized"}return(g==="finalized"?2:g==="confirmed"?1:0)<(f==="finalized"?2:f==="confirmed"?1:0)?g:f}const[c,u,d]=yield Promise.all([o.getCapabilities(),this.performReauthorization(o,i),y4(e)?null:on(this,void 0,void 0,function*(){var f;if(e.feePayer||(e.feePayer=(f=this.publicKey)!==null&&f!==void 0?f:void 0),e.recentBlockhash==null){const{blockhash:g}=yield t.getLatestBlockhash({commitment:a()});e.recentBlockhash=g}})]);if(c.supports_sign_and_send_transactions)return(yield o.signAndSendTransactions({minContextSlot:s,transactions:[e]}))[0];{const[f]=yield o.signTransactions({transactions:[e]});if(y4(f))return yield t.sendTransaction(f);{const g=f.serialize();return yield t.sendRawTransaction(g,Object.assign(Object.assign({},r),{preflightCommitment:a()}))}}}))}catch(o){throw new nc(o==null?void 0:o.message,o)}}))})}signTransaction(e){return on(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){const[t]=yield this.performSignTransactions([e]);return t}))})}signAllTransactions(e){return on(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){return yield this.performSignTransactions(e)}))})}signMessage(e){return on(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){const{authToken:t,selectedAddress:r}=this.assertIsAuthorized();try{return yield this.transact(i=>on(this,void 0,void 0,function*(){yield this.performReauthorization(i,t);const[s]=yield i.signMessages({addresses:[r],payloads:[e]});return s.slice(-ISe)}))}catch(i){throw new dv(i==null?void 0:i.message,i)}}))})}signIn(e){return on(this,void 0,void 0,function*(){return yield this.runWithGuard(()=>on(this,void 0,void 0,function*(){var t,r;if(this._readyState!==It.Installed&&this._readyState!==It.Loadable)throw new pl;this._connecting=!0;try{const i=yield this.performAuthorization(Object.assign(Object.assign({},e),{domain:(t=e==null?void 0:e.domain)!==null&&t!==void 0?t:window.location.host}));if(!i.sign_in_result)throw new Error("Sign in failed, no sign in result returned by wallet");const s=i.sign_in_result.address;return{account:Object.assign(Object.assign({},(r=i.accounts.find(a=>a.address==s))!==null&&r!==void 0?r:{address:s}),{publicKey:Hy(s)}),signedMessage:Hy(i.sign_in_result.signed_message),signature:Hy(i.sign_in_result.signature)}}catch(i){throw new cl(i instanceof Error&&i.message||"Unknown error",i)}finally{this._connecting=!1}}))})}}function MSe(){return{select(n){return on(this,void 0,void 0,function*(){return n[0]})}}}const X_="SolanaMobileWalletAdapterDefaultAuthorizationCache";function TSe(){let n;try{n=window.localStorage}catch{}return{clear(){return on(this,void 0,void 0,function*(){if(n)try{n.removeItem(X_)}catch{}})},get(){return on(this,void 0,void 0,function*(){if(n)try{return JSON.parse(n.getItem(X_))||void 0}catch{}})},set(e){return on(this,void 0,void 0,function*(){if(n)try{n.setItem(X_,JSON.stringify(e))}catch{}})}}}function kSe(n){return on(this,void 0,void 0,function*(){typeof window<"u"&&window.location.assign(n.url)})}function ASe(){return kSe}var RSe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},jSe=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Wy;function DSe(n){const e=({register:t})=>t(n);try{window.dispatchEvent(new OSe(e))}catch(t){console.error(`wallet-standard:register-wallet event could not be dispatched
`,t)}try{window.addEventListener("wallet-standard:app-ready",({detail:t})=>e(t))}catch(t){console.error(`wallet-standard:app-ready event listener could not be added
`,t)}}class OSe extends Event{get detail(){return RSe(this,Wy,"f")}get type(){return"wallet-standard:register-wallet"}constructor(e){super("wallet-standard:register-wallet",{bubbles:!1,cancelable:!1,composed:!1}),Wy.set(this,void 0),jSe(this,Wy,e,"f")}preventDefault(){throw new Error("preventDefault cannot be called")}stopImmediatePropagation(){throw new Error("stopImmediatePropagation cannot be called")}stopPropagation(){throw new Error("stopPropagation cannot be called")}}Wy=new WeakMap;function LSe(n,e){if(n===e)return!0;const t=n.length;if(t!==e.length)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}var Z_,w4;function NSe(){if(w4)return Z_;w4=1;var n=qP().Buffer;function e(t){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var s=0;s<t.length;s++){var o=t.charAt(s),a=o.charCodeAt(0);if(r[a]!==255)throw new TypeError(o+" is ambiguous");r[a]=s}var c=t.length,u=t.charAt(0),d=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(w){if((Array.isArray(w)||w instanceof Uint8Array)&&(w=n.from(w)),!n.isBuffer(w))throw new TypeError("Expected Buffer");if(w.length===0)return"";for(var S=0,b=0,x=0,E=w.length;x!==E&&w[x]===0;)x++,S++;for(var M=(E-x)*f+1>>>0,j=new Uint8Array(M);x!==E;){for(var D=w[x],H=0,L=M-1;(D!==0||H<b)&&L!==-1;L--,H++)D+=256*j[L]>>>0,j[L]=D%c>>>0,D=D/c>>>0;if(D!==0)throw new Error("Non-zero carry");b=H,x++}for(var U=M-b;U!==M&&j[U]===0;)U++;for(var z=u.repeat(S);U<M;++U)z+=t.charAt(j[U]);return z}function m(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return n.alloc(0);for(var S=0,b=0,x=0;w[S]===u;)b++,S++;for(var E=(w.length-S)*d+1>>>0,M=new Uint8Array(E);S<w.length;){var j=r[w.charCodeAt(S)];if(j===255)return;for(var D=0,H=E-1;(j!==0||D<x)&&H!==-1;H--,D++)j+=c*M[H]>>>0,M[H]=j%256>>>0,j=j/256>>>0;if(j!==0)throw new Error("Non-zero carry");x=D,S++}for(var L=E-x;L!==E&&M[L]===0;)L++;var U=n.allocUnsafe(b+(E-L));U.fill(0,0,b);for(var z=b;L!==E;)U[z++]=M[L++];return U}function v(w){var S=m(w);if(S)return S;throw new Error("Non-base"+c+" character")}return{encode:g,decodeUnsafe:m,decode:v}}return Z_=e,Z_}var Q_,v4;function BSe(){if(v4)return Q_;v4=1;var n=NSe(),e="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";return Q_=n(e),Q_}var FSe=BSe();const zSe=fs(FSe);var br=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},nt=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},Kr,ns,pu,gu,cu,Qf,U0,an,$0,XE,Ky,ZE,cp,QE,S4,x4,b4,_4;class USe extends tH{constructor({wallet:e}){super(),Kr.add(this),ns.set(this,void 0),pu.set(this,void 0),gu.set(this,void 0),cu.set(this,void 0),Qf.set(this,void 0),U0.set(this,void 0),an.set(this,void 0),$0.set(this,typeof window>"u"||typeof document>"u"?It.Unsupported:It.Installed),QE.set(this,t=>{if("accounts"in t){const r=nt(this,an,"f").accounts[0];nt(this,ns,"f")&&!nt(this,cu,"f")&&r!==nt(this,ns,"f")&&(r?nt(this,Kr,"m",Ky).call(this,r):(this.emit("error",new uv),nt(this,Kr,"m",ZE).call(this)))}"features"in t&&nt(this,Kr,"m",cp).call(this)}),br(this,an,e,"f"),br(this,ns,null,"f"),br(this,pu,null,"f"),br(this,gu,!1,"f"),br(this,cu,!1,"f"),br(this,Qf,nt(this,an,"f").features[aM].on("change",nt(this,QE,"f")),"f"),nt(this,Kr,"m",cp).call(this)}get name(){return nt(this,an,"f").name}get url(){return"https://github.com/solana-labs/wallet-standard"}get icon(){return nt(this,an,"f").icon}get readyState(){return nt(this,$0,"f")}get publicKey(){return nt(this,pu,"f")}get connecting(){return nt(this,gu,"f")}get supportedTransactionVersions(){return nt(this,U0,"f")}get wallet(){return nt(this,an,"f")}get standard(){return!0}destroy(){br(this,ns,null,"f"),br(this,pu,null,"f"),br(this,gu,!1,"f"),br(this,cu,!1,"f");const e=nt(this,Qf,"f");e&&(br(this,Qf,null,"f"),e())}async autoConnect(){return nt(this,Kr,"m",XE).call(this,{silent:!0})}async connect(){return nt(this,Kr,"m",XE).call(this)}async disconnect(){if(GE in nt(this,an,"f").features)try{br(this,cu,!0,"f"),await nt(this,an,"f").features[GE].disconnect()}catch(e){this.emit("error",new iM(e==null?void 0:e.message,e))}finally{br(this,cu,!1,"f")}nt(this,Kr,"m",ZE).call(this)}async sendTransaction(e,t,r={}){try{const i=nt(this,ns,"f");if(!i)throw new wr;let s;if(Ja in nt(this,an,"f").features)if(i.features.includes(Ja))s=Ja;else if(Dr in nt(this,an,"f").features&&i.features.includes(Dr))s=Dr;else throw new hu;else if(Dr in nt(this,an,"f").features){if(!i.features.includes(Dr))throw new hu;s=Dr}else throw new Xd;const o=yve(t.rpcEndpoint);if(!i.chains.includes(o))throw new nc;try{const{signers:a,...c}=r;let u;if(rc(e)?(a!=null&&a.length&&e.sign(a),u=e.serialize()):(e=await this.prepareTransaction(e,t,c),a!=null&&a.length&&e.partialSign(...a),u=new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))),s===Ja){const[d]=await nt(this,an,"f").features[Ja].signAndSendTransaction({account:i,chain:o,transaction:u,options:{preflightCommitment:v_(c.preflightCommitment||t.commitment),skipPreflight:c.skipPreflight,maxRetries:c.maxRetries,minContextSlot:c.minContextSlot}});return zSe.encode(d.signature)}else{const[d]=await nt(this,an,"f").features[Dr].signTransaction({account:i,chain:o,transaction:u,options:{preflightCommitment:v_(c.preflightCommitment||t.commitment),minContextSlot:c.minContextSlot}});return await t.sendRawTransaction(d.signedTransaction,{...c,preflightCommitment:v_(c.preflightCommitment||t.commitment)})}}catch(a){throw a instanceof Br?a:new nc(a==null?void 0:a.message,a)}}catch(i){throw this.emit("error",i),i}}}ns=new WeakMap,pu=new WeakMap,gu=new WeakMap,cu=new WeakMap,Qf=new WeakMap,U0=new WeakMap,an=new WeakMap,$0=new WeakMap,QE=new WeakMap,Kr=new WeakSet,XE=async function(e){try{if(this.connected||this.connecting)return;if(nt(this,$0,"f")!==It.Installed)throw new pl;if(br(this,gu,!0,"f"),!nt(this,an,"f").accounts.length)try{await nt(this,an,"f").features[oM].connect(e)}catch(r){throw new cl(r==null?void 0:r.message,r)}const t=nt(this,an,"f").accounts[0];if(!t)throw new hu;nt(this,Kr,"m",Ky).call(this,t)}catch(t){throw this.emit("error",t),t}finally{br(this,gu,!1,"f")}},Ky=function(e){let t;try{t=new lt(e.address)}catch(r){throw new bh(r==null?void 0:r.message,r)}br(this,ns,e,"f"),br(this,pu,t,"f"),nt(this,Kr,"m",cp).call(this),this.emit("connect",t)},ZE=function(){br(this,ns,null,"f"),br(this,pu,null,"f"),nt(this,Kr,"m",cp).call(this),this.emit("disconnect")},cp=function(){var t,r;const e=Ja in nt(this,an,"f").features?nt(this,an,"f").features[Ja].supportedTransactionVersions:nt(this,an,"f").features[Dr].supportedTransactionVersions;br(this,U0,LSe(e,["legacy"])?null:new Set(e),"f"),Dr in nt(this,an,"f").features&&((t=nt(this,ns,"f"))!=null&&t.features.includes(Dr))?(this.signTransaction=nt(this,Kr,"m",S4),this.signAllTransactions=nt(this,Kr,"m",x4)):(delete this.signTransaction,delete this.signAllTransactions),zd in nt(this,an,"f").features&&((r=nt(this,ns,"f"))!=null&&r.features.includes(zd))?this.signMessage=nt(this,Kr,"m",b4):delete this.signMessage,w_ in nt(this,an,"f").features?this.signIn=nt(this,Kr,"m",_4):delete this.signIn},S4=async function(e){try{const t=nt(this,ns,"f");if(!t)throw new wr;if(!(Dr in nt(this,an,"f").features))throw new Xd;if(!t.features.includes(Dr))throw new hu;try{const i=(await nt(this,an,"f").features[Dr].signTransaction({account:t,transaction:rc(e)?e.serialize():new Uint8Array(e.serialize({requireAllSignatures:!1,verifySignatures:!1}))}))[0].signedTransaction;return rc(e)?Op.deserialize(i):_o.from(i)}catch(r){throw r instanceof Br?r:new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}},x4=async function(e){try{const t=nt(this,ns,"f");if(!t)throw new wr;if(!(Dr in nt(this,an,"f").features))throw new Xd;if(!t.features.includes(Dr))throw new hu;try{const r=await nt(this,an,"f").features[Dr].signTransaction(...e.map(i=>({account:t,transaction:rc(i)?i.serialize():new Uint8Array(i.serialize({requireAllSignatures:!1,verifySignatures:!1}))})));return e.map((i,s)=>{const o=r[s].signedTransaction;return rc(i)?Op.deserialize(o):_o.from(o)})}catch(r){throw new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}},b4=async function(e){try{const t=nt(this,ns,"f");if(!t)throw new wr;if(!(zd in nt(this,an,"f").features))throw new Xd;if(!t.features.includes(zd))throw new hu;try{return(await nt(this,an,"f").features[zd].signMessage({account:t,message:e}))[0].signature}catch(r){throw new dv(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}},_4=async function(e={}){try{if(!(w_ in nt(this,an,"f").features))throw new Xd;let t;try{[t]=await nt(this,an,"f").features[w_].signIn(e)}catch(r){throw new DO(r==null?void 0:r.message,r)}if(!t)throw new DO;return nt(this,Kr,"m",Ky).call(this,t.account),t}catch(t){throw this.emit("error",t),t}};const $Se=dve;var HSe=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},WSe=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},qy;let bs;const fv=new Set;function KSe(n){lp=void 0,fv.add(n)}function qSe(n){lp=void 0,fv.delete(n)}const Zd={};function GSe(){if(bs||(bs=Object.freeze({register:I4,get:VSe,on:YSe}),typeof window>"u"))return bs;const n=Object.freeze({register:I4});try{window.addEventListener("wallet-standard:register-wallet",({detail:e})=>e(n))}catch(e){console.error(`wallet-standard:register-wallet event listener could not be added
`,e)}try{window.dispatchEvent(new XSe(n))}catch(e){console.error(`wallet-standard:app-ready event could not be dispatched
`,e)}return bs}function I4(...n){var e;return n=n.filter(t=>!fv.has(t)),n.length?(n.forEach(t=>KSe(t)),(e=Zd.register)==null||e.forEach(t=>JE(()=>t(...n))),function(){var r;n.forEach(i=>qSe(i)),(r=Zd.unregister)==null||r.forEach(i=>JE(()=>i(...n)))}):()=>{}}let lp;function VSe(){return lp||(lp=[...fv]),lp}function YSe(n,e){var t;return(t=Zd[n])!=null&&t.push(e)||(Zd[n]=[e]),function(){var i;Zd[n]=(i=Zd[n])==null?void 0:i.filter(s=>e!==s)}}function JE(n){try{n()}catch(e){console.error(e)}}class XSe extends Event{get detail(){return HSe(this,qy,"f")}get type(){return"wallet-standard:app-ready"}constructor(e){super("wallet-standard:app-ready",{bubbles:!1,cancelable:!1,composed:!1}),qy.set(this,void 0),WSe(this,qy,e,"f")}preventDefault(){throw new Error("preventDefault cannot be called")}stopImmediatePropagation(){throw new Error("stopImmediatePropagation cannot be called")}stopPropagation(){throw new Error("stopPropagation cannot be called")}}qy=new WeakMap;function ZSe(){if(bs||(bs=GSe(),typeof window>"u"))return bs;const n=window.navigator.wallets||[];if(!Array.isArray(n))return console.error("window.navigator.wallets is not an array"),bs;const{register:e}=bs,t=(...r)=>r.forEach(i=>JE(()=>i({register:e})));try{Object.defineProperty(window.navigator,"wallets",{value:Object.freeze({push:t})})}catch{return console.error("window.navigator.wallets could not be set"),bs}return t(...n),bs}function QSe(n){const e=E4(()=>new Set),{get:t,on:r}=E4(()=>ZSe()),[i,s]=P.useState(()=>C4(t()));P.useEffect(()=>{const a=[r("register",(...c)=>s(u=>[...u,...C4(c)])),r("unregister",(...c)=>s(u=>u.filter(d=>c.some(f=>f===d.wallet))))];return()=>a.forEach(c=>c())},[r]);const o=JSe(i);return P.useEffect(()=>{if(!o)return;const a=new Set(i);new Set(o.filter(u=>!a.has(u))).forEach(u=>u.destroy())},[o,i]),P.useEffect(()=>()=>i.forEach(a=>a.destroy()),[]),P.useMemo(()=>[...i,...n.filter(({name:a})=>i.some(c=>c.name===a)?(e.has(a)||(e.add(a),console.warn(`${a} was registered as a Standard Wallet. The Wallet Adapter for ${a} can be removed from your app.`)),!1):!0)],[i,n,e])}function E4(n){const e=P.useRef();return e.current||(e.current={value:n()}),e.current.value}function JSe(n){const e=P.useRef();return P.useEffect(()=>{e.current=n}),e.current}function C4(n){return n.filter($Se).map(e=>new USe({wallet:e}))}var ah;(function(n){n[n.DESKTOP_WEB=0]="DESKTOP_WEB",n[n.MOBILE_WEB=1]="MOBILE_WEB"})(ah||(ah={}));function e1e(n){return/(WebView|Version\/.+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+)|; wv\).+(Chrome)\/(\d+)\.(\d+)\.(\d+)\.(\d+))/i.test(n)}function t1e({adapters:n,userAgentString:e}){return n.some(t=>t.name!==el&&t.readyState===It.Installed)?ah.DESKTOP_WEB:e&&/android/i.test(e)&&!e1e(e)?ah.MOBILE_WEB:ah.DESKTOP_WEB}function n1e(n){return n?/devnet/i.test(n)?"devnet":/testnet/i.test(n)?"testnet":"mainnet-beta":"mainnet-beta"}function r1e({children:n,wallets:e,adapter:t,isUnloadingRef:r,onAutoConnectRequest:i,onConnectError:s,onError:o,onSelectWallet:a}){const c=P.useRef(!1),[u,d]=P.useState(!1),f=P.useRef(!1),[g,m]=P.useState(!1),[v,w]=P.useState(()=>(t==null?void 0:t.publicKey)??null),[S,b]=P.useState(()=>(t==null?void 0:t.connected)??!1),x=P.useRef(o);P.useEffect(()=>(x.current=o,()=>{x.current=void 0}),[o]);const E=P.useRef((k,O)=>(r.current||(x.current?x.current(k,O):(console.error(k,O),k instanceof pl&&typeof window<"u"&&O&&window.open(O.url,"_blank"))),k)),[M,j]=P.useState(()=>e.map(k=>({adapter:k,readyState:k.readyState})).filter(({readyState:k})=>k!==It.Unsupported));P.useEffect(()=>{j(O=>e.map((W,q)=>{const X=O[q];return X&&X.adapter===W&&X.readyState===W.readyState?X:{adapter:W,readyState:W.readyState}}).filter(({readyState:W})=>W!==It.Unsupported));function k(O){j(W=>{const q=W.findIndex(({adapter:ne})=>ne===this);if(q===-1)return W;const{adapter:X}=W[q];return[...W.slice(0,q),{adapter:X,readyState:O},...W.slice(q+1)].filter(({readyState:ne})=>ne!==It.Unsupported)})}return e.forEach(O=>O.on("readyStateChange",k,O)),()=>{e.forEach(O=>O.off("readyStateChange",k,O))}},[t,e]);const D=P.useMemo(()=>M.find(k=>k.adapter===t)??null,[t,M]);P.useEffect(()=>{if(!t)return;const k=q=>{w(q),c.current=!1,d(!1),b(!0),f.current=!1,m(!1)},O=()=>{r.current||(w(null),c.current=!1,d(!1),b(!1),f.current=!1,m(!1))},W=q=>{E.current(q,t)};return t.on("connect",k),t.on("disconnect",O),t.on("error",W),()=>{t.off("connect",k),t.off("disconnect",O),t.off("error",W),O()}},[t,r]);const H=P.useRef(!1);P.useEffect(()=>()=>{H.current=!1},[t]),P.useEffect(()=>{H.current||c.current||S||!i||!((D==null?void 0:D.readyState)===It.Installed||(D==null?void 0:D.readyState)===It.Loadable)||(c.current=!0,d(!0),H.current=!0,async function(){try{await i()}catch{s()}finally{d(!1),c.current=!1}}())},[S,i,s,D]);const L=P.useCallback(async(k,O,W)=>{if(!t)throw E.current(new OO);if(!S)throw E.current(new wr,t);return await t.sendTransaction(k,O,W)},[t,S]),U=P.useMemo(()=>t&&"signTransaction"in t?async k=>{if(!S)throw E.current(new wr,t);return await t.signTransaction(k)}:void 0,[t,S]),z=P.useMemo(()=>t&&"signAllTransactions"in t?async k=>{if(!S)throw E.current(new wr,t);return await t.signAllTransactions(k)}:void 0,[t,S]),Y=P.useMemo(()=>t&&"signMessage"in t?async k=>{if(!S)throw E.current(new wr,t);return await t.signMessage(k)}:void 0,[t,S]),V=P.useMemo(()=>t&&"signIn"in t?async k=>await t.signIn(k):void 0,[t]),N=P.useCallback(async()=>{if(c.current||f.current||D!=null&&D.adapter.connected)return;if(!D)throw E.current(new OO);const{adapter:k,readyState:O}=D;if(!(O===It.Installed||O===It.Loadable))throw E.current(new pl,k);c.current=!0,d(!0);try{await k.connect()}catch(W){throw s(),W}finally{d(!1),c.current=!1}},[s,D]),_=P.useCallback(async()=>{if(!f.current&&t){f.current=!0,m(!0);try{await t.disconnect()}finally{m(!1),f.current=!1}}},[t]);return Ce.createElement(rH.Provider,{value:{autoConnect:!!i,wallets:M,wallet:D,publicKey:v,connected:S,connecting:u,disconnecting:g,select:a,connect:N,disconnect:_,sendTransaction:L,signTransaction:U,signAllTransactions:z,signMessage:Y,signIn:V}},n)}let J_;function i1e(){var n;return J_===void 0&&(J_=((n=globalThis.navigator)==null?void 0:n.userAgent)??null),J_}function oy(n){const e=i1e();return t1e({adapters:n,userAgentString:e})===ah.MOBILE_WEB}function s1e(){const n=globalThis.location;if(n)return`${n.protocol}//${n.host}`}function o1e({children:n,wallets:e,autoConnect:t,localStorageKey:r="walletName",onError:i}){const{connection:s}=ove(),o=QSe(e),a=P.useMemo(()=>{if(!oy(o))return null;const x=o.find(E=>E.name===el);return x||new PSe({addressSelector:MSe(),appIdentity:{uri:s1e()},authorizationResultCache:TSe(),cluster:n1e(s==null?void 0:s.rpcEndpoint),onWalletNotFound:ASe()})},[o,s==null?void 0:s.rpcEndpoint]),c=P.useMemo(()=>a==null||o.indexOf(a)!==-1?o:[a,...o],[o,a]),[u,d]=pve(r,oy(o)?el:null),f=P.useMemo(()=>c.find(x=>x.name===u)??null,[c,u]),g=P.useCallback(x=>{u!==x&&(f&&f.name!==el&&f.disconnect(),d(x))},[f,d,u]);P.useEffect(()=>{if(!f)return;function x(){w.current||u===el&&oy(o)||d(null)}return f.on("disconnect",x),()=>{f.off("disconnect",x)}},[f,o,d,u]);const m=P.useRef(!1),v=P.useMemo(()=>{if(!(!t||!f))return async()=>{(t===!0||await t(f))&&(m.current?await f.connect():await f.autoConnect())}},[t,f]),w=P.useRef(!1);P.useEffect(()=>{if(u===el&&oy(o)){w.current=!1;return}function x(){w.current=!0}return window.addEventListener("beforeunload",x),()=>{window.removeEventListener("beforeunload",x)}},[o,u]);const S=P.useCallback(()=>{f&&f.name!==el&&g(null)},[f,g]),b=P.useCallback(x=>{m.current=!0,g(x)},[g]);return Ce.createElement(r1e,{wallets:c,adapter:f,isUnloadingRef:w,onAutoConnectRequest:v,onConnectError:S,onError:i,onSelectWallet:b},n)}const mH={setVisible(n){console.error(yH("call","setVisible"))},visible:!1};Object.defineProperty(mH,"visible",{get(){return console.error(yH("read","visible")),!1}});function yH(n,e){return`You have tried to  ${n} "${e}" on a WalletModalContext without providing one. Make sure to render a WalletModalProvider as an ancestor of the component that uses WalletModalContext`}const wH=P.createContext(mH);function a1e(){return P.useContext(wH)}const c1e=n=>Ce.createElement("button",{className:`wallet-adapter-button ${n.className||""}`,disabled:n.disabled,style:n.style,onClick:n.onClick,tabIndex:n.tabIndex||0,type:"button"},n.startIcon&&Ce.createElement("i",{className:"wallet-adapter-button-start-icon"},n.startIcon),n.children,n.endIcon&&Ce.createElement("i",{className:"wallet-adapter-button-end-icon"},n.endIcon)),l1e=({wallet:n,...e})=>n&&Ce.createElement("img",{src:n.adapter.icon,alt:`${n.adapter.name} icon`,...e}),P4=({id:n,children:e,expanded:t=!1})=>{const r=P.useRef(null),i=P.useRef(!0),s="height 250ms ease-out",o=()=>{const c=r.current;c&&requestAnimationFrame(()=>{c.style.height=c.scrollHeight+"px"})},a=()=>{const c=r.current;c&&requestAnimationFrame(()=>{c.style.height=c.offsetHeight+"px",c.style.overflow="hidden",requestAnimationFrame(()=>{c.style.height="0"})})};return P.useLayoutEffect(()=>{t?o():a()},[t]),P.useLayoutEffect(()=>{const c=r.current;if(!c)return;function u(){c&&(c.style.overflow=t?"initial":"hidden",t&&(c.style.height="auto"))}function d(f){c&&f.target===c&&f.propertyName==="height"&&u()}return i.current&&(u(),i.current=!1),c.addEventListener("transitionend",d),()=>c.removeEventListener("transitionend",d)},[t]),Ce.createElement("div",{className:"wallet-adapter-collapse",id:n,ref:r,role:"region",style:{height:0,transition:i.current?void 0:s}},e)},eI=({handleClick:n,tabIndex:e,wallet:t})=>Ce.createElement("li",null,Ce.createElement(c1e,{onClick:n,startIcon:Ce.createElement(l1e,{wallet:t}),tabIndex:e},t.adapter.name,t.readyState===It.Installed&&Ce.createElement("span",null,"Detected"))),u1e=()=>Ce.createElement("svg",{width:"97",height:"96",viewBox:"0 0 97 96",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Ce.createElement("circle",{cx:"48.5",cy:"48",r:"48",fill:"url(#paint0_linear_880_5115)",fillOpacity:"0.1"}),Ce.createElement("circle",{cx:"48.5",cy:"48",r:"47",stroke:"url(#paint1_linear_880_5115)",strokeOpacity:"0.4",strokeWidth:"2"}),Ce.createElement("g",{clipPath:"url(#clip0_880_5115)"},Ce.createElement("path",{d:"M65.5769 28.1523H31.4231C27.6057 28.1523 24.5 31.258 24.5 35.0754V60.9215C24.5 64.7389 27.6057 67.8446 31.4231 67.8446H65.5769C69.3943 67.8446 72.5 64.7389 72.5 60.9215V35.0754C72.5 31.258 69.3943 28.1523 65.5769 28.1523ZM69.7308 52.1523H59.5769C57.2865 52.1523 55.4231 50.289 55.4231 47.9985C55.4231 45.708 57.2864 43.8446 59.5769 43.8446H69.7308V52.1523ZM69.7308 41.0754H59.5769C55.7595 41.0754 52.6539 44.1811 52.6539 47.9985C52.6539 51.8159 55.7595 54.9215 59.5769 54.9215H69.7308V60.9215C69.7308 63.2119 67.8674 65.0754 65.5769 65.0754H31.4231C29.1327 65.0754 27.2692 63.212 27.2692 60.9215V35.0754C27.2692 32.785 29.1326 30.9215 31.4231 30.9215H65.5769C67.8673 30.9215 69.7308 32.7849 69.7308 35.0754V41.0754Z",fill:"url(#paint2_linear_880_5115)"}),Ce.createElement("path",{d:"M61.4231 46.6172H59.577C58.8123 46.6172 58.1924 47.2371 58.1924 48.0018C58.1924 48.7665 58.8123 49.3863 59.577 49.3863H61.4231C62.1878 49.3863 62.8077 48.7664 62.8077 48.0018C62.8077 47.2371 62.1878 46.6172 61.4231 46.6172Z",fill:"url(#paint3_linear_880_5115)"})),Ce.createElement("defs",null,Ce.createElement("linearGradient",{id:"paint0_linear_880_5115",x1:"3.41664",y1:"98.0933",x2:"103.05",y2:"8.42498",gradientUnits:"userSpaceOnUse"},Ce.createElement("stop",{stopColor:"#9945FF"}),Ce.createElement("stop",{offset:"0.14",stopColor:"#8A53F4"}),Ce.createElement("stop",{offset:"0.42",stopColor:"#6377D6"}),Ce.createElement("stop",{offset:"0.79",stopColor:"#24B0A7"}),Ce.createElement("stop",{offset:"0.99",stopColor:"#00D18C"}),Ce.createElement("stop",{offset:"1",stopColor:"#00D18C"})),Ce.createElement("linearGradient",{id:"paint1_linear_880_5115",x1:"3.41664",y1:"98.0933",x2:"103.05",y2:"8.42498",gradientUnits:"userSpaceOnUse"},Ce.createElement("stop",{stopColor:"#9945FF"}),Ce.createElement("stop",{offset:"0.14",stopColor:"#8A53F4"}),Ce.createElement("stop",{offset:"0.42",stopColor:"#6377D6"}),Ce.createElement("stop",{offset:"0.79",stopColor:"#24B0A7"}),Ce.createElement("stop",{offset:"0.99",stopColor:"#00D18C"}),Ce.createElement("stop",{offset:"1",stopColor:"#00D18C"})),Ce.createElement("linearGradient",{id:"paint2_linear_880_5115",x1:"25.9583",y1:"68.7101",x2:"67.2337",y2:"23.7879",gradientUnits:"userSpaceOnUse"},Ce.createElement("stop",{stopColor:"#9945FF"}),Ce.createElement("stop",{offset:"0.14",stopColor:"#8A53F4"}),Ce.createElement("stop",{offset:"0.42",stopColor:"#6377D6"}),Ce.createElement("stop",{offset:"0.79",stopColor:"#24B0A7"}),Ce.createElement("stop",{offset:"0.99",stopColor:"#00D18C"}),Ce.createElement("stop",{offset:"1",stopColor:"#00D18C"})),Ce.createElement("linearGradient",{id:"paint3_linear_880_5115",x1:"58.3326",y1:"49.4467",x2:"61.0002",y2:"45.4453",gradientUnits:"userSpaceOnUse"},Ce.createElement("stop",{stopColor:"#9945FF"}),Ce.createElement("stop",{offset:"0.14",stopColor:"#8A53F4"}),Ce.createElement("stop",{offset:"0.42",stopColor:"#6377D6"}),Ce.createElement("stop",{offset:"0.79",stopColor:"#24B0A7"}),Ce.createElement("stop",{offset:"0.99",stopColor:"#00D18C"}),Ce.createElement("stop",{offset:"1",stopColor:"#00D18C"})),Ce.createElement("clipPath",{id:"clip0_880_5115"},Ce.createElement("rect",{width:"48",height:"48",fill:"white",transform:"translate(24.5 24)"})))),d1e=({className:n="",container:e="body"})=>{const t=P.useRef(null),{wallets:r,select:i}=fve(),{setVisible:s}=a1e(),[o,a]=P.useState(!1),[c,u]=P.useState(!1),[d,f]=P.useState(null),[g,m]=P.useMemo(()=>{const E=[],M=[];for(const j of r)j.readyState===It.Installed?E.push(j):M.push(j);return E.length?[E,M]:[M,[]]},[r]),v=P.useCallback(()=>{u(!1),setTimeout(()=>s(!1),150)},[s]),w=P.useCallback(E=>{E.preventDefault(),v()},[v]),S=P.useCallback((E,M)=>{i(M),w(E)},[i,w]),b=P.useCallback(()=>a(!o),[o]),x=P.useCallback(E=>{const M=t.current;if(!M)return;const j=M.querySelectorAll("button"),D=j[0],H=j[j.length-1];E.shiftKey?document.activeElement===D&&(H.focus(),E.preventDefault()):document.activeElement===H&&(D.focus(),E.preventDefault())},[t]);return P.useLayoutEffect(()=>{const E=j=>{j.key==="Escape"?v():j.key==="Tab"&&x(j)},{overflow:M}=window.getComputedStyle(document.body);return setTimeout(()=>u(!0),0),document.body.style.overflow="hidden",window.addEventListener("keydown",E,!1),()=>{document.body.style.overflow=M,window.removeEventListener("keydown",E,!1)}},[v,x]),P.useLayoutEffect(()=>f(document.querySelector(e)),[e]),d&&wl.createPortal(Ce.createElement("div",{"aria-labelledby":"wallet-adapter-modal-title","aria-modal":"true",className:`wallet-adapter-modal ${c&&"wallet-adapter-modal-fade-in"} ${n}`,ref:t,role:"dialog"},Ce.createElement("div",{className:"wallet-adapter-modal-container"},Ce.createElement("div",{className:"wallet-adapter-modal-wrapper"},Ce.createElement("button",{onClick:w,className:"wallet-adapter-modal-button-close"},Ce.createElement("svg",{width:"14",height:"14"},Ce.createElement("path",{d:"M14 12.461 8.3 6.772l5.234-5.233L12.006 0 6.772 5.234 1.54 0 0 1.539l5.234 5.233L0 12.006l1.539 1.528L6.772 8.3l5.69 5.7L14 12.461z"}))),g.length?Ce.createElement(Ce.Fragment,null,Ce.createElement("h1",{className:"wallet-adapter-modal-title"},"Connect a wallet on Solana to continue"),Ce.createElement("ul",{className:"wallet-adapter-modal-list"},g.map(E=>Ce.createElement(eI,{key:E.adapter.name,handleClick:M=>S(M,E.adapter.name),wallet:E})),m.length?Ce.createElement(P4,{expanded:o,id:"wallet-adapter-modal-collapse"},m.map(E=>Ce.createElement(eI,{key:E.adapter.name,handleClick:M=>S(M,E.adapter.name),tabIndex:o?0:-1,wallet:E}))):null),m.length?Ce.createElement("button",{className:"wallet-adapter-modal-list-more",onClick:b,tabIndex:0},Ce.createElement("span",null,o?"Less ":"More ","options"),Ce.createElement("svg",{width:"13",height:"7",viewBox:"0 0 13 7",xmlns:"http://www.w3.org/2000/svg",className:`${o?"wallet-adapter-modal-list-more-icon-rotate":""}`},Ce.createElement("path",{d:"M0.71418 1.626L5.83323 6.26188C5.91574 6.33657 6.0181 6.39652 6.13327 6.43762C6.24844 6.47872 6.37371 6.5 6.50048 6.5C6.62725 6.5 6.75252 6.47872 6.8677 6.43762C6.98287 6.39652 7.08523 6.33657 7.16774 6.26188L12.2868 1.626C12.7753 1.1835 12.3703 0.5 11.6195 0.5H1.37997C0.629216 0.5 0.224175 1.1835 0.71418 1.626Z"}))):null):Ce.createElement(Ce.Fragment,null,Ce.createElement("h1",{className:"wallet-adapter-modal-title"},"You'll need a wallet on Solana to continue"),Ce.createElement("div",{className:"wallet-adapter-modal-middle"},Ce.createElement(u1e,null)),m.length?Ce.createElement(Ce.Fragment,null,Ce.createElement("button",{className:"wallet-adapter-modal-list-more",onClick:b,tabIndex:0},Ce.createElement("span",null,o?"Hide ":"Already have a wallet? View ","options"),Ce.createElement("svg",{width:"13",height:"7",viewBox:"0 0 13 7",xmlns:"http://www.w3.org/2000/svg",className:`${o?"wallet-adapter-modal-list-more-icon-rotate":""}`},Ce.createElement("path",{d:"M0.71418 1.626L5.83323 6.26188C5.91574 6.33657 6.0181 6.39652 6.13327 6.43762C6.24844 6.47872 6.37371 6.5 6.50048 6.5C6.62725 6.5 6.75252 6.47872 6.8677 6.43762C6.98287 6.39652 7.08523 6.33657 7.16774 6.26188L12.2868 1.626C12.7753 1.1835 12.3703 0.5 11.6195 0.5H1.37997C0.629216 0.5 0.224175 1.1835 0.71418 1.626Z"}))),Ce.createElement(P4,{expanded:o,id:"wallet-adapter-modal-collapse"},Ce.createElement("ul",{className:"wallet-adapter-modal-list"},m.map(E=>Ce.createElement(eI,{key:E.adapter.name,handleClick:M=>S(M,E.adapter.name),tabIndex:o?0:-1,wallet:E}))))):null))),Ce.createElement("div",{className:"wallet-adapter-modal-overlay",onMouseDown:w})),d)},h1e=({children:n,...e})=>{const[t,r]=P.useState(!1);return Ce.createElement(wH.Provider,{value:{visible:t,setVisible:r}},n,t&&Ce.createElement(d1e,{...e}))},f1e="modulepreload",p1e=function(n){return"/"+n},M4={},vH=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=p1e(c),c in M4)return;M4[c]=!0;const u=c.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":f1e,u||(f.as="script"),f.crossOrigin="",f.href=c,a&&f.setAttribute("nonce",a),document.head.appendChild(f),u)return new Promise((g,m)=>{f.addEventListener("load",g),f.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},g1e="Phantom";class m1e extends sM{constructor(e={}){super(),this.name=g1e,this.url="https://phantom.app",this.icon="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDgiIGhlaWdodD0iMTA4IiB2aWV3Qm94PSIwIDAgMTA4IDEwOCIgZmlsbD0ibm9uZSI+CjxyZWN0IHdpZHRoPSIxMDgiIGhlaWdodD0iMTA4IiByeD0iMjYiIGZpbGw9IiNBQjlGRjIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik00Ni41MjY3IDY5LjkyMjlDNDIuMDA1NCA3Ni44NTA5IDM0LjQyOTIgODUuNjE4MiAyNC4zNDggODUuNjE4MkMxOS41ODI0IDg1LjYxODIgMTUgODMuNjU2MyAxNSA3NS4xMzQyQzE1IDUzLjQzMDUgNDQuNjMyNiAxOS44MzI3IDcyLjEyNjggMTkuODMyN0M4Ny43NjggMTkuODMyNyA5NCAzMC42ODQ2IDk0IDQzLjAwNzlDOTQgNTguODI1OCA4My43MzU1IDc2LjkxMjIgNzMuNTMyMSA3Ni45MTIyQzcwLjI5MzkgNzYuOTEyMiA2OC43MDUzIDc1LjEzNDIgNjguNzA1MyA3Mi4zMTRDNjguNzA1MyA3MS41NzgzIDY4LjgyNzUgNzAuNzgxMiA2OS4wNzE5IDY5LjkyMjlDNjUuNTg5MyA3NS44Njk5IDU4Ljg2ODUgODEuMzg3OCA1Mi41NzU0IDgxLjM4NzhDNDcuOTkzIDgxLjM4NzggNDUuNjcxMyA3OC41MDYzIDQ1LjY3MTMgNzQuNDU5OEM0NS42NzEzIDcyLjk4ODQgNDUuOTc2OCA3MS40NTU2IDQ2LjUyNjcgNjkuOTIyOVpNODMuNjc2MSA0Mi41Nzk0QzgzLjY3NjEgNDYuMTcwNCA4MS41NTc1IDQ3Ljk2NTggNzkuMTg3NSA0Ny45NjU4Qzc2Ljc4MTYgNDcuOTY1OCA3NC42OTg5IDQ2LjE3MDQgNzQuNjk4OSA0Mi41Nzk0Qzc0LjY5ODkgMzguOTg4NSA3Ni43ODE2IDM3LjE5MzEgNzkuMTg3NSAzNy4xOTMxQzgxLjU1NzUgMzcuMTkzMSA4My42NzYxIDM4Ljk4ODUgODMuNjc2MSA0Mi41Nzk0Wk03MC4yMTAzIDQyLjU3OTVDNzAuMjEwMyA0Ni4xNzA0IDY4LjA5MTYgNDcuOTY1OCA2NS43MjE2IDQ3Ljk2NThDNjMuMzE1NyA0Ny45NjU4IDYxLjIzMyA0Ni4xNzA0IDYxLjIzMyA0Mi41Nzk1QzYxLjIzMyAzOC45ODg1IDYzLjMxNTcgMzcuMTkzMSA2NS43MjE2IDM3LjE5MzFDNjguMDkxNiAzNy4xOTMxIDcwLjIxMDMgMzguOTg4NSA3MC4yMTAzIDQyLjU3OTVaIiBmaWxsPSIjRkZGREY4Ii8+Cjwvc3ZnPg==",this.supportedTransactionVersions=new Set(["legacy",0]),this._readyState=typeof window>"u"||typeof document>"u"?It.Unsupported:It.NotDetected,this._disconnected=()=>{const t=this._wallet;t&&(t.off("disconnect",this._disconnected),t.off("accountChanged",this._accountChanged),this._wallet=null,this._publicKey=null,this.emit("error",new uv),this.emit("disconnect"))},this._accountChanged=t=>{const r=this._publicKey;if(r){try{t=new lt(t.toBytes())}catch(i){this.emit("error",new bh(i==null?void 0:i.message,i));return}r.equals(t)||(this._publicKey=t,this.emit("connect",t))}},this._connecting=!1,this._wallet=null,this._publicKey=null,this._readyState!==It.Unsupported&&(qE()?(this._readyState=It.Loadable,this.emit("readyStateChange",this._readyState)):nH(()=>{var t,r,i;return(r=(t=window.phantom)==null?void 0:t.solana)!=null&&r.isPhantom||(i=window.solana)!=null&&i.isPhantom?(this._readyState=It.Installed,this.emit("readyStateChange",this._readyState),!0):!1}))}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get readyState(){return this._readyState}async autoConnect(){this.readyState===It.Installed&&await this.connect()}async connect(){var e;try{if(this.connected||this.connecting)return;if(this.readyState===It.Loadable){const i=encodeURIComponent(window.location.href),s=encodeURIComponent(window.location.origin);window.location.href=`https://phantom.app/ul/browse/${i}?ref=${s}`;return}if(this.readyState!==It.Installed)throw new pl;this._connecting=!0;const t=((e=window.phantom)==null?void 0:e.solana)||window.solana;if(!t.isConnected)try{await t.connect()}catch(i){throw new cl(i==null?void 0:i.message,i)}if(!t.publicKey)throw new hu;let r;try{r=new lt(t.publicKey.toBytes())}catch(i){throw new bh(i==null?void 0:i.message,i)}t.on("disconnect",this._disconnected),t.on("accountChanged",this._accountChanged),this._wallet=t,this._publicKey=r,this.emit("connect",r)}catch(t){throw this.emit("error",t),t}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){e.off("disconnect",this._disconnected),e.off("accountChanged",this._accountChanged),this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(t){this.emit("error",new iM(t==null?void 0:t.message,t))}}this.emit("disconnect")}async sendTransaction(e,t,r={}){try{const i=this._wallet;if(!i)throw new wr;try{const{signers:s,...o}=r;rc(e)?s!=null&&s.length&&e.sign(s):(e=await this.prepareTransaction(e,t,o),s!=null&&s.length&&e.partialSign(...s)),o.preflightCommitment=o.preflightCommitment||t.commitment;const{signature:a}=await i.signAndSendTransaction(e,o);return a}catch(s){throw s instanceof Br?s:new nc(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signTransaction(e){try{const t=this._wallet;if(!t)throw new wr;try{return await t.signTransaction(e)||e}catch(r){throw new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}async signAllTransactions(e){try{const t=this._wallet;if(!t)throw new wr;try{return await t.signAllTransactions(e)||e}catch(r){throw new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}async signMessage(e){try{const t=this._wallet;if(!t)throw new wr;try{const{signature:r}=await t.signMessage(e);return r}catch(r){throw new dv(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}}const y1e="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjMxIiB2aWV3Qm94PSIwIDAgMzEgMzEiIHdpZHRoPSIzMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGxpbmVhckdyYWRpZW50IGlkPSJhIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjIwLjI1IiB4Mj0iMjYuNTcxIiB5MT0iMjcuMTczIiB5Mj0iMTkuODU4Ij48c3RvcCBvZmZzZXQ9Ii4wOCIgc3RvcC1jb2xvcj0iIzk5NDVmZiIvPjxzdG9wIG9mZnNldD0iLjMiIHN0b3AtY29sb3I9IiM4NzUyZjMiLz48c3RvcCBvZmZzZXQ9Ii41IiBzdG9wLWNvbG9yPSIjNTQ5N2Q1Ii8+PHN0b3Agb2Zmc2V0PSIuNiIgc3RvcC1jb2xvcj0iIzQzYjRjYSIvPjxzdG9wIG9mZnNldD0iLjcyIiBzdG9wLWNvbG9yPSIjMjhlMGI5Ii8+PHN0b3Agb2Zmc2V0PSIuOTciIHN0b3AtY29sb3I9IiMxOWZiOWIiLz48L2xpbmVhckdyYWRpZW50PjxnIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iLjA5NCI+PHBhdGggZD0ibTI2LjEwOSAzLjY0My05LjM2OSA2Ljk1OSAxLjczMy00LjEwNSA3LjYzNy0yLjg1M3oiIGZpbGw9IiNlMjc2MWIiIHN0cm9rZT0iI2UyNzYxYiIvPjxnIGZpbGw9IiNlNDc2MWIiIHN0cm9rZT0iI2U0NzYxYiI+PHBhdGggZD0ibTQuNDgxIDMuNjQzIDkuMjk0IDcuMDI0LTEuNjQ4LTQuMTcxem0xOC4yNTggMTYuMTMtMi40OTUgMy44MjMgNS4zMzkgMS40NjkgMS41MzUtNS4yMDctNC4zNzgtLjA4NXptLTE5LjI0Ny4wODUgMS41MjUgNS4yMDcgNS4zMzktMS40NjktMi40OTUtMy44MjN6Ii8+PHBhdGggZD0ibTEwLjA1NSAxMy4zMTMtMS40ODggMi4yNTEgNS4zMDEuMjM1LS4xODgtNS42OTd6bTEwLjQ4IDAtMy42NzItMy4yNzctLjEyMiA1Ljc2MyA1LjI5Mi0uMjM1LTEuNDk3LTIuMjUxem0tMTAuMTc4IDEwLjI4MyAzLjE4My0xLjU1NC0yLjc0OS0yLjE0Ny0uNDMzIDMuNzAxem02LjY5NS0xLjU1NCAzLjE5MiAxLjU1NC0uNDQzLTMuNzAxeiIvPjwvZz48cGF0aCBkPSJtMjAuMjQ0IDIzLjU5Ni0zLjE5Mi0xLjU1NC4yNTQgMi4wODEtLjAyOC44NzZ6bS05Ljg4NyAwIDIuOTY2IDEuNDAzLS4wMTktLjg3Ni4yMzUtMi4wODEtMy4xODMgMS41NTR6IiBmaWxsPSIjZDdjMWIzIiBzdHJva2U9IiNkN2MxYjMiLz48cGF0aCBkPSJtMTMuMzY5IDE4LjUyMS0yLjY1NS0uNzgxIDEuODc0LS44NTd6bTMuODUxIDAgLjc4MS0xLjYzOCAxLjg4My44NTctMi42NjUuNzgxeiIgZmlsbD0iIzIzMzQ0NyIgc3Ryb2tlPSIjMjMzNDQ3Ii8+PHBhdGggZD0ibTEwLjM1NyAyMy41OTYuNDUyLTMuODIzLTIuOTQ3LjA4NXptOS40MzUtMy44MjMuNDUyIDMuODIzIDIuNDk1LTMuNzM4em0yLjI0MS00LjIwOS01LjI5Mi4yMzUuNDkgMi43MjEuNzgyLTEuNjM4IDEuODgzLjg1N3ptLTExLjMxOCAyLjE3NSAxLjg4My0uODU3Ljc3MiAxLjYzOC40OTktMi43MjEtNS4zMDEtLjIzNXoiIGZpbGw9IiNjZDYxMTYiIHN0cm9rZT0iI2NkNjExNiIvPjxwYXRoIGQ9Im04LjU2NyAxNS41NjQgMi4yMjIgNC4zMzEtLjA3NS0yLjE1NnptMTEuMzI4IDIuMTc1LS4wOTQgMi4xNTYgMi4yMzItNC4zMzEtMi4xMzcgMi4xNzV6bS02LjAyNi0xLjk0LS40OTkgMi43MjEuNjIxIDMuMjExLjE0MS00LjIyOC0uMjY0LTEuNzA0em0yLjg3MiAwLS4yNTQgMS42OTUuMTEzIDQuMjM3LjYzMS0zLjIxMXoiIGZpbGw9IiNlNDc1MWYiIHN0cm9rZT0iI2U0NzUxZiIvPjxwYXRoIGQ9Im0xNy4yMyAxOC41Mi0uNjMxIDMuMjExLjQ1Mi4zMTEgMi43NS0yLjE0Ny4wOTQtMi4xNTZ6bS02LjUxNi0uNzgxLjA3NSAyLjE1NiAyLjc1IDIuMTQ3LjQ1Mi0uMzExLS42MjItMy4yMTF6IiBmaWxsPSIjZjY4NTFiIiBzdHJva2U9IiNmNjg1MWIiLz48cGF0aCBkPSJtMTcuMjc3IDI0Ljk5OS4wMjgtLjg3Ni0uMjM1LS4yMDdoLTMuNTVsLS4yMTcuMjA3LjAxOS44NzYtMi45NjYtMS40MDMgMS4wMzYuODQ4IDIuMSAxLjQ1OWgzLjYwNmwyLjEwOS0xLjQ1OSAxLjAzNi0uODQ4eiIgZmlsbD0iI2MwYWQ5ZSIgc3Ryb2tlPSIjYzBhZDllIi8+PHBhdGggZD0ibTE3LjA1MSAyMi4wNDItLjQ1Mi0uMzExaC0yLjYwOGwtLjQ1Mi4zMTEtLjIzNSAyLjA4MS4yMTctLjIwN2gzLjU1bC4yMzUuMjA3LS4yNTQtMi4wODF6IiBmaWxsPSIjMTYxNjE2IiBzdHJva2U9IiMxNjE2MTYiLz48cGF0aCBkPSJtMjYuNTA1IDExLjA1My44LTMuODQyLTEuMTk2LTMuNTY5LTkuMDU4IDYuNzIzIDMuNDg0IDIuOTQ3IDQuOTI1IDEuNDQxIDEuMDkyLTEuMjcxLS40NzEtLjMzOS43NTMtLjY4Ny0uNTg0LS40NTIuNzUzLS41NzQtLjQ5OS0uMzc3em0tMjMuMjExLTMuODQxLjggMy44NDItLjUwOC4zNzcuNzUzLjU3NC0uNTc0LjQ1Mi43NTMuNjg3LS40NzEuMzM5IDEuMDgzIDEuMjcxIDQuOTI1LTEuNDQxIDMuNDg0LTIuOTQ3LTkuMDU5LTYuNzIzeiIgZmlsbD0iIzc2M2QxNiIgc3Ryb2tlPSIjNzYzZDE2Ii8+PHBhdGggZD0ibTI1LjQ2IDE0Ljc1NC00LjkyNS0xLjQ0MSAxLjQ5NyAyLjI1MS0yLjIzMiA0LjMzMSAyLjkzOC0uMDM4aDQuMzc4bC0xLjY1Ny01LjEwNHptLTE1LjQwNS0xLjQ0MS00LjkyNSAxLjQ0MS0xLjYzOCA1LjEwNGg0LjM2OWwyLjkyOC4wMzgtMi4yMjItNC4zMzEgMS40ODgtMi4yNTF6bTYuNjg1IDIuNDg2LjMxMS01LjQzMyAxLjQzMS0zLjg3aC02LjM1NmwxLjQxMyAzLjg3LjMyOSA1LjQzMy4xMTMgMS43MTQuMDA5IDQuMjE5aDIuNjFsLjAxOS00LjIxOS4xMjItMS43MTR6IiBmaWxsPSIjZjY4NTFiIiBzdHJva2U9IiNmNjg1MWIiLz48L2c+PGNpcmNsZSBjeD0iMjMuNSIgY3k9IjIzLjUiIGZpbGw9IiMwMDAiIHI9IjYuNSIvPjxwYXRoIGQ9Im0yNy40NzMgMjUuNTQ1LTEuMzEgMS4zNjhjLS4wMjkuMDMtLjA2My4wNTMtLjEwMS4wN2EuMzEuMzEgMCAwIDEgLS4xMjEuMDI0aC02LjIwOWMtLjAzIDAtLjA1OS0uMDA4LS4wODMtLjAyNGEuMTUuMTUgMCAwIDEgLS4wNTYtLjA2NWMtLjAxMi0uMDI2LS4wMTUtLjA1Ni0uMDEtLjA4NHMuMDE4LS4wNTUuMDM5LS4wNzZsMS4zMTEtMS4zNjhjLjAyOC0uMDMuMDYzLS4wNTMuMTAxLS4wNjlhLjMxLjMxIDAgMCAxIC4xMjEtLjAyNWg2LjIwOGMuMDMgMCAuMDU5LjAwOC4wODMuMDI0YS4xNS4xNSAwIDAgMSAuMDU2LjA2NWMuMDEyLjAyNi4wMTUuMDU2LjAxLjA4NHMtLjAxOC4wNTUtLjAzOS4wNzZ6bS0xLjMxLTIuNzU2Yy0uMDI5LS4wMy0uMDYzLS4wNTMtLjEwMS0uMDdhLjMxLjMxIDAgMCAwIC0uMTIxLS4wMjRoLTYuMjA5Yy0uMDMgMC0uMDU5LjAwOC0uMDgzLjAyNHMtLjA0NC4wMzgtLjA1Ni4wNjUtLjAxNS4wNTYtLjAxLjA4NC4wMTguMDU1LjAzOS4wNzZsMS4zMTEgMS4zNjhjLjAyOC4wMy4wNjMuMDUzLjEwMS4wNjlhLjMxLjMxIDAgMCAwIC4xMjEuMDI1aDYuMjA4Yy4wMyAwIC4wNTktLjAwOC4wODMtLjAyNGEuMTUuMTUgMCAwIDAgLjA1Ni0uMDY1Yy4wMTItLjAyNi4wMTUtLjA1Ni4wMS0uMDg0cy0uMDE4LS4wNTUtLjAzOS0uMDc2em0tNi40MzEtLjk4M2g2LjIwOWEuMzEuMzEgMCAwIDAgLjEyMS0uMDI0Yy4wMzgtLjAxNi4wNzMtLjA0LjEwMS0uMDdsMS4zMS0xLjM2OGMuMDItLjAyMS4wMzQtLjA0Ny4wMzktLjA3NnMuMDAxLS4wNTgtLjAxLS4wODRhLjE1LjE1IDAgMCAwIC0uMDU2LS4wNjVjLS4wMjUtLjAxNi0uMDU0LS4wMjQtLjA4My0uMDI0aC02LjIwOGEuMzEuMzEgMCAwIDAgLS4xMjEuMDI1Yy0uMDM4LjAxNi0uMDcyLjA0LS4xMDEuMDY5bC0xLjMxIDEuMzY4Yy0uMDIuMDIxLS4wMzQuMDQ3LS4wMzkuMDc2cy0uMDAxLjA1OC4wMS4wODQuMDMxLjA0OS4wNTYuMDY1LjA1NC4wMjQuMDgzLjAyNHoiIGZpbGw9InVybCgjYSkiLz48L3N2Zz4=";var gn=function(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)},w1e=function(n,e,t,r,i){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?n!==e||!i:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?i.call(n,t):i?i.value=t:e.set(n,t),t},Gy,mu,eC,tC,nC,mi,rC,SH,xH,iC,sC,oC,aC,cC;class v1e{constructor(){Gy.add(this),mu.set(this,{}),eC.set(this,"1.0.0"),tC.set(this,"MetaMask"),nC.set(this,y1e),mi.set(this,null),rC.set(this,(e,t)=>{var r;return(r=gn(this,mu,"f")[e])!=null&&r.push(t)||(gn(this,mu,"f")[e]=[t]),()=>gn(this,Gy,"m",xH).call(this,e,t)}),iC.set(this,async()=>{if(!gn(this,mi,"f")){let e;try{e=(await vH(async()=>{const{default:t}=await import("./index-BVijsvWH.js");return{default:t}},[])).default}catch{throw new Error("Unable to load Solflare MetaMask SDK")}w1e(this,mi,new e,"f"),gn(this,mi,"f").on("standard_change",t=>gn(this,Gy,"m",SH).call(this,"change",t))}return this.accounts.length||await gn(this,mi,"f").connect(),{accounts:this.accounts}}),sC.set(this,async()=>{gn(this,mi,"f")&&await gn(this,mi,"f").disconnect()}),oC.set(this,async(...e)=>{if(!gn(this,mi,"f"))throw new wr;return await gn(this,mi,"f").standardSignAndSendTransaction(...e)}),aC.set(this,async(...e)=>{if(!gn(this,mi,"f"))throw new wr;return await gn(this,mi,"f").standardSignTransaction(...e)}),cC.set(this,async(...e)=>{if(!gn(this,mi,"f"))throw new wr;return await gn(this,mi,"f").standardSignMessage(...e)})}get version(){return gn(this,eC,"f")}get name(){return gn(this,tC,"f")}get icon(){return gn(this,nC,"f")}get chains(){return[VE,iH,sH]}get features(){return{[oM]:{version:"1.0.0",connect:gn(this,iC,"f")},[GE]:{version:"1.0.0",disconnect:gn(this,sC,"f")},[aM]:{version:"1.0.0",on:gn(this,rC,"f")},[Ja]:{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:gn(this,oC,"f")},[Dr]:{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:gn(this,aC,"f")},[zd]:{version:"1.0.0",signMessage:gn(this,cC,"f")}}}get accounts(){return gn(this,mi,"f")?gn(this,mi,"f").standardAccounts:[]}}mu=new WeakMap,eC=new WeakMap,tC=new WeakMap,nC=new WeakMap,mi=new WeakMap,rC=new WeakMap,iC=new WeakMap,sC=new WeakMap,oC=new WeakMap,aC=new WeakMap,cC=new WeakMap,Gy=new WeakSet,SH=function(e,...t){var r;(r=gn(this,mu,"f")[e])==null||r.forEach(i=>i.apply(null,t))},xH=function(e,t){var r;gn(this,mu,"f")[e]=(r=gn(this,mu,"f")[e])==null?void 0:r.filter(i=>t!==i)};let T4=!1;function S1e(){T4||(DSe(new v1e),T4=!0)}async function x1e(){const n="solflare-detect-metamask";function e(){window.postMessage({target:"metamask-contentscript",data:{name:"metamask-provider",data:{id:n,jsonrpc:"2.0",method:"wallet_getSnaps"}}},window.location.origin)}function t(r){var s,o;const i=r.data;(i==null?void 0:i.target)==="metamask-inpage"&&((s=i.data)==null?void 0:s.name)==="metamask-provider"&&(((o=i.data.data)==null?void 0:o.id)===n?(window.removeEventListener("message",t),i.data.data.error||S1e()):e())}window.addEventListener("message",t),window.setTimeout(()=>window.removeEventListener("message",t),5e3),e()}const b1e="Solflare";class _1e extends sM{constructor(e={}){super(),this.name=b1e,this.url="https://solflare.com",this.icon="data:image/svg+xml;base64,PHN2ZyBmaWxsPSJub25lIiBoZWlnaHQ9IjUwIiB2aWV3Qm94PSIwIDAgNTAgNTAiIHdpZHRoPSI1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+PGxpbmVhckdyYWRpZW50IGlkPSJhIj48c3RvcCBvZmZzZXQ9IjAiIHN0b3AtY29sb3I9IiNmZmMxMGIiLz48c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiNmYjNmMmUiLz48L2xpbmVhckdyYWRpZW50PjxsaW5lYXJHcmFkaWVudCBpZD0iYiIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHgxPSI2LjQ3ODM1IiB4Mj0iMzQuOTEwNyIgeGxpbms6aHJlZj0iI2EiIHkxPSI3LjkyIiB5Mj0iMzMuNjU5MyIvPjxyYWRpYWxHcmFkaWVudCBpZD0iYyIgY3g9IjAiIGN5PSIwIiBncmFkaWVudFRyYW5zZm9ybT0ibWF0cml4KDQuOTkyMTg4MzIgMTIuMDYzODc5NjMgLTEyLjE4MTEzNjU1IDUuMDQwNzEwNzQgMjIuNTIwMiAyMC42MTgzKSIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiIHI9IjEiIHhsaW5rOmhyZWY9IiNhIi8+PHBhdGggZD0ibTI1LjE3MDggNDcuOTEwNGMuNTI1IDAgLjk1MDcuNDIxLjk1MDcuOTQwM3MtLjQyNTcuOTQwMi0uOTUwNy45NDAyLS45NTA3LS40MjA5LS45NTA3LS45NDAyLjQyNTctLjk0MDMuOTUwNy0uOTQwM3ptLTEuMDMyOC00NC45MTU2NWMuNDY0Ni4wMzgzNi44Mzk4LjM5MDQuOTAyNy44NDY4MWwxLjEzMDcgOC4yMTU3NGMuMzc5OCAyLjcxNDMgMy42NTM1IDMuODkwNCA1LjY3NDMgMi4wNDU5bDExLjMyOTEtMTAuMzExNThjLjI3MzMtLjI0ODczLjY5ODktLjIzMTQ5Ljk1MDcuMDM4NTEuMjMwOS4yNDc3Mi4yMzc5LjYyNjk3LjAxNjEuODgyNzdsLTkuODc5MSAxMS4zOTU4Yy0xLjgxODcgMi4wOTQyLS40NzY4IDUuMzY0MyAyLjI5NTYgNS41OTc4bDguNzE2OC44NDAzYy40MzQxLjA0MTguNzUxNy40MjM0LjcwOTMuODUyNC0uMDM0OS4zNTM3LS4zMDc0LjYzOTUtLjY2MjguNjk0OWwtOS4xNTk0IDEuNDMwMmMtMi42NTkzLjM2MjUtMy44NjM2IDMuNTExNy0yLjEzMzkgNS41NTc2bDMuMjIgMy43OTYxYy4yNTk0LjMwNTguMjE4OC43NjE1LS4wOTA4IDEuMDE3OC0uMjYyMi4yMTcyLS42NDE5LjIyNTYtLjkxMzguMDIwM2wtMy45Njk0LTIuOTk3OGMtMi4xNDIxLTEuNjEwOS01LjIyOTctLjI0MTctNS40NTYxIDIuNDI0M2wtLjg3NDcgMTAuMzk3NmMtLjAzNjIuNDI5NS0uNDE3OC43NDg3LS44NTI1LjcxMy0uMzY5LS4wMzAzLS42NjcxLS4zMDk3LS43MTcxLS42NzIxbC0xLjM4NzEtMTAuMDQzN2MtLjM3MTctMi43MTQ0LTMuNjQ1NC0zLjg5MDQtNS42NzQzLTIuMDQ1OWwtMTIuMDUxOTUgMTAuOTc0Yy0uMjQ5NDcuMjI3MS0uNjM4MDkuMjExNC0uODY4LS4wMzUtLjIxMDk0LS4yMjYyLS4yMTczNS0uNTcyNC0uMDE0OTMtLjgwNmwxMC41MTgxOC0xMi4xMzg1YzEuODE4Ny0yLjA5NDIuNDg0OS01LjM2NDQtMi4yODc2LTUuNTk3OGwtOC43MTg3Mi0uODQwNWMtLjQzNDEzLS4wNDE4LS43NTE3Mi0uNDIzNS0uNzA5MzYtLjg1MjQuMDM0OTMtLjM1MzcuMzA3MzktLjYzOTQuNjYyNy0uNjk1bDkuMTUzMzgtMS40Mjk5YzIuNjU5NC0uMzYyNSAzLjg3MTgtMy41MTE3IDIuMTQyMS01LjU1NzZsLTIuMTkyLTIuNTg0MWMtLjMyMTctLjM3OTItLjI3MTMtLjk0NDMuMTEyNi0xLjI2MjEuMzI1My0uMjY5NC43OTYzLS4yNzk3IDEuMTMzNC0uMDI0OWwyLjY5MTggMi4wMzQ3YzIuMTQyMSAxLjYxMDkgNS4yMjk3LjI0MTcgNS40NTYxLTIuNDI0M2wuNzI0MS04LjU1OTk4Yy4wNDU3LS41NDA4LjUyNjUtLjk0MjU3IDEuMDczOS0uODk3Mzd6bS0yMy4xODczMyAyMC40Mzk2NWMuNTI1MDQgMCAuOTUwNjcuNDIxLjk1MDY3Ljk0MDNzLS40MjU2My45NDAzLS45NTA2Ny45NDAzYy0uNTI1MDQxIDAtLjk1MDY3LS40MjEtLjk1MDY3LS45NDAzcy40MjU2MjktLjk0MDMuOTUwNjctLjk0MDN6bTQ3LjY3OTczLS45NTQ3Yy41MjUgMCAuOTUwNy40MjEuOTUwNy45NDAzcy0uNDI1Ny45NDAyLS45NTA3Ljk0MDItLjk1MDctLjQyMDktLjk1MDctLjk0MDIuNDI1Ny0uOTQwMy45NTA3LS45NDAzem0tMjQuNjI5Ni0yMi40Nzk3Yy41MjUgMCAuOTUwNi40MjA5NzMuOTUwNi45NDAyNyAwIC41MTkzLS40MjU2Ljk0MDI3LS45NTA2Ljk0MDI3LS41MjUxIDAtLjk1MDctLjQyMDk3LS45NTA3LS45NDAyNyAwLS41MTkyOTcuNDI1Ni0uOTQwMjcuOTUwNy0uOTQwMjd6IiBmaWxsPSJ1cmwoI2IpIi8+PHBhdGggZD0ibTI0LjU3MSAzMi43NzkyYzQuOTU5NiAwIDguOTgwMi0zLjk3NjUgOC45ODAyLTguODgxOSAwLTQuOTA1My00LjAyMDYtOC44ODE5LTguOTgwMi04Ljg4MTlzLTguOTgwMiAzLjk3NjYtOC45ODAyIDguODgxOWMwIDQuOTA1NCA0LjAyMDYgOC44ODE5IDguOTgwMiA4Ljg4MTl6IiBmaWxsPSJ1cmwoI2MpIi8+PC9zdmc+",this.supportedTransactionVersions=new Set(["legacy",0]),this._readyState=typeof window>"u"||typeof document>"u"?It.Unsupported:It.Loadable,this._disconnected=()=>{const t=this._wallet;t&&(t.off("disconnect",this._disconnected),this._wallet=null,this._publicKey=null,this.emit("error",new uv),this.emit("disconnect"))},this._accountChanged=t=>{if(!t)return;const r=this._publicKey;if(r){try{t=new lt(t.toBytes())}catch(i){this.emit("error",new bh(i==null?void 0:i.message,i));return}r.equals(t)||(this._publicKey=t,this.emit("connect",t))}},this._connecting=!1,this._publicKey=null,this._wallet=null,this._config=e,this._readyState!==It.Unsupported&&(nH(()=>{var t;return(t=window.solflare)!=null&&t.isSolflare||window.SolflareApp?(this._readyState=It.Installed,this.emit("readyStateChange",this._readyState),!0):!1}),x1e())}get publicKey(){return this._publicKey}get connecting(){return this._connecting}get connected(){var e;return!!((e=this._wallet)!=null&&e.connected)}get readyState(){return this._readyState}async autoConnect(){this.readyState===It.Loadable&&qE()||await this.connect()}async connect(){try{if(this.connected||this.connecting)return;if(this._readyState!==It.Loadable&&this._readyState!==It.Installed)throw new pl;if(this.readyState===It.Loadable&&qE()){const i=encodeURIComponent(window.location.href),s=encodeURIComponent(window.location.origin);window.location.href=`https://solflare.com/ul/v1/browse/${i}?ref=${s}`;return}let e;try{e=(await vH(async()=>{const{default:i}=await import("./index-D27unhor.js");return{default:i}},[])).default}catch(i){throw new cve(i==null?void 0:i.message,i)}let t;try{t=new e({network:this._config.network})}catch(i){throw new Xd(i==null?void 0:i.message,i)}if(this._connecting=!0,!t.connected)try{await t.connect()}catch(i){throw new cl(i==null?void 0:i.message,i)}if(!t.publicKey)throw new cl;let r;try{r=new lt(t.publicKey.toBytes())}catch(i){throw new bh(i==null?void 0:i.message,i)}t.on("disconnect",this._disconnected),t.on("accountChanged",this._accountChanged),this._wallet=t,this._publicKey=r,this.emit("connect",r)}catch(e){throw this.emit("error",e),e}finally{this._connecting=!1}}async disconnect(){const e=this._wallet;if(e){e.off("disconnect",this._disconnected),e.off("accountChanged",this._accountChanged),this._wallet=null,this._publicKey=null;try{await e.disconnect()}catch(t){this.emit("error",new iM(t==null?void 0:t.message,t))}}this.emit("disconnect")}async sendTransaction(e,t,r={}){try{const i=this._wallet;if(!i)throw new wr;try{const{signers:s,...o}=r;return rc(e)?s!=null&&s.length&&e.sign(s):(e=await this.prepareTransaction(e,t,o),s!=null&&s.length&&e.partialSign(...s)),o.preflightCommitment=o.preflightCommitment||t.commitment,await i.signAndSendTransaction(e,o)}catch(s){throw s instanceof Br?s:new nc(s==null?void 0:s.message,s)}}catch(i){throw this.emit("error",i),i}}async signTransaction(e){try{const t=this._wallet;if(!t)throw new wr;try{return await t.signTransaction(e)||e}catch(r){throw new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}async signAllTransactions(e){try{const t=this._wallet;if(!t)throw new wr;try{return await t.signAllTransactions(e)||e}catch(r){throw new Po(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}async signMessage(e){try{const t=this._wallet;if(!t)throw new wr;try{return await t.signMessage(e,"utf8")}catch(r){throw new dv(r==null?void 0:r.message,r)}}catch(t){throw this.emit("error",t),t}}}const I1e=({children:n})=>{const e="https://solana-mainnet.g.alchemy.com/v2/Wg9Tc7I748QirlQhtchfDSMpd0xr-cNg",t=P.useMemo(()=>[new m1e,new _1e],[]);return p.jsx(ave,{endpoint:e,children:p.jsx(o1e,{wallets:t,autoConnect:!0,children:p.jsx(h1e,{children:n})})})};window.Buffer=Ct.Buffer;A4.createRoot(document.getElementById("root")).render(p.jsx(I1e,{children:p.jsx(Lge,{})}));export{lt as P,Ja as S,_o as T,Op as V,Dr as a,Jve as b,zd as c,fs as g};
